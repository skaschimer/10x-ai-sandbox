{"version":3,"file":"Chat.2f049d04.js","sources":["../../../../../../src/lib/apis/streaming/index.ts","../../../../../../src/lib/components/common/Banner.svelte","../../../../../../src/lib/components/chat/MessageInput/PromptCommands.svelte","../../../../../../src/lib/components/chat/MessageInput/Documents.svelte","../../../../../../src/lib/components/chat/MessageInput/Models.svelte","../../../../../../src/lib/components/icons/XMark.svelte","../../../../../../src/lib/components/icons/DocumentArrowUpSolid.svelte","../../../../../../src/lib/components/icons/GlobeAltSolid.svelte","../../../../../../src/lib/components/icons/WrenchSolid.svelte","../../../../../../src/lib/components/chat/MessageInput/InputMenu.svelte","../../../../../../src/lib/components/icons/Headphone.svelte","../../../../../../src/lib/components/chat/MessageInput/VoiceRecording.svelte","../../../../../../src/lib/components/chat/MessageInput.svelte","../../../../../../src/lib/components/chat/ModelSelector.svelte","../../../../../../src/lib/components/layout/Navbar/Menu.svelte","../../../../../../src/lib/components/layout/Navbar.svelte","../../../../../../src/lib/components/chat/MessageInput/CallOverlay/VideoInputMenu.svelte","../../../../../../src/lib/components/chat/MessageInput/CallOverlay.svelte","../../../../../../src/lib/components/chat/Chat.svelte"],"sourcesContent":["import { EventSourceParserStream } from 'eventsource-parser/stream';\nimport type { ParsedEvent } from 'eventsource-parser';\n\ntype TextStreamUpdate = {\n\tdone: boolean;\n\tvalue: string;\n\t// eslint-disable-next-line @typescript-eslint/no-explicit-any\n\tcitations?: any;\n\t// eslint-disable-next-line @typescript-eslint/no-explicit-any\n\terror?: any;\n\tusage?: ResponseUsage;\n};\n\ntype ResponseUsage = {\n\t/** Including images and tools if any */\n\tprompt_tokens: number;\n\t/** The tokens generated */\n\tcompletion_tokens: number;\n\t/** Sum of the above two fields */\n\ttotal_tokens: number;\n};\n\n// createOpenAITextStream takes a responseBody with a SSE response,\n// and returns an async generator that emits delta updates with large deltas chunked into random sized chunks\nexport async function createOpenAITextStream(\n\tresponseBody: ReadableStream<Uint8Array>,\n\tsplitLargeDeltas: boolean\n): Promise<AsyncGenerator<TextStreamUpdate>> {\n\tconst eventStream = responseBody\n\t\t.pipeThrough(new TextDecoderStream())\n\t\t.pipeThrough(new EventSourceParserStream())\n\t\t.getReader();\n\tlet iterator = openAIStreamToIterator(eventStream);\n\tif (splitLargeDeltas) {\n\t\titerator = streamLargeDeltasAsRandomChunks(iterator);\n\t}\n\treturn iterator;\n}\n\nasync function* openAIStreamToIterator(\n\treader: ReadableStreamDefaultReader<ParsedEvent>\n): AsyncGenerator<TextStreamUpdate> {\n\twhile (true) {\n\t\tconst { value, done } = await reader.read();\n\t\tif (done) {\n\t\t\tyield { done: true, value: '' };\n\t\t\tbreak;\n\t\t}\n\t\tif (!value) {\n\t\t\tcontinue;\n\t\t}\n\t\tconst data = value.data;\n\t\tif (data.startsWith('[DONE]')) {\n\t\t\tyield { done: true, value: '' };\n\t\t\tbreak;\n\t\t}\n\n\t\ttry {\n\t\t\tconst parsedData = JSON.parse(data);\n\t\t\tconsole.log(parsedData);\n\n\t\t\tif (parsedData.error) {\n\t\t\t\tyield { done: true, value: '', error: parsedData.error };\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tif (parsedData.citations) {\n\t\t\t\tyield { done: false, value: '', citations: parsedData.citations };\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tyield {\n\t\t\t\tdone: false,\n\t\t\t\tvalue: parsedData.choices?.[0]?.delta?.content ?? '',\n\t\t\t\tusage: parsedData.usage\n\t\t\t};\n\t\t} catch (e) {\n\t\t\tconsole.error('Error extracting delta from SSE event:', e);\n\t\t}\n\t}\n}\n\n// streamLargeDeltasAsRandomChunks will chunk large deltas (length > 5) into random sized chunks between 1-3 characters\n// This is to simulate a more fluid streaming, even though some providers may send large chunks of text at once\nasync function* streamLargeDeltasAsRandomChunks(\n\titerator: AsyncGenerator<TextStreamUpdate>\n): AsyncGenerator<TextStreamUpdate> {\n\tfor await (const textStreamUpdate of iterator) {\n\t\tif (textStreamUpdate.done) {\n\t\t\tyield textStreamUpdate;\n\t\t\treturn;\n\t\t}\n\t\tif (textStreamUpdate.citations) {\n\t\t\tyield textStreamUpdate;\n\t\t\tcontinue;\n\t\t}\n\t\tlet content = textStreamUpdate.value;\n\t\tif (content.length < 5) {\n\t\t\tyield { done: false, value: content };\n\t\t\tcontinue;\n\t\t}\n\t\twhile (content != '') {\n\t\t\tconst chunkSize = Math.min(Math.floor(Math.random() * 3) + 1, content.length);\n\t\t\tconst chunk = content.slice(0, chunkSize);\n\t\t\tyield { done: false, value: chunk };\n\t\t\t// Do not sleep if the tab is hidden\n\t\t\t// Timers are throttled to 1s in hidden tabs\n\t\t\tif (document?.visibilityState !== 'hidden') {\n\t\t\t\tawait sleep(5);\n\t\t\t}\n\t\t\tcontent = content.slice(chunkSize);\n\t\t}\n\t}\n}\n\nconst sleep = (ms: number) => new Promise((resolve) => setTimeout(resolve, ms));\n","<script lang=\"ts\">\n\timport type { Banner } from '$lib/types';\n\timport { onMount, createEventDispatcher } from 'svelte';\n\timport { fade } from 'svelte/transition';\n\n\tconst dispatch = createEventDispatcher();\n\n\texport let banner: Banner = {\n\t\tid: '',\n\t\ttype: 'info',\n\t\ttitle: '',\n\t\tcontent: '',\n\t\turl: '',\n\t\tdismissable: true,\n\t\ttimestamp: Math.floor(Date.now() / 1000)\n\t};\n\n\texport let dismissed = false;\n\n\tlet mounted = false;\n\n\tconst classNames: Record<string, string> = {\n\t\tinfo: 'bg-blue-500/20 text-blue-700 dark:text-blue-200 ',\n\t\tsuccess: 'bg-green-500/20 text-green-700 dark:text-green-200',\n\t\twarning: 'bg-yellow-500/20 text-yellow-700 dark:text-yellow-200',\n\t\terror: 'bg-red-500/20 text-red-700 dark:text-red-200'\n\t};\n\n\tconst dismiss = (id) => {\n\t\tdismissed = true;\n\t\tdispatch('dismiss', id);\n\t};\n\n\tonMount(() => {\n\t\tmounted = true;\n\t});\n</script>\n\n{#if !dismissed}\n\t{#if mounted}\n\t\t<div\n\t\t\tclass=\" top-0 left-0 right-0 p-2 mx-4 px-3 flex justify-center items-center relative rounded-xl border border-gray-50 dark:border-gray-850 text-gray-800 dark:text-gary-100 bg-white dark:bg-gray-900 backdrop-blur-xl z-30\"\n\t\t\ttransition:fade={{ delay: 100, duration: 300 }}\n\t\t>\n\t\t\t<div class=\" flex flex-col md:flex-row md:items-center flex-1 text-sm w-fit gap-1.5\">\n\t\t\t\t<div class=\"flex justify-between self-start\">\n\t\t\t\t\t<div\n\t\t\t\t\t\tclass=\" text-xs font-black {classNames[banner.type] ??\n\t\t\t\t\t\t\tclassNames['info']}  w-fit px-2 rounded uppercase line-clamp-1 mr-0.5\"\n\t\t\t\t\t>\n\t\t\t\t\t\t{banner.type}\n\t\t\t\t\t</div>\n\n\t\t\t\t\t{#if banner.url}\n\t\t\t\t\t\t<div class=\"flex md:hidden group w-fit md:items-center\">\n\t\t\t\t\t\t\t<a\n\t\t\t\t\t\t\t\tclass=\"text-gray-700 dark:text-white text-xs font-bold underline\"\n\t\t\t\t\t\t\t\thref=\"/assets/files/whitepaper.pdf\"\n\t\t\t\t\t\t\t\ttarget=\"_blank\">Learn More</a\n\t\t\t\t\t\t\t>\n\n\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\tclass=\" ml-1 text-gray-400 group-hover:text-gray-600 dark:group-hover:text-white\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<!--  -->\n\t\t\t\t\t\t\t\t<svg\n\t\t\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\t\t\t\t\tviewBox=\"0 0 16 16\"\n\t\t\t\t\t\t\t\t\tfill=\"currentColor\"\n\t\t\t\t\t\t\t\t\tclass=\"w-4 h-4\"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\t\tfill-rule=\"evenodd\"\n\t\t\t\t\t\t\t\t\t\td=\"M4.22 11.78a.75.75 0 0 1 0-1.06L9.44 5.5H5.75a.75.75 0 0 1 0-1.5h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V6.56l-5.22 5.22a.75.75 0 0 1-1.06 0Z\"\n\t\t\t\t\t\t\t\t\t\tclip-rule=\"evenodd\"\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t{/if}\n\t\t\t\t</div>\n\n\t\t\t\t<div class=\"flex-1 text-xs text-gray-700 dark:text-white\">\n\t\t\t\t\t{banner.content}\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t{#if banner.url}\n\t\t\t\t<div class=\"hidden md:flex group w-fit md:items-center\">\n\t\t\t\t\t<a\n\t\t\t\t\t\tclass=\"text-gray-700 dark:text-white text-xs font-bold underline\"\n\t\t\t\t\t\thref=\"/\"\n\t\t\t\t\t\ttarget=\"_blank\">Learn More</a\n\t\t\t\t\t>\n\n\t\t\t\t\t<div class=\" ml-1 text-gray-400 group-hover:text-gray-600 dark:group-hover:text-white\">\n\t\t\t\t\t\t<!--  -->\n\t\t\t\t\t\t<svg\n\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\t\t\tviewBox=\"0 0 16 16\"\n\t\t\t\t\t\t\tfill=\"currentColor\"\n\t\t\t\t\t\t\tclass=\"size-4\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\tfill-rule=\"evenodd\"\n\t\t\t\t\t\t\t\td=\"M4.22 11.78a.75.75 0 0 1 0-1.06L9.44 5.5H5.75a.75.75 0 0 1 0-1.5h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V6.56l-5.22 5.22a.75.75 0 0 1-1.06 0Z\"\n\t\t\t\t\t\t\t\tclip-rule=\"evenodd\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</svg>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t{/if}\n\t\t\t<div class=\"flex self-start\">\n\t\t\t\t{#if banner.dismissible}\n\t\t\t\t\t<button\n\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\tdismiss(banner.id);\n\t\t\t\t\t\t}}\n\t\t\t\t\t\tclass=\" -mt-[3px] ml-1.5 mr-1 text-gray-400 dark:hover:text-white h-1\">&times;</button\n\t\t\t\t\t>\n\t\t\t\t{/if}\n\t\t\t</div>\n\t\t</div>\n\t{/if}\n{/if}\n","<script lang=\"ts\">\n\timport { prompts } from '$lib/stores';\n\timport { findWordIndices } from '$lib/utils';\n\timport { tick, getContext } from 'svelte';\n\timport { toast } from 'svelte-sonner';\n\n\tconst i18n = getContext('i18n');\n\n\texport let files;\n\texport let prompt = '';\n\tlet selectedCommandIdx = 0;\n\tlet filteredPromptCommands = [];\n\n\t$: filteredPromptCommands = $prompts\n\t\t.filter((p) => p.command.includes(prompt))\n\t\t.sort((a, b) => a.title.localeCompare(b.title));\n\n\t$: if (prompt) {\n\t\tselectedCommandIdx = 0;\n\t}\n\n\texport const selectUp = () => {\n\t\tselectedCommandIdx = Math.max(0, selectedCommandIdx - 1);\n\t};\n\n\texport const selectDown = () => {\n\t\tselectedCommandIdx = Math.min(selectedCommandIdx + 1, filteredPromptCommands.length - 1);\n\t};\n\n\tconst confirmCommand = async (command) => {\n\t\tlet text = command.content;\n\n\t\tif (command.content.includes('{{CLIPBOARD}}')) {\n\t\t\tconst clipboardText = await navigator.clipboard.readText().catch((err) => {\n\t\t\t\ttoast.error($i18n.t('Failed to read clipboard contents'));\n\t\t\t\treturn '{{CLIPBOARD}}';\n\t\t\t});\n\n\t\t\tconsole.log(clipboardText);\n\n\t\t\tconst clipboardItems = await navigator.clipboard.read();\n\n\t\t\tlet imageUrl = null;\n\t\t\tfor (const item of clipboardItems) {\n\t\t\t\t// Check for known image types\n\t\t\t\tfor (const type of item.types) {\n\t\t\t\t\tif (type.startsWith('image/')) {\n\t\t\t\t\t\tconst blob = await item.getType(type);\n\t\t\t\t\t\timageUrl = URL.createObjectURL(blob);\n\t\t\t\t\t\tconsole.log(`Image URL (${type}): ${imageUrl}`);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (imageUrl) {\n\t\t\t\tfiles = [\n\t\t\t\t\t...files,\n\t\t\t\t\t{\n\t\t\t\t\t\ttype: 'image',\n\t\t\t\t\t\turl: imageUrl\n\t\t\t\t\t}\n\t\t\t\t];\n\t\t\t}\n\n\t\t\ttext = command.content.replaceAll('{{CLIPBOARD}}', clipboardText);\n\t\t}\n\n\t\tprompt = text;\n\n\t\tconst chatInputElement = document.getElementById('chat-textarea');\n\n\t\tawait tick();\n\n\t\tchatInputElement.style.height = '';\n\t\tchatInputElement.style.height = Math.min(chatInputElement.scrollHeight, 200) + 'px';\n\n\t\tchatInputElement?.focus();\n\n\t\tawait tick();\n\n\t\tconst words = findWordIndices(prompt);\n\n\t\tif (words.length > 0) {\n\t\t\tconst word = words.at(0);\n\t\t\tchatInputElement.setSelectionRange(word?.startIndex, word.endIndex + 1);\n\t\t}\n\t};\n</script>\n\n{#if filteredPromptCommands.length > 0}\n\t<div class=\"pl-1 pr-12 mb-3 text-left w-full absolute bottom-0 left-0 right-0\">\n\t\t<div class=\"flex w-full dark:border dark:border-gray-850 rounded-lg\">\n\t\t\t<div class=\"  bg-gray-50 dark:bg-gray-850 w-10 rounded-l-lg text-center\">\n\t\t\t\t<div class=\" text-lg font-semibold mt-2\">/</div>\n\t\t\t</div>\n\n\t\t\t<div\n\t\t\t\tclass=\"max-h-60 flex flex-col w-full rounded-r-lg bg-white dark:bg-gray-900 dark:text-gray-100\"\n\t\t\t>\n\t\t\t\t<div class=\"m-1 overflow-y-auto p-1 rounded-r-lg space-y-0.5 scrollbar-hidden\">\n\t\t\t\t\t{#each filteredPromptCommands as command, commandIdx}\n\t\t\t\t\t\t<button\n\t\t\t\t\t\t\tclass=\" px-3 py-1.5 rounded-xl w-full text-left {commandIdx === selectedCommandIdx\n\t\t\t\t\t\t\t\t? '  bg-gray-50 dark:bg-gray-850 selected-command-option-button'\n\t\t\t\t\t\t\t\t: ''}\"\n\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\tconfirmCommand(command);\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\ton:mousemove={() => {\n\t\t\t\t\t\t\t\tselectedCommandIdx = commandIdx;\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\ton:focus={() => {}}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<div class=\" font-medium text-black dark:text-gray-100\">\n\t\t\t\t\t\t\t\t{command.command}\n\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t<div class=\" text-xs text-gray-600 dark:text-gray-100\">\n\t\t\t\t\t\t\t\t{command.title}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</button>\n\t\t\t\t\t{/each}\n\t\t\t\t</div>\n\n\t\t\t\t<div\n\t\t\t\t\tclass=\" px-2 pb-1 text-xs text-gray-600 dark:text-gray-100 bg-white dark:bg-gray-900 rounded-br-xl flex items-center space-x-1\"\n\t\t\t\t>\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<svg\n\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\t\t\tfill=\"none\"\n\t\t\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\t\t\tstroke-width=\"1.5\"\n\t\t\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\t\t\tclass=\"w-3 h-3\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\tstroke-linecap=\"round\"\n\t\t\t\t\t\t\t\tstroke-linejoin=\"round\"\n\t\t\t\t\t\t\t\td=\"m11.25 11.25.041-.02a.75.75 0 0 1 1.063.852l-.708 2.836a.75.75 0 0 0 1.063.853l.041-.021M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9-3.75h.008v.008H12V8.25Z\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</svg>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div class=\"line-clamp-1\">\n\t\t\t\t\t\t{$i18n.t(\n\t\t\t\t\t\t\t'Tip: Update multiple variable slots consecutively by pressing the tab key in the chat input after each replacement.'\n\t\t\t\t\t\t)}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n{/if}\n","<script lang=\"ts\">\n\timport { createEventDispatcher } from 'svelte';\n\n\timport { documents } from '$lib/stores';\n\timport { removeFirstHashWord, isValidHttpUrl } from '$lib/utils';\n\timport { tick, getContext } from 'svelte';\n\timport { toast } from 'svelte-sonner';\n\n\tconst i18n = getContext('i18n');\n\n\texport let prompt = '';\n\n\tconst dispatch = createEventDispatcher();\n\tlet selectedIdx = 0;\n\n\tlet filteredItems = [];\n\tlet filteredDocs = [];\n\n\tlet collections = [];\n\n\t$: collections = [\n\t\t...($documents.length > 0\n\t\t\t? [\n\t\t\t\t\t{\n\t\t\t\t\t\tname: 'All Documents',\n\t\t\t\t\t\ttype: 'collection',\n\t\t\t\t\t\ttitle: $i18n.t('All Documents'),\n\t\t\t\t\t\tcollection_names: $documents.map((doc) => doc.collection_name)\n\t\t\t\t\t}\n\t\t\t  ]\n\t\t\t: []),\n\t\t...$documents\n\t\t\t.reduce((a, e, i, arr) => {\n\t\t\t\treturn [...new Set([...a, ...(e?.content?.tags ?? []).map((tag) => tag.name)])];\n\t\t\t}, [])\n\t\t\t.map((tag) => ({\n\t\t\t\tname: tag,\n\t\t\t\ttype: 'collection',\n\t\t\t\tcollection_names: $documents\n\t\t\t\t\t.filter((doc) => (doc?.content?.tags ?? []).map((tag) => tag.name).includes(tag))\n\t\t\t\t\t.map((doc) => doc.collection_name)\n\t\t\t}))\n\t];\n\n\t$: filteredCollections = collections\n\t\t.filter((collection) => collection.name.includes(prompt.split(' ')?.at(0)?.substring(1) ?? ''))\n\t\t.sort((a, b) => a.name.localeCompare(b.name));\n\n\t$: filteredDocs = $documents\n\t\t.filter((doc) => doc.name.includes(prompt.split(' ')?.at(0)?.substring(1) ?? ''))\n\t\t.sort((a, b) => a.title.localeCompare(b.title));\n\n\t$: filteredItems = [...filteredCollections, ...filteredDocs];\n\n\t$: if (prompt) {\n\t\tselectedIdx = 0;\n\n\t\tconsole.log(filteredCollections);\n\t}\n\n\texport const selectUp = () => {\n\t\tselectedIdx = Math.max(0, selectedIdx - 1);\n\t};\n\n\texport const selectDown = () => {\n\t\tselectedIdx = Math.min(selectedIdx + 1, filteredItems.length - 1);\n\t};\n\n\tconst confirmSelect = async (doc) => {\n\t\tdispatch('select', doc);\n\n\t\tprompt = removeFirstHashWord(prompt);\n\t\tconst chatInputElement = document.getElementById('chat-textarea');\n\n\t\tawait tick();\n\t\tchatInputElement?.focus();\n\t\tawait tick();\n\t};\n\n\tconst confirmSelectWeb = async (url) => {\n\t\tdispatch('url', url);\n\n\t\tprompt = removeFirstHashWord(prompt);\n\t\tconst chatInputElement = document.getElementById('chat-textarea');\n\n\t\tawait tick();\n\t\tchatInputElement?.focus();\n\t\tawait tick();\n\t};\n\n\tconst confirmSelectYoutube = async (url) => {\n\t\tdispatch('youtube', url);\n\n\t\tprompt = removeFirstHashWord(prompt);\n\t\tconst chatInputElement = document.getElementById('chat-textarea');\n\n\t\tawait tick();\n\t\tchatInputElement?.focus();\n\t\tawait tick();\n\t};\n</script>\n\n{#if filteredItems.length > 0 || prompt.split(' ')?.at(0)?.substring(1).startsWith('http')}\n\t<div class=\"pl-1 pr-12 mb-3 text-left w-full absolute bottom-0 left-0 right-0\">\n\t\t<div class=\"flex w-full dark:border dark:border-gray-850 rounded-lg\">\n\t\t\t<div class=\" bg-gray-50 dark:bg-gray-850 w-10 rounded-l-lg text-center\">\n\t\t\t\t<div class=\" text-lg font-semibold mt-2\">#</div>\n\t\t\t</div>\n\n\t\t\t<div\n\t\t\t\tclass=\"max-h-60 flex flex-col w-full rounded-r-xl bg-white dark:bg-gray-900 dark:text-gray-100\"\n\t\t\t>\n\t\t\t\t<div class=\"m-1 overflow-y-auto p-1 rounded-r-xl space-y-0.5 scrollbar-hidden\">\n\t\t\t\t\t{#each filteredItems as doc, docIdx}\n\t\t\t\t\t\t<button\n\t\t\t\t\t\t\tclass=\" px-3 py-1.5 rounded-xl w-full text-left {docIdx === selectedIdx\n\t\t\t\t\t\t\t\t? ' bg-gray-50 dark:bg-gray-850 dark:text-gray-100 selected-command-option-button'\n\t\t\t\t\t\t\t\t: ''}\"\n\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\tconsole.log(doc);\n\n\t\t\t\t\t\t\t\tconfirmSelect(doc);\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\ton:mousemove={() => {\n\t\t\t\t\t\t\t\tselectedIdx = docIdx;\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\ton:focus={() => {}}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{#if doc.type === 'collection'}\n\t\t\t\t\t\t\t\t<div class=\" font-medium text-black dark:text-gray-100 line-clamp-1\">\n\t\t\t\t\t\t\t\t\t{doc?.title ?? `#${doc.name}`}\n\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t<div class=\" text-xs text-gray-600 dark:text-gray-100 line-clamp-1\">\n\t\t\t\t\t\t\t\t\t{$i18n.t('Collection')}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t{:else}\n\t\t\t\t\t\t\t\t<div class=\" font-medium text-black dark:text-gray-100 line-clamp-1\">\n\t\t\t\t\t\t\t\t\t#{doc.name} ({doc.filename})\n\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t<div class=\" text-xs text-gray-600 dark:text-gray-100 line-clamp-1\">\n\t\t\t\t\t\t\t\t\t{doc.title}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t</button>\n\t\t\t\t\t{/each}\n\n\t\t\t\t\t{#if prompt\n\t\t\t\t\t\t.split(' ')\n\t\t\t\t\t\t.some((s) => s.substring(1).startsWith('https://www.youtube.com') || s\n\t\t\t\t\t\t\t\t\t.substring(1)\n\t\t\t\t\t\t\t\t\t.startsWith('https://youtu.be'))}\n\t\t\t\t\t\t<button\n\t\t\t\t\t\t\tclass=\"px-3 py-1.5 rounded-xl w-full text-left bg-gray-100 selected-command-option-button\"\n\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\tconst url = prompt.split(' ')?.at(0)?.substring(1);\n\t\t\t\t\t\t\t\tif (isValidHttpUrl(url)) {\n\t\t\t\t\t\t\t\t\tconfirmSelectYoutube(url);\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\ttoast.error(\n\t\t\t\t\t\t\t\t\t\t$i18n.t(\n\t\t\t\t\t\t\t\t\t\t\t'Oops! Looks like the URL is invalid. Please double-check and try again.'\n\t\t\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<div class=\" font-medium text-black line-clamp-1\">\n\t\t\t\t\t\t\t\t{prompt.split(' ')?.at(0)?.substring(1)}\n\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t<div class=\" text-xs text-gray-600 line-clamp-1\">{$i18n.t('Youtube')}</div>\n\t\t\t\t\t\t</button>\n\t\t\t\t\t{:else if prompt.split(' ')?.at(0)?.substring(1).startsWith('http')}\n\t\t\t\t\t\t<button\n\t\t\t\t\t\t\tclass=\"px-3 py-1.5 rounded-xl w-full text-left bg-gray-100 selected-command-option-button\"\n\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\tconst url = prompt.split(' ')?.at(0)?.substring(1);\n\t\t\t\t\t\t\t\tif (isValidHttpUrl(url)) {\n\t\t\t\t\t\t\t\t\tconfirmSelectWeb(url);\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\ttoast.error(\n\t\t\t\t\t\t\t\t\t\t$i18n.t(\n\t\t\t\t\t\t\t\t\t\t\t'Oops! Looks like the URL is invalid. Please double-check and try again.'\n\t\t\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<div class=\" font-medium text-black line-clamp-1\">\n\t\t\t\t\t\t\t\t{prompt.split(' ')?.at(0)?.substring(1)}\n\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t<div class=\" text-xs text-gray-600 line-clamp-1\">{$i18n.t('Web')}</div>\n\t\t\t\t\t\t</button>\n\t\t\t\t\t{/if}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n{/if}\n","<script lang=\"ts\">\n\timport { createEventDispatcher } from 'svelte';\n\n\timport { generatePrompt } from '$lib/apis/ollama';\n\timport { models } from '$lib/stores';\n\timport { splitStream } from '$lib/utils';\n\timport { tick, getContext } from 'svelte';\n\timport { toast } from 'svelte-sonner';\n\n\tconst i18n = getContext('i18n');\n\n\tconst dispatch = createEventDispatcher();\n\n\texport let prompt = '';\n\texport let user = null;\n\n\texport let chatInputPlaceholder = '';\n\texport let messages = [];\n\n\tlet selectedIdx = 0;\n\tlet filteredModels = [];\n\n\t$: filteredModels = $models\n\t\t.filter((p) => p.name.includes(prompt.split(' ')?.at(0)?.substring(1) ?? ''))\n\t\t.sort((a, b) => a.name.localeCompare(b.name));\n\n\t$: if (prompt) {\n\t\tselectedIdx = 0;\n\t}\n\n\texport const selectUp = () => {\n\t\tselectedIdx = Math.max(0, selectedIdx - 1);\n\t};\n\n\texport const selectDown = () => {\n\t\tselectedIdx = Math.min(selectedIdx + 1, filteredModels.length - 1);\n\t};\n\n\tconst confirmSelect = async (model) => {\n\t\tprompt = '';\n\t\tdispatch('select', model);\n\t};\n\n\tconst confirmSelectCollaborativeChat = async (model) => {\n\t\t// dispatch('select', model);\n\t\tprompt = '';\n\t\tuser = JSON.parse(JSON.stringify(model.name));\n\t\tawait tick();\n\n\t\tchatInputPlaceholder = $i18n.t('{{modelName}} is thinking...', { modelName: model.name });\n\n\t\tconst chatInputElement = document.getElementById('chat-textarea');\n\n\t\tawait tick();\n\t\tchatInputElement?.focus();\n\t\tawait tick();\n\n\t\tconst convoText = messages.reduce((a, message, i, arr) => {\n\t\t\treturn `${a}### ${message.role.toUpperCase()}\\n${message.content}\\n\\n`;\n\t\t}, '');\n\n\t\tconst res = await generatePrompt(localStorage.token, model.name, convoText);\n\n\t\tif (res && res.ok) {\n\t\t\tconst reader = res.body\n\t\t\t\t.pipeThrough(new TextDecoderStream())\n\t\t\t\t.pipeThrough(splitStream('\\n'))\n\t\t\t\t.getReader();\n\n\t\t\twhile (true) {\n\t\t\t\tconst { value, done } = await reader.read();\n\t\t\t\tif (done) {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\ttry {\n\t\t\t\t\tlet lines = value.split('\\n');\n\n\t\t\t\t\tfor (const line of lines) {\n\t\t\t\t\t\tif (line !== '') {\n\t\t\t\t\t\t\tconsole.log(line);\n\t\t\t\t\t\t\tlet data = JSON.parse(line);\n\n\t\t\t\t\t\t\tif ('detail' in data) {\n\t\t\t\t\t\t\t\tthrow data;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif ('id' in data) {\n\t\t\t\t\t\t\t\tconsole.log(data);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tif (data.done == false) {\n\t\t\t\t\t\t\t\t\tif (prompt == '' && data.response == '\\n') {\n\t\t\t\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\tprompt += data.response;\n\t\t\t\t\t\t\t\t\t\tconsole.log(data.response);\n\t\t\t\t\t\t\t\t\t\tchatInputElement.scrollTop = chatInputElement.scrollHeight;\n\t\t\t\t\t\t\t\t\t\tawait tick();\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} catch (error) {\n\t\t\t\t\tconsole.log(error);\n\t\t\t\t\tif ('detail' in error) {\n\t\t\t\t\t\ttoast.error(error.detail);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\tif (res !== null) {\n\t\t\t\tconst error = await res.json();\n\t\t\t\tconsole.log(error);\n\t\t\t\tif ('detail' in error) {\n\t\t\t\t\ttoast.error(error.detail);\n\t\t\t\t} else {\n\t\t\t\t\ttoast.error(error.error);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\ttoast.error(\n\t\t\t\t\t$i18n.t('Uh-oh! There was an issue connecting to {{provider}}.', { provider: 'llama' })\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\n\t\tchatInputPlaceholder = '';\n\n\t\tconsole.log(user);\n\t};\n</script>\n\n{#if prompt.charAt(0) === '@'}\n\t{#if filteredModels.length > 0}\n\t\t<div class=\"pl-1 pr-12 mb-3 text-left w-full absolute bottom-0 left-0 right-0\">\n\t\t\t<div class=\"flex w-full dark:border dark:border-gray-850 rounded-lg\">\n\t\t\t\t<div class=\" bg-gray-50 dark:bg-gray-850 w-10 rounded-l-lg text-center\">\n\t\t\t\t\t<div class=\" text-lg font-semibold mt-2\">@</div>\n\t\t\t\t</div>\n\n\t\t\t\t<div\n\t\t\t\t\tclass=\"max-h-60 flex flex-col w-full rounded-r-lg bg-white dark:bg-gray-900 dark:text-gray-100\"\n\t\t\t\t>\n\t\t\t\t\t<div class=\"m-1 overflow-y-auto p-1 rounded-r-lg space-y-0.5 scrollbar-hidden\">\n\t\t\t\t\t\t{#each filteredModels as model, modelIdx}\n\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\tclass=\" px-3 py-1.5 rounded-xl w-full text-left {modelIdx === selectedIdx\n\t\t\t\t\t\t\t\t\t? '  bg-gray-50 dark:bg-gray-850  selected-command-option-button'\n\t\t\t\t\t\t\t\t\t: ''}\"\n\t\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\t\tconfirmSelect(model);\n\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\ton:mousemove={() => {\n\t\t\t\t\t\t\t\t\tselectedIdx = modelIdx;\n\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\ton:focus={() => {}}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<div class=\" font-medium text-black dark:text-gray-100 line-clamp-1\">\n\t\t\t\t\t\t\t\t\t{model.name}\n\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t<!-- <div class=\" text-xs text-gray-600 line-clamp-1\">\n\t\t\t\t\t\t\t\t{doc.title}\n\t\t\t\t\t\t\t</div> -->\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t{/each}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t{/if}\n{/if}\n","<script lang=\"ts\">\n\texport let className = 'size-3.5';\n\texport let strokeWidth = '2';\n</script>\n\n<svg\n\txmlns=\"http://www.w3.org/2000/svg\"\n\tfill=\"none\"\n\tviewBox=\"0 0 24 24\"\n\tstroke-width={strokeWidth}\n\tstroke=\"currentColor\"\n\tclass={className}\n>\n\t<path stroke-linecap=\"round\" stroke-linejoin=\"round\" d=\"M6 18 18 6M6 6l12 12\" />\n</svg>\n","<script lang=\"ts\">\n\texport let className = 'size-4';\n</script>\n\n<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"currentColor\" class={className}>\n\t<path\n\t\tfill-rule=\"evenodd\"\n\t\td=\"M5.625 1.5H9a3.75 3.75 0 0 1 3.75 3.75v1.875c0 1.036.84 1.875 1.875 1.875H16.5a3.75 3.75 0 0 1 3.75 3.75v7.875c0 1.035-.84 1.875-1.875 1.875H5.625a1.875 1.875 0 0 1-1.875-1.875V3.375c0-1.036.84-1.875 1.875-1.875Zm6.905 9.97a.75.75 0 0 0-1.06 0l-3 3a.75.75 0 1 0 1.06 1.06l1.72-1.72V18a.75.75 0 0 0 1.5 0v-4.19l1.72 1.72a.75.75 0 1 0 1.06-1.06l-3-3Z\"\n\t\tclip-rule=\"evenodd\"\n\t/>\n\t<path\n\t\td=\"M14.25 5.25a5.23 5.23 0 0 0-1.279-3.434 9.768 9.768 0 0 1 6.963 6.963A5.23 5.23 0 0 0 16.5 7.5h-1.875a.375.375 0 0 1-.375-.375V5.25Z\"\n\t/>\n</svg>\n","<script lang=\"ts\">\n\texport let className = 'size-4';\n</script>\n\n<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"currentColor\" class={className}>\n\t<path\n\t\td=\"M21.721 12.752a9.711 9.711 0 0 0-.945-5.003 12.754 12.754 0 0 1-4.339 2.708 18.991 18.991 0 0 1-.214 4.772 17.165 17.165 0 0 0 5.498-2.477ZM14.634 15.55a17.324 17.324 0 0 0 .332-4.647c-.952.227-1.945.347-2.966.347-1.021 0-2.014-.12-2.966-.347a17.515 17.515 0 0 0 .332 4.647 17.385 17.385 0 0 0 5.268 0ZM9.772 17.119a18.963 18.963 0 0 0 4.456 0A17.182 17.182 0 0 1 12 21.724a17.18 17.18 0 0 1-2.228-4.605ZM7.777 15.23a18.87 18.87 0 0 1-.214-4.774 12.753 12.753 0 0 1-4.34-2.708 9.711 9.711 0 0 0-.944 5.004 17.165 17.165 0 0 0 5.498 2.477ZM21.356 14.752a9.765 9.765 0 0 1-7.478 6.817 18.64 18.64 0 0 0 1.988-4.718 18.627 18.627 0 0 0 5.49-2.098ZM2.644 14.752c1.682.971 3.53 1.688 5.49 2.099a18.64 18.64 0 0 0 1.988 4.718 9.765 9.765 0 0 1-7.478-6.816ZM13.878 2.43a9.755 9.755 0 0 1 6.116 3.986 11.267 11.267 0 0 1-3.746 2.504 18.63 18.63 0 0 0-2.37-6.49ZM12 2.276a17.152 17.152 0 0 1 2.805 7.121c-.897.23-1.837.353-2.805.353-.968 0-1.908-.122-2.805-.353A17.151 17.151 0 0 1 12 2.276ZM10.122 2.43a18.629 18.629 0 0 0-2.37 6.49 11.266 11.266 0 0 1-3.746-2.504 9.754 9.754 0 0 1 6.116-3.985Z\"\n\t/>\n</svg>\n","<script lang=\"ts\">\n\texport let className = 'size-4';\n</script>\n\n<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"currentColor\" class={className}>\n\t<path\n\t\tfill-rule=\"evenodd\"\n\t\td=\"M12 6.75a5.25 5.25 0 0 1 6.775-5.025.75.75 0 0 1 .313 1.248l-3.32 3.319c.063.475.276.934.641 1.299.365.365.824.578 1.3.64l3.318-3.319a.75.75 0 0 1 1.248.313 5.25 5.25 0 0 1-5.472 6.756c-1.018-.086-1.87.1-2.309.634L7.344 21.3A3.298 3.298 0 1 1 2.7 16.657l8.684-7.151c.533-.44.72-1.291.634-2.309A5.342 5.342 0 0 1 12 6.75ZM4.117 19.125a.75.75 0 0 1 .75-.75h.008a.75.75 0 0 1 .75.75v.008a.75.75 0 0 1-.75.75h-.008a.75.75 0 0 1-.75-.75v-.008Z\"\n\t\tclip-rule=\"evenodd\"\n\t/>\n</svg>\n","<script lang=\"ts\">\n\timport { DropdownMenu } from 'bits-ui';\n\timport { flyAndScale } from '$lib/utils/transitions';\n\timport { getContext } from 'svelte';\n\n\timport Dropdown from '$lib/components/common/Dropdown.svelte';\n\timport Tooltip from '$lib/components/common/Tooltip.svelte';\n\timport DocumentArrowUpSolid from '$lib/components/icons/DocumentArrowUpSolid.svelte';\n\timport Switch from '$lib/components/common/Switch.svelte';\n\timport GlobeAltSolid from '$lib/components/icons/GlobeAltSolid.svelte';\n\timport { config } from '$lib/stores';\n\timport WrenchSolid from '$lib/components/icons/WrenchSolid.svelte';\n\n\tconst i18n = getContext('i18n');\n\n\texport let uploadFilesHandler: Function;\n\n\texport let selectedToolIds: string[] = [];\n\texport let webSearchEnabled: boolean;\n\n\texport let tools = {};\n\texport let onClose: Function;\n\n\t$: tools = Object.fromEntries(\n\t\tObject.keys(tools).map((toolId) => [\n\t\t\ttoolId,\n\t\t\t{\n\t\t\t\t...tools[toolId],\n\t\t\t\tenabled: selectedToolIds.includes(toolId)\n\t\t\t}\n\t\t])\n\t);\n\n\tlet show = false;\n</script>\n\n<Dropdown\n\tbind:show\n\ton:change={(e) => {\n\t\tif (e.detail === false) {\n\t\t\tonClose();\n\t\t}\n\t}}\n>\n\t<Tooltip content={$i18n.t('More')}>\n\t\t<slot />\n\t</Tooltip>\n\n\t<div slot=\"content\">\n\t\t<DropdownMenu.Content\n\t\t\tclass=\"w-full max-w-[200px] rounded-xl px-1 py-1  border-gray-300/30 dark:border-gray-700/50 z-50 bg-white dark:bg-gray-850 dark:text-white shadow\"\n\t\t\tsideOffset={15}\n\t\t\talignOffset={-8}\n\t\t\tside=\"top\"\n\t\t\talign=\"start\"\n\t\t\ttransition={flyAndScale}\n\t\t>\n\t\t\t{#if Object.keys(tools).length > 0}\n\t\t\t\t<div class=\"  max-h-28 overflow-y-auto scrollbar-hidden\">\n\t\t\t\t\t{#each Object.keys(tools) as toolId}\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tclass=\"flex gap-2 items-center px-3 py-2 text-sm font-medium cursor-pointer rounded-xl\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<div class=\"flex-1 flex items-center gap-2\">\n\t\t\t\t\t\t\t\t<WrenchSolid />\n\t\t\t\t\t\t\t\t<Tooltip content={tools[toolId]?.description ?? ''} className=\"flex-1\">\n\t\t\t\t\t\t\t\t\t<div class=\" line-clamp-1\">{tools[toolId].name}</div>\n\t\t\t\t\t\t\t\t</Tooltip>\n\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t<Switch\n\t\t\t\t\t\t\t\tbind:state={tools[toolId].enabled}\n\t\t\t\t\t\t\t\ton:change={(e) => {\n\t\t\t\t\t\t\t\t\tselectedToolIds = e.detail\n\t\t\t\t\t\t\t\t\t\t? [...selectedToolIds, toolId]\n\t\t\t\t\t\t\t\t\t\t: selectedToolIds.filter((id) => id !== toolId);\n\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t{/each}\n\t\t\t\t</div>\n\n\t\t\t\t<hr class=\"border-gray-100 dark:border-gray-800 my-1\" />\n\t\t\t{/if}\n\n\t\t\t{#if $config?.features?.enable_web_search}\n\t\t\t\t<div\n\t\t\t\t\tclass=\"flex gap-2 items-center px-3 py-2 text-sm font-medium cursor-pointer rounded-xl\"\n\t\t\t\t>\n\t\t\t\t\t<div class=\"flex-1 flex items-center gap-2\">\n\t\t\t\t\t\t<GlobeAltSolid />\n\t\t\t\t\t\t<div class=\" line-clamp-1\">{$i18n.t('Web Search')}</div>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<Switch bind:state={webSearchEnabled} />\n\t\t\t\t</div>\n\n\t\t\t\t<hr class=\"border-gray-100 dark:border-gray-800 my-1\" />\n\t\t\t{/if}\n\n\t\t\t<DropdownMenu.Item\n\t\t\t\tclass=\"flex gap-2 items-center px-3 py-2 text-sm  font-medium cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800  rounded-xl\"\n\t\t\t\ton:click={() => {\n\t\t\t\t\tuploadFilesHandler();\n\t\t\t\t}}\n\t\t\t>\n\t\t\t\t<DocumentArrowUpSolid />\n\t\t\t\t<div class=\" line-clamp-1\">{$i18n.t('Upload Files')}</div>\n\t\t\t</DropdownMenu.Item>\n\t\t</DropdownMenu.Content>\n\t</div>\n</Dropdown>\n","<script lang=\"ts\">\n\texport let className = 'w-4 h-4';\n\texport let strokeWidth = '0';\n</script>\n\n<svg\n\taria-hidden=\"true\"\n\txmlns=\"http://www.w3.org/2000/svg\"\n\tfill=\"currentColor\"\n\tviewBox=\"0 0 24 24\"\n\tstroke-width={strokeWidth}\n\tstroke=\"currentColor\"\n\tclass={className}\n>\n\t<path\n\t\tfill-rule=\"evenodd\"\n\t\td=\"M12 5a7 7 0 0 0-7 7v1.17c.313-.11.65-.17 1-.17h2a1 1 0 0 1 1 1v6a1 1 0 0 1-1 1H6a3 3 0 0 1-3-3v-6a9 9 0 0 1 18 0v6a3 3 0 0 1-3 3h-2a1 1 0 0 1-1-1v-6a1 1 0 0 1 1-1h2c.35 0 .687.06 1 .17V12a7 7 0 0 0-7-7Z\"\n\t\tclip-rule=\"evenodd\"\n\t/>\n</svg>\n","<script lang=\"ts\">\n\timport { toast } from 'svelte-sonner';\n\timport { createEventDispatcher, tick, getContext } from 'svelte';\n\timport { config, settings } from '$lib/stores';\n\timport { blobToFile, calculateSHA256, findWordIndices } from '$lib/utils';\n\n\timport { transcribeAudio } from '$lib/apis/audio';\n\n\tconst i18n = getContext('i18n');\n\n\tconst dispatch = createEventDispatcher();\n\n\texport let recording = false;\n\n\tlet loading = false;\n\tlet confirmed = false;\n\n\tlet durationSeconds = 0;\n\tlet durationCounter = null;\n\n\tlet transcription = '';\n\n\tconst startDurationCounter = () => {\n\t\tdurationCounter = setInterval(() => {\n\t\t\tdurationSeconds++;\n\t\t}, 1000);\n\t};\n\n\tconst stopDurationCounter = () => {\n\t\tclearInterval(durationCounter);\n\t\tdurationSeconds = 0;\n\t};\n\n\t$: if (recording) {\n\t\tstartRecording();\n\t} else {\n\t\tstopRecording();\n\t}\n\n\tconst formatSeconds = (seconds) => {\n\t\tconst minutes = Math.floor(seconds / 60);\n\t\tconst remainingSeconds = seconds % 60;\n\t\tconst formattedSeconds = remainingSeconds < 10 ? `0${remainingSeconds}` : remainingSeconds;\n\t\treturn `${minutes}:${formattedSeconds}`;\n\t};\n\n\tlet speechRecognition;\n\n\tlet mediaRecorder;\n\tlet audioChunks = [];\n\n\tconst MIN_DECIBELS = -45;\n\tconst VISUALIZER_BUFFER_LENGTH = 300;\n\n\tlet visualizerData = Array(VISUALIZER_BUFFER_LENGTH).fill(0);\n\n\t// Function to calculate the RMS level from time domain data\n\tconst calculateRMS = (data: Uint8Array) => {\n\t\tlet sumSquares = 0;\n\t\tfor (let i = 0; i < data.length; i++) {\n\t\t\tconst normalizedValue = (data[i] - 128) / 128; // Normalize the data\n\t\t\tsumSquares += normalizedValue * normalizedValue;\n\t\t}\n\t\treturn Math.sqrt(sumSquares / data.length);\n\t};\n\n\tconst normalizeRMS = (rms) => {\n\t\trms = rms * 10;\n\t\tconst exp = 1.5; // Adjust exponent value; values greater than 1 expand larger numbers more and compress smaller numbers more\n\t\tconst scaledRMS = Math.pow(rms, exp);\n\n\t\t// Scale between 0.01 (1%) and 1.0 (100%)\n\t\treturn Math.min(1.0, Math.max(0.01, scaledRMS));\n\t};\n\n\tconst analyseAudio = (stream) => {\n\t\tconst audioContext = new AudioContext();\n\t\tconst audioStreamSource = audioContext.createMediaStreamSource(stream);\n\n\t\tconst analyser = audioContext.createAnalyser();\n\t\tanalyser.minDecibels = MIN_DECIBELS;\n\t\taudioStreamSource.connect(analyser);\n\n\t\tconst bufferLength = analyser.frequencyBinCount;\n\n\t\tconst domainData = new Uint8Array(bufferLength);\n\t\tconst timeDomainData = new Uint8Array(analyser.fftSize);\n\n\t\tlet lastSoundTime = Date.now();\n\n\t\tconst detectSound = () => {\n\t\t\tconst processFrame = () => {\n\t\t\t\tif (!recording || loading) return;\n\n\t\t\t\tif (recording && !loading) {\n\t\t\t\t\tanalyser.getByteTimeDomainData(timeDomainData);\n\t\t\t\t\tanalyser.getByteFrequencyData(domainData);\n\n\t\t\t\t\t// Calculate RMS level from time domain data\n\t\t\t\t\tconst rmsLevel = calculateRMS(timeDomainData);\n\t\t\t\t\t// Push the calculated decibel level to visualizerData\n\t\t\t\t\tvisualizerData.push(normalizeRMS(rmsLevel));\n\n\t\t\t\t\t// Ensure visualizerData array stays within the buffer length\n\t\t\t\t\tif (visualizerData.length >= VISUALIZER_BUFFER_LENGTH) {\n\t\t\t\t\t\tvisualizerData.shift();\n\t\t\t\t\t}\n\n\t\t\t\t\tvisualizerData = visualizerData;\n\n\t\t\t\t\t// if (domainData.some((value) => value > 0)) {\n\t\t\t\t\t// \tlastSoundTime = Date.now();\n\t\t\t\t\t// }\n\n\t\t\t\t\t// if (recording && Date.now() - lastSoundTime > 3000) {\n\t\t\t\t\t// \tif ($settings?.speechAutoSend ?? false) {\n\t\t\t\t\t// \t\tconfirmRecording();\n\t\t\t\t\t// \t}\n\t\t\t\t\t// }\n\t\t\t\t}\n\n\t\t\t\twindow.requestAnimationFrame(processFrame);\n\t\t\t};\n\n\t\t\twindow.requestAnimationFrame(processFrame);\n\t\t};\n\n\t\tdetectSound();\n\t};\n\n\tconst transcribeHandler = async (audioBlob) => {\n\t\t// Create a blob from the audio chunks\n\n\t\tawait tick();\n\t\tconst file = blobToFile(audioBlob, 'recording.wav');\n\n\t\tconst res = await transcribeAudio(localStorage.token, file).catch((error) => {\n\t\t\ttoast.error(error);\n\t\t\treturn null;\n\t\t});\n\n\t\tif (res) {\n\t\t\tconsole.log(res.text);\n\t\t\tdispatch('confirm', res.text);\n\t\t}\n\t};\n\n\tconst saveRecording = (blob) => {\n\t\tconst url = URL.createObjectURL(blob);\n\t\tconst a = document.createElement('a');\n\t\tdocument.body.appendChild(a);\n\t\ta.style = 'display: none';\n\t\ta.href = url;\n\t\ta.download = 'recording.wav';\n\t\ta.click();\n\t\twindow.URL.revokeObjectURL(url);\n\t};\n\n\tconst startRecording = async () => {\n\t\tstartDurationCounter();\n\n\t\tconst stream = await navigator.mediaDevices.getUserMedia({ audio: true });\n\t\tmediaRecorder = new MediaRecorder(stream);\n\t\tmediaRecorder.onstart = () => {\n\t\t\tconsole.log('Recording started');\n\t\t\taudioChunks = [];\n\t\t\tanalyseAudio(stream);\n\t\t};\n\t\tmediaRecorder.ondataavailable = (event) => audioChunks.push(event.data);\n\t\tmediaRecorder.onstop = async () => {\n\t\t\tconsole.log('Recording stopped');\n\t\t\tif (($settings?.audio?.stt?.engine ?? '') === 'web') {\n\t\t\t\taudioChunks = [];\n\t\t\t} else {\n\t\t\t\tif (confirmed) {\n\t\t\t\t\tconst audioBlob = new Blob(audioChunks, { type: 'audio/wav' });\n\n\t\t\t\t\tawait transcribeHandler(audioBlob);\n\n\t\t\t\t\tconfirmed = false;\n\t\t\t\t\tloading = false;\n\t\t\t\t}\n\t\t\t\taudioChunks = [];\n\t\t\t\trecording = false;\n\t\t\t}\n\t\t};\n\t\tmediaRecorder.start();\n\t\tif ($config.audio.stt.engine === 'web' || ($settings?.audio?.stt?.engine ?? '') === 'web') {\n\t\t\tif ('SpeechRecognition' in window || 'webkitSpeechRecognition' in window) {\n\t\t\t\t// Create a SpeechRecognition object\n\t\t\t\tspeechRecognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();\n\n\t\t\t\t// Set continuous to true for continuous recognition\n\t\t\t\tspeechRecognition.continuous = true;\n\n\t\t\t\t// Set the timeout for turning off the recognition after inactivity (in milliseconds)\n\t\t\t\tconst inactivityTimeout = 2000; // 3 seconds\n\n\t\t\t\tlet timeoutId;\n\t\t\t\t// Start recognition\n\t\t\t\tspeechRecognition.start();\n\n\t\t\t\t// Event triggered when speech is recognized\n\t\t\t\tspeechRecognition.onresult = async (event) => {\n\t\t\t\t\t// Clear the inactivity timeout\n\t\t\t\t\tclearTimeout(timeoutId);\n\n\t\t\t\t\t// Handle recognized speech\n\t\t\t\t\tconsole.log(event);\n\t\t\t\t\tconst transcript = event.results[Object.keys(event.results).length - 1][0].transcript;\n\n\t\t\t\t\ttranscription = `${transcription}${transcript}`;\n\n\t\t\t\t\tawait tick();\n\t\t\t\t\tdocument.getElementById('chat-textarea')?.focus();\n\n\t\t\t\t\t// Restart the inactivity timeout\n\t\t\t\t\ttimeoutId = setTimeout(() => {\n\t\t\t\t\t\tconsole.log('Speech recognition turned off due to inactivity.');\n\t\t\t\t\t\tspeechRecognition.stop();\n\t\t\t\t\t}, inactivityTimeout);\n\t\t\t\t};\n\n\t\t\t\t// Event triggered when recognition is ended\n\t\t\t\tspeechRecognition.onend = function () {\n\t\t\t\t\t// Restart recognition after it ends\n\t\t\t\t\tconsole.log('recognition ended');\n\n\t\t\t\t\tconfirmRecording();\n\t\t\t\t\tdispatch('confirm', transcription);\n\n\t\t\t\t\tconfirmed = false;\n\t\t\t\t\tloading = false;\n\t\t\t\t};\n\n\t\t\t\t// Event triggered when an error occurs\n\t\t\t\tspeechRecognition.onerror = function (event) {\n\t\t\t\t\tconsole.log(event);\n\t\t\t\t\ttoast.error($i18n.t(`Speech recognition error: {{error}}`, { error: event.error }));\n\t\t\t\t\tdispatch('cancel');\n\n\t\t\t\t\tstopRecording();\n\t\t\t\t};\n\t\t\t}\n\t\t}\n\t};\n\n\tconst stopRecording = async () => {\n\t\tif (recording && mediaRecorder) {\n\t\t\tawait mediaRecorder.stop();\n\t\t}\n\t\tstopDurationCounter();\n\t\taudioChunks = [];\n\t};\n\n\tconst confirmRecording = async () => {\n\t\tloading = true;\n\t\tconfirmed = true;\n\n\t\tif (recording && mediaRecorder) {\n\t\t\tawait mediaRecorder.stop();\n\t\t}\n\t\tclearInterval(durationCounter);\n\t};\n</script>\n\n<div\n\tclass=\"{loading\n\t\t? ' bg-gray-100/50 dark:bg-gray-850/50'\n\t\t: 'bg-indigo-300/10 dark:bg-indigo-500/10 '} rounded-full flex p-2.5\"\n>\n\t<div class=\"flex items-center mr-1\">\n\t\t<button\n\t\t\ttype=\"button\"\n\t\t\tclass=\"p-1.5\n\n            {loading\n\t\t\t\t? ' bg-gray-200 dark:bg-gray-700/50'\n\t\t\t\t: 'bg-indigo-400/20 text-indigo-600 dark:text-indigo-300 '} \n\n\n             rounded-full\"\n\t\t\ton:click={async () => {\n\t\t\t\tdispatch('cancel');\n\t\t\t\tstopRecording();\n\t\t\t}}\n\t\t>\n\t\t\t<svg\n\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\tfill=\"none\"\n\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\tstroke-width=\"3\"\n\t\t\t\tstroke=\"currentColor\"\n\t\t\t\tclass=\"size-4\"\n\t\t\t>\n\t\t\t\t<path stroke-linecap=\"round\" stroke-linejoin=\"round\" d=\"M6 18 18 6M6 6l12 12\" />\n\t\t\t</svg>\n\t\t</button>\n\t</div>\n\n\t<div\n\t\tclass=\"flex flex-1 self-center items-center justify-between ml-2 mx-1 overflow-hidden h-6\"\n\t\tdir=\"rtl\"\n\t>\n\t\t<div class=\"flex-1 flex items-center gap-0.5 h-6\">\n\t\t\t{#each visualizerData.slice().reverse() as rms}\n\t\t\t\t<div\n\t\t\t\t\tclass=\"w-[2px]\n                    \n                    {loading\n\t\t\t\t\t\t? ' bg-gray-500 dark:bg-gray-400   '\n\t\t\t\t\t\t: 'bg-indigo-500 dark:bg-indigo-400  '} \n                    \n                    inline-block h-full\"\n\t\t\t\t\tstyle=\"height: {Math.min(100, Math.max(14, rms * 100))}%;\"\n\t\t\t\t/>\n\t\t\t{/each}\n\t\t</div>\n\t</div>\n\n\t<div class=\"  mx-1.5 pr-1 flex justify-center items-center\">\n\t\t<div\n\t\t\tclass=\"text-sm\n        \n        \n        {loading ? ' text-gray-500  dark:text-gray-400  ' : ' text-indigo-400 '} \n       font-medium flex-1 mx-auto text-center\"\n\t\t>\n\t\t\t{formatSeconds(durationSeconds)}\n\t\t</div>\n\t</div>\n\n\t<div class=\"flex items-center mr-1\">\n\t\t{#if loading}\n\t\t\t<div class=\" text-gray-500 rounded-full cursor-not-allowed\">\n\t\t\t\t<svg\n\t\t\t\t\twidth=\"24\"\n\t\t\t\t\theight=\"24\"\n\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\tfill=\"currentColor\"\n\t\t\t\t\t><style>\n\t\t\t\t\t\t.spinner_OSmW {\n\t\t\t\t\t\t\ttransform-origin: center;\n\t\t\t\t\t\t\tanimation: spinner_T6mA 0.75s step-end infinite;\n\t\t\t\t\t\t}\n\t\t\t\t\t\t@keyframes spinner_T6mA {\n\t\t\t\t\t\t\t8.3% {\n\t\t\t\t\t\t\t\ttransform: rotate(30deg);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t16.6% {\n\t\t\t\t\t\t\t\ttransform: rotate(60deg);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t25% {\n\t\t\t\t\t\t\t\ttransform: rotate(90deg);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t33.3% {\n\t\t\t\t\t\t\t\ttransform: rotate(120deg);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t41.6% {\n\t\t\t\t\t\t\t\ttransform: rotate(150deg);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t50% {\n\t\t\t\t\t\t\t\ttransform: rotate(180deg);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t58.3% {\n\t\t\t\t\t\t\t\ttransform: rotate(210deg);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t66.6% {\n\t\t\t\t\t\t\t\ttransform: rotate(240deg);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t75% {\n\t\t\t\t\t\t\t\ttransform: rotate(270deg);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t83.3% {\n\t\t\t\t\t\t\t\ttransform: rotate(300deg);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t91.6% {\n\t\t\t\t\t\t\t\ttransform: rotate(330deg);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t100% {\n\t\t\t\t\t\t\t\ttransform: rotate(360deg);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t</style><g class=\"spinner_OSmW\"\n\t\t\t\t\t\t><rect x=\"11\" y=\"1\" width=\"2\" height=\"5\" opacity=\".14\" /><rect\n\t\t\t\t\t\t\tx=\"11\"\n\t\t\t\t\t\t\ty=\"1\"\n\t\t\t\t\t\t\twidth=\"2\"\n\t\t\t\t\t\t\theight=\"5\"\n\t\t\t\t\t\t\ttransform=\"rotate(30 12 12)\"\n\t\t\t\t\t\t\topacity=\".29\"\n\t\t\t\t\t\t/><rect\n\t\t\t\t\t\t\tx=\"11\"\n\t\t\t\t\t\t\ty=\"1\"\n\t\t\t\t\t\t\twidth=\"2\"\n\t\t\t\t\t\t\theight=\"5\"\n\t\t\t\t\t\t\ttransform=\"rotate(60 12 12)\"\n\t\t\t\t\t\t\topacity=\".43\"\n\t\t\t\t\t\t/><rect\n\t\t\t\t\t\t\tx=\"11\"\n\t\t\t\t\t\t\ty=\"1\"\n\t\t\t\t\t\t\twidth=\"2\"\n\t\t\t\t\t\t\theight=\"5\"\n\t\t\t\t\t\t\ttransform=\"rotate(90 12 12)\"\n\t\t\t\t\t\t\topacity=\".57\"\n\t\t\t\t\t\t/><rect\n\t\t\t\t\t\t\tx=\"11\"\n\t\t\t\t\t\t\ty=\"1\"\n\t\t\t\t\t\t\twidth=\"2\"\n\t\t\t\t\t\t\theight=\"5\"\n\t\t\t\t\t\t\ttransform=\"rotate(120 12 12)\"\n\t\t\t\t\t\t\topacity=\".71\"\n\t\t\t\t\t\t/><rect\n\t\t\t\t\t\t\tx=\"11\"\n\t\t\t\t\t\t\ty=\"1\"\n\t\t\t\t\t\t\twidth=\"2\"\n\t\t\t\t\t\t\theight=\"5\"\n\t\t\t\t\t\t\ttransform=\"rotate(150 12 12)\"\n\t\t\t\t\t\t\topacity=\".86\"\n\t\t\t\t\t\t/><rect x=\"11\" y=\"1\" width=\"2\" height=\"5\" transform=\"rotate(180 12 12)\" /></g\n\t\t\t\t\t></svg\n\t\t\t\t>\n\t\t\t</div>\n\t\t{:else}\n\t\t\t<button\n\t\t\t\ttype=\"button\"\n\t\t\t\tclass=\"p-1.5 bg-indigo-500 text-white dark:bg-indigo-500 dark:text-blue-950 rounded-full\"\n\t\t\t\ton:click={async () => {\n\t\t\t\t\tawait confirmRecording();\n\t\t\t\t}}\n\t\t\t>\n\t\t\t\t<svg\n\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\tfill=\"none\"\n\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\tstroke-width=\"2.5\"\n\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\tclass=\"size-4\"\n\t\t\t\t>\n\t\t\t\t\t<path stroke-linecap=\"round\" stroke-linejoin=\"round\" d=\"m4.5 12.75 6 6 9-13.5\" />\n\t\t\t\t</svg>\n\t\t\t</button>\n\t\t{/if}\n\t</div>\n</div>\n\n<style>\n\t.visualizer {\n\t\tdisplay: flex;\n\t\theight: 100%;\n\t}\n\n\t.visualizer-bar {\n\t\twidth: 2px;\n\t\tbackground-color: #4a5aba; /* or whatever color you need */\n\t}\n</style>\n","<script lang=\"ts\">\n\timport { toast } from 'svelte-sonner';\n\timport { onMount, tick, getContext } from 'svelte';\n\timport {\n\t\ttype Model,\n\t\tmobile,\n\t\tsettings,\n\t\tshowSidebar,\n\t\tmodels,\n\t\tconfig,\n\t\tshowCallOverlay,\n\t\ttools,\n\t\tuser as _user\n\t} from '$lib/stores';\n\timport { blobToFile, calculateSHA256, findWordIndices } from '$lib/utils';\n\n\timport {\n\t\tuploadDocToVectorDB,\n\t\tuploadWebToVectorDB,\n\t\tuploadYoutubeTranscriptionToVectorDB\n\t} from '$lib/apis/rag';\n\timport { SUPPORTED_FILE_TYPE, SUPPORTED_FILE_EXTENSIONS, WEBUI_BASE_URL } from '$lib/constants';\n\n\timport Prompts from './MessageInput/PromptCommands.svelte';\n\timport Suggestions from './MessageInput/Suggestions.svelte';\n\timport AddFilesPlaceholder from '../AddFilesPlaceholder.svelte';\n\timport Documents from './MessageInput/Documents.svelte';\n\timport Models from './MessageInput/Models.svelte';\n\timport Tooltip from '../common/Tooltip.svelte';\n\timport XMark from '$lib/components/icons/XMark.svelte';\n\timport InputMenu from './MessageInput/InputMenu.svelte';\n\timport Headphone from '../icons/Headphone.svelte';\n\timport VoiceRecording from './MessageInput/VoiceRecording.svelte';\n\timport { transcribeAudio } from '$lib/apis/audio';\n\n\tconst i18n = getContext('i18n');\n\n\texport let submitPrompt: Function;\n\texport let stopResponse: Function;\n\n\texport let autoScroll = true;\n\n\texport let atSelectedModel: Model | undefined;\n\texport let selectedModels: [''];\n\n\tlet recording = false;\n\n\tlet chatTextAreaElement: HTMLTextAreaElement;\n\tlet filesInputElement;\n\n\tlet promptsElement;\n\tlet documentsElement;\n\tlet modelsElement;\n\n\tlet inputFiles;\n\tlet dragged = false;\n\n\tlet user = null;\n\tlet chatInputPlaceholder = '';\n\n\texport let files = [];\n\n\texport let availableToolIds = [];\n\texport let selectedToolIds = [];\n\texport let webSearchEnabled = false;\n\n\texport let prompt = '';\n\texport let messages = [];\n\n\tlet visionCapableModels = [];\n\t$: visionCapableModels = [...(atSelectedModel ? [atSelectedModel] : selectedModels)].filter(\n\t\t(model) => $models.find((m) => m.id === model)?.info?.meta?.capabilities?.vision ?? true\n\t);\n\n\t$: if (prompt) {\n\t\tif (chatTextAreaElement) {\n\t\t\tchatTextAreaElement.style.height = '';\n\t\t\tchatTextAreaElement.style.height = Math.min(chatTextAreaElement.scrollHeight, 200) + 'px';\n\t\t}\n\t}\n\n\tconst scrollToBottom = () => {\n\t\tconst element = document.getElementById('messages-container');\n\t\telement.scrollTop = element.scrollHeight;\n\t};\n\n\tconst uploadDoc = async (file) => {\n\t\tconsole.log(file);\n\n\t\tconst doc = {\n\t\t\ttype: 'doc',\n\t\t\tname: file.name,\n\t\t\tcollection_name: '',\n\t\t\tupload_status: false,\n\t\t\terror: ''\n\t\t};\n\n\t\ttry {\n\t\t\tfiles = [...files, doc];\n\n\t\t\tif (['audio/mpeg', 'audio/wav'].includes(file['type'])) {\n\t\t\t\tconst res = await transcribeAudio(localStorage.token, file).catch((error) => {\n\t\t\t\t\ttoast.error(error);\n\t\t\t\t\treturn null;\n\t\t\t\t});\n\n\t\t\t\tif (res) {\n\t\t\t\t\tconsole.log(res);\n\t\t\t\t\tconst blob = new Blob([res.text], { type: 'text/plain' });\n\t\t\t\t\tfile = blobToFile(blob, `${file.name}.txt`);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tconst res = await uploadDocToVectorDB(localStorage.token, '', file);\n\n\t\t\tif (res) {\n\t\t\t\tdoc.upload_status = true;\n\t\t\t\tdoc.collection_name = res.collection_name;\n\t\t\t\tfiles = files;\n\t\t\t}\n\t\t} catch (e) {\n\t\t\t// Remove the failed doc from the files array\n\t\t\tfiles = files.filter((f) => f.name !== file.name);\n\t\t\ttoast.error(e);\n\t\t}\n\t};\n\n\tconst uploadWeb = async (url) => {\n\t\tconsole.log(url);\n\n\t\tconst doc = {\n\t\t\ttype: 'doc',\n\t\t\tname: url,\n\t\t\tcollection_name: '',\n\t\t\tupload_status: false,\n\t\t\turl: url,\n\t\t\terror: ''\n\t\t};\n\n\t\ttry {\n\t\t\tfiles = [...files, doc];\n\t\t\tconst res = await uploadWebToVectorDB(localStorage.token, '', url);\n\n\t\t\tif (res) {\n\t\t\t\tdoc.upload_status = true;\n\t\t\t\tdoc.collection_name = res.collection_name;\n\t\t\t\tfiles = files;\n\t\t\t}\n\t\t} catch (e) {\n\t\t\t// Remove the failed doc from the files array\n\t\t\tfiles = files.filter((f) => f.name !== url);\n\t\t\ttoast.error(e);\n\t\t}\n\t};\n\n\tconst uploadYoutubeTranscription = async (url) => {\n\t\tconsole.log(url);\n\n\t\tconst doc = {\n\t\t\ttype: 'doc',\n\t\t\tname: url,\n\t\t\tcollection_name: '',\n\t\t\tupload_status: false,\n\t\t\turl: url,\n\t\t\terror: ''\n\t\t};\n\n\t\ttry {\n\t\t\tfiles = [...files, doc];\n\t\t\tconst res = await uploadYoutubeTranscriptionToVectorDB(localStorage.token, url);\n\n\t\t\tif (res) {\n\t\t\t\tdoc.upload_status = true;\n\t\t\t\tdoc.collection_name = res.collection_name;\n\t\t\t\tfiles = files;\n\t\t\t}\n\t\t} catch (e) {\n\t\t\t// Remove the failed doc from the files array\n\t\t\tfiles = files.filter((f) => f.name !== url);\n\t\t\ttoast.error(e);\n\t\t}\n\t};\n\n\tonMount(() => {\n\t\twindow.setTimeout(() => chatTextAreaElement?.focus(), 0);\n\n\t\tconst dropZone = document.querySelector('body');\n\n\t\tconst handleKeyDown = (event: KeyboardEvent) => {\n\t\t\tif (event.key === 'Escape') {\n\t\t\t\tconsole.log('Escape');\n\t\t\t\tdragged = false;\n\t\t\t}\n\t\t};\n\n\t\tconst onDragOver = (e) => {\n\t\t\te.preventDefault();\n\t\t\tdragged = true;\n\t\t};\n\n\t\tconst onDragLeave = () => {\n\t\t\tdragged = false;\n\t\t};\n\n\t\tconst onDrop = async (e) => {\n\t\t\te.preventDefault();\n\t\t\tconsole.log(e);\n\n\t\t\tif (e.dataTransfer?.files) {\n\t\t\t\tconst inputFiles = Array.from(e.dataTransfer?.files);\n\n\t\t\t\tif (inputFiles && inputFiles.length > 0) {\n\t\t\t\t\tinputFiles.forEach((file) => {\n\t\t\t\t\t\tconsole.log(file, file.name.split('.').at(-1));\n\t\t\t\t\t\tif (['image/gif', 'image/webp', 'image/jpeg', 'image/png'].includes(file['type'])) {\n\t\t\t\t\t\t\tif (visionCapableModels.length === 0) {\n\t\t\t\t\t\t\t\ttoast.error($i18n.t('Selected model(s) do not support image inputs'));\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tlet reader = new FileReader();\n\t\t\t\t\t\t\treader.onload = (event) => {\n\t\t\t\t\t\t\t\tfiles = [\n\t\t\t\t\t\t\t\t\t...files,\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\ttype: 'image',\n\t\t\t\t\t\t\t\t\t\turl: `${event.target.result}`\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t];\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\treader.readAsDataURL(file);\n\t\t\t\t\t\t} else if (\n\t\t\t\t\t\t\tSUPPORTED_FILE_TYPE.includes(file['type']) ||\n\t\t\t\t\t\t\tSUPPORTED_FILE_EXTENSIONS.includes(file.name.split('.').at(-1))\n\t\t\t\t\t\t) {\n\t\t\t\t\t\t\tuploadDoc(file);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\ttoast.error(\n\t\t\t\t\t\t\t\t$i18n.t(\n\t\t\t\t\t\t\t\t\t`Unknown File Type '{{file_type}}', but accepting and treating as plain text`,\n\t\t\t\t\t\t\t\t\t{ file_type: file['type'] }\n\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\tuploadDoc(file);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\ttoast.error($i18n.t(`File not found.`));\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tdragged = false;\n\t\t};\n\n\t\twindow.addEventListener('keydown', handleKeyDown);\n\n\t\tdropZone?.addEventListener('dragover', onDragOver);\n\t\tdropZone?.addEventListener('drop', onDrop);\n\t\tdropZone?.addEventListener('dragleave', onDragLeave);\n\n\t\treturn () => {\n\t\t\twindow.removeEventListener('keydown', handleKeyDown);\n\n\t\t\tdropZone?.removeEventListener('dragover', onDragOver);\n\t\t\tdropZone?.removeEventListener('drop', onDrop);\n\t\t\tdropZone?.removeEventListener('dragleave', onDragLeave);\n\t\t};\n\t});\n</script>\n\n{#if dragged}\n\t<div\n\t\tclass=\"fixed {$showSidebar\n\t\t\t? 'left-0 md:left-[260px] md:w-[calc(100%-260px)]'\n\t\t\t: 'left-0'}  w-full h-full flex z-50 touch-none pointer-events-none\"\n\t\tid=\"dropzone\"\n\t\trole=\"region\"\n\t\taria-label=\"Drag and Drop Container\"\n\t>\n\t\t<div class=\"absolute w-full h-full backdrop-blur bg-gray-800/40 flex justify-center\">\n\t\t\t<div class=\"m-auto pt-64 flex flex-col justify-center\">\n\t\t\t\t<div class=\"max-w-md\">\n\t\t\t\t\t<AddFilesPlaceholder />\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n{/if}\n\n<div class=\"w-full\">\n\t<div class=\" -mb-0.5 mx-auto inset-x-0 bg-transparent flex justify-center\">\n\t\t<div class=\"flex flex-col max-w-6xl px-2.5 md:px-6 w-full\">\n\t\t\t<div class=\"relative\">\n\t\t\t\t{#if autoScroll === false && messages.length > 0}\n\t\t\t\t\t<div class=\" absolute -top-12 left-0 right-0 flex justify-center z-30\">\n\t\t\t\t\t\t<button\n\t\t\t\t\t\t\tclass=\" bg-white border border-gray-100 dark:border-none dark:bg-white/20 p-1.5 rounded-full\"\n\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\tautoScroll = true;\n\t\t\t\t\t\t\t\tscrollToBottom();\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<svg\n\t\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\t\t\t\tviewBox=\"0 0 20 20\"\n\t\t\t\t\t\t\t\tfill=\"currentColor\"\n\t\t\t\t\t\t\t\tclass=\"w-5 h-5\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\tfill-rule=\"evenodd\"\n\t\t\t\t\t\t\t\t\td=\"M10 3a.75.75 0 01.75.75v10.638l3.96-4.158a.75.75 0 111.08 1.04l-5.25 5.5a.75.75 0 01-1.08 0l-5.25-5.5a.75.75 0 111.08-1.04l3.96 4.158V3.75A.75.75 0 0110 3z\"\n\t\t\t\t\t\t\t\t\tclip-rule=\"evenodd\"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</div>\n\t\t\t\t{/if}\n\t\t\t</div>\n\n\t\t\t<div class=\"w-full relative\">\n\t\t\t\t{#if prompt.charAt(0) === '/'}\n\t\t\t\t\t<Prompts bind:this={promptsElement} bind:prompt bind:files />\n\t\t\t\t{:else if prompt.charAt(0) === '#'}\n\t\t\t\t\t<Documents\n\t\t\t\t\t\tbind:this={documentsElement}\n\t\t\t\t\t\tbind:prompt\n\t\t\t\t\t\ton:youtube={(e) => {\n\t\t\t\t\t\t\tconsole.log(e);\n\t\t\t\t\t\t\tuploadYoutubeTranscription(e.detail);\n\t\t\t\t\t\t}}\n\t\t\t\t\t\ton:url={(e) => {\n\t\t\t\t\t\t\tconsole.log(e);\n\t\t\t\t\t\t\tuploadWeb(e.detail);\n\t\t\t\t\t\t}}\n\t\t\t\t\t\ton:select={(e) => {\n\t\t\t\t\t\t\tconsole.log(e);\n\t\t\t\t\t\t\tfiles = [\n\t\t\t\t\t\t\t\t...files,\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\ttype: e?.detail?.type ?? 'doc',\n\t\t\t\t\t\t\t\t\t...e.detail,\n\t\t\t\t\t\t\t\t\tupload_status: true\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t];\n\t\t\t\t\t\t}}\n\t\t\t\t\t/>\n\t\t\t\t{/if}\n\n\t\t\t\t<Models\n\t\t\t\t\tbind:this={modelsElement}\n\t\t\t\t\tbind:prompt\n\t\t\t\t\tbind:chatInputPlaceholder\n\t\t\t\t\t{messages}\n\t\t\t\t\ton:select={(e) => {\n\t\t\t\t\t\tatSelectedModel = e.detail;\n\t\t\t\t\t\tchatTextAreaElement?.focus();\n\t\t\t\t\t}}\n\t\t\t\t/>\n\n\t\t\t\t{#if atSelectedModel !== undefined}\n\t\t\t\t\t<div\n\t\t\t\t\t\tclass=\"px-3 py-2.5 text-left w-full flex justify-between items-center absolute bottom-0 left-0 right-0 bg-gradient-to-t from-50% from-white dark:from-gray-900\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<div class=\"flex items-center gap-2 text-sm dark:text-gray-500\">\n\t\t\t\t\t\t\t<img\n\t\t\t\t\t\t\t\tcrossorigin=\"anonymous\"\n\t\t\t\t\t\t\t\talt=\"model profile\"\n\t\t\t\t\t\t\t\tclass=\"size-5 max-w-[28px] object-cover rounded-full\"\n\t\t\t\t\t\t\t\tsrc={$models.find((model) => model.id === atSelectedModel.id)?.info?.meta\n\t\t\t\t\t\t\t\t\t?.profile_image_url ??\n\t\t\t\t\t\t\t\t\t($i18n.language === 'dg-DG'\n\t\t\t\t\t\t\t\t\t\t? `/doge.png`\n\t\t\t\t\t\t\t\t\t\t: `${WEBUI_BASE_URL}/static/favicon.png`)}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\tTalking to <span class=\" font-medium\">{atSelectedModel.name}</span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\tclass=\"flex items-center\"\n\t\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\t\tatSelectedModel = undefined;\n\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<XMark />\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t{/if}\n\t\t\t</div>\n\t\t</div>\n\t</div>\n\n\t<div class=\"bg-white dark:bg-gray-900\">\n\t\t<div class=\"max-w-6xl px-2.5 md:px-6 mx-auto inset-x-0\">\n\t\t\t<div class=\" pb-2\">\n\t\t\t\t<input\n\t\t\t\t\tbind:this={filesInputElement}\n\t\t\t\t\tbind:files={inputFiles}\n\t\t\t\t\ttype=\"file\"\n\t\t\t\t\thidden\n\t\t\t\t\tmultiple\n\t\t\t\t\ton:change={async () => {\n\t\t\t\t\t\tif (inputFiles && inputFiles.length > 0) {\n\t\t\t\t\t\t\tconst _inputFiles = Array.from(inputFiles);\n\t\t\t\t\t\t\t_inputFiles.forEach((file) => {\n\t\t\t\t\t\t\t\tif (['image/gif', 'image/webp', 'image/jpeg', 'image/png'].includes(file['type'])) {\n\t\t\t\t\t\t\t\t\tif (visionCapableModels.length === 0) {\n\t\t\t\t\t\t\t\t\t\ttoast.error($i18n.t('Selected model(s) do not support image inputs'));\n\t\t\t\t\t\t\t\t\t\tinputFiles = null;\n\t\t\t\t\t\t\t\t\t\tfilesInputElement.value = '';\n\t\t\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tlet reader = new FileReader();\n\t\t\t\t\t\t\t\t\treader.onload = (event) => {\n\t\t\t\t\t\t\t\t\t\tfiles = [\n\t\t\t\t\t\t\t\t\t\t\t...files,\n\t\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\t\ttype: 'image',\n\t\t\t\t\t\t\t\t\t\t\t\turl: `${event.target.result}`\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t];\n\t\t\t\t\t\t\t\t\t\tinputFiles = null;\n\t\t\t\t\t\t\t\t\t\tfilesInputElement.value = '';\n\t\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\t\treader.readAsDataURL(file);\n\t\t\t\t\t\t\t\t} else if (\n\t\t\t\t\t\t\t\t\tSUPPORTED_FILE_TYPE.includes(file['type']) ||\n\t\t\t\t\t\t\t\t\tSUPPORTED_FILE_EXTENSIONS.includes(file.name.split('.').at(-1))\n\t\t\t\t\t\t\t\t) {\n\t\t\t\t\t\t\t\t\tuploadDoc(file);\n\t\t\t\t\t\t\t\t\tfilesInputElement.value = '';\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\ttoast.error(\n\t\t\t\t\t\t\t\t\t\t$i18n.t(\n\t\t\t\t\t\t\t\t\t\t\t`Unknown File Type '{{file_type}}', but accepting and treating as plain text`,\n\t\t\t\t\t\t\t\t\t\t\t{ file_type: file['type'] }\n\t\t\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\tuploadDoc(file);\n\t\t\t\t\t\t\t\t\tfilesInputElement.value = '';\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\ttoast.error($i18n.t(`File not found.`));\n\t\t\t\t\t\t}\n\t\t\t\t\t}}\n\t\t\t\t/>\n\n\t\t\t\t{#if recording}\n\t\t\t\t\t<VoiceRecording\n\t\t\t\t\t\tbind:recording\n\t\t\t\t\t\ton:cancel={async () => {\n\t\t\t\t\t\t\trecording = false;\n\n\t\t\t\t\t\t\tawait tick();\n\t\t\t\t\t\t\tdocument.getElementById('chat-textarea')?.focus();\n\t\t\t\t\t\t}}\n\t\t\t\t\t\ton:confirm={async (e) => {\n\t\t\t\t\t\t\tconst response = e.detail;\n\t\t\t\t\t\t\tprompt = `${prompt}${response} `;\n\n\t\t\t\t\t\t\trecording = false;\n\n\t\t\t\t\t\t\tawait tick();\n\t\t\t\t\t\t\tdocument.getElementById('chat-textarea')?.focus();\n\n\t\t\t\t\t\t\tif ($settings?.speechAutoSend ?? false) {\n\t\t\t\t\t\t\t\tsubmitPrompt(prompt);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}}\n\t\t\t\t\t/>\n\t\t\t\t{:else}\n\t\t\t\t\t<form\n\t\t\t\t\t\tclass=\"w-full flex gap-1.5\"\n\t\t\t\t\t\ton:submit|preventDefault={() => {\n\t\t\t\t\t\t\t// check if selectedModels support image input\n\t\t\t\t\t\t\tsubmitPrompt(prompt);\n\t\t\t\t\t\t}}\n\t\t\t\t\t>\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tclass=\"flex-1 flex flex-col relative w-full rounded-3xl px-1.5 bg-gray-50 dark:bg-gray-850 dark:text-gray-100\"\n\t\t\t\t\t\t\tdir={$settings?.chatDirection ?? 'LTR'}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{#if files.length > 0}\n\t\t\t\t\t\t\t\t<div class=\"mx-2 mt-2 mb-1 flex flex-wrap gap-2\">\n\t\t\t\t\t\t\t\t\t{#each files as file, fileIdx}\n\t\t\t\t\t\t\t\t\t\t<div class=\" relative group\">\n\t\t\t\t\t\t\t\t\t\t\t{#if file.type === 'image'}\n\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"relative\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<img\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tsrc={file.url}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\talt=\"input\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tclass=\" h-16 w-16 rounded-xl object-cover\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t\t\t\t{#if atSelectedModel ? visionCapableModels.length === 0 : selectedModels.length !== visionCapableModels.length}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Tooltip\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tclassName=\" absolute top-1 left-1\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcontent={$i18n.t('{{ models }}', {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tmodels: [...(atSelectedModel ? [atSelectedModel] : selectedModels)]\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t.filter((id) => !visionCapableModels.includes(id))\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t.join(', ')\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t})}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<svg\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tfill=\"currentColor\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tclass=\"size-4 fill-yellow-300\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tfill-rule=\"evenodd\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\td=\"M9.401 3.003c1.155-2 4.043-2 5.197 0l7.355 12.748c1.154 2-.29 4.5-2.599 4.5H4.645c-2.309 0-3.752-2.5-2.598-4.5L9.4 3.003ZM12 8.25a.75.75 0 0 1 .75.75v3.75a.75.75 0 0 1-1.5 0V9a.75.75 0 0 1 .75-.75Zm0 8.25a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5Z\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tclip-rule=\"evenodd\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</Tooltip>\n\t\t\t\t\t\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t{:else if file.type === 'doc'}\n\t\t\t\t\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\t\t\t\t\tclass=\"h-16 w-[15rem] flex items-center space-x-3 px-2.5 dark:bg-gray-600 rounded-xl border border-gray-200 dark:border-none\"\n\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"p-2.5 bg-red-400 text-white rounded-lg\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t{#if file.upload_status}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<svg\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tfill=\"currentColor\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tclass=\"w-6 h-6\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tfill-rule=\"evenodd\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\td=\"M5.625 1.5c-1.036 0-1.875.84-1.875 1.875v17.25c0 1.035.84 1.875 1.875 1.875h12.75c1.035 0 1.875-.84 1.875-1.875V12.75A3.75 3.75 0 0 0 16.5 9h-1.875a1.875 1.875 0 0 1-1.875-1.875V5.25A3.75 3.75 0 0 0 9 1.5H5.625ZM7.5 15a.75.75 0 0 1 .75-.75h7.5a.75.75 0 0 1 0 1.5h-7.5A.75.75 0 0 1 7.5 15Zm.75 2.25a.75.75 0 0 0 0 1.5H12a.75.75 0 0 0 0-1.5H8.25Z\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tclip-rule=\"evenodd\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\td=\"M12.971 1.816A5.23 5.23 0 0 1 14.25 5.25v1.875c0 .207.168.375.375.375H16.5a5.23 5.23 0 0 1 3.434 1.279 9.768 9.768 0 0 0-6.963-6.963Z\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t{:else}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<svg\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tclass=\" w-6 h-6 translate-y-[0.5px]\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tfill=\"currentColor\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t><style>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t.spinner_qM83 {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tanimation: spinner_8HQG 1.05s infinite;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t.spinner_oXPr {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tanimation-delay: 0.1s;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t.spinner_ZTLf {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tanimation-delay: 0.2s;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t@keyframes spinner_8HQG {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t0%,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t57.14% {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tanimation-timing-function: cubic-bezier(0.33, 0.66, 0.66, 1);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttransform: translate(0);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t28.57% {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tanimation-timing-function: cubic-bezier(0.33, 0, 0.66, 0.33);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttransform: translateY(-6px);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t100% {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttransform: translate(0);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</style><circle\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tclass=\"spinner_qM83\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcx=\"4\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcy=\"12\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tr=\"2.5\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t/><circle\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tclass=\"spinner_qM83 spinner_oXPr\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcx=\"12\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcy=\"12\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tr=\"2.5\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t/><circle\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tclass=\"spinner_qM83 spinner_ZTLf\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcx=\"20\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcy=\"12\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tr=\"2.5\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t/></svg\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"flex flex-col justify-center -space-y-0.5\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class=\" dark:text-gray-100 text-sm font-medium line-clamp-1\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{file.name}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class=\" text-gray-500 text-sm\">{$i18n.t('Document')}</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t{:else if file.type === 'collection'}\n\t\t\t\t\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\t\t\t\t\tclass=\"h-16 w-[15rem] flex items-center space-x-3 px-2.5 dark:bg-gray-600 rounded-xl border border-gray-200 dark:border-none\"\n\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"p-2.5 bg-red-400 text-white rounded-lg\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<svg\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tfill=\"currentColor\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tclass=\"w-6 h-6\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\td=\"M7.5 3.375c0-1.036.84-1.875 1.875-1.875h.375a3.75 3.75 0 0 1 3.75 3.75v1.875C13.5 8.161 14.34 9 15.375 9h1.875A3.75 3.75 0 0 1 21 12.75v3.375C21 17.16 20.16 18 19.125 18h-9.75A1.875 1.875 0 0 1 7.5 16.125V3.375Z\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\td=\"M15 5.25a5.23 5.23 0 0 0-1.279-3.434 9.768 9.768 0 0 1 6.963 6.963A5.23 5.23 0 0 0 17.25 7.5h-1.875A.375.375 0 0 1 15 7.125V5.25ZM4.875 6H6v10.125A3.375 3.375 0 0 0 9.375 19.5H16.5v1.125c0 1.035-.84 1.875-1.875 1.875h-9.75A1.875 1.875 0 0 1 3 20.625V7.875C3 6.839 3.84 6 4.875 6Z\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"flex flex-col justify-center -space-y-0.5\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class=\" dark:text-gray-100 text-sm font-medium line-clamp-1\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{file?.title ?? `#${file.name}`}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class=\" text-gray-500 text-sm\">{$i18n.t('Collection')}</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t{/if}\n\n\t\t\t\t\t\t\t\t\t\t\t<div class=\" absolute -top-1 -right-1\">\n\t\t\t\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\t\t\t\tclass=\" bg-gray-400 text-white border border-white rounded-full group-hover:visible invisible transition\"\n\t\t\t\t\t\t\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tfiles.splice(fileIdx, 1);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tfiles = files;\n\t\t\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<svg\n\t\t\t\t\t\t\t\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tviewBox=\"0 0 20 20\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tfill=\"currentColor\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tclass=\"w-4 h-4\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\td=\"M6.28 5.22a.75.75 0 00-1.06 1.06L8.94 10l-3.72 3.72a.75.75 0 101.06 1.06L10 11.06l3.72 3.72a.75.75 0 101.06-1.06L11.06 10l3.72-3.72a.75.75 0 00-1.06-1.06L10 8.94 6.28 5.22z\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t{/each}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t{/if}\n\n\t\t\t\t\t\t\t<div class=\" flex\">\n\t\t\t\t\t\t\t\t<div class=\" ml-0.5 self-end mb-1.5 flex space-x-1\">\n\t\t\t\t\t\t\t\t\t<InputMenu\n\t\t\t\t\t\t\t\t\t\tbind:webSearchEnabled\n\t\t\t\t\t\t\t\t\t\tbind:selectedToolIds\n\t\t\t\t\t\t\t\t\t\ttools={$tools.reduce((a, e, i, arr) => {\n\t\t\t\t\t\t\t\t\t\t\tif (availableToolIds.includes(e.id) || ($_user?.role ?? 'user') === 'admin') {\n\t\t\t\t\t\t\t\t\t\t\t\ta[e.id] = {\n\t\t\t\t\t\t\t\t\t\t\t\t\tname: e.name,\n\t\t\t\t\t\t\t\t\t\t\t\t\tdescription: e.meta.description,\n\t\t\t\t\t\t\t\t\t\t\t\t\tenabled: false\n\t\t\t\t\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\treturn a;\n\t\t\t\t\t\t\t\t\t\t}, {})}\n\t\t\t\t\t\t\t\t\t\tuploadFilesHandler={() => {\n\t\t\t\t\t\t\t\t\t\t\tfilesInputElement.click();\n\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\tonClose={async () => {\n\t\t\t\t\t\t\t\t\t\t\tawait tick();\n\t\t\t\t\t\t\t\t\t\t\tchatTextAreaElement?.focus();\n\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\t\tclass=\"bg-gray-50 hover:bg-gray-100 text-gray-800 dark:bg-gray-850 dark:text-white dark:hover:bg-gray-800 transition rounded-full p-2 outline-none focus:outline-none\"\n\t\t\t\t\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t<svg\n\t\t\t\t\t\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\t\t\t\t\t\t\t\tviewBox=\"0 0 16 16\"\n\t\t\t\t\t\t\t\t\t\t\t\tfill=\"currentColor\"\n\t\t\t\t\t\t\t\t\t\t\t\tclass=\"size-5\"\n\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\t\t\t\t\td=\"M8.75 3.75a.75.75 0 0 0-1.5 0v3.5h-3.5a.75.75 0 0 0 0 1.5h3.5v3.5a.75.75 0 0 0 1.5 0v-3.5h3.5a.75.75 0 0 0 0-1.5h-3.5v-3.5Z\"\n\t\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t\t</InputMenu>\n\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t<textarea\n\t\t\t\t\t\t\t\t\tid=\"chat-textarea\"\n\t\t\t\t\t\t\t\t\tbind:this={chatTextAreaElement}\n\t\t\t\t\t\t\t\t\tclass=\"scrollbar-hidden bg-gray-50 dark:bg-gray-850 dark:text-gray-100 outline-none w-full py-3 px-1 rounded-xl resize-none h-[48px]\"\n\t\t\t\t\t\t\t\t\tplaceholder={chatInputPlaceholder !== ''\n\t\t\t\t\t\t\t\t\t\t? chatInputPlaceholder\n\t\t\t\t\t\t\t\t\t\t: $i18n.t('Send a Message')}\n\t\t\t\t\t\t\t\t\tbind:value={prompt}\n\t\t\t\t\t\t\t\t\ton:keypress={(e) => {\n\t\t\t\t\t\t\t\t\t\tif (\n\t\t\t\t\t\t\t\t\t\t\t!$mobile ||\n\t\t\t\t\t\t\t\t\t\t\t!(\n\t\t\t\t\t\t\t\t\t\t\t\t'ontouchstart' in window ||\n\t\t\t\t\t\t\t\t\t\t\t\tnavigator.maxTouchPoints > 0 ||\n\t\t\t\t\t\t\t\t\t\t\t\tnavigator.msMaxTouchPoints > 0\n\t\t\t\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t\t\t\t) {\n\t\t\t\t\t\t\t\t\t\t\t// Prevent Enter key from creating a new line\n\t\t\t\t\t\t\t\t\t\t\tif (e.key === 'Enter' && !e.shiftKey) {\n\t\t\t\t\t\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\t\t// Submit the prompt when Enter key is pressed\n\t\t\t\t\t\t\t\t\t\t\tif (prompt !== '' && e.key === 'Enter' && !e.shiftKey) {\n\t\t\t\t\t\t\t\t\t\t\t\tsubmitPrompt(prompt);\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\ton:keydown={async (e) => {\n\t\t\t\t\t\t\t\t\t\tconst isCtrlPressed = e.ctrlKey || e.metaKey; // metaKey is for Cmd key on Mac\n\n\t\t\t\t\t\t\t\t\t\t// Check if Ctrl + R is pressed\n\t\t\t\t\t\t\t\t\t\tif (prompt === '' && isCtrlPressed && e.key.toLowerCase() === 'r') {\n\t\t\t\t\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t\t\t\t\t\tconsole.log('regenerate');\n\n\t\t\t\t\t\t\t\t\t\t\tconst regenerateButton = [\n\t\t\t\t\t\t\t\t\t\t\t\t...document.getElementsByClassName('regenerate-response-button')\n\t\t\t\t\t\t\t\t\t\t\t]?.at(-1);\n\n\t\t\t\t\t\t\t\t\t\t\tregenerateButton?.click();\n\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\tif (prompt === '' && e.key == 'ArrowUp') {\n\t\t\t\t\t\t\t\t\t\t\te.preventDefault();\n\n\t\t\t\t\t\t\t\t\t\t\tconst userMessageElement = [\n\t\t\t\t\t\t\t\t\t\t\t\t...document.getElementsByClassName('user-message')\n\t\t\t\t\t\t\t\t\t\t\t]?.at(-1);\n\n\t\t\t\t\t\t\t\t\t\t\tconst editButton = [\n\t\t\t\t\t\t\t\t\t\t\t\t...document.getElementsByClassName('edit-user-message-button')\n\t\t\t\t\t\t\t\t\t\t\t]?.at(-1);\n\n\t\t\t\t\t\t\t\t\t\t\tconsole.log(userMessageElement);\n\n\t\t\t\t\t\t\t\t\t\t\tuserMessageElement.scrollIntoView({ block: 'center' });\n\t\t\t\t\t\t\t\t\t\t\teditButton?.click();\n\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\tif (['/', '#', '@'].includes(prompt.charAt(0)) && e.key === 'ArrowUp') {\n\t\t\t\t\t\t\t\t\t\t\te.preventDefault();\n\n\t\t\t\t\t\t\t\t\t\t\t(promptsElement || documentsElement || modelsElement).selectUp();\n\n\t\t\t\t\t\t\t\t\t\t\tconst commandOptionButton = [\n\t\t\t\t\t\t\t\t\t\t\t\t...document.getElementsByClassName('selected-command-option-button')\n\t\t\t\t\t\t\t\t\t\t\t]?.at(-1);\n\t\t\t\t\t\t\t\t\t\t\tcommandOptionButton.scrollIntoView({ block: 'center' });\n\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\tif (['/', '#', '@'].includes(prompt.charAt(0)) && e.key === 'ArrowDown') {\n\t\t\t\t\t\t\t\t\t\t\te.preventDefault();\n\n\t\t\t\t\t\t\t\t\t\t\t(promptsElement || documentsElement || modelsElement).selectDown();\n\n\t\t\t\t\t\t\t\t\t\t\tconst commandOptionButton = [\n\t\t\t\t\t\t\t\t\t\t\t\t...document.getElementsByClassName('selected-command-option-button')\n\t\t\t\t\t\t\t\t\t\t\t]?.at(-1);\n\t\t\t\t\t\t\t\t\t\t\tcommandOptionButton.scrollIntoView({ block: 'center' });\n\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\tif (['/', '#', '@'].includes(prompt.charAt(0)) && e.key === 'Enter') {\n\t\t\t\t\t\t\t\t\t\t\te.preventDefault();\n\n\t\t\t\t\t\t\t\t\t\t\tconst commandOptionButton = [\n\t\t\t\t\t\t\t\t\t\t\t\t...document.getElementsByClassName('selected-command-option-button')\n\t\t\t\t\t\t\t\t\t\t\t]?.at(-1);\n\n\t\t\t\t\t\t\t\t\t\t\tif (e.shiftKey) {\n\t\t\t\t\t\t\t\t\t\t\t\tprompt = `${prompt}\\n`;\n\t\t\t\t\t\t\t\t\t\t\t} else if (commandOptionButton) {\n\t\t\t\t\t\t\t\t\t\t\t\tcommandOptionButton?.click();\n\t\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\t\tdocument.getElementById('send-message-button')?.click();\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\tif (['/', '#', '@'].includes(prompt.charAt(0)) && e.key === 'Tab') {\n\t\t\t\t\t\t\t\t\t\t\te.preventDefault();\n\n\t\t\t\t\t\t\t\t\t\t\tconst commandOptionButton = [\n\t\t\t\t\t\t\t\t\t\t\t\t...document.getElementsByClassName('selected-command-option-button')\n\t\t\t\t\t\t\t\t\t\t\t]?.at(-1);\n\n\t\t\t\t\t\t\t\t\t\t\tcommandOptionButton?.click();\n\t\t\t\t\t\t\t\t\t\t} else if (e.key === 'Tab') {\n\t\t\t\t\t\t\t\t\t\t\tconst words = findWordIndices(prompt);\n\n\t\t\t\t\t\t\t\t\t\t\tif (words.length > 0) {\n\t\t\t\t\t\t\t\t\t\t\t\tconst word = words.at(0);\n\t\t\t\t\t\t\t\t\t\t\t\tconst fullPrompt = prompt;\n\n\t\t\t\t\t\t\t\t\t\t\t\tprompt = prompt.substring(0, word?.endIndex + 1);\n\t\t\t\t\t\t\t\t\t\t\t\tawait tick();\n\n\t\t\t\t\t\t\t\t\t\t\t\te.target.scrollTop = e.target.scrollHeight;\n\t\t\t\t\t\t\t\t\t\t\t\tprompt = fullPrompt;\n\t\t\t\t\t\t\t\t\t\t\t\tawait tick();\n\n\t\t\t\t\t\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t\t\t\t\t\t\te.target.setSelectionRange(word?.startIndex, word.endIndex + 1);\n\t\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\t\te.target.style.height = '';\n\t\t\t\t\t\t\t\t\t\t\te.target.style.height = Math.min(e.target.scrollHeight, 200) + 'px';\n\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\tif (e.key === 'Escape') {\n\t\t\t\t\t\t\t\t\t\t\tconsole.log('Escape');\n\t\t\t\t\t\t\t\t\t\t\tatSelectedModel = undefined;\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\trows=\"1\"\n\t\t\t\t\t\t\t\t\ton:input={(e) => {\n\t\t\t\t\t\t\t\t\t\te.target.style.height = '';\n\t\t\t\t\t\t\t\t\t\te.target.style.height = Math.min(e.target.scrollHeight, 200) + 'px';\n\t\t\t\t\t\t\t\t\t\tuser = null;\n\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\ton:focus={(e) => {\n\t\t\t\t\t\t\t\t\t\te.target.style.height = '';\n\t\t\t\t\t\t\t\t\t\te.target.style.height = Math.min(e.target.scrollHeight, 200) + 'px';\n\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\ton:paste={(e) => {\n\t\t\t\t\t\t\t\t\t\tconst clipboardData = e.clipboardData || window.clipboardData;\n\n\t\t\t\t\t\t\t\t\t\tif (clipboardData && clipboardData.items) {\n\t\t\t\t\t\t\t\t\t\t\tfor (const item of clipboardData.items) {\n\t\t\t\t\t\t\t\t\t\t\t\tif (item.type.indexOf('image') !== -1) {\n\t\t\t\t\t\t\t\t\t\t\t\t\tconst blob = item.getAsFile();\n\t\t\t\t\t\t\t\t\t\t\t\t\tconst reader = new FileReader();\n\n\t\t\t\t\t\t\t\t\t\t\t\t\treader.onload = function (e) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tfiles = [\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t...files,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype: 'image',\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\turl: `${e.target.result}`\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t];\n\t\t\t\t\t\t\t\t\t\t\t\t\t};\n\n\t\t\t\t\t\t\t\t\t\t\t\t\treader.readAsDataURL(blob);\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t/>\n\n\t\t\t\t\t\t\t\t<div class=\"self-end mb-2 flex space-x-1 mr-1\">\n\t\t\t\t\t\t\t\t\t{#if messages.length == 0 || messages.at(-1).done == true}\n\t\t\t\t\t\t\t\t\t\t<Tooltip content={$i18n.t('Record voice')}>\n\t\t\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\t\t\tid=\"voice-input-button\"\n\t\t\t\t\t\t\t\t\t\t\t\tclass=\" text-gray-600 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-850 transition rounded-full p-1.5 mr-0.5 self-center\"\n\t\t\t\t\t\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t\t\t\t\t\t\ton:click={async () => {\n\t\t\t\t\t\t\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tconst res = await navigator.mediaDevices\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t.getUserMedia({ audio: true })\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t.catch(function (err) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttoast.error(\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t$i18n.t(\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t`Permission denied when accessing microphone: {{error}}`,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\terror: err\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\treturn null;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (res) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\trecording = true;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t} catch {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttoast.error($i18n.t('Permission denied when accessing microphone'));\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t<svg\n\t\t\t\t\t\t\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tviewBox=\"0 0 20 20\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tfill=\"currentColor\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tclass=\"w-5 h-5 translate-y-[0.5px]\"\n\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<path d=\"M7 4a3 3 0 016 0v6a3 3 0 11-6 0V4z\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\t\t\t\t\t\td=\"M5.5 9.643a.75.75 0 00-1.5 0V10c0 3.06 2.29 5.585 5.25 5.954V17.5h-1.5a.75.75 0 000 1.5h4.5a.75.75 0 000-1.5h-1.5v-1.546A6.001 6.001 0 0016 10v-.357a.75.75 0 00-1.5 0V10a4.5 4.5 0 01-9 0v-.357z\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t\t\t</Tooltip>\n\t\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class=\"flex items-end w-10\">\n\t\t\t\t\t\t\t{#if messages.length == 0 || messages.at(-1).done == true}\n\t\t\t\t\t\t\t\t{#if prompt === ''}\n\t\t\t\t\t\t\t\t\t<div class=\" flex items-center mb-1\">\n\t\t\t\t\t\t\t\t\t\t<Tooltip content={$i18n.t('Call')}>\n\t\t\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\t\t\tclass=\" text-gray-600 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-850 transition rounded-full p-2 self-center\"\n\t\t\t\t\t\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t\t\t\t\t\t\ton:click={async () => {\n\t\t\t\t\t\t\t\t\t\t\t\t\tif (selectedModels.length > 1) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttoast.error($i18n.t('Select only one model to call'));\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\t\t\t\tif ($config.audio.stt.engine === 'web') {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttoast.error(\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t$i18n.t('Call feature is not supported when using Web STT engine')\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t);\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t// check if user has access to getUserMedia\n\t\t\t\t\t\t\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tawait navigator.mediaDevices.getUserMedia({ audio: true });\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t// If the user grants the permission, proceed to show the call overlay\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tshowCallOverlay.set(true);\n\t\t\t\t\t\t\t\t\t\t\t\t\t} catch (err) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t// If the user denies the permission or an error occurs, show an error message\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttoast.error($i18n.t('Permission denied when accessing media devices'));\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t<Headphone className=\"size-6\" />\n\t\t\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t\t\t</Tooltip>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t{:else}\n\t\t\t\t\t\t\t\t\t<div class=\" flex items-center mb-1\">\n\t\t\t\t\t\t\t\t\t\t<Tooltip content={$i18n.t('Send message')}>\n\t\t\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\t\t\tid=\"send-message-button\"\n\t\t\t\t\t\t\t\t\t\t\t\tclass=\"{prompt !== ''\n\t\t\t\t\t\t\t\t\t\t\t\t\t? 'bg-black text-white hover:bg-gray-900 dark:bg-white dark:text-black dark:hover:bg-gray-100 '\n\t\t\t\t\t\t\t\t\t\t\t\t\t: 'text-white bg-gray-200 dark:text-gray-900 dark:bg-gray-700 disabled'} transition rounded-full p-1.5 m-0.5 self-center\"\n\t\t\t\t\t\t\t\t\t\t\t\ttype=\"submit\"\n\t\t\t\t\t\t\t\t\t\t\t\tdisabled={prompt === ''}\n\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t<svg\n\t\t\t\t\t\t\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tviewBox=\"0 0 16 16\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tfill=\"currentColor\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tclass=\"size-6\"\n\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tfill-rule=\"evenodd\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\td=\"M8 14a.75.75 0 0 1-.75-.75V4.56L4.03 7.78a.75.75 0 0 1-1.06-1.06l4.5-4.5a.75.75 0 0 1 1.06 0l4.5 4.5a.75.75 0 0 1-1.06 1.06L8.75 4.56v8.69A.75.75 0 0 1 8 14Z\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tclip-rule=\"evenodd\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t\t\t</Tooltip>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t{:else}\n\t\t\t\t\t\t\t\t<div class=\" flex items-center mb-1.5\">\n\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\tclass=\"bg-white hover:bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-white dark:hover:bg-gray-800 transition rounded-full p-1.5\"\n\t\t\t\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\t\t\t\tstopResponse();\n\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t<svg\n\t\t\t\t\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\t\t\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\t\t\t\t\t\t\tfill=\"currentColor\"\n\t\t\t\t\t\t\t\t\t\t\tclass=\"size-6\"\n\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\t\t\t\tfill-rule=\"evenodd\"\n\t\t\t\t\t\t\t\t\t\t\t\td=\"M2.25 12c0-5.385 4.365-9.75 9.75-9.75s9.75 4.365 9.75 9.75-4.365 9.75-9.75 9.75S2.25 17.385 2.25 12zm6-2.438c0-.724.588-1.312 1.313-1.312h4.874c.725 0 1.313.588 1.313 1.313v4.874c0 .725-.588 1.313-1.313 1.313H9.564a1.312 1.312 0 01-1.313-1.313V9.564z\"\n\t\t\t\t\t\t\t\t\t\t\t\tclip-rule=\"evenodd\"\n\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</form>\n\t\t\t\t{/if}\n\n\t\t\t\t<div class=\"mt-1.5 text-xs text-gray-500 text-center line-clamp-1\">\n\t\t\t\t\t{$i18n.t('LLMs can make mistakes. Verify important information.')}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n</div>\n\n<style>\n\t.scrollbar-hidden:active::-webkit-scrollbar-thumb,\n\t.scrollbar-hidden:focus::-webkit-scrollbar-thumb,\n\t.scrollbar-hidden:hover::-webkit-scrollbar-thumb {\n\t\tvisibility: visible;\n\t}\n\t.scrollbar-hidden::-webkit-scrollbar-thumb {\n\t\tvisibility: hidden;\n\t}\n</style>\n","<script lang=\"ts\">\n\timport { models, showSettings, settings, user, mobile } from '$lib/stores';\n\timport { onMount, tick, getContext } from 'svelte';\n\timport { toast } from 'svelte-sonner';\n\timport Selector from './ModelSelector/Selector.svelte';\n\timport Tooltip from '../common/Tooltip.svelte';\n\n\timport { setDefaultModels } from '$lib/apis/configs';\n\timport { updateUserSettings } from '$lib/apis/users';\n\n\tconst i18n = getContext('i18n');\n\n\texport let selectedModels = [''];\n\texport let disabled = false;\n\n\texport let showSetDefault = true;\n\n\tconst saveDefaultModel = async () => {\n\t\tconst hasEmptyModel = selectedModels.filter((it) => it === '');\n\t\tif (hasEmptyModel.length) {\n\t\t\ttoast.error($i18n.t('Choose a model before saving...'));\n\t\t\treturn;\n\t\t}\n\t\tsettings.set({ ...$settings, models: selectedModels });\n\t\tawait updateUserSettings(localStorage.token, { ui: $settings });\n\n\t\ttoast.success($i18n.t('Default model updated'));\n\t};\n\n\t$: if (selectedModels.length > 0 && $models.length > 0) {\n\t\tselectedModels = selectedModels.map((model) =>\n\t\t\t$models.map((m) => m.id).includes(model) ? model : ''\n\t\t);\n\t}\n</script>\n\n<div class=\"flex flex-col w-full items-center md:items-start\">\n\t{#each selectedModels as selectedModel, selectedModelIdx}\n\t\t<div class=\"flex w-full max-w-fit\">\n\t\t\t<div class=\"overflow-hidden w-full\">\n\t\t\t\t<div class=\"mr-1 max-w-full\">\n\t\t\t\t\t<Selector\n\t\t\t\t\t\tplaceholder={$i18n.t('Select a model')}\n\t\t\t\t\t\titems={$models.map((model) => ({\n\t\t\t\t\t\t\tvalue: model.id,\n\t\t\t\t\t\t\tlabel: model.name,\n\t\t\t\t\t\t\tmodel: model\n\t\t\t\t\t\t}))}\n\t\t\t\t\t\tbind:value={selectedModel}\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t{#if selectedModelIdx === 0}\n\t\t\t\t<!-- <div class=\"  self-center mr-2 disabled:text-gray-600 disabled:hover:text-gray-600\">\n\t\t\t\t\t<Tooltip content={$i18n.t('Add Model')}>\n\t\t\t\t\t\t<button\n\t\t\t\t\t\t\tclass=\" \"\n\t\t\t\t\t\t\t{disabled}\n\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\tselectedModels = [...selectedModels, ''];\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<svg\n\t\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\t\t\t\tfill=\"none\"\n\t\t\t\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\t\t\t\tstroke-width=\"2\"\n\t\t\t\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\t\t\t\tclass=\"size-3.5\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<path stroke-linecap=\"round\" stroke-linejoin=\"round\" d=\"M12 6v12m6-6H6\" />\n\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</Tooltip>\n\t\t\t\t</div> -->\n\t\t\t{:else}\n\t\t\t\t<div class=\"  self-center disabled:text-gray-600 disabled:hover:text-gray-600 mr-2\">\n\t\t\t\t\t<Tooltip content={$i18n.t('Remove Model')}>\n\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t{disabled}\n\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\tselectedModels.splice(selectedModelIdx, 1);\n\t\t\t\t\t\t\t\tselectedModels = selectedModels;\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<svg\n\t\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\t\t\t\tfill=\"none\"\n\t\t\t\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\t\t\t\tstroke-width=\"2\"\n\t\t\t\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\t\t\t\tclass=\"size-3.5\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<path stroke-linecap=\"round\" stroke-linejoin=\"round\" d=\"M19.5 12h-15\" />\n\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</Tooltip>\n\t\t\t\t</div>\n\t\t\t{/if}\n\t\t</div>\n\t{/each}\n</div>\n\n{#if showSetDefault && !$mobile}\n\t<div class=\"text-left mt-0.5 ml-1 text-[0.7rem] text-gray-500\">\n\t\t<button on:click={saveDefaultModel}> {$i18n.t('Set as default')}</button>\n\t</div>\n{/if}\n","<script lang=\"ts\">\n\timport { DropdownMenu } from 'bits-ui';\n\timport { getContext } from 'svelte';\n\n\timport fileSaver from 'file-saver';\n\tconst { saveAs } = fileSaver;\n\n\timport { showSettings } from '$lib/stores';\n\timport { flyAndScale } from '$lib/utils/transitions';\n\n\timport Dropdown from '$lib/components/common/Dropdown.svelte';\n\timport Tags from '$lib/components/chat/Tags.svelte';\n\n\timport { downloadChatAsPDF } from '$lib/apis/utils';\n\n\tconst i18n = getContext('i18n');\n\n\texport let shareEnabled: boolean = false;\n\texport let shareHandler: Function;\n\texport let downloadHandler: Function;\n\n\t// export let tagHandler: Function;\n\n\texport let chat;\n\texport let onClose: Function = () => {};\n\n\tconst downloadTxt = async () => {\n\t\tconst _chat = chat.chat;\n\t\tconsole.log('download', chat);\n\n\t\tconst chatText = _chat.messages.reduce((a, message, i, arr) => {\n\t\t\treturn `${a}### ${message.role.toUpperCase()}\\n${message.content}\\n\\n`;\n\t\t}, '');\n\n\t\tlet blob = new Blob([chatText], {\n\t\t\ttype: 'text/plain'\n\t\t});\n\n\t\tsaveAs(blob, `chat-${_chat.title}.txt`);\n\t};\n\n\tconst downloadPdf = async () => {\n\t\tconst _chat = chat.chat;\n\t\tconsole.log('download', chat);\n\n\t\tconst blob = await downloadChatAsPDF(_chat);\n\n\t\t// Create a URL for the blob\n\t\tconst url = window.URL.createObjectURL(blob);\n\n\t\t// Create a link element to trigger the download\n\t\tconst a = document.createElement('a');\n\t\ta.href = url;\n\t\ta.download = `chat-${_chat.title}.pdf`;\n\n\t\t// Append the link to the body and click it programmatically\n\t\tdocument.body.appendChild(a);\n\t\ta.click();\n\n\t\t// Remove the link from the body\n\t\tdocument.body.removeChild(a);\n\n\t\t// Revoke the URL to release memory\n\t\twindow.URL.revokeObjectURL(url);\n\t};\n\n\tconst downloadJSONExport = async () => {\n\t\tlet blob = new Blob([JSON.stringify([chat])], {\n\t\t\ttype: 'application/json'\n\t\t});\n\t\tsaveAs(blob, `chat-export-${Date.now()}.json`);\n\t};\n</script>\n\n<Dropdown\n\ton:change={(e) => {\n\t\tif (e.detail === false) {\n\t\t\tonClose();\n\t\t}\n\t}}\n>\n\t<slot />\n\n\t<div slot=\"content\">\n\t\t<DropdownMenu.Content\n\t\t\tclass=\"w-full max-w-[200px] rounded-xl px-1 py-1.5 border border-gray-300/30 dark:border-gray-700/50 z-50 bg-white dark:bg-gray-850 dark:text-white shadow-lg\"\n\t\t\tsideOffset={8}\n\t\t\tside=\"bottom\"\n\t\t\talign=\"end\"\n\t\t\ttransition={flyAndScale}\n\t\t>\n\t\t\t<!-- <DropdownMenu.Item\n\t\t\t\tclass=\"flex gap-2 items-center px-3 py-2 text-sm  cursor-pointer dark:hover:bg-gray-800 rounded-md\"\n\t\t\t\ton:click={async () => {\n\t\t\t\t\tawait showSettings.set(!$showSettings);\n\t\t\t\t}}\n\t\t\t>\n\t\t\t\t<svg\n\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\tfill=\"none\"\n\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\tstroke-width=\"1.5\"\n\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\tclass=\"size-4\"\n\t\t\t\t>\n\t\t\t\t\t<path\n\t\t\t\t\t\tstroke-linecap=\"round\"\n\t\t\t\t\t\tstroke-linejoin=\"round\"\n\t\t\t\t\t\td=\"M9.594 3.94c.09-.542.56-.94 1.11-.94h2.593c.55 0 1.02.398 1.11.94l.213 1.281c.063.374.313.686.645.87.074.04.147.083.22.127.325.196.72.257 1.075.124l1.217-.456a1.125 1.125 0 0 1 1.37.49l1.296 2.247a1.125 1.125 0 0 1-.26 1.431l-1.003.827c-.293.241-.438.613-.43.992a7.723 7.723 0 0 1 0 .255c-.008.378.137.75.43.991l1.004.827c.424.35.534.955.26 1.43l-1.298 2.247a1.125 1.125 0 0 1-1.369.491l-1.217-.456c-.355-.133-.75-.072-1.076.124a6.47 6.47 0 0 1-.22.128c-.331.183-.581.495-.644.869l-.213 1.281c-.09.543-.56.94-1.11.94h-2.594c-.55 0-1.019-.398-1.11-.94l-.213-1.281c-.062-.374-.312-.686-.644-.87a6.52 6.52 0 0 1-.22-.127c-.325-.196-.72-.257-1.076-.124l-1.217.456a1.125 1.125 0 0 1-1.369-.49l-1.297-2.247a1.125 1.125 0 0 1 .26-1.431l1.004-.827c.292-.24.437-.613.43-.991a6.932 6.932 0 0 1 0-.255c.007-.38-.138-.751-.43-.992l-1.004-.827a1.125 1.125 0 0 1-.26-1.43l1.297-2.247a1.125 1.125 0 0 1 1.37-.491l1.216.456c.356.133.751.072 1.076-.124.072-.044.146-.086.22-.128.332-.183.582-.495.644-.869l.214-1.28Z\"\n\t\t\t\t\t/>\n\t\t\t\t\t<path\n\t\t\t\t\t\tstroke-linecap=\"round\"\n\t\t\t\t\t\tstroke-linejoin=\"round\"\n\t\t\t\t\t\td=\"M15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z\"\n\t\t\t\t\t/>\n\t\t\t\t</svg>\n\t\t\t\t<div class=\"flex items-center\">{$i18n.t('Settings')}</div>\n\t\t\t</DropdownMenu.Item> -->\n\n\t\t\t<DropdownMenu.Item\n\t\t\t\tclass=\"flex gap-2 items-center px-3 py-2 text-sm  cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 rounded-md\"\n\t\t\t\tid=\"chat-share-button\"\n\t\t\t\ton:click={() => {\n\t\t\t\t\tshareHandler();\n\t\t\t\t}}\n\t\t\t>\n\t\t\t\t<svg\n\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\tfill=\"currentColor\"\n\t\t\t\t\tclass=\"size-4\"\n\t\t\t\t>\n\t\t\t\t\t<path\n\t\t\t\t\t\tfill-rule=\"evenodd\"\n\t\t\t\t\t\td=\"M15.75 4.5a3 3 0 1 1 .825 2.066l-8.421 4.679a3.002 3.002 0 0 1 0 1.51l8.421 4.679a3 3 0 1 1-.729 1.31l-8.421-4.678a3 3 0 1 1 0-4.132l8.421-4.679a3 3 0 0 1-.096-.755Z\"\n\t\t\t\t\t\tclip-rule=\"evenodd\"\n\t\t\t\t\t/>\n\t\t\t\t</svg>\n\t\t\t\t<div class=\"flex items-center\">{$i18n.t('Share')}</div>\n\t\t\t</DropdownMenu.Item>\n\t\t\t<!-- <DropdownMenu.Item\n\t\t\t\t\tclass=\"flex gap-2 items-center px-3 py-2 text-sm  font-medium cursor-pointer\"\n\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\tdownloadHandler();\n\t\t\t\t\t}}\n\t\t\t\t/> -->\n\t\t\t<DropdownMenu.Sub>\n\t\t\t\t<DropdownMenu.SubTrigger\n\t\t\t\t\tclass=\"flex gap-2 items-center px-3 py-2 text-sm  cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 rounded-md\"\n\t\t\t\t>\n\t\t\t\t\t<svg\n\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\t\tfill=\"none\"\n\t\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\t\tstroke-width=\"1.5\"\n\t\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\t\tclass=\"size-4\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<path\n\t\t\t\t\t\t\tstroke-linecap=\"round\"\n\t\t\t\t\t\t\tstroke-linejoin=\"round\"\n\t\t\t\t\t\t\td=\"M3 16.5v2.25A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75V16.5M16.5 12 12 16.5m0 0L7.5 12m4.5 4.5V3\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</svg>\n\n\t\t\t\t\t<div class=\"flex items-center\">{$i18n.t('Download')}</div>\n\t\t\t\t</DropdownMenu.SubTrigger>\n\t\t\t\t<DropdownMenu.SubContent\n\t\t\t\t\tclass=\"w-full rounded-lg px-1 py-1.5 border border-gray-300/30 dark:border-gray-700/50 z-50 bg-white dark:bg-gray-850 dark:text-white shadow-lg\"\n\t\t\t\t\ttransition={flyAndScale}\n\t\t\t\t\tsideOffset={8}\n\t\t\t\t>\n\t\t\t\t\t<DropdownMenu.Item\n\t\t\t\t\t\tclass=\"flex gap-2 items-center px-3 py-2 text-sm  cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 rounded-md\"\n\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\tdownloadJSONExport();\n\t\t\t\t\t\t}}\n\t\t\t\t\t>\n\t\t\t\t\t\t<div class=\"flex items-center line-clamp-1\">{$i18n.t('Export chat (.json)')}</div>\n\t\t\t\t\t</DropdownMenu.Item>\n\t\t\t\t\t<DropdownMenu.Item\n\t\t\t\t\t\tclass=\"flex gap-2 items-center px-3 py-2 text-sm  cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 rounded-md\"\n\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\tdownloadTxt();\n\t\t\t\t\t\t}}\n\t\t\t\t\t>\n\t\t\t\t\t\t<div class=\"flex items-center line-clamp-1\">{$i18n.t('Plain text (.txt)')}</div>\n\t\t\t\t\t</DropdownMenu.Item>\n\n\t\t\t\t\t<DropdownMenu.Item\n\t\t\t\t\t\tclass=\"flex gap-2 items-center px-3 py-2 text-sm  cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 rounded-md\"\n\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\tdownloadPdf();\n\t\t\t\t\t\t}}\n\t\t\t\t\t>\n\t\t\t\t\t\t<div class=\"flex items-center line-clamp-1\">{$i18n.t('PDF document (.pdf)')}</div>\n\t\t\t\t\t</DropdownMenu.Item>\n\t\t\t\t</DropdownMenu.SubContent>\n\t\t\t</DropdownMenu.Sub>\n\n\t\t\t<hr class=\"border-gray-100 dark:border-gray-800 mt-2.5 mb-1.5\" />\n\n\t\t\t<div class=\"flex p-1\">\n\t\t\t\t<Tags chatId={chat.id} />\n\t\t\t</div>\n\t\t</DropdownMenu.Content>\n\t</div>\n</Dropdown>\n","<script lang=\"ts\">\n\timport { getContext } from 'svelte';\n\timport { toast } from 'svelte-sonner';\n\n\timport {\n\t\tWEBUI_NAME,\n\t\tchatId,\n\t\tmobile,\n\t\tsettings,\n\t\tshowArchivedChats,\n\t\tshowSettings,\n\t\tshowSidebar,\n\t\tuser\n\t} from '$lib/stores';\n\n\timport { slide } from 'svelte/transition';\n\timport ShareChatModal from '../chat/ShareChatModal.svelte';\n\timport ModelSelector from '../chat/ModelSelector.svelte';\n\timport Tooltip from '../common/Tooltip.svelte';\n\timport Menu from './Navbar/Menu.svelte';\n\timport { page } from '$app/stores';\n\timport UserMenu from './Sidebar/UserMenu.svelte';\n\timport MenuLines from '../icons/MenuLines.svelte';\n\n\tconst i18n = getContext('i18n');\n\n\texport let initNewChat: Function;\n\texport let title: string = $WEBUI_NAME;\n\texport let shareEnabled: boolean = false;\n\n\texport let chat;\n\texport let selectedModels;\n\n\texport let showModelSelector = true;\n\n\tlet showShareChatModal = false;\n\tlet showDownloadChatModal = false;\n</script>\n\n<ShareChatModal bind:show={showShareChatModal} chatId={$chatId} />\n<nav id=\"nav\" class=\" sticky py-2.5 top-0 flex flex-row justify-center z-30\">\n\t<div class=\" flex max-w-full w-full mx-auto px-5 pt-0.5 md:px-[1rem]\">\n\t\t<div class=\"flex items-center w-full max-w-full\">\n\t\t\t<div\n\t\t\t\tclass=\"{$showSidebar\n\t\t\t\t\t? 'md:hidden'\n\t\t\t\t\t: ''} mr-3 self-start flex flex-none items-center text-gray-600 dark:text-gray-400\"\n\t\t\t>\n\t\t\t\t<button\n\t\t\t\t\tid=\"sidebar-toggle-button\"\n\t\t\t\t\tclass=\"cursor-pointer px-2 py-2 flex rounded-xl hover:bg-gray-100 dark:hover:bg-gray-850 transition\"\n\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\tshowSidebar.set(!$showSidebar);\n\t\t\t\t\t}}\n\t\t\t\t>\n\t\t\t\t\t<div class=\" m-auto self-center\">\n\t\t\t\t\t\t<MenuLines />\n\t\t\t\t\t</div>\n\t\t\t\t</button>\n\t\t\t</div>\n\t\t\t<div class=\"flex-1 overflow-hidden max-w-full\">\n\t\t\t\t{#if showModelSelector}\n\t\t\t\t\t<ModelSelector bind:selectedModels showSetDefault={!shareEnabled} />\n\t\t\t\t{/if}\n\t\t\t</div>\n\n\t\t\t<div class=\"self-start flex flex-none items-center text-gray-600 dark:text-gray-400\">\n\t\t\t\t<!-- <div class=\"md:hidden flex self-center w-[1px] h-5 mx-2 bg-gray-300 dark:bg-stone-700\" /> -->\n\n\t\t\t\t{#if shareEnabled && chat && chat.id}\n\t\t\t\t\t<Menu\n\t\t\t\t\t\t{chat}\n\t\t\t\t\t\t{shareEnabled}\n\t\t\t\t\t\tshareHandler={() => {\n\t\t\t\t\t\t\tshowShareChatModal = !showShareChatModal;\n\t\t\t\t\t\t}}\n\t\t\t\t\t\tdownloadHandler={() => {\n\t\t\t\t\t\t\tshowDownloadChatModal = !showDownloadChatModal;\n\t\t\t\t\t\t}}\n\t\t\t\t\t>\n\t\t\t\t\t\t<button\n\t\t\t\t\t\t\tclass=\"hidden md:flex cursor-pointer px-2 py-2 rounded-xl hover:bg-gray-100 dark:hover:bg-gray-850 transition\"\n\t\t\t\t\t\t\tid=\"chat-context-menu-button\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<div class=\" m-auto self-center\">\n\t\t\t\t\t\t\t\t<svg\n\t\t\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\t\t\t\t\tfill=\"none\"\n\t\t\t\t\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\t\t\t\t\tstroke-width=\"1.5\"\n\t\t\t\t\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\t\t\t\t\tclass=\"size-5\"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\t\tstroke-linecap=\"round\"\n\t\t\t\t\t\t\t\t\t\tstroke-linejoin=\"round\"\n\t\t\t\t\t\t\t\t\t\td=\"M6.75 12a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0ZM12.75 12a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0ZM18.75 12a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0Z\"\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</Menu>\n\t\t\t\t{/if}\n\t\t\t\t<Tooltip content={$i18n.t('New Chat')}>\n\t\t\t\t\t<button\n\t\t\t\t\t\tid=\"new-chat-button\"\n\t\t\t\t\t\tclass=\" flex {$showSidebar\n\t\t\t\t\t\t\t? 'md:hidden'\n\t\t\t\t\t\t\t: ''} cursor-pointer px-2 py-2 rounded-xl hover:bg-gray-100 dark:hover:bg-gray-850 transition\"\n\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\tinitNewChat();\n\t\t\t\t\t\t}}\n\t\t\t\t\t>\n\t\t\t\t\t\t<div class=\" m-auto self-center\">\n\t\t\t\t\t\t\t<svg\n\t\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\t\t\t\tviewBox=\"0 0 20 20\"\n\t\t\t\t\t\t\t\tfill=\"currentColor\"\n\t\t\t\t\t\t\t\tclass=\"w-5 h-5\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\td=\"M5.433 13.917l1.262-3.155A4 4 0 017.58 9.42l6.92-6.918a2.121 2.121 0 013 3l-6.92 6.918c-.383.383-.84.685-1.343.886l-3.154 1.262a.5.5 0 01-.65-.65z\"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\td=\"M3.5 5.75c0-.69.56-1.25 1.25-1.25H10A.75.75 0 0010 3H4.75A2.75 2.75 0 002 5.75v9.5A2.75 2.75 0 004.75 18h9.5A2.75 2.75 0 0017 15.25V10a.75.75 0 00-1.5 0v5.25c0 .69-.56 1.25-1.25 1.25h-9.5c-.69 0-1.25-.56-1.25-1.25v-9.5z\"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</button>\n\t\t\t\t</Tooltip>\n\n\t\t\t\t{#if $user !== undefined}\n\t\t\t\t\t<UserMenu\n\t\t\t\t\t\tclassName=\"max-w-[200px]\"\n\t\t\t\t\t\trole={$user.role}\n\t\t\t\t\t\ton:show={(e) => {\n\t\t\t\t\t\t\tif (e.detail === 'archived-chat') {\n\t\t\t\t\t\t\t\tshowArchivedChats.set(true);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}}\n\t\t\t\t\t>\n\t\t\t\t\t\t<button\n\t\t\t\t\t\t\tclass=\"select-none flex rounded-xl p-1.5 w-full hover:bg-gray-100 dark:hover:bg-gray-850 transition\"\n\t\t\t\t\t\t\taria-label=\"User Menu\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<div class=\" self-center\">\n\t\t\t\t\t\t\t\t<img\n\t\t\t\t\t\t\t\t\tsrc={$user.profile_image_url}\n\t\t\t\t\t\t\t\t\tclass=\"size-6 object-cover rounded-full\"\n\t\t\t\t\t\t\t\t\talt=\"User profile\"\n\t\t\t\t\t\t\t\t\tdraggable=\"false\"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</UserMenu>\n\t\t\t\t{/if}\n\t\t\t</div>\n\t\t</div>\n\t</div>\n</nav>\n","<script lang=\"ts\">\n\timport { DropdownMenu } from 'bits-ui';\n\timport { flyAndScale } from '$lib/utils/transitions';\n\timport { getContext, createEventDispatcher } from 'svelte';\n\n\tconst i18n = getContext('i18n');\n\tconst dispatch = createEventDispatcher();\n\n\timport Dropdown from '$lib/components/common/Dropdown.svelte';\n\n\texport let onClose: Function = () => {};\n\texport let devices: any;\n\n\tlet show = false;\n</script>\n\n<Dropdown\n\tbind:show\n\ton:change={(e) => {\n\t\tif (e.detail === false) {\n\t\t\tonClose();\n\t\t}\n\t}}\n>\n\t<slot />\n\n\t<div slot=\"content\">\n\t\t<DropdownMenu.Content\n\t\t\tclass=\"w-full max-w-[180px] rounded-lg px-1 py-1.5 border border-gray-300/30 dark:border-gray-700/50 z-[9999] bg-white dark:bg-gray-900 dark:text-white shadow-sm\"\n\t\t\tsideOffset={6}\n\t\t\tside=\"top\"\n\t\t\talign=\"start\"\n\t\t\ttransition={flyAndScale}\n\t\t>\n\t\t\t{#each devices as device}\n\t\t\t\t<DropdownMenu.Item\n\t\t\t\t\tclass=\"flex gap-2 items-center px-3 py-2 text-sm  cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 rounded-md\"\n\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\tdispatch('change', device.deviceId);\n\t\t\t\t\t}}\n\t\t\t\t>\n\t\t\t\t\t<div class=\"flex items-center\">\n\t\t\t\t\t\t<div class=\" line-clamp-1\">\n\t\t\t\t\t\t\t{device?.label ?? 'Camera'}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</DropdownMenu.Item>\n\t\t\t{/each}\n\t\t</DropdownMenu.Content>\n\t</div>\n</Dropdown>\n","<script lang=\"ts\">\n\timport { config, settings, showCallOverlay } from '$lib/stores';\n\timport { onMount, tick, getContext } from 'svelte';\n\n\timport {\n\t\tblobToFile,\n\t\tcalculateSHA256,\n\t\textractSentencesForAudio,\n\t\tfindWordIndices\n\t} from '$lib/utils';\n\timport { generateEmoji } from '$lib/apis';\n\timport { synthesizeOpenAISpeech, transcribeAudio } from '$lib/apis/audio';\n\n\timport { toast } from 'svelte-sonner';\n\n\timport Tooltip from '$lib/components/common/Tooltip.svelte';\n\timport VideoInputMenu from './CallOverlay/VideoInputMenu.svelte';\n\n\tconst i18n = getContext('i18n');\n\n\texport let eventTarget: EventTarget;\n\n\texport let submitPrompt: Function;\n\texport let stopResponse: Function;\n\n\texport let files;\n\n\texport let chatId;\n\texport let modelId;\n\n\tlet loading = false;\n\tlet confirmed = false;\n\tlet interrupted = false;\n\tlet assistantSpeaking = false;\n\n\tlet emoji = null;\n\n\tlet camera = false;\n\tlet cameraStream = null;\n\n\tlet chatStreaming = false;\n\n\tlet rmsLevel = 0;\n\tlet hasStartedSpeaking = false;\n\tlet mediaRecorder;\n\tlet audioChunks = [];\n\n\tlet videoInputDevices = [];\n\tlet selectedVideoInputDeviceId = null;\n\n\tconst getVideoInputDevices = async () => {\n\t\tconst devices = await navigator.mediaDevices.enumerateDevices();\n\t\tvideoInputDevices = devices.filter((device) => device.kind === 'videoinput');\n\n\t\tif (!!navigator.mediaDevices.getDisplayMedia) {\n\t\t\tvideoInputDevices = [\n\t\t\t\t...videoInputDevices,\n\t\t\t\t{\n\t\t\t\t\tdeviceId: 'screen',\n\t\t\t\t\tlabel: 'Screen Share'\n\t\t\t\t}\n\t\t\t];\n\t\t}\n\n\t\tconsole.log(videoInputDevices);\n\t\tif (selectedVideoInputDeviceId === null && videoInputDevices.length > 0) {\n\t\t\tselectedVideoInputDeviceId = videoInputDevices[0].deviceId;\n\t\t}\n\t};\n\n\tconst startCamera = async () => {\n\t\tawait getVideoInputDevices();\n\n\t\tif (cameraStream === null) {\n\t\t\tcamera = true;\n\t\t\tawait tick();\n\t\t\ttry {\n\t\t\t\tawait startVideoStream();\n\t\t\t} catch (err) {\n\t\t\t\tconsole.error('Error accessing webcam: ', err);\n\t\t\t}\n\t\t}\n\t};\n\n\tconst startVideoStream = async () => {\n\t\tconst video = document.getElementById('camera-feed');\n\t\tif (video) {\n\t\t\tif (selectedVideoInputDeviceId === 'screen') {\n\t\t\t\tcameraStream = await navigator.mediaDevices.getDisplayMedia({\n\t\t\t\t\tvideo: {\n\t\t\t\t\t\tcursor: 'always'\n\t\t\t\t\t},\n\t\t\t\t\taudio: false\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tcameraStream = await navigator.mediaDevices.getUserMedia({\n\t\t\t\t\tvideo: {\n\t\t\t\t\t\tdeviceId: selectedVideoInputDeviceId ? { exact: selectedVideoInputDeviceId } : undefined\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (cameraStream) {\n\t\t\t\tawait getVideoInputDevices();\n\t\t\t\tvideo.srcObject = cameraStream;\n\t\t\t\tawait video.play();\n\t\t\t}\n\t\t}\n\t};\n\n\tconst stopVideoStream = async () => {\n\t\tif (cameraStream) {\n\t\t\tconst tracks = cameraStream.getTracks();\n\t\t\ttracks.forEach((track) => track.stop());\n\t\t}\n\n\t\tcameraStream = null;\n\t};\n\n\tconst takeScreenshot = () => {\n\t\tconst video = document.getElementById('camera-feed');\n\t\tconst canvas = document.getElementById('camera-canvas');\n\n\t\tif (!canvas) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst context = canvas.getContext('2d');\n\n\t\t// Make the canvas match the video dimensions\n\t\tcanvas.width = video.videoWidth;\n\t\tcanvas.height = video.videoHeight;\n\n\t\t// Draw the image from the video onto the canvas\n\t\tcontext.drawImage(video, 0, 0, video.videoWidth, video.videoHeight);\n\n\t\t// Convert the canvas to a data base64 URL and console log it\n\t\tconst dataURL = canvas.toDataURL('image/png');\n\t\tconsole.log(dataURL);\n\n\t\treturn dataURL;\n\t};\n\n\tconst stopCamera = async () => {\n\t\tawait stopVideoStream();\n\t\tcamera = false;\n\t};\n\n\tconst MIN_DECIBELS = -55;\n\tconst VISUALIZER_BUFFER_LENGTH = 300;\n\n\tconst transcribeHandler = async (audioBlob) => {\n\t\t// Create a blob from the audio chunks\n\n\t\tawait tick();\n\t\tconst file = blobToFile(audioBlob, 'recording.wav');\n\n\t\tconst res = await transcribeAudio(localStorage.token, file).catch((error) => {\n\t\t\ttoast.error(error);\n\t\t\treturn null;\n\t\t});\n\n\t\tif (res) {\n\t\t\tconsole.log(res.text);\n\n\t\t\tif (res.text !== '') {\n\t\t\t\tconst _responses = await submitPrompt(res.text, { _raw: true });\n\t\t\t\tconsole.log(_responses);\n\t\t\t}\n\t\t}\n\t};\n\n\tconst stopRecordingCallback = async (_continue = true) => {\n\t\tif ($showCallOverlay) {\n\t\t\tconsole.log('%c%s', 'color: red; font-size: 20px;', ' stopRecordingCallback ');\n\n\t\t\t// deep copy the audioChunks array\n\t\t\tconst _audioChunks = audioChunks.slice(0);\n\n\t\t\taudioChunks = [];\n\t\t\tmediaRecorder = false;\n\n\t\t\tif (_continue) {\n\t\t\t\tstartRecording();\n\t\t\t}\n\n\t\t\tif (confirmed) {\n\t\t\t\tloading = true;\n\t\t\t\temoji = null;\n\n\t\t\t\tif (cameraStream) {\n\t\t\t\t\tconst imageUrl = takeScreenshot();\n\n\t\t\t\t\tfiles = [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttype: 'image',\n\t\t\t\t\t\t\turl: imageUrl\n\t\t\t\t\t\t}\n\t\t\t\t\t];\n\t\t\t\t}\n\n\t\t\t\tconst audioBlob = new Blob(_audioChunks, { type: 'audio/wav' });\n\t\t\t\tawait transcribeHandler(audioBlob);\n\n\t\t\t\tconfirmed = false;\n\t\t\t\tloading = false;\n\t\t\t}\n\t\t} else {\n\t\t\taudioChunks = [];\n\t\t\tmediaRecorder = false;\n\t\t}\n\t};\n\n\tconst startRecording = async () => {\n\t\tconst stream = await navigator.mediaDevices.getUserMedia({ audio: true });\n\t\tmediaRecorder = new MediaRecorder(stream);\n\n\t\tmediaRecorder.onstart = () => {\n\t\t\tconsole.log('Recording started');\n\t\t\taudioChunks = [];\n\t\t\tanalyseAudio(stream);\n\t\t};\n\n\t\tmediaRecorder.ondataavailable = (event) => {\n\t\t\tif (hasStartedSpeaking) {\n\t\t\t\taudioChunks.push(event.data);\n\t\t\t}\n\t\t};\n\n\t\tmediaRecorder.onstop = (e) => {\n\t\t\tconsole.log('Recording stopped', e);\n\t\t\tstopRecordingCallback();\n\t\t};\n\n\t\tmediaRecorder.start();\n\t};\n\n\t// Function to calculate the RMS level from time domain data\n\tconst calculateRMS = (data: Uint8Array) => {\n\t\tlet sumSquares = 0;\n\t\tfor (let i = 0; i < data.length; i++) {\n\t\t\tconst normalizedValue = (data[i] - 128) / 128; // Normalize the data\n\t\t\tsumSquares += normalizedValue * normalizedValue;\n\t\t}\n\t\treturn Math.sqrt(sumSquares / data.length);\n\t};\n\n\tconst analyseAudio = (stream) => {\n\t\tconst audioContext = new AudioContext();\n\t\tconst audioStreamSource = audioContext.createMediaStreamSource(stream);\n\n\t\tconst analyser = audioContext.createAnalyser();\n\t\tanalyser.minDecibels = MIN_DECIBELS;\n\t\taudioStreamSource.connect(analyser);\n\n\t\tconst bufferLength = analyser.frequencyBinCount;\n\n\t\tconst domainData = new Uint8Array(bufferLength);\n\t\tconst timeDomainData = new Uint8Array(analyser.fftSize);\n\n\t\tlet lastSoundTime = Date.now();\n\t\thasStartedSpeaking = false;\n\n\t\tconsole.log(' Sound detection started', lastSoundTime, hasStartedSpeaking);\n\n\t\tconst detectSound = () => {\n\t\t\tconst processFrame = () => {\n\t\t\t\tif (!mediaRecorder || !$showCallOverlay) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (assistantSpeaking) {\n\t\t\t\t\t// Mute the audio if the assistant is speaking\n\t\t\t\t\tanalyser.maxDecibels = 0;\n\t\t\t\t\tanalyser.minDecibels = -1;\n\t\t\t\t} else {\n\t\t\t\t\tanalyser.minDecibels = MIN_DECIBELS;\n\t\t\t\t\tanalyser.maxDecibels = -30;\n\t\t\t\t}\n\n\t\t\t\tanalyser.getByteTimeDomainData(timeDomainData);\n\t\t\t\tanalyser.getByteFrequencyData(domainData);\n\n\t\t\t\t// Calculate RMS level from time domain data\n\t\t\t\trmsLevel = calculateRMS(timeDomainData);\n\n\t\t\t\t// Check if initial speech/noise has started\n\t\t\t\tconst hasSound = domainData.some((value) => value > 0);\n\t\t\t\tif (hasSound) {\n\t\t\t\t\t// BIG RED TEXT\n\t\t\t\t\tconsole.log('%c%s', 'color: red; font-size: 20px;', ' Sound detected');\n\n\t\t\t\t\tif (!hasStartedSpeaking) {\n\t\t\t\t\t\thasStartedSpeaking = true;\n\t\t\t\t\t\tstopAllAudio();\n\t\t\t\t\t}\n\n\t\t\t\t\tlastSoundTime = Date.now();\n\t\t\t\t}\n\n\t\t\t\t// Start silence detection only after initial speech/noise has been detected\n\t\t\t\tif (hasStartedSpeaking) {\n\t\t\t\t\tif (Date.now() - lastSoundTime > 2000) {\n\t\t\t\t\t\tconfirmed = true;\n\n\t\t\t\t\t\tif (mediaRecorder) {\n\t\t\t\t\t\t\tconsole.log('%c%s', 'color: red; font-size: 20px;', ' Silence detected');\n\t\t\t\t\t\t\tmediaRecorder.stop();\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\twindow.requestAnimationFrame(processFrame);\n\t\t\t};\n\n\t\t\twindow.requestAnimationFrame(processFrame);\n\t\t};\n\n\t\tdetectSound();\n\t};\n\n\tlet finishedMessages = {};\n\tlet currentMessageId = null;\n\tlet currentUtterance = null;\n\n\tconst speakSpeechSynthesisHandler = (content) => {\n\t\tif ($showCallOverlay) {\n\t\t\treturn new Promise((resolve) => {\n\t\t\t\tlet voices = [];\n\t\t\t\tconst getVoicesLoop = setInterval(async () => {\n\t\t\t\t\tvoices = await speechSynthesis.getVoices();\n\t\t\t\t\tif (voices.length > 0) {\n\t\t\t\t\t\tclearInterval(getVoicesLoop);\n\n\t\t\t\t\t\tconst voice =\n\t\t\t\t\t\t\tvoices\n\t\t\t\t\t\t\t\t?.filter(\n\t\t\t\t\t\t\t\t\t(v) => v.voiceURI === ($settings?.audio?.tts?.voice ?? $config?.audio?.tts?.voice)\n\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t\t?.at(0) ?? undefined;\n\n\t\t\t\t\t\tcurrentUtterance = new SpeechSynthesisUtterance(content);\n\n\t\t\t\t\t\tif (voice) {\n\t\t\t\t\t\t\tcurrentUtterance.voice = voice;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tspeechSynthesis.speak(currentUtterance);\n\t\t\t\t\t\tcurrentUtterance.onend = async (e) => {\n\t\t\t\t\t\t\tawait new Promise((r) => setTimeout(r, 200));\n\t\t\t\t\t\t\tresolve(e);\n\t\t\t\t\t\t};\n\t\t\t\t\t}\n\t\t\t\t}, 100);\n\t\t\t});\n\t\t} else {\n\t\t\treturn Promise.resolve();\n\t\t}\n\t};\n\n\tconst playAudio = (audio) => {\n\t\tif ($showCallOverlay) {\n\t\t\treturn new Promise((resolve) => {\n\t\t\t\tconst audioElement = document.getElementById('audioElement');\n\n\t\t\t\tif (audioElement) {\n\t\t\t\t\taudioElement.src = audio.src;\n\t\t\t\t\taudioElement.muted = true;\n\n\t\t\t\t\taudioElement\n\t\t\t\t\t\t.play()\n\t\t\t\t\t\t.then(() => {\n\t\t\t\t\t\t\taudioElement.muted = false;\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.catch((error) => {\n\t\t\t\t\t\t\tconsole.error(error);\n\t\t\t\t\t\t});\n\n\t\t\t\t\taudioElement.onended = async (e) => {\n\t\t\t\t\t\tawait new Promise((r) => setTimeout(r, 100));\n\t\t\t\t\t\tresolve(e);\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t});\n\t\t} else {\n\t\t\treturn Promise.resolve();\n\t\t}\n\t};\n\n\tconst stopAllAudio = async () => {\n\t\tassistantSpeaking = false;\n\t\tinterrupted = true;\n\n\t\tif (chatStreaming) {\n\t\t\tstopResponse();\n\t\t}\n\n\t\tif (currentUtterance) {\n\t\t\tspeechSynthesis.cancel();\n\t\t\tcurrentUtterance = null;\n\t\t}\n\n\t\tconst audioElement = document.getElementById('audioElement');\n\t\tif (audioElement) {\n\t\t\taudioElement.muted = true;\n\t\t\taudioElement.pause();\n\t\t\taudioElement.currentTime = 0;\n\t\t}\n\t};\n\n\tlet audioAbortController = new AbortController();\n\n\t// Audio cache map where key is the content and value is the Audio object.\n\tconst audioCache = new Map();\n\tconst emojiCache = new Map();\n\n\tconst fetchAudio = async (content) => {\n\t\tif (!audioCache.has(content)) {\n\t\t\ttry {\n\t\t\t\t// Set the emoji for the content if needed\n\t\t\t\tif ($settings?.showEmojiInCall ?? false) {\n\t\t\t\t\tconst emoji = await generateEmoji(localStorage.token, modelId, content, chatId);\n\t\t\t\t\tif (emoji) {\n\t\t\t\t\t\temojiCache.set(content, emoji);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif ($config.audio.tts.engine !== '') {\n\t\t\t\t\tconst res = await synthesizeOpenAISpeech(\n\t\t\t\t\t\tlocalStorage.token,\n\t\t\t\t\t\t$settings?.audio?.tts?.voice ?? $config?.audio?.tts?.voice,\n\t\t\t\t\t\tcontent\n\t\t\t\t\t).catch((error) => {\n\t\t\t\t\t\tconsole.error(error);\n\t\t\t\t\t\treturn null;\n\t\t\t\t\t});\n\n\t\t\t\t\tif (res) {\n\t\t\t\t\t\tconst blob = await res.blob();\n\t\t\t\t\t\tconst blobUrl = URL.createObjectURL(blob);\n\t\t\t\t\t\taudioCache.set(content, new Audio(blobUrl));\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\taudioCache.set(content, true);\n\t\t\t\t}\n\t\t\t} catch (error) {\n\t\t\t\tconsole.error('Error synthesizing speech:', error);\n\t\t\t}\n\t\t}\n\n\t\treturn audioCache.get(content);\n\t};\n\n\tlet messages = {};\n\n\tconst monitorAndPlayAudio = async (id, signal) => {\n\t\twhile (!signal.aborted) {\n\t\t\tif (messages[id] && messages[id].length > 0) {\n\t\t\t\t// Retrieve the next content string from the queue\n\t\t\t\tconst content = messages[id].shift(); // Dequeues the content for playing\n\n\t\t\t\tif (audioCache.has(content)) {\n\t\t\t\t\t// If content is available in the cache, play it\n\n\t\t\t\t\t// Set the emoji for the content if available\n\t\t\t\t\tif (($settings?.showEmojiInCall ?? false) && emojiCache.has(content)) {\n\t\t\t\t\t\temoji = emojiCache.get(content);\n\t\t\t\t\t} else {\n\t\t\t\t\t\temoji = null;\n\t\t\t\t\t}\n\n\t\t\t\t\tif ($config.audio.tts.engine !== '') {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tconsole.log(\n\t\t\t\t\t\t\t\t'%c%s',\n\t\t\t\t\t\t\t\t'color: red; font-size: 20px;',\n\t\t\t\t\t\t\t\t`Playing audio for content: ${content}`\n\t\t\t\t\t\t\t);\n\n\t\t\t\t\t\t\tconst audio = audioCache.get(content);\n\t\t\t\t\t\t\tawait playAudio(audio); // Here ensure that playAudio is indeed correct method to execute\n\t\t\t\t\t\t\tconsole.log(`Played audio for content: ${content}`);\n\t\t\t\t\t\t\tawait new Promise((resolve) => setTimeout(resolve, 200)); // Wait before retrying to reduce tight loop\n\t\t\t\t\t\t} catch (error) {\n\t\t\t\t\t\t\tconsole.error('Error playing audio:', error);\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tawait speakSpeechSynthesisHandler(content);\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\t// If not available in the cache, push it back to the queue and delay\n\t\t\t\t\tmessages[id].unshift(content); // Re-queue the content at the start\n\t\t\t\t\tconsole.log(`Audio for \"${content}\" not yet available in the cache, re-queued...`);\n\t\t\t\t\tawait new Promise((resolve) => setTimeout(resolve, 200)); // Wait before retrying to reduce tight loop\n\t\t\t\t}\n\t\t\t} else if (finishedMessages[id] && messages[id] && messages[id].length === 0) {\n\t\t\t\t// If the message is finished and there are no more messages to process, break the loop\n\t\t\t\tassistantSpeaking = false;\n\t\t\t\tbreak;\n\t\t\t} else {\n\t\t\t\t// No messages to process, sleep for a bit\n\t\t\t\tawait new Promise((resolve) => setTimeout(resolve, 200));\n\t\t\t}\n\t\t}\n\t\tconsole.log(`Audio monitoring and playing stopped for message ID ${id}`);\n\t};\n\n\tonMount(async () => {\n\t\tstartRecording();\n\n\t\tconst chatStartHandler = async (e) => {\n\t\t\tconst { id } = e.detail;\n\n\t\t\tchatStreaming = true;\n\n\t\t\tif (currentMessageId !== id) {\n\t\t\t\tconsole.log(`Received chat start event for message ID ${id}`);\n\n\t\t\t\tcurrentMessageId = id;\n\t\t\t\tif (audioAbortController) {\n\t\t\t\t\taudioAbortController.abort();\n\t\t\t\t}\n\t\t\t\taudioAbortController = new AbortController();\n\n\t\t\t\tassistantSpeaking = true;\n\t\t\t\t// Start monitoring and playing audio for the message ID\n\t\t\t\tmonitorAndPlayAudio(id, audioAbortController.signal);\n\t\t\t}\n\t\t};\n\n\t\tconst chatEventHandler = async (e) => {\n\t\t\tconst { id, content } = e.detail;\n\t\t\t// \"id\" here is message id\n\t\t\t// if \"id\" is not the same as \"currentMessageId\" then do not process\n\t\t\t// \"content\" here is a sentence from the assistant,\n\t\t\t// there will be many sentences for the same \"id\"\n\n\t\t\tif (currentMessageId === id) {\n\t\t\t\tconsole.log(`Received chat event for message ID ${id}: ${content}`);\n\n\t\t\t\ttry {\n\t\t\t\t\tif (messages[id] === undefined) {\n\t\t\t\t\t\tmessages[id] = [content];\n\t\t\t\t\t} else {\n\t\t\t\t\t\tmessages[id].push(content);\n\t\t\t\t\t}\n\n\t\t\t\t\tconsole.log(content);\n\n\t\t\t\t\tfetchAudio(content);\n\t\t\t\t} catch (error) {\n\t\t\t\t\tconsole.error('Failed to fetch or play audio:', error);\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\tconst chatFinishHandler = async (e) => {\n\t\t\tconst { id, content } = e.detail;\n\t\t\t// \"content\" here is the entire message from the assistant\n\t\t\tfinishedMessages[id] = true;\n\n\t\t\tchatStreaming = false;\n\t\t};\n\n\t\teventTarget.addEventListener('chat:start', chatStartHandler);\n\t\teventTarget.addEventListener('chat', chatEventHandler);\n\t\teventTarget.addEventListener('chat:finish', chatFinishHandler);\n\n\t\treturn async () => {\n\t\t\teventTarget.removeEventListener('chat:start', chatStartHandler);\n\t\t\teventTarget.removeEventListener('chat', chatEventHandler);\n\t\t\teventTarget.removeEventListener('chat:finish', chatFinishHandler);\n\n\t\t\taudioAbortController.abort();\n\t\t\tawait tick();\n\n\t\t\tawait stopAllAudio();\n\n\t\t\tawait stopRecordingCallback(false);\n\t\t\tawait stopCamera();\n\t\t};\n\t});\n</script>\n\n{#if $showCallOverlay}\n\t<div class=\" absolute w-full h-screen max-h-[100dvh] flex z-[999] overflow-hidden\">\n\t\t<div\n\t\t\tclass=\"absolute w-full h-screen max-h-[100dvh] bg-white text-gray-700 dark:bg-black dark:text-gray-300 flex justify-center\"\n\t\t>\n\t\t\t<div class=\"max-w-lg w-full h-screen max-h-[100dvh] flex flex-col justify-between p-3 md:p-6\">\n\t\t\t\t{#if camera}\n\t\t\t\t\t<button\n\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\tclass=\"flex justify-center items-center w-full h-20 min-h-20\"\n\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\tif (assistantSpeaking) {\n\t\t\t\t\t\t\t\tstopAllAudio();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}}\n\t\t\t\t\t>\n\t\t\t\t\t\t{#if emoji}\n\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\tclass=\"  transition-all rounded-full\"\n\t\t\t\t\t\t\t\tstyle=\"font-size:{rmsLevel * 100 > 4\n\t\t\t\t\t\t\t\t\t? '4.5'\n\t\t\t\t\t\t\t\t\t: rmsLevel * 100 > 2\n\t\t\t\t\t\t\t\t\t? '4.25'\n\t\t\t\t\t\t\t\t\t: rmsLevel * 100 > 1\n\t\t\t\t\t\t\t\t\t? '3.75'\n\t\t\t\t\t\t\t\t\t: '3.5'}rem;width: 100%; text-align:center;\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t{emoji}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t{:else if loading || assistantSpeaking}\n\t\t\t\t\t\t\t<svg\n\t\t\t\t\t\t\t\tclass=\"size-12 text-gray-900 dark:text-gray-400\"\n\t\t\t\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\t\t\t\tfill=\"currentColor\"\n\t\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\t\t\t\t><style>\n\t\t\t\t\t\t\t\t\t.spinner_qM83 {\n\t\t\t\t\t\t\t\t\t\tanimation: spinner_8HQG 1.05s infinite;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t.spinner_oXPr {\n\t\t\t\t\t\t\t\t\t\tanimation-delay: 0.1s;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t.spinner_ZTLf {\n\t\t\t\t\t\t\t\t\t\tanimation-delay: 0.2s;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t@keyframes spinner_8HQG {\n\t\t\t\t\t\t\t\t\t\t0%,\n\t\t\t\t\t\t\t\t\t\t57.14% {\n\t\t\t\t\t\t\t\t\t\t\tanimation-timing-function: cubic-bezier(0.33, 0.66, 0.66, 1);\n\t\t\t\t\t\t\t\t\t\t\ttransform: translate(0);\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t28.57% {\n\t\t\t\t\t\t\t\t\t\t\tanimation-timing-function: cubic-bezier(0.33, 0, 0.66, 0.33);\n\t\t\t\t\t\t\t\t\t\t\ttransform: translateY(-6px);\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t100% {\n\t\t\t\t\t\t\t\t\t\t\ttransform: translate(0);\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t</style><circle class=\"spinner_qM83\" cx=\"4\" cy=\"12\" r=\"3\" /><circle\n\t\t\t\t\t\t\t\t\tclass=\"spinner_qM83 spinner_oXPr\"\n\t\t\t\t\t\t\t\t\tcx=\"12\"\n\t\t\t\t\t\t\t\t\tcy=\"12\"\n\t\t\t\t\t\t\t\t\tr=\"3\"\n\t\t\t\t\t\t\t\t/><circle class=\"spinner_qM83 spinner_ZTLf\" cx=\"20\" cy=\"12\" r=\"3\" /></svg\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t{:else}\n\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\tclass=\" {rmsLevel * 100 > 4\n\t\t\t\t\t\t\t\t\t? ' size-[4.5rem]'\n\t\t\t\t\t\t\t\t\t: rmsLevel * 100 > 2\n\t\t\t\t\t\t\t\t\t? ' size-16'\n\t\t\t\t\t\t\t\t\t: rmsLevel * 100 > 1\n\t\t\t\t\t\t\t\t\t? 'size-14'\n\t\t\t\t\t\t\t\t\t: 'size-12'}  transition-all bg-black dark:bg-white rounded-full\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t<!-- navbar -->\n\t\t\t\t\t</button>\n\t\t\t\t{/if}\n\n\t\t\t\t<div class=\"flex justify-center items-center flex-1 h-full w-full max-h-full\">\n\t\t\t\t\t{#if !camera}\n\t\t\t\t\t\t<button\n\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\tif (assistantSpeaking) {\n\t\t\t\t\t\t\t\t\tstopAllAudio();\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{#if emoji}\n\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\tclass=\"  transition-all rounded-full\"\n\t\t\t\t\t\t\t\t\tstyle=\"font-size:{rmsLevel * 100 > 4\n\t\t\t\t\t\t\t\t\t\t? '13'\n\t\t\t\t\t\t\t\t\t\t: rmsLevel * 100 > 2\n\t\t\t\t\t\t\t\t\t\t? '12'\n\t\t\t\t\t\t\t\t\t\t: rmsLevel * 100 > 1\n\t\t\t\t\t\t\t\t\t\t? '11.5'\n\t\t\t\t\t\t\t\t\t\t: '11'}rem;width:100%;text-align:center;\"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t{emoji}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t{:else if loading || assistantSpeaking}\n\t\t\t\t\t\t\t\t<svg\n\t\t\t\t\t\t\t\t\tclass=\"size-44 text-gray-900 dark:text-gray-400\"\n\t\t\t\t\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\t\t\t\t\tfill=\"currentColor\"\n\t\t\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\t\t\t\t\t><style>\n\t\t\t\t\t\t\t\t\t\t.spinner_qM83 {\n\t\t\t\t\t\t\t\t\t\t\tanimation: spinner_8HQG 1.05s infinite;\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t.spinner_oXPr {\n\t\t\t\t\t\t\t\t\t\t\tanimation-delay: 0.1s;\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t.spinner_ZTLf {\n\t\t\t\t\t\t\t\t\t\t\tanimation-delay: 0.2s;\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t@keyframes spinner_8HQG {\n\t\t\t\t\t\t\t\t\t\t\t0%,\n\t\t\t\t\t\t\t\t\t\t\t57.14% {\n\t\t\t\t\t\t\t\t\t\t\t\tanimation-timing-function: cubic-bezier(0.33, 0.66, 0.66, 1);\n\t\t\t\t\t\t\t\t\t\t\t\ttransform: translate(0);\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t28.57% {\n\t\t\t\t\t\t\t\t\t\t\t\tanimation-timing-function: cubic-bezier(0.33, 0, 0.66, 0.33);\n\t\t\t\t\t\t\t\t\t\t\t\ttransform: translateY(-6px);\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t100% {\n\t\t\t\t\t\t\t\t\t\t\t\ttransform: translate(0);\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t</style><circle class=\"spinner_qM83\" cx=\"4\" cy=\"12\" r=\"3\" /><circle\n\t\t\t\t\t\t\t\t\t\tclass=\"spinner_qM83 spinner_oXPr\"\n\t\t\t\t\t\t\t\t\t\tcx=\"12\"\n\t\t\t\t\t\t\t\t\t\tcy=\"12\"\n\t\t\t\t\t\t\t\t\t\tr=\"3\"\n\t\t\t\t\t\t\t\t\t/><circle class=\"spinner_qM83 spinner_ZTLf\" cx=\"20\" cy=\"12\" r=\"3\" /></svg\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{:else}\n\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\tclass=\" {rmsLevel * 100 > 4\n\t\t\t\t\t\t\t\t\t\t? ' size-52'\n\t\t\t\t\t\t\t\t\t\t: rmsLevel * 100 > 2\n\t\t\t\t\t\t\t\t\t\t? 'size-48'\n\t\t\t\t\t\t\t\t\t\t: rmsLevel * 100 > 1\n\t\t\t\t\t\t\t\t\t\t? 'size-[11.5rem]'\n\t\t\t\t\t\t\t\t\t\t: 'size-44'}  transition-all bg-black dark:bg-white rounded-full\"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t</button>\n\t\t\t\t\t{:else}\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tclass=\"relative flex video-container w-full max-h-full pt-2 pb-4 md:py-6 px-2 h-full\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<video\n\t\t\t\t\t\t\t\tid=\"camera-feed\"\n\t\t\t\t\t\t\t\tautoplay\n\t\t\t\t\t\t\t\tclass=\"rounded-2xl h-full min-w-full object-cover object-center\"\n\t\t\t\t\t\t\t\tplaysinline\n\t\t\t\t\t\t\t/>\n\n\t\t\t\t\t\t\t<canvas id=\"camera-canvas\" style=\"display:none;\" />\n\n\t\t\t\t\t\t\t<div class=\" absolute top-4 md:top-8 left-4\">\n\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t\t\t\tclass=\"p-1.5 text-white cursor-pointer backdrop-blur-xl bg-black/10 rounded-full\"\n\t\t\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\t\t\tstopCamera();\n\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<svg\n\t\t\t\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\t\t\t\t\t\tviewBox=\"0 0 16 16\"\n\t\t\t\t\t\t\t\t\t\tfill=\"currentColor\"\n\t\t\t\t\t\t\t\t\t\tclass=\"size-6\"\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\t\t\td=\"M5.28 4.22a.75.75 0 0 0-1.06 1.06L6.94 8l-2.72 2.72a.75.75 0 1 0 1.06 1.06L8 9.06l2.72 2.72a.75.75 0 1 0 1.06-1.06L9.06 8l2.72-2.72a.75.75 0 0 0-1.06-1.06L8 6.94 5.28 4.22Z\"\n\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t{/if}\n\t\t\t\t</div>\n\n\t\t\t\t<div class=\"flex justify-between items-center pb-2 w-full\">\n\t\t\t\t\t<div>\n\t\t\t\t\t\t{#if camera}\n\t\t\t\t\t\t\t<VideoInputMenu\n\t\t\t\t\t\t\t\tdevices={videoInputDevices}\n\t\t\t\t\t\t\t\ton:change={async (e) => {\n\t\t\t\t\t\t\t\t\tconsole.log(e.detail);\n\t\t\t\t\t\t\t\t\tselectedVideoInputDeviceId = e.detail;\n\t\t\t\t\t\t\t\t\tawait stopVideoStream();\n\t\t\t\t\t\t\t\t\tawait startVideoStream();\n\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<button class=\" p-3 rounded-full bg-gray-50 dark:bg-gray-900\" type=\"button\">\n\t\t\t\t\t\t\t\t\t<svg\n\t\t\t\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\t\t\t\t\t\tviewBox=\"0 0 20 20\"\n\t\t\t\t\t\t\t\t\t\tfill=\"currentColor\"\n\t\t\t\t\t\t\t\t\t\tclass=\"size-5\"\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\t\t\tfill-rule=\"evenodd\"\n\t\t\t\t\t\t\t\t\t\t\td=\"M15.312 11.424a5.5 5.5 0 0 1-9.201 2.466l-.312-.311h2.433a.75.75 0 0 0 0-1.5H3.989a.75.75 0 0 0-.75.75v4.242a.75.75 0 0 0 1.5 0v-2.43l.31.31a7 7 0 0 0 11.712-3.138.75.75 0 0 0-1.449-.39Zm1.23-3.723a.75.75 0 0 0 .219-.53V2.929a.75.75 0 0 0-1.5 0V5.36l-.31-.31A7 7 0 0 0 3.239 8.188a.75.75 0 1 0 1.448.389A5.5 5.5 0 0 1 13.89 6.11l.311.31h-2.432a.75.75 0 0 0 0 1.5h4.243a.75.75 0 0 0 .53-.219Z\"\n\t\t\t\t\t\t\t\t\t\t\tclip-rule=\"evenodd\"\n\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t</VideoInputMenu>\n\t\t\t\t\t\t{:else}\n\t\t\t\t\t\t\t<Tooltip content={$i18n.t('Camera')}>\n\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\tclass=\" p-3 rounded-full bg-gray-50 dark:bg-gray-900\"\n\t\t\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t\t\t\ton:click={async () => {\n\t\t\t\t\t\t\t\t\t\tawait navigator.mediaDevices.getUserMedia({ video: true });\n\t\t\t\t\t\t\t\t\t\tstartCamera();\n\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<svg\n\t\t\t\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\t\t\t\t\t\tfill=\"none\"\n\t\t\t\t\t\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\t\t\t\t\t\tstroke-width=\"1.5\"\n\t\t\t\t\t\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\t\t\t\t\t\tclass=\"size-5\"\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\t\t\tstroke-linecap=\"round\"\n\t\t\t\t\t\t\t\t\t\t\tstroke-linejoin=\"round\"\n\t\t\t\t\t\t\t\t\t\t\td=\"M6.827 6.175A2.31 2.31 0 0 1 5.186 7.23c-.38.054-.757.112-1.134.175C2.999 7.58 2.25 8.507 2.25 9.574V18a2.25 2.25 0 0 0 2.25 2.25h15A2.25 2.25 0 0 0 21.75 18V9.574c0-1.067-.75-1.994-1.802-2.169a47.865 47.865 0 0 0-1.134-.175 2.31 2.31 0 0 1-1.64-1.055l-.822-1.316a2.192 2.192 0 0 0-1.736-1.039 48.774 48.774 0 0 0-5.232 0 2.192 2.192 0 0 0-1.736 1.039l-.821 1.316Z\"\n\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\t\t\tstroke-linecap=\"round\"\n\t\t\t\t\t\t\t\t\t\t\tstroke-linejoin=\"round\"\n\t\t\t\t\t\t\t\t\t\t\td=\"M16.5 12.75a4.5 4.5 0 1 1-9 0 4.5 4.5 0 0 1 9 0ZM18.75 10.5h.008v.008h-.008V10.5Z\"\n\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t</Tooltip>\n\t\t\t\t\t\t{/if}\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<button\n\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\tif (assistantSpeaking) {\n\t\t\t\t\t\t\t\t\tstopAllAudio();\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<div class=\" line-clamp-1 text-sm font-medium\">\n\t\t\t\t\t\t\t\t{#if loading}\n\t\t\t\t\t\t\t\t\t{$i18n.t('Thinking...')}\n\t\t\t\t\t\t\t\t{:else if assistantSpeaking}\n\t\t\t\t\t\t\t\t\t{$i18n.t('Tap to interrupt')}\n\t\t\t\t\t\t\t\t{:else}\n\t\t\t\t\t\t\t\t\t{$i18n.t('Listening...')}\n\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<button\n\t\t\t\t\t\t\tclass=\" p-3 rounded-full bg-gray-50 dark:bg-gray-900\"\n\t\t\t\t\t\t\ton:click={async () => {\n\t\t\t\t\t\t\t\tshowCallOverlay.set(false);\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<svg\n\t\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\t\t\t\tviewBox=\"0 0 20 20\"\n\t\t\t\t\t\t\t\tfill=\"currentColor\"\n\t\t\t\t\t\t\t\tclass=\"size-5\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\td=\"M6.28 5.22a.75.75 0 0 0-1.06 1.06L8.94 10l-3.72 3.72a.75.75 0 1 0 1.06 1.06L10 11.06l3.72 3.72a.75.75 0 1 0 1.06-1.06L11.06 10l3.72-3.72a.75.75 0 0 0-1.06-1.06L10 8.94 6.28 5.22Z\"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n{/if}\n","<script lang=\"ts\">\n\timport { v4 as uuidv4 } from 'uuid';\n\timport { toast } from 'svelte-sonner';\n\timport mermaid from 'mermaid';\n\n\timport { getContext, onMount, tick } from 'svelte';\n\timport { goto } from '$app/navigation';\n\timport { page } from '$app/stores';\n\n\timport type { Writable } from 'svelte/store';\n\timport type { i18n as i18nType } from 'i18next';\n\timport { OLLAMA_API_BASE_URL, OPENAI_API_BASE_URL, WEBUI_BASE_URL } from '$lib/constants';\n\n\timport {\n\t\tchatId,\n\t\tchats,\n\t\tconfig,\n\t\ttype Model,\n\t\tmodels,\n\t\tsettings,\n\t\tshowSidebar,\n\t\ttags as _tags,\n\t\tWEBUI_NAME,\n\t\tbanners,\n\t\tuser,\n\t\tsocket,\n\t\tshowCallOverlay,\n\t\ttools\n\t} from '$lib/stores';\n\timport {\n\t\tconvertMessagesToHistory,\n\t\tcopyToClipboard,\n\t\textractSentencesForAudio,\n\t\tgetUserPosition,\n\t\tpromptTemplate,\n\t\tsplitStream\n\t} from '$lib/utils';\n\n\timport { generateChatCompletion } from '$lib/apis/ollama';\n\timport {\n\t\taddTagById,\n\t\tcreateNewChat,\n\t\tdeleteTagById,\n\t\tgetAllChatTags,\n\t\tgetChatById,\n\t\tgetChatList,\n\t\tgetTagsById,\n\t\tupdateChatById\n\t} from '$lib/apis/chats';\n\timport { generateOpenAIChatCompletion } from '$lib/apis/openai';\n\timport { runWebSearch } from '$lib/apis/rag';\n\timport { createOpenAITextStream } from '$lib/apis/streaming';\n\timport { queryMemory } from '$lib/apis/memories';\n\timport { getAndUpdateUserLocation, getUserSettings } from '$lib/apis/users';\n\timport { chatCompleted, generateTitle, generateSearchQuery } from '$lib/apis';\n\n\timport Banner from '../common/Banner.svelte';\n\timport MessageInput from '$lib/components/chat/MessageInput.svelte';\n\timport Messages from '$lib/components/chat/Messages.svelte';\n\timport Navbar from '$lib/components/layout/Navbar.svelte';\n\timport CallOverlay from './MessageInput/CallOverlay.svelte';\n\timport { error } from '@sveltejs/kit';\n\n\tconst i18n: Writable<i18nType> = getContext('i18n');\n\n\texport let chatIdProp = '';\n\tlet loaded = false;\n\n\tconst eventTarget = new EventTarget();\n\n\tlet stopResponseFlag = false;\n\tlet autoScroll = true;\n\tlet processing = '';\n\tlet messagesContainerElement: HTMLDivElement;\n\n\tlet showModelSelector = true;\n\n\tlet selectedModels = [''];\n\tlet atSelectedModel: Model | undefined;\n\n\tlet selectedModelIds = [];\n\t$: selectedModelIds = atSelectedModel !== undefined ? [atSelectedModel.id] : selectedModels;\n\n\tlet selectedToolIds = [];\n\tlet webSearchEnabled = false;\n\n\tlet chat = null;\n\tlet tags = [];\n\n\tlet title = '';\n\tlet prompt = '';\n\tlet files = [];\n\tlet messages = [];\n\tlet history = {\n\t\tmessages: {},\n\t\tcurrentId: null\n\t};\n\n\t$: if (history.currentId !== null) {\n\t\tlet _messages = [];\n\n\t\tlet currentMessage = history.messages[history.currentId];\n\t\twhile (currentMessage !== null) {\n\t\t\t_messages.unshift({ ...currentMessage });\n\t\t\tcurrentMessage =\n\t\t\t\tcurrentMessage.parentId !== null ? history.messages[currentMessage.parentId] : null;\n\t\t}\n\t\tmessages = _messages;\n\t} else {\n\t\tmessages = [];\n\t}\n\n\t$: if (chatIdProp) {\n\t\t(async () => {\n\t\t\tconsole.log(chatIdProp);\n\t\t\tif (chatIdProp && (await loadChat())) {\n\t\t\t\tawait tick();\n\t\t\t\tloaded = true;\n\n\t\t\t\twindow.setTimeout(() => scrollToBottom(), 0);\n\t\t\t\tconst chatInput = document.getElementById('chat-textarea');\n\t\t\t\tchatInput?.focus();\n\t\t\t} else {\n\t\t\t\tawait goto('/');\n\t\t\t}\n\t\t})();\n\t}\n\n\tonMount(async () => {\n\t\tif (!$chatId) {\n\t\t\tchatId.subscribe(async (value) => {\n\t\t\t\tif (!value) {\n\t\t\t\t\tawait initNewChat();\n\t\t\t\t}\n\t\t\t});\n\t\t} else {\n\t\t\tif (!($settings.saveChatHistory ?? true)) {\n\t\t\t\tawait goto('/');\n\t\t\t}\n\t\t}\n\t});\n\n\t//////////////////////////\n\t// Web functions\n\t//////////////////////////\n\n\tconst initNewChat = async () => {\n\t\twindow.history.replaceState(history.state, '', `/`);\n\t\tawait chatId.set('');\n\n\t\tautoScroll = true;\n\n\t\ttitle = '';\n\t\tmessages = [];\n\t\thistory = {\n\t\t\tmessages: {},\n\t\t\tcurrentId: null\n\t\t};\n\n\t\tif ($page.url.searchParams.get('models')) {\n\t\t\tselectedModels = $page.url.searchParams.get('models')?.split(',');\n\t\t} else if ($settings?.models) {\n\t\t\tselectedModels = $settings?.models;\n\t\t} else if ($config?.default_models) {\n\t\t\tconsole.log($config?.default_models.split(',') ?? '');\n\t\t\tselectedModels = $config?.default_models.split(',');\n\t\t} else {\n\t\t\tselectedModels = [''];\n\t\t}\n\n\t\tif ($page.url.searchParams.get('q')) {\n\t\t\tprompt = $page.url.searchParams.get('q') ?? '';\n\n\t\t\tif (prompt) {\n\t\t\t\tawait tick();\n\t\t\t\tsubmitPrompt(prompt);\n\t\t\t}\n\t\t}\n\n\t\tselectedModels = selectedModels.map((modelId) =>\n\t\t\t$models.map((m) => m.id).includes(modelId) ? modelId : ''\n\t\t);\n\n\t\tconst userSettings = await getUserSettings(localStorage.token);\n\n\t\tif (userSettings) {\n\t\t\tsettings.set(userSettings.ui);\n\t\t} else {\n\t\t\tsettings.set(JSON.parse(localStorage.getItem('settings') ?? '{}'));\n\t\t}\n\n\t\tconst chatInput = document.getElementById('chat-textarea');\n\t\tsetTimeout(() => chatInput?.focus(), 0);\n\t};\n\n\tconst loadChat = async () => {\n\t\tchatId.set(chatIdProp);\n\t\tchat = await getChatById(localStorage.token, $chatId).catch(async (error) => {\n\t\t\tawait goto('/');\n\t\t\treturn null;\n\t\t});\n\n\t\tif (chat) {\n\t\t\ttags = await getTags();\n\t\t\tconst chatContent = chat.chat;\n\n\t\t\tif (chatContent) {\n\t\t\t\tconsole.log(chatContent);\n\n\t\t\t\tselectedModels =\n\t\t\t\t\t(chatContent?.models ?? undefined) !== undefined\n\t\t\t\t\t\t? chatContent.models\n\t\t\t\t\t\t: [chatContent.models ?? ''];\n\t\t\t\thistory =\n\t\t\t\t\t(chatContent?.history ?? undefined) !== undefined\n\t\t\t\t\t\t? chatContent.history\n\t\t\t\t\t\t: convertMessagesToHistory(chatContent.messages);\n\t\t\t\ttitle = chatContent.title;\n\n\t\t\t\tconst userSettings = await getUserSettings(localStorage.token);\n\n\t\t\t\tif (userSettings) {\n\t\t\t\t\tawait settings.set(userSettings.ui);\n\t\t\t\t} else {\n\t\t\t\t\tawait settings.set(JSON.parse(localStorage.getItem('settings') ?? '{}'));\n\t\t\t\t}\n\n\t\t\t\tawait settings.set({\n\t\t\t\t\t...$settings,\n\t\t\t\t\tsystem: chatContent.system ?? $settings.system,\n\t\t\t\t\tparams: chatContent.options ?? $settings.params\n\t\t\t\t});\n\n\t\t\t\tautoScroll = true;\n\t\t\t\tawait tick();\n\n\t\t\t\tif (messages.length > 0) {\n\t\t\t\t\thistory.messages[messages.at(-1).id].done = true;\n\t\t\t\t}\n\t\t\t\tawait tick();\n\n\t\t\t\treturn true;\n\t\t\t} else {\n\t\t\t\treturn null;\n\t\t\t}\n\t\t}\n\t};\n\n\tconst scrollToBottom = async () => {\n\t\tawait tick();\n\t\tif (messagesContainerElement) {\n\t\t\tmessagesContainerElement.scrollTop = messagesContainerElement.scrollHeight;\n\t\t}\n\t};\n\n\tconst createMessagesList = (responseMessageId) => {\n\t\tconst message = history.messages[responseMessageId];\n\t\tif (message.parentId) {\n\t\t\treturn [...createMessagesList(message.parentId), message];\n\t\t} else {\n\t\t\treturn [message];\n\t\t}\n\t};\n\n\tconst chatCompletedHandler = async (modelId, messages) => {\n\t\tawait mermaid.run({\n\t\t\tquerySelector: '.mermaid'\n\t\t});\n\n\t\tconst res = await chatCompleted(localStorage.token, {\n\t\t\tmodel: modelId,\n\t\t\tmessages: messages.map((m) => ({\n\t\t\t\tid: m.id,\n\t\t\t\trole: m.role,\n\t\t\t\tcontent: m.content,\n\t\t\t\ttimestamp: m.timestamp\n\t\t\t})),\n\t\t\tchat_id: $chatId\n\t\t}).catch((error) => {\n\t\t\tconsole.error(error);\n\t\t\treturn null;\n\t\t});\n\n\t\tif (res !== null) {\n\t\t\t// Update chat history with the new messages\n\t\t\tfor (const message of res.messages) {\n\t\t\t\thistory.messages[message.id] = {\n\t\t\t\t\t...history.messages[message.id],\n\t\t\t\t\t...(history.messages[message.id].content !== message.content\n\t\t\t\t\t\t? { originalContent: history.messages[message.id].content }\n\t\t\t\t\t\t: {}),\n\t\t\t\t\t...message\n\t\t\t\t};\n\t\t\t}\n\t\t}\n\t};\n\n\tconst getChatEventEmitter = async (modelId: string, chatId: string = '') => {\n\t\treturn setInterval(() => {\n\t\t\t$socket?.emit('usage', {\n\t\t\t\taction: 'chat',\n\t\t\t\tmodel: modelId,\n\t\t\t\tchat_id: chatId\n\t\t\t});\n\t\t}, 1000);\n\t};\n\n\t//////////////////////////\n\t// Chat functions\n\t//////////////////////////\n\n\tconst submitPrompt = async (userPrompt, { _raw = false } = {}) => {\n\t\tlet _responses = [];\n\t\tconsole.log('submitPrompt', $chatId);\n\n\t\tselectedModels = selectedModels.map((modelId) =>\n\t\t\t$models.map((m) => m.id).includes(modelId) ? modelId : ''\n\t\t);\n\n\t\tif (selectedModels.includes('')) {\n\t\t\ttoast.error($i18n.t('Model not selected'));\n\t\t} else if (messages.length != 0 && messages.at(-1).done != true) {\n\t\t\t// Response not done\n\t\t\tconsole.log('wait');\n\t\t} else if (\n\t\t\tfiles.length > 0 &&\n\t\t\tfiles.filter((file) => file.upload_status === false).length > 0\n\t\t) {\n\t\t\t// Upload not done\n\t\t\ttoast.error(\n\t\t\t\t$i18n.t(\n\t\t\t\t\t`Oops! Hold tight! Your files are still in the processing oven. We're cooking them up to perfection. Please be patient and we'll let you know once they're ready.`\n\t\t\t\t)\n\t\t\t);\n\t\t} else {\n\t\t\t// Reset chat input textarea\n\t\t\tconst chatTextAreaElement = document.getElementById('chat-textarea');\n\n\t\t\tif (chatTextAreaElement) {\n\t\t\t\tchatTextAreaElement.value = '';\n\t\t\t\tchatTextAreaElement.style.height = '';\n\t\t\t}\n\n\t\t\tconst _files = JSON.parse(JSON.stringify(files));\n\t\t\tfiles = [];\n\n\t\t\tprompt = '';\n\n\t\t\t// Create user message\n\t\t\tlet userMessageId = uuidv4();\n\t\t\tlet userMessage = {\n\t\t\t\tid: userMessageId,\n\t\t\t\tparentId: messages.length !== 0 ? messages.at(-1).id : null,\n\t\t\t\tchildrenIds: [],\n\t\t\t\trole: 'user',\n\t\t\t\tcontent: userPrompt,\n\t\t\t\tfiles: _files.length > 0 ? _files : undefined,\n\t\t\t\ttimestamp: Math.floor(Date.now() / 1000), // Unix epoch\n\t\t\t\tmodels: selectedModels.filter((m, mIdx) => selectedModels.indexOf(m) === mIdx)\n\t\t\t};\n\n\t\t\t// Add message to history and Set currentId to messageId\n\t\t\thistory.messages[userMessageId] = userMessage;\n\t\t\thistory.currentId = userMessageId;\n\n\t\t\t// Append messageId to childrenIds of parent message\n\t\t\tif (messages.length !== 0) {\n\t\t\t\thistory.messages[messages.at(-1).id].childrenIds.push(userMessageId);\n\t\t\t}\n\n\t\t\t// Wait until history/message have been updated\n\t\t\tawait tick();\n\t\t\t_responses = await sendPrompt(userPrompt, userMessageId, { newChat: true });\n\t\t}\n\n\t\treturn _responses;\n\t};\n\n\tconst sendPrompt = async (prompt, parentId, { modelId = null, newChat = false } = {}) => {\n\t\tlet _responses = [];\n\n\t\t// If modelId is provided, use it, else use selected model\n\t\tlet selectedModelIds = modelId\n\t\t\t? [modelId]\n\t\t\t: atSelectedModel !== undefined\n\t\t\t? [atSelectedModel.id]\n\t\t\t: selectedModels;\n\n\t\t// Create response messages for each selected model\n\t\tconst responseMessageIds = {};\n\t\tfor (const modelId of selectedModelIds) {\n\t\t\tconst model = $models.filter((m) => m.id === modelId).at(0);\n\n\t\t\tif (model) {\n\t\t\t\tlet responseMessageId = uuidv4();\n\t\t\t\tlet responseMessage = {\n\t\t\t\t\tparentId: parentId,\n\t\t\t\t\tid: responseMessageId,\n\t\t\t\t\tchildrenIds: [],\n\t\t\t\t\trole: 'assistant',\n\t\t\t\t\tcontent: '',\n\t\t\t\t\tmodel: model.id,\n\t\t\t\t\tmodelName: model.name ?? model.id,\n\t\t\t\t\tuserContext: null,\n\t\t\t\t\ttimestamp: Math.floor(Date.now() / 1000) // Unix epoch\n\t\t\t\t};\n\n\t\t\t\t// Add message to history and Set currentId to messageId\n\t\t\t\thistory.messages[responseMessageId] = responseMessage;\n\t\t\t\thistory.currentId = responseMessageId;\n\n\t\t\t\t// Append messageId to childrenIds of parent message\n\t\t\t\tif (parentId !== null) {\n\t\t\t\t\thistory.messages[parentId].childrenIds = [\n\t\t\t\t\t\t...history.messages[parentId].childrenIds,\n\t\t\t\t\t\tresponseMessageId\n\t\t\t\t\t];\n\t\t\t\t}\n\n\t\t\t\tresponseMessageIds[modelId] = responseMessageId;\n\t\t\t}\n\t\t}\n\t\tawait tick();\n\n\t\t// Create new chat if only one message in messages\n\t\tif (newChat && messages.length == 2) {\n\t\t\tif ($settings.saveChatHistory ?? true) {\n\t\t\t\tchat = await createNewChat(localStorage.token, {\n\t\t\t\t\tid: $chatId,\n\t\t\t\t\ttitle: $i18n.t('New Chat'),\n\t\t\t\t\tmodels: selectedModels,\n\t\t\t\t\tsystem: $settings.system ?? undefined,\n\t\t\t\t\toptions: {\n\t\t\t\t\t\t...($settings.params ?? {})\n\t\t\t\t\t},\n\t\t\t\t\tmessages: messages,\n\t\t\t\t\thistory: history,\n\t\t\t\t\ttags: [],\n\t\t\t\t\ttimestamp: Date.now()\n\t\t\t\t});\n\t\t\t\tawait chats.set(await getChatList(localStorage.token));\n\t\t\t\tawait chatId.set(chat.id);\n\t\t\t} else {\n\t\t\t\tawait chatId.set('local');\n\t\t\t}\n\t\t\tawait tick();\n\t\t}\n\n\t\tconst _chatId = JSON.parse(JSON.stringify($chatId));\n\n\t\tawait Promise.all(\n\t\t\tselectedModelIds.map(async (modelId) => {\n\t\t\t\tconsole.log('modelId', modelId);\n\t\t\t\tconst model = $models.filter((m) => m.id === modelId).at(0);\n\n\t\t\t\tif (model) {\n\t\t\t\t\t// If there are image files, check if model is vision capable\n\t\t\t\t\tconst hasImages = messages.some((message) =>\n\t\t\t\t\t\tmessage.files?.some((file) => file.type === 'image')\n\t\t\t\t\t);\n\n\t\t\t\t\tif (hasImages && !(model.info?.meta?.capabilities?.vision ?? true)) {\n\t\t\t\t\t\ttoast.error(\n\t\t\t\t\t\t\t$i18n.t('Model {{modelName}} is not vision capable', {\n\t\t\t\t\t\t\t\tmodelName: model.name ?? model.id\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\n\t\t\t\t\tlet responseMessageId = responseMessageIds[modelId];\n\t\t\t\t\tlet responseMessage = history.messages[responseMessageId];\n\n\t\t\t\t\tlet userContext = null;\n\t\t\t\t\tif ($settings?.memory ?? false) {\n\t\t\t\t\t\tif (userContext === null) {\n\t\t\t\t\t\t\tconst res = await queryMemory(localStorage.token, prompt).catch((error) => {\n\t\t\t\t\t\t\t\ttoast.error(error);\n\t\t\t\t\t\t\t\treturn null;\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tif (res) {\n\t\t\t\t\t\t\t\tif (res.documents[0].length > 0) {\n\t\t\t\t\t\t\t\t\tuserContext = res.documents.reduce((acc, doc, index) => {\n\t\t\t\t\t\t\t\t\t\tconst createdAtTimestamp = res.metadatas[index][0].created_at;\n\t\t\t\t\t\t\t\t\t\tconst createdAtDate = new Date(createdAtTimestamp * 1000)\n\t\t\t\t\t\t\t\t\t\t\t.toISOString()\n\t\t\t\t\t\t\t\t\t\t\t.split('T')[0];\n\t\t\t\t\t\t\t\t\t\tacc.push(`${index + 1}. [${createdAtDate}]. ${doc[0]}`);\n\t\t\t\t\t\t\t\t\t\treturn acc;\n\t\t\t\t\t\t\t\t\t}, []);\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tconsole.log(userContext);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tresponseMessage.userContext = userContext;\n\n\t\t\t\t\tconst chatEventEmitter = await getChatEventEmitter(model.id, _chatId);\n\t\t\t\t\tif (webSearchEnabled) {\n\t\t\t\t\t\tawait getWebSearchResults(model.id, parentId, responseMessageId);\n\t\t\t\t\t}\n\n\t\t\t\t\tlet _response = null;\n\t\t\t\t\tif (model?.owned_by === 'openai') {\n\t\t\t\t\t\t_response = await sendPromptOpenAI(model, prompt, responseMessageId, _chatId);\n\t\t\t\t\t} else if (model) {\n\t\t\t\t\t\t_response = await sendPromptOllama(model, prompt, responseMessageId, _chatId);\n\t\t\t\t\t}\n\t\t\t\t\t_responses.push(_response);\n\n\t\t\t\t\tif (chatEventEmitter) clearInterval(chatEventEmitter);\n\t\t\t\t} else {\n\t\t\t\t\ttoast.error($i18n.t(`Model {{modelId}} not found`, { modelId }));\n\t\t\t\t}\n\t\t\t})\n\t\t);\n\n\t\tawait chats.set(await getChatList(localStorage.token));\n\t\treturn _responses;\n\t};\n\n\tconst sendPromptOllama = async (model, userPrompt, responseMessageId, _chatId) => {\n\t\tlet _response = null;\n\n\t\tconst responseMessage = history.messages[responseMessageId];\n\n\t\t// Wait until history/message have been updated\n\t\tawait tick();\n\n\t\t// Scroll down\n\t\tscrollToBottom();\n\n\t\tconst messagesBody = [\n\t\t\t$settings.system || (responseMessage?.userContext ?? null)\n\t\t\t\t? {\n\t\t\t\t\t\trole: 'system',\n\t\t\t\t\t\tcontent: `${promptTemplate(\n\t\t\t\t\t\t\t$settings?.system ?? '',\n\t\t\t\t\t\t\t$user.name,\n\t\t\t\t\t\t\t$settings?.userLocation\n\t\t\t\t\t\t\t\t? await getAndUpdateUserLocation(localStorage.token)\n\t\t\t\t\t\t\t\t: undefined\n\t\t\t\t\t\t)}${\n\t\t\t\t\t\t\tresponseMessage?.userContext ?? null\n\t\t\t\t\t\t\t\t? `\\n\\nUser Context:\\n${(responseMessage?.userContext ?? []).join('\\n')}`\n\t\t\t\t\t\t\t\t: ''\n\t\t\t\t\t\t}`\n\t\t\t\t  }\n\t\t\t\t: undefined,\n\t\t\t...messages\n\t\t]\n\t\t\t.filter((message) => message?.content?.trim())\n\t\t\t.map((message, idx, arr) => {\n\t\t\t\t// Prepare the base message object\n\t\t\t\tconst baseMessage = {\n\t\t\t\t\trole: message.role,\n\t\t\t\t\tcontent: message.content\n\t\t\t\t};\n\n\t\t\t\t// Extract and format image URLs if any exist\n\t\t\t\tconst imageUrls = message.files\n\t\t\t\t\t?.filter((file) => file.type === 'image')\n\t\t\t\t\t.map((file) => file.url.slice(file.url.indexOf(',') + 1));\n\n\t\t\t\t// Add images array only if it contains elements\n\t\t\t\tif (imageUrls && imageUrls.length > 0 && message.role === 'user') {\n\t\t\t\t\tbaseMessage.images = imageUrls;\n\t\t\t\t}\n\t\t\t\treturn baseMessage;\n\t\t\t});\n\n\t\tlet lastImageIndex = -1;\n\n\t\t// Find the index of the last object with images\n\t\tmessagesBody.forEach((item, index) => {\n\t\t\tif (item.images) {\n\t\t\t\tlastImageIndex = index;\n\t\t\t}\n\t\t});\n\n\t\t// Remove images from all but the last one\n\t\tmessagesBody.forEach((item, index) => {\n\t\t\tif (index !== lastImageIndex) {\n\t\t\t\tdelete item.images;\n\t\t\t}\n\t\t});\n\n\t\tlet docs = [];\n\n\t\tif (model?.info?.meta?.knowledge ?? false) {\n\t\t\tdocs = model.info.meta.knowledge;\n\t\t}\n\n\t\tdocs = [\n\t\t\t...docs,\n\t\t\t...messages\n\t\t\t\t.filter((message) => message?.files ?? null)\n\t\t\t\t.map((message) =>\n\t\t\t\t\tmessage.files.filter((item) =>\n\t\t\t\t\t\t['doc', 'collection', 'web_search_results'].includes(item.type)\n\t\t\t\t\t)\n\t\t\t\t)\n\t\t\t\t.flat(1)\n\t\t].filter(\n\t\t\t(item, index, array) =>\n\t\t\t\tarray.findIndex((i) => JSON.stringify(i) === JSON.stringify(item)) === index\n\t\t);\n\n\t\teventTarget.dispatchEvent(\n\t\t\tnew CustomEvent('chat:start', {\n\t\t\t\tdetail: {\n\t\t\t\t\tid: responseMessageId\n\t\t\t\t}\n\t\t\t})\n\t\t);\n\n\t\tawait tick();\n\n\t\tconst [res, controller] = await generateChatCompletion(localStorage.token, {\n\t\t\tmodel: model.id,\n\t\t\tmessages: messagesBody,\n\t\t\toptions: {\n\t\t\t\t...($settings.params ?? {}),\n\t\t\t\tstop:\n\t\t\t\t\t$settings?.params?.stop ?? undefined\n\t\t\t\t\t\t? $settings.params.stop.map((str) =>\n\t\t\t\t\t\t\t\tdecodeURIComponent(JSON.parse('\"' + str.replace(/\\\"/g, '\\\\\"') + '\"'))\n\t\t\t\t\t\t  )\n\t\t\t\t\t\t: undefined,\n\t\t\t\tnum_predict: $settings?.params?.max_tokens ?? undefined,\n\t\t\t\trepeat_penalty: $settings?.params?.frequency_penalty ?? undefined\n\t\t\t},\n\t\t\tformat: $settings.requestFormat ?? undefined,\n\t\t\tkeep_alive: $settings.keepAlive ?? undefined,\n\t\t\ttool_ids: selectedToolIds.length > 0 ? selectedToolIds : undefined,\n\t\t\tdocs: docs.length > 0 ? docs : undefined,\n\t\t\tcitations: docs.length > 0,\n\t\t\tchat_id: $chatId\n\t\t});\n\n\t\tif (res && res.ok) {\n\t\t\tconsole.log('controller', controller);\n\n\t\t\tconst reader = res.body\n\t\t\t\t.pipeThrough(new TextDecoderStream())\n\t\t\t\t.pipeThrough(splitStream('\\n'))\n\t\t\t\t.getReader();\n\n\t\t\twhile (true) {\n\t\t\t\tconst { value, done } = await reader.read();\n\t\t\t\tif (done || stopResponseFlag || _chatId !== $chatId) {\n\t\t\t\t\tresponseMessage.done = true;\n\t\t\t\t\tmessages = messages;\n\n\t\t\t\t\tif (stopResponseFlag) {\n\t\t\t\t\t\tcontroller.abort('User: Stop Response');\n\t\t\t\t\t} else {\n\t\t\t\t\t\tconst messages = createMessagesList(responseMessageId);\n\t\t\t\t\t\tawait chatCompletedHandler(model.id, messages);\n\t\t\t\t\t}\n\n\t\t\t\t\t_response = responseMessage.content;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\ttry {\n\t\t\t\t\tlet lines = value.split('\\n');\n\n\t\t\t\t\tfor (const line of lines) {\n\t\t\t\t\t\tif (line !== '') {\n\t\t\t\t\t\t\tconsole.log(line);\n\t\t\t\t\t\t\tlet data = JSON.parse(line);\n\n\t\t\t\t\t\t\tif ('citations' in data) {\n\t\t\t\t\t\t\t\tresponseMessage.citations = data.citations;\n\t\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif ('detail' in data) {\n\t\t\t\t\t\t\t\tthrow data;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif (data.done == false) {\n\t\t\t\t\t\t\t\tif (responseMessage.content == '' && data.message.content == '\\n') {\n\t\t\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tresponseMessage.content += data.message.content;\n\n\t\t\t\t\t\t\t\t\tconst sentences = extractSentencesForAudio(responseMessage.content);\n\t\t\t\t\t\t\t\t\tsentences.pop();\n\n\t\t\t\t\t\t\t\t\t// dispatch only last sentence and make sure it hasn't been dispatched before\n\t\t\t\t\t\t\t\t\tif (\n\t\t\t\t\t\t\t\t\t\tsentences.length > 0 &&\n\t\t\t\t\t\t\t\t\t\tsentences[sentences.length - 1] !== responseMessage.lastSentence\n\t\t\t\t\t\t\t\t\t) {\n\t\t\t\t\t\t\t\t\t\tresponseMessage.lastSentence = sentences[sentences.length - 1];\n\t\t\t\t\t\t\t\t\t\teventTarget.dispatchEvent(\n\t\t\t\t\t\t\t\t\t\t\tnew CustomEvent('chat', {\n\t\t\t\t\t\t\t\t\t\t\t\tdetail: { id: responseMessageId, content: sentences[sentences.length - 1] }\n\t\t\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\tmessages = messages;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tresponseMessage.done = true;\n\n\t\t\t\t\t\t\t\tif (responseMessage.content == '') {\n\t\t\t\t\t\t\t\t\tresponseMessage.error = {\n\t\t\t\t\t\t\t\t\t\tcode: 400,\n\t\t\t\t\t\t\t\t\t\tcontent: `Oops! No text generated from Ollama, Please try again.`\n\t\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tresponseMessage.context = data.context ?? null;\n\t\t\t\t\t\t\t\tresponseMessage.info = {\n\t\t\t\t\t\t\t\t\ttotal_duration: data.total_duration,\n\t\t\t\t\t\t\t\t\tload_duration: data.load_duration,\n\t\t\t\t\t\t\t\t\tsample_count: data.sample_count,\n\t\t\t\t\t\t\t\t\tsample_duration: data.sample_duration,\n\t\t\t\t\t\t\t\t\tprompt_eval_count: data.prompt_eval_count,\n\t\t\t\t\t\t\t\t\tprompt_eval_duration: data.prompt_eval_duration,\n\t\t\t\t\t\t\t\t\teval_count: data.eval_count,\n\t\t\t\t\t\t\t\t\teval_duration: data.eval_duration\n\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\tmessages = messages;\n\n\t\t\t\t\t\t\t\tif ($settings.notificationEnabled && !document.hasFocus()) {\n\t\t\t\t\t\t\t\t\tconst notification = new Notification(`${model.id}`, {\n\t\t\t\t\t\t\t\t\t\tbody: responseMessage.content,\n\t\t\t\t\t\t\t\t\t\ticon: `${WEBUI_BASE_URL}/static/favicon.png`\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tif ($settings?.responseAutoCopy ?? false) {\n\t\t\t\t\t\t\t\t\tcopyToClipboard(responseMessage.content);\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tif ($settings.responseAutoPlayback && !$showCallOverlay) {\n\t\t\t\t\t\t\t\t\tawait tick();\n\t\t\t\t\t\t\t\t\tdocument.getElementById(`speak-button-${responseMessage.id}`)?.click();\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} catch (error) {\n\t\t\t\t\tconsole.log(error);\n\t\t\t\t\tif ('detail' in error) {\n\t\t\t\t\t\ttoast.error(error.detail);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tif (autoScroll) {\n\t\t\t\t\tscrollToBottom();\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif ($chatId == _chatId) {\n\t\t\t\tif ($settings.saveChatHistory ?? true) {\n\t\t\t\t\tchat = await updateChatById(localStorage.token, _chatId, {\n\t\t\t\t\t\tmessages: messages,\n\t\t\t\t\t\thistory: history,\n\t\t\t\t\t\tmodels: selectedModels\n\t\t\t\t\t});\n\t\t\t\t\tawait chats.set(await getChatList(localStorage.token));\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\tif (res !== null) {\n\t\t\t\tconst error = await res.json();\n\t\t\t\tconsole.log(error);\n\t\t\t\tif ('detail' in error) {\n\t\t\t\t\ttoast.error(error.detail);\n\t\t\t\t\tresponseMessage.error = { content: error.detail };\n\t\t\t\t} else {\n\t\t\t\t\ttoast.error(error.error);\n\t\t\t\t\tresponseMessage.error = { content: error.error };\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\ttoast.error(\n\t\t\t\t\t$i18n.t(`Uh-oh! There was an issue connecting to {{provider}}.`, { provider: 'Ollama' })\n\t\t\t\t);\n\t\t\t\tresponseMessage.error = {\n\t\t\t\t\tcontent: $i18n.t(`Uh-oh! There was an issue connecting to {{provider}}.`, {\n\t\t\t\t\t\tprovider: 'Ollama'\n\t\t\t\t\t})\n\t\t\t\t};\n\t\t\t}\n\t\t\tresponseMessage.done = true;\n\t\t\tmessages = messages;\n\t\t}\n\n\t\tstopResponseFlag = false;\n\t\tawait tick();\n\n\t\tlet lastSentence = extractSentencesForAudio(responseMessage.content)?.at(-1) ?? '';\n\t\tif (lastSentence) {\n\t\t\teventTarget.dispatchEvent(\n\t\t\t\tnew CustomEvent('chat', {\n\t\t\t\t\tdetail: { id: responseMessageId, content: lastSentence }\n\t\t\t\t})\n\t\t\t);\n\t\t}\n\t\teventTarget.dispatchEvent(\n\t\t\tnew CustomEvent('chat:finish', {\n\t\t\t\tdetail: {\n\t\t\t\t\tid: responseMessageId,\n\t\t\t\t\tcontent: responseMessage.content\n\t\t\t\t}\n\t\t\t})\n\t\t);\n\n\t\tif (autoScroll) {\n\t\t\tscrollToBottom();\n\t\t}\n\n\t\tif (messages.length == 2 && messages.at(1).content !== '') {\n\t\t\twindow.history.replaceState(history.state, '', `/c/${_chatId}`);\n\t\t\tconst _title = await generateChatTitle(userPrompt);\n\t\t\tawait setChatTitle(_chatId, _title);\n\t\t}\n\n\t\treturn _response;\n\t};\n\n\tconst sendPromptOpenAI = async (model, userPrompt, responseMessageId, _chatId) => {\n\t\tlet _response = null;\n\t\tconst responseMessage = history.messages[responseMessageId];\n\n\t\tlet docs = [];\n\n\t\tif (model?.info?.meta?.knowledge ?? false) {\n\t\t\tdocs = model.info.meta.knowledge;\n\t\t}\n\n\t\tdocs = [\n\t\t\t...docs,\n\t\t\t...messages\n\t\t\t\t.filter((message) => message?.files ?? null)\n\t\t\t\t.map((message) =>\n\t\t\t\t\tmessage.files.filter((item) =>\n\t\t\t\t\t\t['doc', 'collection', 'web_search_results'].includes(item.type)\n\t\t\t\t\t)\n\t\t\t\t)\n\t\t\t\t.flat(1)\n\t\t].filter(\n\t\t\t(item, index, array) =>\n\t\t\t\tarray.findIndex((i) => JSON.stringify(i) === JSON.stringify(item)) === index\n\t\t);\n\n\t\tscrollToBottom();\n\n\t\teventTarget.dispatchEvent(\n\t\t\tnew CustomEvent('chat:start', {\n\t\t\t\tdetail: {\n\t\t\t\t\tid: responseMessageId\n\t\t\t\t}\n\t\t\t})\n\t\t);\n\t\tawait tick();\n\n\t\ttry {\n\t\t\tconst [res, controller] = await generateOpenAIChatCompletion(\n\t\t\t\tlocalStorage.token,\n\t\t\t\t{\n\t\t\t\t\tmodel: model.id,\n\t\t\t\t\tstream: true,\n\t\t\t\t\tstream_options:\n\t\t\t\t\t\tmodel.info?.meta?.capabilities?.usage ?? false\n\t\t\t\t\t\t\t? {\n\t\t\t\t\t\t\t\t\tinclude_usage: true\n\t\t\t\t\t\t\t  }\n\t\t\t\t\t\t\t: undefined,\n\t\t\t\t\tmessages: [\n\t\t\t\t\t\t$settings.system || (responseMessage?.userContext ?? null)\n\t\t\t\t\t\t\t? {\n\t\t\t\t\t\t\t\t\trole: 'system',\n\t\t\t\t\t\t\t\t\tcontent: `${promptTemplate(\n\t\t\t\t\t\t\t\t\t\t$settings?.system ?? '',\n\t\t\t\t\t\t\t\t\t\t$user.name,\n\t\t\t\t\t\t\t\t\t\t$settings?.userLocation\n\t\t\t\t\t\t\t\t\t\t\t? await getAndUpdateUserLocation(localStorage.token)\n\t\t\t\t\t\t\t\t\t\t\t: undefined\n\t\t\t\t\t\t\t\t\t)}${\n\t\t\t\t\t\t\t\t\t\tresponseMessage?.userContext ?? null\n\t\t\t\t\t\t\t\t\t\t\t? `\\n\\nUser Context:\\n${(responseMessage?.userContext ?? []).join('\\n')}`\n\t\t\t\t\t\t\t\t\t\t\t: ''\n\t\t\t\t\t\t\t\t\t}`\n\t\t\t\t\t\t\t  }\n\t\t\t\t\t\t\t: undefined,\n\t\t\t\t\t\t...messages\n\t\t\t\t\t]\n\t\t\t\t\t\t.filter((message) => message?.content?.trim())\n\t\t\t\t\t\t.map((message, idx, arr) => ({\n\t\t\t\t\t\t\trole: message.role,\n\t\t\t\t\t\t\t...((message.files?.filter((file) => file.type === 'image').length > 0 ?? false) &&\n\t\t\t\t\t\t\tmessage.role === 'user'\n\t\t\t\t\t\t\t\t? {\n\t\t\t\t\t\t\t\t\t\tcontent: [\n\t\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\t\ttype: 'text',\n\t\t\t\t\t\t\t\t\t\t\t\ttext:\n\t\t\t\t\t\t\t\t\t\t\t\t\tarr.length - 1 !== idx\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t? message.content\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t: message?.raContent ?? message.content\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t...message.files\n\t\t\t\t\t\t\t\t\t\t\t\t.filter((file) => file.type === 'image')\n\t\t\t\t\t\t\t\t\t\t\t\t.map((file) => ({\n\t\t\t\t\t\t\t\t\t\t\t\t\ttype: 'image_url',\n\t\t\t\t\t\t\t\t\t\t\t\t\timage_url: {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\turl: file.url\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t}))\n\t\t\t\t\t\t\t\t\t\t]\n\t\t\t\t\t\t\t\t  }\n\t\t\t\t\t\t\t\t: {\n\t\t\t\t\t\t\t\t\t\tcontent:\n\t\t\t\t\t\t\t\t\t\t\tarr.length - 1 !== idx\n\t\t\t\t\t\t\t\t\t\t\t\t? message.content\n\t\t\t\t\t\t\t\t\t\t\t\t: message?.raContent ?? message.content\n\t\t\t\t\t\t\t\t  })\n\t\t\t\t\t\t})),\n\t\t\t\t\tseed: $settings?.params?.seed ?? undefined,\n\t\t\t\t\tstop:\n\t\t\t\t\t\t$settings?.params?.stop ?? undefined\n\t\t\t\t\t\t\t? $settings.params.stop.map((str) =>\n\t\t\t\t\t\t\t\t\tdecodeURIComponent(JSON.parse('\"' + str.replace(/\\\"/g, '\\\\\"') + '\"'))\n\t\t\t\t\t\t\t  )\n\t\t\t\t\t\t\t: undefined,\n\t\t\t\t\ttemperature: $settings?.params?.temperature ?? undefined,\n\t\t\t\t\ttop_p: $settings?.params?.top_p ?? undefined,\n\t\t\t\t\tfrequency_penalty: $settings?.params?.frequency_penalty ?? undefined,\n\t\t\t\t\tmax_tokens: $settings?.params?.max_tokens ?? undefined,\n\t\t\t\t\ttool_ids: selectedToolIds.length > 0 ? selectedToolIds : undefined,\n\t\t\t\t\tdocs: docs.length > 0 ? docs : undefined,\n\t\t\t\t\tcitations: docs.length > 0,\n\t\t\t\t\tchat_id: $chatId\n\t\t\t\t},\n\t\t\t\t`${OPENAI_API_BASE_URL}`\n\t\t\t);\n\n\t\t\t// Wait until history/message have been updated\n\t\t\tawait tick();\n\n\t\t\tscrollToBottom();\n\n\t\t\tif (res && res.ok && res.body) {\n\t\t\t\tconst textStream = await createOpenAITextStream(res.body, $settings.splitLargeChunks);\n\t\t\t\tlet lastUsage = null;\n\n\t\t\t\tfor await (const update of textStream) {\n\t\t\t\t\tconst { value, done, citations, error, usage } = update;\n\t\t\t\t\tif (error) {\n\t\t\t\t\t\tawait handleOpenAIError(error, null, model, responseMessage);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\tif (done || stopResponseFlag || _chatId !== $chatId) {\n\t\t\t\t\t\tresponseMessage.done = true;\n\t\t\t\t\t\tmessages = messages;\n\n\t\t\t\t\t\tif (stopResponseFlag) {\n\t\t\t\t\t\t\tcontroller.abort('User: Stop Response');\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tconst messages = createMessagesList(responseMessageId);\n\n\t\t\t\t\t\t\tawait chatCompletedHandler(model.id, messages);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t_response = responseMessage.content;\n\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (usage) {\n\t\t\t\t\t\tlastUsage = usage;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (citations) {\n\t\t\t\t\t\tresponseMessage.citations = citations;\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (responseMessage.content == '' && value == '\\n') {\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tresponseMessage.content += value;\n\n\t\t\t\t\t\tconst sentences = extractSentencesForAudio(responseMessage.content);\n\t\t\t\t\t\tsentences.pop();\n\n\t\t\t\t\t\t// dispatch only last sentence and make sure it hasn't been dispatched before\n\t\t\t\t\t\tif (\n\t\t\t\t\t\t\tsentences.length > 0 &&\n\t\t\t\t\t\t\tsentences[sentences.length - 1] !== responseMessage.lastSentence\n\t\t\t\t\t\t) {\n\t\t\t\t\t\t\tresponseMessage.lastSentence = sentences[sentences.length - 1];\n\t\t\t\t\t\t\teventTarget.dispatchEvent(\n\t\t\t\t\t\t\t\tnew CustomEvent('chat', {\n\t\t\t\t\t\t\t\t\tdetail: { id: responseMessageId, content: sentences[sentences.length - 1] }\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tmessages = messages;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (autoScroll) {\n\t\t\t\t\t\tscrollToBottom();\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif ($settings.notificationEnabled && !document.hasFocus()) {\n\t\t\t\t\tconst notification = new Notification(`${model.id}`, {\n\t\t\t\t\t\tbody: responseMessage.content,\n\t\t\t\t\t\ticon: `${WEBUI_BASE_URL}/static/favicon.png`\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tif ($settings.responseAutoCopy) {\n\t\t\t\t\tcopyToClipboard(responseMessage.content);\n\t\t\t\t}\n\n\t\t\t\tif ($settings.responseAutoPlayback && !$showCallOverlay) {\n\t\t\t\t\tawait tick();\n\n\t\t\t\t\tdocument.getElementById(`speak-button-${responseMessage.id}`)?.click();\n\t\t\t\t}\n\n\t\t\t\tif (lastUsage) {\n\t\t\t\t\tresponseMessage.info = { ...lastUsage, openai: true };\n\t\t\t\t}\n\n\t\t\t\tif ($chatId == _chatId) {\n\t\t\t\t\tif ($settings.saveChatHistory ?? true) {\n\t\t\t\t\t\tchat = await updateChatById(localStorage.token, _chatId, {\n\t\t\t\t\t\t\tmodels: selectedModels,\n\t\t\t\t\t\t\tmessages: messages,\n\t\t\t\t\t\t\thistory: history\n\t\t\t\t\t\t});\n\t\t\t\t\t\tawait chats.set(await getChatList(localStorage.token));\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tawait handleOpenAIError(null, res, model, responseMessage);\n\t\t\t}\n\t\t} catch (error) {\n\t\t\tawait handleOpenAIError(error, null, model, responseMessage);\n\t\t}\n\t\tmessages = messages;\n\n\t\tstopResponseFlag = false;\n\t\tawait tick();\n\n\t\tlet lastSentence = extractSentencesForAudio(responseMessage.content)?.at(-1) ?? '';\n\t\tif (lastSentence) {\n\t\t\teventTarget.dispatchEvent(\n\t\t\t\tnew CustomEvent('chat', {\n\t\t\t\t\tdetail: { id: responseMessageId, content: lastSentence }\n\t\t\t\t})\n\t\t\t);\n\t\t}\n\n\t\teventTarget.dispatchEvent(\n\t\t\tnew CustomEvent('chat:finish', {\n\t\t\t\tdetail: {\n\t\t\t\t\tid: responseMessageId,\n\t\t\t\t\tcontent: responseMessage.content\n\t\t\t\t}\n\t\t\t})\n\t\t);\n\n\t\tif (autoScroll) {\n\t\t\tscrollToBottom();\n\t\t}\n\n\t\tif (messages.length == 2) {\n\t\t\twindow.history.replaceState(history.state, '', `/c/${_chatId}`);\n\n\t\t\tconst _title = await generateChatTitle(userPrompt);\n\t\t\tawait setChatTitle(_chatId, _title);\n\t\t}\n\n\t\treturn _response;\n\t};\n\n\tconst handleOpenAIError = async (error, res: Response | null, model, responseMessage) => {\n\t\tlet errorMessage = '';\n\t\tlet innerError;\n\n\t\tif (error) {\n\t\t\tinnerError = error;\n\t\t} else if (res !== null) {\n\t\t\tinnerError = await res.json();\n\t\t}\n\t\tconsole.error(innerError);\n\t\tif ('detail' in innerError) {\n\t\t\ttoast.error(innerError.detail);\n\t\t\terrorMessage = innerError.detail;\n\t\t} else if ('error' in innerError) {\n\t\t\tif ('message' in innerError.error) {\n\t\t\t\ttoast.error(innerError.error.message);\n\t\t\t\terrorMessage = innerError.error.message;\n\t\t\t} else {\n\t\t\t\ttoast.error(innerError.error);\n\t\t\t\terrorMessage = innerError.error;\n\t\t\t}\n\t\t} else if ('message' in innerError) {\n\t\t\ttoast.error(innerError.message);\n\t\t\terrorMessage = innerError.message;\n\t\t}\n\n\t\tresponseMessage.error = {\n\t\t\tcontent:\n\t\t\t\t$i18n.t(`Uh-oh! There was an issue connecting to {{provider}}.`, {\n\t\t\t\t\tprovider: model.name ?? model.id\n\t\t\t\t}) +\n\t\t\t\t'\\n' +\n\t\t\t\terrorMessage\n\t\t};\n\t\tresponseMessage.done = true;\n\n\t\tmessages = messages;\n\t};\n\n\tconst stopResponse = () => {\n\t\tstopResponseFlag = true;\n\t\tconsole.log('stopResponse');\n\t};\n\n\tconst regenerateResponse = async (message) => {\n\t\tconsole.log('regenerateResponse');\n\n\t\tif (messages.length != 0) {\n\t\t\tlet userMessage = history.messages[message.parentId];\n\t\t\tlet userPrompt = userMessage.content;\n\n\t\t\tif ((userMessage?.models ?? [...selectedModels]).length == 1) {\n\t\t\t\t// If user message has only one model selected, sendPrompt automatically selects it for regeneration\n\t\t\t\tawait sendPrompt(userPrompt, userMessage.id);\n\t\t\t} else {\n\t\t\t\t// If there are multiple models selected, use the model of the response message for regeneration\n\t\t\t\t// e.g. many model chat\n\t\t\t\tawait sendPrompt(userPrompt, userMessage.id, { modelId: message.model });\n\t\t\t}\n\t\t}\n\t};\n\n\tconst continueGeneration = async () => {\n\t\tconsole.log('continueGeneration');\n\t\tconst _chatId = JSON.parse(JSON.stringify($chatId));\n\n\t\tif (messages.length != 0 && messages.at(-1).done == true) {\n\t\t\tconst responseMessage = history.messages[history.currentId];\n\t\t\tresponseMessage.done = false;\n\t\t\tawait tick();\n\n\t\t\tconst model = $models.filter((m) => m.id === responseMessage.model).at(0);\n\n\t\t\tif (model) {\n\t\t\t\tif (model?.owned_by === 'openai') {\n\t\t\t\t\tawait sendPromptOpenAI(\n\t\t\t\t\t\tmodel,\n\t\t\t\t\t\thistory.messages[responseMessage.parentId].content,\n\t\t\t\t\t\tresponseMessage.id,\n\t\t\t\t\t\t_chatId\n\t\t\t\t\t);\n\t\t\t\t} else\n\t\t\t\t\tawait sendPromptOllama(\n\t\t\t\t\t\tmodel,\n\t\t\t\t\t\thistory.messages[responseMessage.parentId].content,\n\t\t\t\t\t\tresponseMessage.id,\n\t\t\t\t\t\t_chatId\n\t\t\t\t\t);\n\t\t\t}\n\t\t} else {\n\t\t\ttoast.error($i18n.t(`Model {{modelId}} not found`, { modelId }));\n\t\t}\n\t};\n\n\tconst generateChatTitle = async (userPrompt) => {\n\t\tif ($settings?.title?.auto ?? true) {\n\t\t\tconst title = await generateTitle(\n\t\t\t\tlocalStorage.token,\n\t\t\t\tselectedModels[0],\n\t\t\t\tuserPrompt,\n\t\t\t\t$chatId\n\t\t\t).catch((error) => {\n\t\t\t\tconsole.error(error);\n\t\t\t\treturn 'New Chat';\n\t\t\t});\n\n\t\t\treturn title;\n\t\t} else {\n\t\t\treturn `${userPrompt}`;\n\t\t}\n\t};\n\n\tconst setChatTitle = async (_chatId, _title) => {\n\t\tif (_chatId === $chatId) {\n\t\t\ttitle = _title;\n\t\t}\n\n\t\tif ($settings.saveChatHistory ?? true) {\n\t\t\tchat = await updateChatById(localStorage.token, _chatId, { title: _title });\n\t\t\tawait chats.set(await getChatList(localStorage.token));\n\t\t}\n\t};\n\n\tconst getWebSearchResults = async (model: string, parentId: string, responseId: string) => {\n\t\tconst responseMessage = history.messages[responseId];\n\n\t\tresponseMessage.statusHistory = [\n\t\t\t{\n\t\t\t\tdone: false,\n\t\t\t\taction: 'web_search',\n\t\t\t\tdescription: $i18n.t('Generating search query')\n\t\t\t}\n\t\t];\n\t\tmessages = messages;\n\n\t\tconst prompt = history.messages[parentId].content;\n\t\tlet searchQuery = await generateSearchQuery(localStorage.token, model, messages, prompt).catch(\n\t\t\t(error) => {\n\t\t\t\tconsole.log(error);\n\t\t\t\treturn prompt;\n\t\t\t}\n\t\t);\n\n\t\tif (!searchQuery) {\n\t\t\ttoast.warning($i18n.t('No search query generated'));\n\t\t\tresponseMessage.statusHistory.push({\n\t\t\t\tdone: true,\n\t\t\t\terror: true,\n\t\t\t\taction: 'web_search',\n\t\t\t\tdescription: 'No search query generated'\n\t\t\t});\n\n\t\t\tmessages = messages;\n\t\t}\n\n\t\tresponseMessage.statusHistory.push({\n\t\t\tdone: false,\n\t\t\taction: 'web_search',\n\t\t\tdescription: $i18n.t(`Searching \"{{searchQuery}}\"`, { searchQuery })\n\t\t});\n\t\tmessages = messages;\n\n\t\tconst results = await runWebSearch(localStorage.token, searchQuery).catch((error) => {\n\t\t\tconsole.log(error);\n\t\t\ttoast.error(error);\n\n\t\t\treturn null;\n\t\t});\n\n\t\tif (results) {\n\t\t\tresponseMessage.statusHistory.push({\n\t\t\t\tdone: true,\n\t\t\t\taction: 'web_search',\n\t\t\t\tdescription: $i18n.t('Searched {{count}} sites', { count: results.filenames.length }),\n\t\t\t\tquery: searchQuery,\n\t\t\t\turls: results.filenames\n\t\t\t});\n\n\t\t\tif (responseMessage?.files ?? undefined === undefined) {\n\t\t\t\tresponseMessage.files = [];\n\t\t\t}\n\n\t\t\tresponseMessage.files.push({\n\t\t\t\tcollection_name: results.collection_name,\n\t\t\t\tname: searchQuery,\n\t\t\t\ttype: 'web_search_results',\n\t\t\t\turls: results.filenames\n\t\t\t});\n\n\t\t\tmessages = messages;\n\t\t} else {\n\t\t\tresponseMessage.statusHistory.push({\n\t\t\t\tdone: true,\n\t\t\t\terror: true,\n\t\t\t\taction: 'web_search',\n\t\t\t\tdescription: 'No search results found'\n\t\t\t});\n\t\t\tmessages = messages;\n\t\t}\n\t};\n\n\tconst getTags = async () => {\n\t\treturn await getTagsById(localStorage.token, $chatId).catch(async (error) => {\n\t\t\treturn [];\n\t\t});\n\t};\n</script>\n\n<svelte:head>\n\t<title>\n\t\t{title\n\t\t\t? `${title.length > 30 ? `${title.slice(0, 30)}...` : title} | ${$WEBUI_NAME}`\n\t\t\t: `${$WEBUI_NAME}`}\n\t</title>\n</svelte:head>\n\n<audio id=\"audioElement\" src=\"\" style=\"display: none;\" />\n\n{#if $showCallOverlay}\n\t<CallOverlay\n\t\t{submitPrompt}\n\t\t{stopResponse}\n\t\tbind:files\n\t\tmodelId={selectedModelIds?.at(0) ?? null}\n\t\tchatId={$chatId}\n\t\t{eventTarget}\n\t/>\n{/if}\n\n{#if !chatIdProp || (loaded && chatIdProp)}\n\t<div\n\t\tclass=\"h-screen max-h-[100dvh] {$showSidebar\n\t\t\t? 'md:max-w-[calc(100%-260px)]'\n\t\t\t: ''} w-full max-w-full flex flex-col\"\n\t>\n\t\t<Navbar\n\t\t\t{title}\n\t\t\tbind:selectedModels\n\t\t\tbind:showModelSelector\n\t\t\tshareEnabled={messages.length > 0}\n\t\t\t{chat}\n\t\t\t{initNewChat}\n\t\t/>\n\n\t\t{#if $banners.length > 0 && messages.length === 0 && !$chatId && selectedModels.length <= 1}\n\t\t\t<div\n\t\t\t\tclass=\"absolute top-[4.25rem] w-full {$showSidebar ? 'md:max-w-[calc(100%-260px)]' : ''}\"\n\t\t\t>\n\t\t\t\t<div class=\" flex flex-col gap-1 w-full\">\n\t\t\t\t\t{#each $banners.filter( (b) => (b.dismissible ? !JSON.parse(localStorage.getItem('dismissedBannerIds') ?? '[]').includes(b.id) : true) ) as banner}\n\t\t\t\t\t\t<Banner\n\t\t\t\t\t\t\t{banner}\n\t\t\t\t\t\t\ton:dismiss={(e) => {\n\t\t\t\t\t\t\t\tconst bannerId = e.detail;\n\n\t\t\t\t\t\t\t\tlocalStorage.setItem(\n\t\t\t\t\t\t\t\t\t'dismissedBannerIds',\n\t\t\t\t\t\t\t\t\tJSON.stringify(\n\t\t\t\t\t\t\t\t\t\t[\n\t\t\t\t\t\t\t\t\t\t\tbannerId,\n\t\t\t\t\t\t\t\t\t\t\t...JSON.parse(localStorage.getItem('dismissedBannerIds') ?? '[]')\n\t\t\t\t\t\t\t\t\t\t].filter((id) => $banners.find((b) => b.id === id))\n\t\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t/>\n\t\t\t\t\t{/each}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t{/if}\n\n\t\t<div class=\"flex flex-col flex-auto\">\n\t\t\t<div\n\t\t\t\tclass=\" pb-2.5 flex flex-col justify-between w-full flex-auto overflow-auto h-0 max-w-full\"\n\t\t\t\tid=\"messages-container\"\n\t\t\t\tbind:this={messagesContainerElement}\n\t\t\t\ton:scroll={(e) => {\n\t\t\t\t\tautoScroll =\n\t\t\t\t\t\tmessagesContainerElement.scrollHeight - messagesContainerElement.scrollTop <=\n\t\t\t\t\t\tmessagesContainerElement.clientHeight + 5;\n\t\t\t\t}}\n\t\t\t>\n\t\t\t\t<div class=\" h-full w-full flex flex-col {chatIdProp ? 'py-4' : 'pt-2 pb-4'}\">\n\t\t\t\t\t<Messages\n\t\t\t\t\t\tchatId={$chatId}\n\t\t\t\t\t\t{selectedModels}\n\t\t\t\t\t\t{processing}\n\t\t\t\t\t\tbind:history\n\t\t\t\t\t\tbind:messages\n\t\t\t\t\t\tbind:autoScroll\n\t\t\t\t\t\tbind:prompt\n\t\t\t\t\t\tbottomPadding={files.length > 0}\n\t\t\t\t\t\t{sendPrompt}\n\t\t\t\t\t\t{continueGeneration}\n\t\t\t\t\t\t{regenerateResponse}\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<MessageInput\n\t\t\t\tbind:files\n\t\t\t\tbind:prompt\n\t\t\t\tbind:autoScroll\n\t\t\t\tbind:selectedToolIds\n\t\t\t\tbind:webSearchEnabled\n\t\t\t\tbind:atSelectedModel\n\t\t\t\tavailableToolIds={selectedModelIds.reduce((a, e, i, arr) => {\n\t\t\t\t\tconst model = $models.find((m) => m.id === e);\n\t\t\t\t\tif (model?.info?.meta?.toolIds ?? false) {\n\t\t\t\t\t\treturn [...new Set([...a, ...model.info.meta.toolIds])];\n\t\t\t\t\t}\n\t\t\t\t\treturn a;\n\t\t\t\t}, [])}\n\t\t\t\t{selectedModels}\n\t\t\t\t{messages}\n\t\t\t\t{submitPrompt}\n\t\t\t\t{stopResponse}\n\t\t\t/>\n\t\t</div>\n\t</div>\n{/if}\n"],"names":["createOpenAITextStream","responseBody","splitLargeDeltas","eventStream","EventSourceParserStream","iterator","openAIStreamToIterator","streamLargeDeltasAsRandomChunks","reader","value","done","data","parsedData","_c","_b","_a","e","textStreamUpdate","content","chunkSize","sleep","ms","resolve","ctx","create_if_block_1","t0_value","t3_value","if_block0","create_if_block_4","if_block1","create_if_block_3","if_block2","create_if_block_2","attr","div0","div0_class_value","insert_hydration","target","div5","anchor","append_hydration","div3","div1","div2","div4","current","dirty","set_data","t0","t3","div5_transition","create_bidirectional_transition","fade","button","create_if_block","dispatch","createEventDispatcher","banner","dismissed","$$props","mounted","classNames","dismiss","id","onMount","i","div8","div7","div6","t4","t4_value","t2_value","button_class_value","t2","i18n","getContext","files","prompt","selectedCommandIdx","filteredPromptCommands","selectUp","$$invalidate","selectDown","confirmCommand","command","text","clipboardText","err","toast","$i18n","clipboardItems","imageUrl","item","type","blob","chatInputElement","tick","words","findWordIndices","word","commandIdx","$prompts","p","a","b","show_if","func","show_if_1","t1_value","t6_value","t1","t6","s","selectedIdx","filteredItems","filteredDocs","collections","confirmSelect","doc","removeFirstHashWord","confirmSelectWeb","url","confirmSelectYoutube","docIdx","isValidHttpUrl","$documents","arr","tag","filteredCollections","collection","div","user","chatInputPlaceholder","messages","filteredModels","model","modelIdx","$models","svg","path","className","strokeWidth","path0","path1","hr","each_blocks","t","t_value","tooltip_changes","flyAndScale","uploadFilesHandler","selectedToolIds","webSearchEnabled","tools","onClose","show","toolId","div_class_value","set_style","div6_class_value","VISUALIZER_BUFFER_LENGTH","recording","loading","confirmed","durationSeconds","durationCounter","transcription","startDurationCounter","stopDurationCounter","formatSeconds","seconds","minutes","remainingSeconds","formattedSeconds","speechRecognition","mediaRecorder","audioChunks","MIN_DECIBELS","visualizerData","calculateRMS","sumSquares","normalizedValue","normalizeRMS","rms","scaledRMS","analyseAudio","stream","audioContext","audioStreamSource","analyser","bufferLength","domainData","timeDomainData","processFrame","rmsLevel","transcribeHandler","audioBlob","file","blobToFile","res","transcribeAudio","error","startRecording","event","$settings","$config","inactivityTimeout","timeoutId","transcript","confirmRecording","stopRecording","src_url_equal","img","img_src_value","WEBUI_BASE_URL","span","textarea","textarea_placeholder_value","form","inputmenu_changes","create_if_block_8","create_if_block_6","style","circle0","circle1","circle2","button_disabled_value","create_if_block_14","create_if_block_13","if_block3","create_if_block_10","input","t7","t7_value","submitPrompt","stopResponse","autoScroll","atSelectedModel","selectedModels","chatTextAreaElement","filesInputElement","promptsElement","documentsElement","modelsElement","inputFiles","dragged","availableToolIds","visionCapableModels","scrollToBottom","element","uploadDoc","uploadDocToVectorDB","f","uploadWeb","uploadWebToVectorDB","uploadYoutubeTranscription","uploadYoutubeTranscriptionToVectorDB","dropZone","handleKeyDown","onDragOver","onDragLeave","onDrop","SUPPORTED_FILE_TYPE","SUPPORTED_FILE_EXTENSIONS","$$value","response","func_1","fileIdx","func_2","$_user","$mobile","isCtrlPressed","regenerateButton","userMessageElement","editButton","commandOptionButton","fullPrompt","clipboardData","showCallOverlay","_d","m","selector_changes","if_block","disabled","showSetDefault","saveDefaultModel","it","settings","updateUserSettings","selectedModelIdx","tags","Tags","tags_changes","saveAs","fileSaver","shareEnabled","shareHandler","downloadHandler","chat","downloadTxt","_chat","chatText","message","downloadPdf","downloadChatAsPDF","downloadJSONExport","usermenu_changes","nav","initNewChat","title","$WEBUI_NAME","showModelSelector","showShareChatModal","showDownloadChatModal","showSidebar","$showSidebar","showArchivedChats","devices","device","create_if_block_7","button0","button1","create_if_block_9","video","canvas","create_if_block_5","eventTarget","chatId","modelId","assistantSpeaking","emoji","camera","cameraStream","chatStreaming","hasStartedSpeaking","videoInputDevices","selectedVideoInputDeviceId","getVideoInputDevices","startCamera","startVideoStream","stopVideoStream","track","takeScreenshot","context","dataURL","stopCamera","_responses","stopRecordingCallback","_continue","$showCallOverlay","_audioChunks","lastSoundTime","stopAllAudio","finishedMessages","currentMessageId","currentUtterance","speakSpeechSynthesisHandler","voices","getVoicesLoop","voice","v","r","playAudio","audio","audioElement","audioAbortController","audioCache","emojiCache","fetchAudio","generateEmoji","synthesizeOpenAISpeech","blobUrl","monitorAndPlayAudio","signal","chatStartHandler","chatEventHandler","chatFinishHandler","calloverlay_changes","messageinput_changes","each_value","ensure_array_like","document_1","title_value","processing","chatIdProp","loaded","stopResponseFlag","messagesContainerElement","selectedModelIds","history","$chatId","goto","$page","userSettings","getUserSettings","chatInput","loadChat","getChatById","getTags","chatContent","convertMessagesToHistory","createMessagesList","responseMessageId","chatCompletedHandler","mermaid","chatCompleted","getChatEventEmitter","$socket","userPrompt","_raw","_files","userMessageId","uuidv4","userMessage","mIdx","sendPrompt","parentId","newChat","responseMessageIds","responseMessage","createNewChat","chats","getChatList","_chatId","userContext","queryMemory","acc","index","createdAtTimestamp","createdAtDate","chatEventEmitter","getWebSearchResults","_response","sendPromptOpenAI","sendPromptOllama","messagesBody","promptTemplate","$user","getAndUpdateUserLocation","idx","baseMessage","imageUrls","lastImageIndex","docs","array","controller","generateChatCompletion","str","_e","splitStream","lines","line","sentences","extractSentencesForAudio","notification","copyToClipboard","_f","updateChatById","lastSentence","_g","_title","generateChatTitle","setChatTitle","generateOpenAIChatCompletion","_h","_i","_j","_k","OPENAI_API_BASE_URL","textStream","lastUsage","update","citations","usage","handleOpenAIError","_l","_m","errorMessage","innerError","regenerateResponse","continueGeneration","generateTitle","responseId","searchQuery","generateSearchQuery","results","runWebSearch","getTagsById","bannerId","$banners","_messages","currentMessage"],"mappings":";;;;qYAwBsB,eAAAA,GACrBC,EACAC,EAC4C,CAC5C,MAAMC,EAAcF,EAClB,YAAY,IAAI,iBAAmB,EACnC,YAAY,IAAIG,EAAyB,EACzC,UAAU,EACR,IAAAC,EAAWC,GAAuBH,CAAW,EACjD,OAAID,IACHG,EAAWE,GAAgCF,CAAQ,GAE7CA,CACR,CAEA,eAAgBC,GACfE,EACmC,WACnC,OAAa,CACZ,KAAM,CAAE,MAAAC,EAAO,KAAAC,CAAA,EAAS,MAAMF,EAAO,KAAK,EAC1C,GAAIE,EAAM,CACT,KAAM,CAAE,KAAM,GAAM,MAAO,EAAG,EAC9B,KACD,CACA,GAAI,CAACD,EACJ,SAED,MAAME,EAAOF,EAAM,KACf,GAAAE,EAAK,WAAW,QAAQ,EAAG,CAC9B,KAAM,CAAE,KAAM,GAAM,MAAO,EAAG,EAC9B,KACD,CAEI,GAAA,CACG,MAAAC,EAAa,KAAK,MAAMD,CAAI,EAGlC,GAFA,QAAQ,IAAIC,CAAU,EAElBA,EAAW,MAAO,CACrB,KAAM,CAAE,KAAM,GAAM,MAAO,GAAI,MAAOA,EAAW,OACjD,KACD,CAEA,GAAIA,EAAW,UAAW,CACzB,KAAM,CAAE,KAAM,GAAO,MAAO,GAAI,UAAWA,EAAW,WACtD,QACD,CAEM,KAAA,CACL,KAAM,GACN,QAAOC,GAAAC,GAAAC,EAAAH,EAAW,UAAX,YAAAG,EAAqB,KAArB,YAAAD,EAAyB,QAAzB,YAAAD,EAAgC,UAAW,GAClD,MAAOD,EAAW,KAAA,QAEXI,EAAG,CACH,QAAA,MAAM,yCAA0CA,CAAC,CAC1D,CACD,CACD,CAIA,eAAgBT,GACfF,EACmC,CACnC,gBAAiBY,KAAoBZ,EAAU,CAC9C,GAAIY,EAAiB,KAAM,CACpB,MAAAA,EACN,MACD,CACA,GAAIA,EAAiB,UAAW,CACzB,MAAAA,EACN,QACD,CACA,IAAIC,EAAUD,EAAiB,MAC3B,GAAAC,EAAQ,OAAS,EAAG,CACvB,KAAM,CAAE,KAAM,GAAO,MAAOA,CAAQ,EACpC,QACD,CACA,KAAOA,GAAW,IAAI,CACrB,MAAMC,EAAY,KAAK,IAAI,KAAK,MAAM,KAAK,OAAO,EAAI,CAAC,EAAI,EAAGD,EAAQ,MAAM,EAE5E,KAAM,CAAE,KAAM,GAAO,MADPA,EAAQ,MAAM,EAAGC,CAAS,CACN,GAG9B,+BAAU,mBAAoB,UACjC,MAAMC,GAAM,CAAC,EAEJF,EAAAA,EAAQ,MAAMC,CAAS,CAClC,CACD,CACD,CAEA,MAAMC,GAASC,GAAe,IAAI,QAASC,GAAY,WAAWA,EAASD,CAAE,CAAC,yBC5ExEE,EAAO,CAAA,GAAAC,GAAAD,CAAA,yFAAPA,EAAO,CAAA,gKAWNE,EAAAF,KAAO,KAAI,aAiCZG,EAAAH,KAAO,QAAO,eA9BVI,EAAAJ,KAAO,KAAGK,GAAA,EAkCZC,EAAAN,KAAO,KAAGO,GAAA,EA0BTC,EAAAR,KAAO,aAAWS,GAAAT,CAAA,6hBAlEOU,EAAAC,EAAA,QAAAC,EAAA,uBAAAZ,KAAWA,EAAM,CAAA,EAAC,IAAI,GACjDA,KAAW,MAAM,mDAAA,6cARtBa,EAkFKC,EAAAC,EAAAC,CAAA,EA9EJC,EAyCKF,EAAAG,CAAA,EAxCJD,EAmCKC,EAAAC,CAAA,EAlCJF,EAKKE,EAAAR,CAAA,sCA+BNM,EAEKC,EAAAE,CAAA,sCA4BNH,EASKF,EAAAM,CAAA,+BAvED,CAAAC,GAAAC,EAAA,IAAArB,KAAAA,EAAAF,KAAO,KAAI,KAAAwB,GAAAC,EAAAvB,CAAA,GAHgB,CAAAoB,GAAAC,EAAA,GAAAX,KAAAA,EAAA,uBAAAZ,KAAWA,EAAM,CAAA,EAAC,IAAI,GACjDA,KAAW,MAAM,sEAKdA,KAAO,sDA8BX,CAAAsB,GAAAC,EAAA,IAAApB,KAAAA,EAAAH,KAAO,QAAO,KAAAwB,GAAAE,EAAAvB,CAAA,EAIZH,KAAO,kDA0BNA,KAAO,+FAvEM2B,IAAAA,EAAAC,GAAAb,EAAAc,GAAA,CAAA,MAAO,IAAK,SAAU,GAAG,EAAA,EAAA,+BAAzBF,IAAAA,EAAAC,GAAAb,EAAAc,GAAA,CAAA,MAAO,IAAK,SAAU,GAAG,EAAA,EAAA,q1BAYzChB,EAwBKC,EAAAK,EAAAH,CAAA,gwBAUPH,EAsBKC,EAAAK,EAAAH,CAAA,sSAIJH,EAKAC,EAAAgB,EAAAd,CAAA,uFAjFChB,EAAS,CAAA,GAAA+B,GAAA/B,CAAA,2FAATA,EAAS,CAAA,iIAjCRgC,EAAWC,KAEN,GAAA,CAAA,OAAAC,EAAA,CACV,GAAI,GACJ,KAAM,OACN,MAAO,GACP,QAAS,GACT,IAAK,GACL,YAAa,GACb,UAAW,KAAK,MAAM,KAAK,IAAA,EAAQ,GAAI,OAG7B,UAAAC,EAAY,EAAA,EAAAC,EAEnBC,EAAU,GAER,MAAAC,EAAA,CACL,KAAM,mDACN,QAAS,qDACT,QAAS,wDACT,MAAO,gDAGFC,EAAWC,GAAA,KAChBL,EAAY,EAAA,EACZH,EAAS,UAAWQ,CAAE,GAGvBC,GAAA,IAAA,KACCJ,EAAU,EAAA,iBAkFLE,EAAQL,EAAO,EAAE,msBC8BjBlC,EAAK,CAAA,EAAC,EACN,qHAAoH,EAAA,UA/C/GA,EAAsB,CAAA,CAAA,uBAA3B,OAAI0C,GAAA,wzCAVV7B,EA+DKC,EAAA6B,EAAA3B,CAAA,EA9DJC,EA6DK0B,EAAAC,CAAA,EA5DJ3B,EAEK2B,EAAAzB,CAAA,SAELF,EAuDK2B,EAAAC,CAAA,EApDJ5B,EAwBK4B,EAAAzB,CAAA,0DAELH,EAyBK4B,EAAA9B,CAAA,EAtBJE,EAeKF,EAAAG,CAAA,SAELD,EAIKF,EAAAM,CAAA,+BAjDErB,EAAsB,CAAA,CAAA,oBAA3B,OAAI0C,GAAA,EAAA,mHAAJ,mBA8CA1C,EAAK,CAAA,EAAC,EACN,qHAAoH,EAAA,KAAAwB,GAAAsB,EAAAC,CAAA,iDAhClH7C,EAAAF,MAAQ,QAAO,SAIfgD,EAAAhD,MAAQ,MAAK,qeAjBkCU,EAAAoB,EAAA,QAAAmB,EAAA,4CAAAjD,EAAe,EAAA,IAAAA,EAAA,CAAA,EAC7D,+DACA,GAAE,+BAHNa,EAoBQC,EAAAgB,EAAAd,CAAA,EAPPC,EAEKa,EAAAnB,CAAA,gBAELM,EAEKa,EAAAX,CAAA,+FALHI,EAAA,GAAArB,KAAAA,EAAAF,MAAQ,QAAO,KAAAwB,GAAAC,EAAAvB,CAAA,EAIfqB,EAAA,GAAAyB,KAAAA,EAAAhD,MAAQ,MAAK,KAAAwB,GAAA0B,EAAAF,CAAA,EAjBkCzB,EAAA,GAAA0B,KAAAA,EAAA,4CAAAjD,EAAe,EAAA,IAAAA,EAAA,CAAA,EAC7D,+DACA,uEAfLA,EAAsB,CAAA,EAAC,OAAS,GAAC+B,GAAA/B,CAAA,2FAAjCA,EAAsB,CAAA,EAAC,OAAS,wKAnF9B,MAAAmD,EAAOC,GAAW,MAAM,sBAEnB,GAAA,CAAA,MAAAC,CAAA,EAAAjB,GACA,OAAAkB,EAAS,EAAA,EAAAlB,EAChBmB,EAAqB,EACrBC,EAAA,CAAA,EAUS,MAAAC,EAAA,IAAA,CACZC,EAAA,EAAAH,EAAqB,KAAK,IAAI,EAAGA,EAAqB,CAAC,CAAA,GAG3CI,EAAA,IAAA,CACZD,EAAA,EAAAH,EAAqB,KAAK,IAAIA,EAAqB,EAAGC,EAAuB,OAAS,CAAC,CAAA,GAGlFI,EAAwB,MAAAC,GAAA,CACzB,IAAAC,EAAOD,EAAQ,WAEfA,EAAQ,QAAQ,SAAS,eAAe,EAAA,OACrCE,EAAsB,MAAA,UAAU,UAAU,SAAA,EAAW,MAAOC,IACjEC,GAAM,MAAMC,EAAM,EAAE,mCAAmC,CAAA,EAChD,kBAGR,QAAQ,IAAIH,CAAa,EAEnB,MAAAI,EAAA,MAAuB,UAAU,UAAU,KAAA,MAE7CC,EAAW,eACJC,KAAQF,EAEP,UAAAG,KAAQD,EAAK,MACnB,GAAAC,EAAK,WAAW,QAAQ,EAAA,OACrBC,EAAa,MAAAF,EAAK,QAAQC,CAAI,EACpCF,EAAW,IAAI,gBAAgBG,CAAI,EACnC,QAAQ,IAAA,cAAkBD,CAAI,MAAMF,CAAQ,EAAA,EAK3CA,OACHf,EACI,CAAA,GAAAA,EAAA,CAEF,KAAM,QACN,IAAKe,CAAA,CAAA,CAAA,EAKRN,EAAOD,EAAQ,QAAQ,WAAW,gBAAiBE,CAAa,MAGjET,EAASQ,CAAA,QAEHU,EAAmB,SAAS,eAAe,eAAe,EAE1D,MAAAC,GAAA,EAEND,EAAiB,MAAM,OAAS,GAChCA,EAAiB,MAAM,OAAS,KAAK,IAAIA,EAAiB,aAAc,GAAG,EAAI,KAE/EA,GAAA,MAAAA,EAAkB,QAEZ,MAAAC,GAAA,EAEA,MAAAC,EAAQC,GAAgBrB,CAAM,EAEhC,GAAAoB,EAAM,OAAS,EAAA,OACZE,EAAOF,EAAM,GAAG,CAAC,EACvBF,EAAiB,kBAAkBI,GAAA,YAAAA,EAAM,WAAYA,EAAK,SAAW,CAAC,UAuBjEhB,EAAeC,CAAO,SAGtBH,EAAA,EAAAH,EAAqBsB,CAAU,kHAjGtCnB,EAAA,EAAGF,EAAyBsB,EAC1B,OAAQC,GAAMA,EAAE,QAAQ,SAASzB,CAAM,CACvC,EAAA,KAAA,CAAM0B,EAAGC,IAAMD,EAAE,MAAM,cAAcC,EAAE,KAAK,CAAA,CAAA,iBAEvC3B,OACNC,EAAqB,CAAA,mXC+FXvD,EAAa,CAAA,CAAA,uBAAlB,OAAI0C,GAAA,4EAoCDwC,GAAA,OAAAA,EAAA,CAAA,CAAAlF,EAAA,CAAA,EACH,MAAM,GAAG,EACT,KAAImF,EAAA,kBAyBIC,GAAA,OAAAA,EAAA,CAAA,GAAA7F,GAAAC,EAAAQ,EAAO,CAAA,EAAA,MAAM,GAAG,IAAhB,YAAAR,EAAmB,GAAG,KAAtB,MAAAD,EAA0B,UAAU,GAAG,WAAW,y8BAzEhEsB,EAoGKC,EAAAC,EAAAC,CAAA,EAnGJC,EAkGKF,EAAAM,CAAA,EAjGJJ,EAEKI,EAAAF,CAAA,SAELF,EA4FKI,EAAAH,CAAA,EAzFJD,EAwFKC,EAAAE,CAAA,+FAvFGpB,EAAa,CAAA,CAAA,oBAAlB,OAAI0C,GAAA,EAAA,gHAAJ,uIA0BI2C,EAAArF,MAAI,KAAI,OAAIG,EAAAH,MAAI,SAAQ,WAIzBsF,EAAAtF,MAAI,MAAK,gCALyD,GAClE,eAAU,IAAE,eAAc,GAC5B,oFAFoE,GAClE,mBAAU,IAAE,mBAAc,GAC5B,iPAFAa,EAEKC,EAAAH,EAAAK,CAAA,8CAELH,EAEKC,EAAAK,EAAAH,CAAA,iBALFO,EAAA,GAAA8D,KAAAA,EAAArF,MAAI,KAAI,KAAAwB,GAAA+D,EAAAF,CAAA,EAAI9D,EAAA,GAAApB,KAAAA,EAAAH,MAAI,SAAQ,KAAAwB,GAAAE,EAAAvB,CAAA,EAIzBoB,EAAA,GAAA+D,KAAAA,EAAAtF,MAAI,MAAK,KAAAwB,GAAAgE,EAAAF,CAAA,yDAZTpF,KAAAV,EAAAQ,EAAK,EAAA,IAAL,YAAAR,EAAK,QAAa,IAAAQ,MAAI,IAAI,IAAA,WAI1BA,EAAK,CAAA,EAAC,EAAE,YAAY,EAAA,uWALtBa,EAEKC,EAAAH,EAAAK,CAAA,kBAELH,EAEKC,EAAAK,EAAAH,CAAA,uBALHO,EAAA,GAAArB,KAAAA,KAAAV,EAAAQ,EAAK,EAAA,IAAL,YAAAR,EAAK,QAAa,IAAAQ,MAAI,IAAI,IAAA,KAAAwB,GAAAC,EAAAvB,CAAA,cAI1BF,EAAK,CAAA,EAAC,EAAE,YAAY,EAAA,KAAAwB,GAAA0B,EAAAF,CAAA,gFANlBhD,EAAG,EAAA,EAAC,OAAS,aAAYO,wNAdmBG,EAAAoB,EAAA,QAAAmB,EAAA,4CAAAjD,EAAW,EAAA,IAAAA,EAAA,CAAA,EACzD,iFACA,GAAE,+BAHNa,EAgCQC,EAAAgB,EAAAd,CAAA,6JA/B0CO,EAAA,GAAA0B,KAAAA,EAAA,4CAAAjD,EAAW,EAAA,IAAAA,EAAA,CAAA,EACzD,iFACA,yFA6EDT,GAAAC,EAAAQ,EAAM,CAAA,EAAC,MAAM,GAAG,IAAhB,YAAAR,EAAmB,GAAG,KAAtB,YAAAD,EAA0B,UAAU,IAAC,WAGWS,EAAK,CAAA,EAAC,EAAE,KAAK,EAAA,qgBApBhEa,EAqBQC,EAAAgB,EAAAd,CAAA,EALPC,EAEKa,EAAAnB,CAAA,gBAELM,EAAsEa,EAAAX,CAAA,uEAHpE5B,GAAAC,EAAAQ,EAAM,CAAA,EAAC,MAAM,GAAG,IAAhB,YAAAR,EAAmB,GAAG,KAAtB,YAAAD,EAA0B,UAAU,IAAC,KAAAiC,GAAAC,EAAAvB,CAAA,cAGWF,EAAK,CAAA,EAAC,EAAE,KAAK,EAAA,KAAAwB,GAAA0B,EAAAF,CAAA,8DA1B7DzD,GAAAC,EAAAQ,EAAM,CAAA,EAAC,MAAM,GAAG,IAAhB,YAAAR,EAAmB,GAAG,KAAtB,YAAAD,EAA0B,UAAU,IAAC,WAGWS,EAAK,CAAA,EAAC,EAAE,SAAS,EAAA,qgBApBpEa,EAqBQC,EAAAgB,EAAAd,CAAA,EALPC,EAEKa,EAAAnB,CAAA,gBAELM,EAA0Ea,EAAAX,CAAA,uEAHxE5B,GAAAC,EAAAQ,EAAM,CAAA,EAAC,MAAM,GAAG,IAAhB,YAAAR,EAAmB,GAAG,KAAtB,YAAAD,EAA0B,UAAU,IAAC,KAAAiC,GAAAC,EAAAvB,CAAA,cAGWF,EAAK,CAAA,EAAC,EAAE,SAAS,EAAA,KAAAwB,GAAA0B,EAAAF,CAAA,wDAxErEhD,EAAa,CAAA,EAAC,OAAS,KAAKT,GAAAC,EAAAQ,EAAM,CAAA,EAAC,MAAM,GAAG,IAAhB,YAAAR,EAAmB,GAAG,KAAtB,YAAAD,EAA0B,UAAU,GAAG,WAAW,+HAA9ES,EAAa,CAAA,EAAC,OAAS,KAAKT,GAAAC,EAAAQ,EAAM,CAAA,EAAC,MAAM,GAAG,IAAhB,YAAAR,EAAmB,GAAG,KAAtB,YAAAD,EAA0B,UAAU,GAAG,WAAW,kHAiDtE,MAAA4F,GAAAM,GAAMA,EAAE,UAAU,CAAC,EAAE,WAAW,yBAAyB,GAAKA,EACjE,UAAU,CAAC,EACX,WAAW,kBAAkB,+DAjJhC,MAAAtC,EAAOC,GAAW,MAAM,0BAEnB,OAAAE,EAAS,EAAA,EAAAlB,QAEdJ,EAAWC,SACbyD,EAAc,EAEdC,EAAA,CAAA,EACAC,EAAA,CAAA,EAEAC,EAAA,CAAA,EA0CS,MAAApC,EAAA,IAAA,CACZC,EAAA,EAAAgC,EAAc,KAAK,IAAI,EAAGA,EAAc,CAAC,CAAA,GAG7B/B,EAAA,IAAA,CACZD,EAAA,EAAAgC,EAAc,KAAK,IAAIA,EAAc,EAAGC,EAAc,OAAS,CAAC,CAAA,GAG3DG,EAAuB,MAAAC,GAAA,CAC5B/D,EAAS,SAAU+D,CAAG,EAEtBrC,EAAA,EAAAJ,EAAS0C,GAAoB1C,CAAM,CAAA,QAC7BkB,EAAmB,SAAS,eAAe,eAAe,EAE1D,MAAAC,GAAA,EACND,GAAA,MAAAA,EAAkB,QACZ,MAAAC,GAAA,GAGDwB,EAA0B,MAAAC,GAAA,CAC/BlE,EAAS,MAAOkE,CAAG,EAEnBxC,EAAA,EAAAJ,EAAS0C,GAAoB1C,CAAM,CAAA,QAC7BkB,EAAmB,SAAS,eAAe,eAAe,EAE1D,MAAAC,GAAA,EACND,GAAA,MAAAA,EAAkB,QACZ,MAAAC,GAAA,GAGD0B,EAA8B,MAAAD,GAAA,CACnClE,EAAS,UAAWkE,CAAG,EAEvBxC,EAAA,EAAAJ,EAAS0C,GAAoB1C,CAAM,CAAA,QAC7BkB,EAAmB,SAAS,eAAe,eAAe,EAE1D,MAAAC,GAAA,EACND,GAAA,MAAAA,EAAkB,QACZ,MAAAC,GAAA,SAsBA,QAAQ,IAAIsB,CAAG,EAEfD,EAAcC,CAAG,SAGjBrC,EAAA,EAAAgC,EAAcU,CAAM,kBAiCd,MAAAF,GAAM3G,GAAAC,EAAA8D,EAAO,MAAM,GAAG,IAAhB,YAAA9D,EAAmB,GAAG,KAAtB,YAAAD,EAA0B,UAAU,GAC5C8G,GAAeH,CAAG,EACrBC,EAAqBD,CAAG,EAExBjC,GAAM,MACLC,EAAM,EACL,yEAAwE,CAAA,kBAiBrE,MAAAgC,GAAM3G,GAAAC,EAAA8D,EAAO,MAAM,GAAG,IAAhB,YAAA9D,EAAmB,GAAG,KAAtB,YAAAD,EAA0B,UAAU,GAC5C8G,GAAeH,CAAG,EACrBD,EAAiBC,CAAG,EAEpBjC,GAAM,MACLC,EAAM,EACL,yEAAwE,CAAA,uFAvK/ER,EAAA,GAAAmC,EAAA,CACE,GAAAS,EAAW,OAAS,IAGpB,KAAM,gBACN,KAAM,aACN,MAAOpC,EAAM,EAAE,eAAe,EAC9B,iBAAkBoC,EAAW,IAAKP,GAAQA,EAAI,eAAe,UAI9DO,EACD,OAAQ,CAAAtB,EAAGvF,EAAGiD,EAAG6D,IAAA,cACF,GAAA,IAAA,IAAA,CAAA,GAAQvB,QAAOxF,EAAAC,GAAA,YAAAA,EAAG,UAAH,YAAAD,EAAY,WAAY,IAAKgH,GAAQA,EAAI,IAAI,CAAA,CAAA,QAE3E,IAAKA,IAAA,CACL,KAAMA,EACN,KAAM,aACN,iBAAkBF,EAChB,OAAQP,GAAA,OAAS,SAAAvG,EAAAuG,GAAA,YAAAA,EAAK,UAAL,YAAAvG,EAAc,WAAY,IAAKgH,GAAQA,EAAI,IAAI,EAAE,SAASA,CAAG,IAC9E,IAAKT,GAAQA,EAAI,eAAe,wBAIlCrC,EAAA,GAAA+C,EAAsBZ,EACvB,OAAQa,GAAe,SAAA,OAAAA,EAAW,KAAK,WAASnH,GAAAC,EAAA8D,EAAO,MAAM,GAAG,IAAhB,YAAA9D,EAAmB,GAAG,KAAtB,YAAAD,EAA0B,UAAU,KAAM,EAAE,EAC5F,EAAA,KAAA,CAAMyF,EAAGC,IAAMD,EAAE,KAAK,cAAcC,EAAE,IAAI,CAAA,CAAA,mBAEzCvB,EAAA,GAAAkC,EAAeU,EAChB,OAAQP,GAAQ,SAAA,OAAAA,EAAI,KAAK,WAASxG,GAAAC,EAAA8D,EAAO,MAAM,GAAG,IAAhB,YAAA9D,EAAmB,GAAG,KAAtB,YAAAD,EAA0B,UAAU,KAAM,EAAE,EAC9E,EAAA,KAAA,CAAMyF,EAAGC,IAAMD,EAAE,MAAM,cAAcC,EAAE,KAAK,CAAA,CAAA,mBAE3CvB,EAAA,EAAAiC,EAAA,CAAA,GAAoBc,KAAwBb,CAAY,CAAA,mBAEpDtC,QACNoC,EAAc,CAAA,EAEd,QAAQ,IAAIe,CAAmB,iTC6E3BzG,EAAc,CAAA,EAAC,OAAS,GAACC,GAAAD,CAAA,yFAAzBA,EAAc,CAAA,EAAC,OAAS,sLAWjBA,EAAc,CAAA,CAAA,uBAAnB,OAAI0C,GAAA,g5BAVV7B,EAoCKC,EAAAC,EAAAC,CAAA,EAnCJC,EAkCKF,EAAAM,CAAA,EAjCJJ,EAEKI,EAAAF,CAAA,SAELF,EA4BKI,EAAAH,CAAA,EAzBJD,EAwBKC,EAAAE,CAAA,yEAvBGpB,EAAc,CAAA,CAAA,oBAAnB,OAAI0C,GAAA,EAAA,mHAAJ,uDAeExC,EAAAF,MAAM,KAAI,gWAbqCU,EAAAoB,EAAA,QAAAmB,EAAA,4CAAAjD,EAAa,EAAA,IAAAA,EAAA,CAAA,EAC3D,gEACA,GAAE,+BAHNa,EAoBQC,EAAAgB,EAAAd,CAAA,EAPPC,EAEKa,EAAA6E,CAAA,+FADHpF,EAAA,GAAArB,KAAAA,EAAAF,MAAM,KAAI,KAAAwB,GAAAC,EAAAvB,CAAA,EAbqCqB,EAAA,GAAA0B,KAAAA,EAAA,4CAAAjD,EAAa,EAAA,IAAAA,EAAA,CAAA,EAC3D,gEACA,+DAhBN,IAAAkF,EAAAlF,EAAO,CAAA,EAAA,OAAO,CAAC,IAAM,0GAArBuB,EAAA,IAAA2D,EAAAlF,EAAO,CAAA,EAAA,OAAO,CAAC,IAAM,4KA5HnB,MAAAmD,EAAOC,GAAW,MAAM,2BAExBpB,EAAWC,SAEN,OAAAqB,EAAS,EAAA,EAAAlB,GACT,KAAAwE,EAAO,IAAA,EAAAxE,GAEP,qBAAAyE,EAAuB,EAAA,EAAAzE,EACvB,CAAA,SAAA0E,EAAA,EAAA,EAAA1E,EAEPsD,EAAc,EACdqB,EAAA,CAAA,EAUS,MAAAtD,EAAA,IAAA,CACZC,EAAA,EAAAgC,EAAc,KAAK,IAAI,EAAGA,EAAc,CAAC,CAAA,GAG7B/B,EAAA,IAAA,CACZD,EAAA,EAAAgC,EAAc,KAAK,IAAIA,EAAc,EAAGqB,EAAe,OAAS,CAAC,CAAA,GAG5DjB,EAAuB,MAAAkB,GAAA,KAC5B1D,EAAS,EAAA,EACTtB,EAAS,SAAUgF,CAAK,SAgHjBlB,EAAckB,CAAK,SAGnBtD,EAAA,EAAAgC,EAAcuB,CAAQ,6MArI3BvD,EAAA,EAAAqD,EAAiBG,EAClB,OAAQnC,GAAM,SAAA,OAAAA,EAAE,KAAK,WAASxF,GAAAC,EAAA8D,EAAO,MAAM,GAAG,IAAhB,YAAA9D,EAAmB,GAAG,KAAtB,YAAAD,EAA0B,UAAU,KAAM,EAAE,EAC1E,EAAA,KAAA,CAAMyF,EAAGC,IAAMD,EAAE,KAAK,cAAcC,EAAE,IAAI,CAAA,CAAA,gBAErC3B,OACNoC,EAAc,CAAA,+sBClBD1F,EAAW,CAAA,CAAA,2CAElBA,EAAS,CAAA,CAAA,UANjBa,EASKC,EAAAqG,EAAAnG,CAAA,EADJC,EAA+EkG,EAAAC,CAAA,oCAJjEpH,EAAW,CAAA,CAAA,mBAElBA,EAAS,CAAA,CAAA,mDAVL,UAAAqH,EAAY,UAAA,EAAAjF,GACZ,YAAAkF,EAAc,GAAA,EAAAlF,4nCCE6DpC,EAAS,CAAA,CAAA,UAAhGa,EASKC,EAAAqG,EAAAnG,CAAA,EARJC,EAICkG,EAAAI,CAAA,EACDtG,EAECkG,EAAAK,CAAA,6BARqFxH,EAAS,CAAA,CAAA,mDAHpF,UAAAqH,EAAY,QAAA,EAAAjF,8gDCG+DpC,EAAS,CAAA,CAAA,UAAhGa,EAIKC,EAAAqG,EAAAnG,CAAA,EAHJC,EAECkG,EAAAC,CAAA,6BAHqFpH,EAAS,CAAA,CAAA,mDAHpF,UAAAqH,EAAY,QAAA,EAAAjF,y9BCG+DpC,EAAS,CAAA,CAAA,UAAhGa,EAMKC,EAAAqG,EAAAnG,CAAA,EALJC,EAICkG,EAAAC,CAAA,6BALqFpH,EAAS,CAAA,CAAA,mDAHpF,UAAAqH,EAAY,QAAA,EAAAjF,shBC2CLpC,EAAK,CAAA,EAAC,EAAE,MAAM,yJAAdA,EAAK,CAAA,EAAC,EAAE,MAAM,mKAerB,OAAO,KAAKA,EAAK,CAAA,CAAA,CAAA,uBAAtB,OAAI0C,GAAA,kZADP7B,EAsBKC,EAAA6F,EAAA3F,CAAA,4DAELH,EAAuDC,EAAA2G,EAAAzG,CAAA,4BAvB/C,OAAO,KAAKhB,EAAK,CAAA,CAAA,CAAA,oBAAtB,OAAI0C,GAAA,EAAA,4GAAJ,OAAIA,EAAAgF,EAAA,OAAAhF,GAAA,0CAAJ,OAAIA,GAAA,8IAO0B1C,EAAK,CAAA,EAACA,EAAM,EAAA,CAAA,EAAE,KAAI,8JAA9Ca,EAAoDC,EAAA6F,EAAA3F,CAAA,6BAAxBhB,EAAK,CAAA,EAACA,EAAM,EAAA,CAAA,EAAE,KAAI,KAAAwB,GAAAmG,EAAAC,CAAA,6FAD7B,UAAApI,EAAAQ,EAAM,CAAA,EAAAA,EAAS,EAAA,CAAA,IAAf,YAAAR,EAAe,cAAe,uJAMpCQ,EAAK,CAAA,EAACA,EAAM,EAAA,CAAA,EAAE,UAAO,iBAArBA,EAAK,CAAA,EAACA,EAAM,EAAA,CAAA,EAAE,khBAX5Ba,EAkBKC,EAAAK,EAAAH,CAAA,EAfJC,EAKKE,EAAAR,CAAA,gGAHcY,EAAA,IAAAsG,EAAA,UAAArI,EAAAQ,EAAM,CAAA,EAAAA,EAAS,EAAA,CAAA,IAAf,YAAAR,EAAe,cAAe,qFAMpCQ,EAAK,CAAA,EAACA,EAAM,EAAA,CAAA,EAAE,8OAoBAA,EAAK,CAAA,EAAC,EAAE,YAAY,EAAA,qEAG7BA,EAAgB,CAAA,IAAA,iBAAhBA,EAAgB,CAAA,upBARrCa,EASKC,EAAAM,EAAAJ,CAAA,EANJC,EAGKG,EAAAD,CAAA,sBADJF,EAAuDE,EAAAR,CAAA,sCAMzDE,EAAuDC,EAAA2G,EAAAzG,CAAA,mCANzBhB,EAAK,CAAA,EAAC,EAAE,YAAY,EAAA,KAAAwB,GAAA+D,EAAAF,CAAA,oCAG7BrF,EAAgB,CAAA,oMAaTA,EAAK,CAAA,EAAC,EAAE,cAAc,EAAA,oPAAlDa,EAAyDC,EAAA6F,EAAA3F,CAAA,0CAA7BhB,EAAK,CAAA,EAAC,EAAE,cAAc,EAAA,KAAAwB,GAAA+D,EAAAF,CAAA,yHAlD9C,IAAAH,EAAA,OAAO,KAAKlF,EAAO,CAAA,CAAA,EAAA,OAAS,yBA4B5BT,GAAAC,EAAAQ,EAAO,CAAA,IAAP,YAAAR,EAAS,WAAT,YAAAD,EAAmB,oBAAiBwC,GAAA/B,CAAA,6ZA5BpCuB,EAAA,IAAA2D,EAAA,OAAO,KAAKlF,EAAO,CAAA,CAAA,EAAA,OAAS,+GA4B5BT,GAAAC,EAAAQ,EAAO,CAAA,IAAP,YAAAR,EAAS,WAAT,MAAAD,EAAmB,8gBAlCZ,sDAIAuI,6MAPdjH,EA8DKC,EAAA6F,EAAA3F,CAAA,wtBAjGC,MAAAmC,EAAOC,GAAW,MAAM,sBAEnB,GAAA,CAAA,mBAAA2E,CAAA,EAAA3F,EAEA,CAAA,gBAAA4F,EAAA,EAAA,EAAA5F,EACA,CAAA,iBAAA6F,CAAA,EAAA7F,EAEA,CAAA,MAAA8F,EAAA,EAAA,EAAA9F,EACA,CAAA,QAAA+F,CAAA,EAAA/F,EAYPgG,EAAO,kCAsCQF,EAAMG,CAAM,EAAE,QAAOnJ,CAAA,IAArBgJ,EAAMG,CAAM,EAAE,QAAOnJ,4BACrBO,IAAC,KACZuI,EAAkBvI,EAAE,OACb,CAAA,GAAAuI,EAAiBK,CAAM,EAC3BL,EAAgB,OAAQxF,GAAOA,IAAO6F,CAAM,CAAA,iBAmB/BJ,EAAgB/I,sBASpC6I,sCAjEQtI,GAAC,CACRA,EAAE,SAAW,IAChB0I,6SAjBFzE,EAAA,EAAGwE,EAAQ,OAAO,YACjB,OAAO,KAAKA,CAAK,EAAE,IAAKG,GAAA,CACvBA,GAEI,GAAAH,EAAMG,CAAM,EACf,QAASL,EAAgB,SAASK,CAAM,y2BClB7BrI,EAAW,CAAA,CAAA,2CAElBA,EAAS,CAAA,CAAA,UAPjBa,EAcKC,EAAAqG,EAAAnG,CAAA,EALJC,EAICkG,EAAAC,CAAA,oCARapH,EAAW,CAAA,CAAA,mBAElBA,EAAS,CAAA,CAAA,mDAXL,UAAAqH,EAAY,SAAA,EAAAjF,GACZ,YAAAkF,EAAc,GAAA,EAAAlF,wXCmTL1B,EAAAiG,EAAA,QAAA2B,EAAA,YAAAtI,EAAA,CAAA,EACb,mCACA,sCAAoC,sBAAA,EAGvBuI,GAAA5B,EAAA,SAAA,KAAK,IAAI,IAAK,KAAK,IAAI,GAAI3G,MAAM,GAAG,CAAA,EAAA,GAAA,UARrDa,EASCC,EAAA6F,EAAA3F,CAAA,UANgBO,EAAA,CAAA,EAAA,GAAA+G,KAAAA,EAAA,YAAAtI,EAAA,CAAA,EACb,mCACA,sCAAoC,gDAGvBuI,GAAA5B,EAAA,SAAA,KAAK,IAAI,IAAK,KAAK,IAAI,GAAI3G,MAAM,GAAG,CAAA,EAAA,GAAA,6iBA+GtDa,EAiBQC,EAAAgB,EAAAd,CAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;y1BA5GRH,EAyFKC,EAAA6F,EAAA3F,CAAA,kEA/FJgC,EAAAhD,KAAcA,EAAe,CAAA,CAAA,EAAA,sBAvBvBA,EAAc,CAAA,EAAC,MAAK,EAAG,QAAO,CAAA,uBAAnC,OAAI0C,GAAA,4CA4BF1C,EAAO,CAAA,EAAA+B,irCAzDDrB,EAAAoB,EAAA,QAAAmB,EAAA,UAAAjD,EAAA,CAAA,EACP,mCACA,0DAAwD,eAAA,yOA+CrDA,EAAO,CAAA,EAAG,uCAAyC,qBAAmB,yCAAA,oGA1DtEU,EAAAmC,EAAA,QAAA2F,GAAAxI,EAAA,CAAA,EACL,sCACA,2CAAyC,0BAAA,UAH7Ca,EAmLKC,EAAA+B,EAAA7B,CAAA,EA9KJC,EA2BK4B,EAAAlC,CAAA,EA1BJM,EAyBQN,EAAAmB,CAAA,EAVPb,EASKa,EAAAqF,CAAA,EADJlG,EAA+EkG,EAAAC,CAAA,SAKlFnG,EAkBK4B,EAAAzB,CAAA,EAdJH,EAaKG,EAAAD,CAAA,0DAGNF,EAUK4B,EAAAxB,CAAA,EATJJ,EAQKI,EAAAH,CAAA,gBAGND,EAgHK4B,EAAA9B,CAAA,wDAxKOQ,EAAA,CAAA,EAAA,GAAA0B,KAAAA,EAAA,UAAAjD,EAAA,CAAA,EACP,mCACA,0DAAwD,8CA2BpDA,EAAc,CAAA,EAAC,MAAK,EAAG,QAAO,CAAA,oBAAnC,OAAI0C,GAAA,EAAA,sHAAJ,OAuBDnB,EAAA,CAAA,EAAA,GAAAyB,KAAAA,EAAAhD,KAAcA,EAAe,CAAA,CAAA,EAAA,KAAAwB,GAAA0B,EAAAF,CAAA,6BAHxBhD,EAAO,CAAA,EAAG,uCAAyC,qBAAmB,2HA1DtEuB,EAAA,CAAA,EAAA,GAAAiH,KAAAA,GAAAxI,EAAA,CAAA,EACL,sCACA,2CAAyC,mGAzNtCyI,GAA2B,6EA5C3B,MAAAtF,EAAOC,GAAW,MAAM,6BAExBpB,EAAWC,SAEN,UAAAyG,EAAY,EAAA,EAAAtG,EAEnBuG,EAAU,GACVC,EAAY,GAEZC,EAAkB,EAClBC,EAAkB,KAElBC,EAAgB,GAEd,MAAAC,EAAA,IAAA,CACLF,EAAkB,iBACjBpF,EAAA,EAAAmF,IAAAA,CAAA,GACE,MAGEI,EAAA,IAAA,CACL,cAAcH,CAAe,MAC7BD,EAAkB,CAAA,GASbK,EAAiBC,GAAA,OAChBC,EAAU,KAAK,MAAMD,EAAU,EAAE,EACjCE,EAAmBF,EAAU,GAC7BG,EAAmBD,EAAmB,OAASA,CAAgB,GAAKA,EAChE,MAAA,GAAAD,CAAO,IAAIE,CAAgB,IAGlC,IAAAC,EAEAC,EACAC,EAAA,CAAA,QAEEC,EAAe,IAGjB,IAAAC,EAAiB,MAAMlB,EAAwB,EAAE,KAAK,CAAC,QAGrDmB,EAAgBxK,GAAA,KACjByK,EAAa,UACRnH,EAAI,EAAGA,EAAItD,EAAK,OAAQsD,IAAA,OAC1BoH,GAAmB1K,EAAKsD,CAAC,EAAI,KAAO,IAC1CmH,GAAcC,EAAkBA,SAE1B,KAAK,KAAKD,EAAazK,EAAK,MAAM,GAGpC2K,EAAgBC,GAAA,CACrBA,EAAMA,EAAM,SAENC,EAAY,KAAK,IAAID,EADf,GACuB,EAG5B,OAAA,KAAK,IAAI,EAAK,KAAK,IAAI,IAAMC,CAAS,CAAA,GAGxCC,EAAgBC,GAAA,OACfC,EAAmB,IAAA,aACnBC,EAAoBD,EAAa,wBAAwBD,CAAM,EAE/DG,EAAWF,EAAa,iBAC9BE,EAAS,YAAcZ,EACvBW,EAAkB,QAAQC,CAAQ,EAE5B,MAAAC,GAAeD,EAAS,kBAExBE,GAAA,IAAiB,WAAWD,EAAY,EACxCE,GAAqB,IAAA,WAAWH,EAAS,OAAO,GAIhD,IAAA,CACC,MAAAI,GAAA,IAAA,OACAhC,GAAaC,OAEdD,GAAc,CAAAC,EAAA,CACjB2B,EAAS,sBAAsBG,EAAc,EAC7CH,EAAS,qBAAqBE,EAAU,EAGlC,MAAAG,GAAWf,EAAaa,EAAc,EAE5Cd,EAAe,KAAKI,EAAaY,EAAQ,CAAA,EAGrChB,EAAe,QAAUlB,IAC5BkB,EAAe,MAAA,SAgBjB,OAAO,sBAAsBe,EAAY,IAG1C,OAAO,sBAAsBA,EAAY,OAMrCE,EAA2B,MAAAC,GAAA,CAG1B,MAAApG,GAAA,QACAqG,EAAOC,GAAWF,EAAW,eAAe,EAE5CG,EAAA,MAAYC,GAAgB,aAAa,MAAOH,CAAI,EAAE,MAAOI,IAClEjH,GAAM,MAAMiH,CAAK,EACV,OAGJF,IACH,QAAQ,IAAIA,EAAI,IAAI,EACpBhJ,EAAS,UAAWgJ,EAAI,IAAI,IAexBG,EAAA,SAAA,SACLnC,UAEMmB,EAAe,MAAA,UAAU,aAAa,aAAA,CAAe,MAAO,EAAA,CAAA,KAClEX,EAAA,IAAoB,cAAcW,CAAM,EACxCX,EAAc,QAAA,IAAA,CACb,QAAQ,IAAI,mBAAmB,EAC/BC,EAAA,CAAA,EACAS,EAAaC,CAAM,GAEpBX,EAAc,gBAAmB4B,GAAU3B,EAAY,KAAK2B,EAAM,IAAI,EACtE5B,EAAc,OAAA,SAAA,aACb,QAAQ,IAAI,mBAAmB,KAC1BjK,IAAAC,EAAA6L,GAAA,YAAAA,EAAW,QAAX,YAAA7L,EAAkB,MAAlB,YAAAD,GAAuB,SAAU,MAAQ,MAC7CkK,EAAA,CAAA,OAEI,GAAAb,EAAA,OACGiC,GAAgB,IAAA,KAAKpB,GAAe,KAAM,WAAA,CAAA,EAE1C,MAAAmB,EAAkBC,EAAS,EAEjCjC,EAAY,OACZD,EAAU,EAAA,EAEXc,EAAA,CAAA,MACAf,EAAY,EAAA,IAGdc,EAAc,MAAA,GACV8B,EAAQ,MAAM,IAAI,SAAW,UAAU/L,GAAAC,EAAA6L,GAAA,YAAAA,EAAW,QAAX,YAAA7L,EAAkB,MAAlB,YAAAD,EAAuB,SAAU,MAAQ,SAC/E,sBAAuB,QAAU,4BAA6B,QAAA,CAEjEgK,EAAyB,IAAA,OAAO,mBAAqB,OAAO,yBAG5DA,EAAkB,WAAa,SAGzBgC,EAAoB,IAEtB,IAAAC,GAEJjC,EAAkB,MAAA,EAGlBA,EAAkB,SAAkB,MAAA6B,IAAA,QAEnC,aAAaI,EAAS,EAGtB,QAAQ,IAAIJ,EAAK,QACXK,GAAaL,GAAM,QAAQ,OAAO,KAAKA,GAAM,OAAO,EAAE,OAAS,CAAC,EAAE,CAAC,EAAE,WAE3ErC,EAAmB,GAAAA,CAAa,GAAG0C,EAAU,GAEvC,MAAAhH,GAAA,GACNjF,GAAA,SAAS,eAAe,eAAe,IAAvC,MAAAA,GAA0C,QAG1CgM,GAAY,gBACX,QAAQ,IAAI,kDAAkD,EAC9DjC,EAAkB,KAAA,GAChBgC,IAIJhC,EAAkB,MAAA,UAAA,CAEjB,QAAQ,IAAI,mBAAmB,EAE/BmC,IACA1J,EAAS,UAAW+G,CAAa,EAEjCH,EAAY,OACZD,EAAU,EAAA,GAIXY,EAAkB,QAAoB,SAAA6B,GAAA,CACrC,QAAQ,IAAIA,EAAK,EACjBnH,GAAM,MAAMC,EAAM,EAA2C,sCAAA,CAAA,MAAOkH,GAAM,KAAA,CAAA,CAAA,EAC1EpJ,EAAS,QAAQ,EAEjB2J,OAMEA,EAAA,SAAA,CACDjD,GAAac,SACVA,EAAc,OAErBP,IACAQ,EAAA,CAAA,GAGKiC,EAAA,SAAA,KACL/C,EAAU,EAAA,EACVC,EAAY,GAERF,GAAac,SACVA,EAAc,OAErB,cAAcV,CAAe,gBAqB3B9G,EAAS,QAAQ,EACjB2J,wBAiJOD,EAAgB,gGA5YnBhD,EACNyC,IAEAQ,mwBC2Oc3L,EAAC,EAAA,EACZ,iDACA,UAAQ,yDAAA,gGAHZa,EAeKC,EAAAI,EAAAF,CAAA,EAPJC,EAMKC,EAAAE,CAAA,EALJH,EAIKG,EAAAD,CAAA,EAHJF,EAEKE,EAAAR,CAAA,iEAXOX,EAAC,EAAA,EACZ,iDACA,UAAQ,w4BAoBRa,EAqBKC,EAAA6F,EAAA3F,CAAA,EApBJC,EAmBQ0F,EAAA7E,CAAA,wjCA6DiCkB,EAAAhD,KAAgB,KAAI,mGADxD,aACQ,0PADR,aACQ,yWAPN4L,GAAAC,EAAA,IAAAC,IAAAxM,GAAAC,GAAAC,EAAAQ,EAAQ,EAAA,EAAA,KAAkDA,EAAA,EAAA,CAAA,IAA1D,YAAAR,EAA0D,OAA1D,YAAAD,EAAgE,OAAhE,YAAAD,EACF,qBACDU,EAAK,EAAA,EAAC,WAAa,uBAEd+L,EAAc,sBAAA,GAAArL,EAAAmL,EAAA,MAAAC,CAAA,+SAZxBjL,EA4BKC,EAAAI,EAAAF,CAAA,EAzBJC,EAcKC,EAAAC,CAAA,EAbJF,EASCE,EAAA0K,CAAA,SACD5K,EAEKE,EAAAR,CAAA,SADOM,EAAuDN,EAAAqL,CAAA,gBAGpE/K,EASKC,EAAAE,CAAA,EARJH,EAOQG,EAAAU,CAAA,uEAlBF,CAAAR,GAAAC,EAAA,CAAA,EAAA,SAAA,CAAAqK,GAAAC,EAAA,IAAAC,IAAAxM,GAAAC,GAAAC,EAAAQ,EAAQ,EAAA,EAAA,KAAkDA,EAAA,EAAA,CAAA,IAA1D,YAAAR,EAA0D,OAA1D,YAAAD,EAAgE,OAAhE,YAAAD,EACF,qBACDU,EAAK,EAAA,EAAC,WAAa,uBAEd+L,EAAc,sBAAA,kBAGkB,CAAAzK,GAAAC,EAAA,CAAA,EAAA,IAAAyB,KAAAA,EAAAhD,KAAgB,KAAI,KAAAwB,GAAA0B,EAAAF,CAAA,+IA2erDoC,EAAApF,EAAS,EAAA,EAAA,QAAU,GAAKA,EAAS,EAAA,EAAA,GAAI,EAAC,EAAE,MAAQ,uBA7XlDA,EAAK,CAAA,EAAC,OAAS,GAACK,GAAAL,CAAA,uDA+KX,MAAAA,MAAO,OAAMA,EAAA,EAAA,EAAA,EAAA,sVA8PlBkF,GAAA,OAAAA,EAAAlF,EAAS,EAAA,EAAA,QAAU,GAAKA,EAAS,EAAA,EAAA,GAAI,EAAC,EAAE,MAAQ,y6BAtNtCU,EAAAuL,EAAA,cAAAC,EAAAlM,QAAyB,GACnCA,EAAA,EAAA,EACAA,EAAK,EAAA,EAAC,EAAE,gBAAgB,CAAA,2NA3NxBR,EAAAQ,EAAS,EAAA,IAAT,YAAAR,EAAW,gBAAiB,KAAK,gFATxCqB,EAghBMC,EAAAqL,EAAAnL,CAAA,EAzgBLC,EA+aKkL,EAAAjL,CAAA,wBAjQJD,EAgQKC,EAAAE,CAAA,EA/PJH,EAsCKG,EAAAT,CAAA,sBAELM,EAuKCG,EAAA6K,CAAA,gBAhKYjM,EAAM,CAAA,CAAA,SAkKnBiB,EA6CKG,EAAAD,CAAA,wBAGPF,EAwFKkL,EAAA9K,CAAA,0MApgBCrB,EAAK,CAAA,EAAC,OAAS,8GA+KVuB,EAAA,CAAA,EAAA,YAAA6K,EAAA,MAAApM,MAAO,OAAMA,EAAA,EAAA,EAAA,CAAA,CAAA,6OAwCR,CAAAsB,GAAAC,EAAA,CAAA,EAAA,UAAA2K,KAAAA,EAAAlM,QAAyB,GACnCA,EAAA,EAAA,EACAA,EAAK,EAAA,EAAC,EAAE,gBAAgB,uCACfA,EAAM,CAAA,CAAA,EAmKbuB,EAAA,CAAA,EAAA,OAAA6D,EAAApF,EAAS,EAAA,EAAA,QAAU,GAAKA,EAAS,EAAA,EAAA,GAAI,EAAC,EAAE,MAAQ,0IA/XlDR,GAAAQ,EAAS,EAAA,IAAT,YAAAR,GAAW,gBAAiB,4xBAIxBQ,EAAK,CAAA,CAAA,uBAAV,OAAI0C,GAAA,qSADP7B,EAsKKC,EAAA6F,EAAA3F,CAAA,uFArKGhB,EAAK,CAAA,CAAA,oBAAV,OAAI0C,GAAA,EAAA,4GAAJ,OAAIA,EAAAgF,EAAA,OAAAhF,GAAA,0CAAJ,OAAI,GAAA,uwBAsIC2C,KAAA7F,EAAAQ,EAAM,EAAA,IAAN,YAAAR,EAAM,QAAa,IAAAQ,MAAK,IAAI,IAAA,WAGOA,EAAK,EAAA,EAAC,EAAE,YAAY,EAAA,yyBAxB3Da,EA0BKC,EAAAO,EAAAL,CAAA,EAvBJC,EAcKI,EAAAV,CAAA,SAELM,EAMKI,EAAAH,CAAA,EALJD,EAEKC,EAAAC,CAAA,gBAELF,EAAgEC,EAAAE,CAAA,uBAH9DG,EAAA,CAAA,EAAA,GAAA8D,KAAAA,KAAA7F,EAAAQ,EAAM,EAAA,IAAN,YAAAR,EAAM,QAAa,IAAAQ,MAAK,IAAI,IAAA,KAAAwB,GAAA+D,EAAAF,CAAA,uBAGOrF,EAAK,EAAA,EAAC,EAAE,YAAY,EAAA,KAAAwB,GAAAE,EAAAvB,CAAA,yDA/BvDkF,EAAArF,MAAK,KAAI,WAG0BA,EAAK,EAAA,EAAC,EAAE,UAAU,EAAA,qBAvElD,OAAAA,MAAK,cAAaqM,sxBAJzBxL,EA6EKC,EAAAO,EAAAL,CAAA,EA1EJC,EAiEKI,EAAAV,CAAA,qBAELM,EAMKI,EAAAH,CAAA,EALJD,EAEKC,EAAAC,CAAA,gBAELF,EAA8DC,EAAAE,CAAA,sEAH5DG,EAAA,CAAA,EAAA,GAAA8D,KAAAA,EAAArF,MAAK,KAAI,KAAAwB,GAAA+D,EAAAF,CAAA,uBAG0BrF,EAAK,EAAA,EAAC,EAAE,UAAU,EAAA,KAAAwB,GAAAE,EAAAvB,CAAA,kEApGnDH,EAAe,CAAA,EAAGA,EAAmB,EAAA,EAAC,SAAW,EAAIA,EAAe,CAAA,EAAA,SAAWA,MAAoB,SAAMsM,GAAAtM,CAAA,sLAJxG4L,GAAAC,EAAA,IAAAC,EAAA9L,MAAK,GAAG,GAAAU,EAAAmL,EAAA,MAAAC,CAAA,sGAFfjL,EA6BKC,EAAA6F,EAAA3F,CAAA,EA5BJC,EAIC0F,EAAAkF,CAAA,sCAHK,CAAAvK,GAAAC,EAAA,CAAA,EAAA,GAAA,CAAAqK,GAAAC,EAAA,IAAAC,EAAA9L,MAAK,GAAG,kBAITA,EAAe,CAAA,EAAGA,EAAmB,EAAA,EAAC,SAAW,EAAIA,EAAe,CAAA,EAAA,SAAWA,MAAoB,yPAmD9F;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,iBAwBP,mKAxBO;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,iBAwBP,wmBA7BDa,EA6CAC,EAAAqG,EAAAnG,CAAA,EAxCEC,EAwBOkG,EAAAoF,CAAA,SAAAtL,EAKNkG,EAAAqF,CAAA,EAAAvL,EAKAkG,EAAAsF,CAAA,EAAAxL,EAKAkG,EAAAuF,CAAA,09BA5DH7L,EAcKC,EAAAqG,EAAAnG,CAAA,EARJC,EAICkG,EAAAI,CAAA,EACDtG,EAECkG,EAAAK,CAAA,4GAxCOxH,EAAK,EAAA,EAAC,EAAE,eAAc,CAC9B,OAAM,IAAOA,EAAe,CAAA,GAAIA,EAAe,CAAA,CAAA,EAAIA,EAAc,CAAA,GAC/D,OAAMA,EAAA,EAAA,CAAA,EACN,KAAK,IAAI,mKAHHA,EAAK,EAAA,EAAC,EAAE,eAAc,CAC9B,OAAM,IAAOA,EAAe,CAAA,GAAIA,EAAe,CAAA,CAAA,EAAIA,EAAc,CAAA,GAC/D,OAAMA,EAAA,EAAA,CAAA,EACN,KAAK,IAAI,mzBAGZa,EAWKC,EAAAqG,EAAAnG,CAAA,EALJC,EAICkG,EAAAC,CAAA,sZA1BDpH,EAAI,EAAA,EAAC,OAAS,QAAO,EA+BhBA,EAAI,EAAA,EAAC,OAAS,MAAK,EA+EnBA,EAAI,EAAA,EAAC,OAAS,aAAY,2lBA/GrCa,EAkKKC,EAAAK,EAAAH,CAAA,4BArBJC,EAoBKE,EAAAR,CAAA,EAnBJM,EAkBQN,EAAAmB,CAAA,m5BA8BVjB,EAcQC,EAAAgB,EAAAd,CAAA,8EA+KUhB,EAAK,EAAA,EAAC,EAAE,cAAc,gKAAtBA,EAAK,EAAA,EAAC,EAAE,cAAc,g6BACvCa,EAuCQC,EAAAgB,EAAAd,CAAA,64BAwEXH,EAoBKC,EAAA6F,EAAA3F,CAAA,EAnBJC,EAkBQ0F,EAAA7E,CAAA,0IAnFJ,OAAA9B,OAAW,GAAE,sXAsCEA,EAAK,EAAA,EAAC,EAAE,cAAc,6NADzCa,EAwBKC,EAAA6F,EAAA3F,CAAA,gEAvBchB,EAAK,EAAA,EAAC,EAAE,cAAc,4MApCtBA,EAAK,EAAA,EAAC,EAAE,MAAM,6NADjCa,EAkCKC,EAAA6F,EAAA3F,CAAA,gEAjCchB,EAAK,EAAA,EAAC,EAAE,MAAM,80BAuCtBU,EAAAoB,EAAA,QAAAmB,GAAAjD,OAAW,GAChB,8FACA,uEAAqE,kDAAA,uBAE9D8B,EAAA,SAAA6K,EAAA3M,OAAW,WANtBa,EAoBQC,EAAAgB,EAAAd,CAAA,EAZPC,EAWKa,EAAAqF,CAAA,EALJlG,EAICkG,EAAAC,CAAA,UAhBM7F,EAAA,CAAA,EAAA,GAAA0B,KAAAA,GAAAjD,OAAW,GAChB,8FACA,uEAAqE,oEAE9DuB,EAAA,CAAA,EAAA,GAAAoL,KAAAA,EAAA3M,OAAW,6ZA1CtBa,EA8BQC,EAAAgB,EAAAd,CAAA,kOA0DbhB,EAAK,EAAA,EAAC,EAAE,uDAAuD,EAAA,eAhuBhEA,EAAO,EAAA,GAAA4M,GAAA5M,CAAA,EAuBHM,EAAAN,OAAe,IAASA,EAAS,EAAA,EAAA,OAAS,GAAC6M,GAAA7M,CAAA,kFA2B3CkF,GAAA,OAAAA,EAAAlF,EAAO,CAAA,EAAA,OAAO,CAAC,IAAM,UAEhBoF,GAAA,OAAAA,EAAApF,EAAO,CAAA,EAAA,OAAO,CAAC,IAAM,8UAqC1B,IAAA8M,GAAA9M,OAAoB,QAAS+M,GAAA/M,CAAA,gDA2F7BA,EAAS,EAAA,EAAA,42CAjKlBa,EAktBKC,EAAA6B,EAAA3B,CAAA,EAjtBJC,EAsGK0B,EAAAzB,CAAA,EArGJD,EAoGKC,EAAAE,CAAA,EAnGJH,EAyBKG,EAAAT,CAAA,wBAELM,EAuEKG,EAAAD,CAAA,yEAIPF,EAwmBK0B,EAAAC,CAAA,EAvmBJ3B,EAsmBK2B,EAAAC,CAAA,EArmBJ5B,EAomBK4B,EAAA9B,CAAA,EAnmBJE,EAmDCF,EAAAiM,CAAA,yCA6iBD/L,EAEKF,EAAAM,CAAA,iFAjuBJrB,EAAO,EAAA,mHAuBHA,OAAe,IAASA,EAAS,EAAA,EAAA,OAAS,wYAkE1CA,OAAoB,6RAuoBvBA,EAAK,EAAA,EAAC,EAAE,uDAAuD,EAAA,KAAAwB,GAAAyL,EAAAC,CAAA,waA18B9D,MAAA/J,EAAOC,GAAW,MAAM,uBAEnB,GAAA,CAAA,aAAA+J,CAAA,EAAA/K,EACA,CAAA,aAAAgL,CAAA,EAAAhL,GAEA,WAAAiL,EAAa,EAAA,EAAAjL,EAEb,CAAA,gBAAAkL,CAAA,EAAAlL,EACA,CAAA,eAAAmL,CAAA,EAAAnL,EAEPsG,EAAY,GAEZ8E,EACAC,EAEAC,EACAC,EACAC,EAEAC,EACAC,EAAU,GAEVlH,EAAO,KACPC,EAAuB,GAEhB,CAAA,MAAAxD,EAAA,EAAA,EAAAjB,EAEA,CAAA,iBAAA2L,EAAA,EAAA,EAAA3L,EACA,CAAA,gBAAA4F,GAAA,EAAA,EAAA5F,GACA,iBAAA6F,GAAmB,EAAA,EAAA7F,GAEnB,OAAAkB,EAAS,EAAA,EAAAlB,EACT,CAAA,SAAA0E,EAAA,EAAA,EAAA1E,EAEP4L,EAAA,CAAA,EAYE,MAAAC,EAAA,IAAA,OACCC,EAAU,SAAS,eAAe,oBAAoB,EAC5DA,EAAQ,UAAYA,EAAQ,cAGvBC,GAAmB,MAAArD,GAAA,CACxB,QAAQ,IAAIA,CAAI,EAEV,MAAA/E,EAAA,CACL,KAAM,MACN,KAAM+E,EAAK,KACX,gBAAiB,GACjB,cAAe,GACf,MAAO,QAMF,GAFLpH,EAAA,EAAAL,EAAA,CAAA,GAAYA,EAAO0C,CAAG,CAAA,EAEjB,CAAA,aAAc,WAAW,EAAE,SAAS+E,EAAK,IAAM,EAAA,CAC7CE,MAAAA,GAAAA,MAAYC,GAAgB,aAAa,MAAOH,CAAI,EAAE,MAAOI,KAClEjH,GAAM,MAAMiH,EAAK,EACV,OAGJF,GAAAA,GAAAA,CACH,QAAQ,IAAIA,EAAG,EACT,MAAAzG,GAAA,IAAW,KAAMyG,CAAAA,GAAI,IAAI,EAAA,CAAK,KAAM,YAAA,CAAA,EAC1CF,EAAOC,GAAWxG,GAAS,GAAAuG,EAAK,IAAI,MAAA,GAIhC,MAAAE,GAAA,MAAYoD,GAAoB,aAAa,MAAO,GAAItD,CAAI,EAE9DE,KACHjF,EAAI,cAAgB,GACpBA,EAAI,gBAAkBiF,GAAI,uBAGnB,OAAAvL,GAAA,CAERiE,EAAA,EAAAL,EAAQA,EAAM,OAAQgL,IAAMA,GAAE,OAASvD,EAAK,IAAI,CAAA,EAChD7G,GAAM,MAAMxE,EAAC,IAIT6O,GAAmB,MAAApI,GAAA,CACxB,QAAQ,IAAIA,CAAG,EAET,MAAAH,EAAA,CACL,KAAM,MACN,KAAMG,EACN,gBAAiB,GACjB,cAAe,GACf,IAAAA,EACA,MAAO,QAIPxC,EAAA,EAAAL,EAAA,CAAA,GAAYA,EAAO0C,CAAG,CAAA,EAChB,MAAAiF,GAAA,MAAYuD,GAAoB,aAAa,MAAO,GAAIrI,CAAG,EAE7D8E,KACHjF,EAAI,cAAgB,GACpBA,EAAI,gBAAkBiF,GAAI,uBAGnB,OAAAvL,GAAA,CAERiE,EAAA,EAAAL,EAAQA,EAAM,OAAQgL,IAAMA,GAAE,OAASnI,CAAG,CAAA,EAC1CjC,GAAM,MAAMxE,EAAC,IAIT+O,GAAoC,MAAAtI,GAAA,CACzC,QAAQ,IAAIA,CAAG,EAET,MAAAH,EAAA,CACL,KAAM,MACN,KAAMG,EACN,gBAAiB,GACjB,cAAe,GACf,IAAAA,EACA,MAAO,QAIPxC,EAAA,EAAAL,EAAA,CAAA,GAAYA,EAAO0C,CAAG,CAAA,QAChBiF,GAAY,MAAAyD,GAAqC,aAAa,MAAOvI,CAAG,EAE1E8E,KACHjF,EAAI,cAAgB,GACpBA,EAAI,gBAAkBiF,GAAI,uBAGnB,OAAAvL,GAAA,CAERiE,EAAA,EAAAL,EAAQA,EAAM,OAAQgL,IAAMA,GAAE,OAASnI,CAAG,CAAA,EAC1CjC,GAAM,MAAMxE,EAAC,IAIfgD,GAAA,IAAA,CACC,OAAO,WAAA,IAAiB+K,GAAA,YAAAA,EAAqB,QAAS,CAAC,QAEjDkB,EAAW,SAAS,cAAc,MAAM,EAExCC,EAAiBvD,IAAA,CAClBA,GAAM,MAAQ,WACjB,QAAQ,IAAI,QAAQ,OACpB0C,EAAU,EAAA,IAINc,GAAcnP,IAAA,CACnBA,GAAE,eAAA,OACFqO,EAAU,EAAA,GAGLe,GAAA,IAAA,MACLf,EAAU,EAAA,GAGLgB,GAAgB,MAAArP,IAAA,WAIjB,GAHJA,GAAE,eAAA,EACF,QAAQ,IAAIA,EAAC,GAETD,GAAAC,GAAE,eAAF,MAAAD,GAAgB,MAAA,CACbqO,MAAAA,GAAa,MAAM,MAAKtO,GAAAE,GAAE,eAAF,YAAAF,GAAgB,KAAK,EAE/CsO,IAAcA,GAAW,OAAS,EACrCA,GAAW,QAAS/C,IAAA,CAEd,GADL,QAAQ,IAAIA,GAAMA,GAAK,KAAK,MAAM,GAAG,EAAE,KAAK,CAAA,EACvC,CAAA,YAAa,aAAc,aAAc,WAAW,EAAE,SAASA,GAAK,IAAM,EAAA,CAC1E,GAAAkD,EAAoB,SAAW,EAAA,CAClC/J,GAAM,MAAMC,EAAM,EAAE,+CAA+C,CAAA,aAGhEjF,GAAa,IAAA,WACjBA,GAAO,OAAUmM,IAAA,CAChB1H,EAAA,EAAAL,EAAA,CACI,GAAAA,GAEF,KAAM,QACN,IAAQ,GAAA+H,GAAM,OAAO,MAAM,OAI9BnM,GAAO,cAAc6L,EAAI,CAEzB,MAAAiE,GAAoB,SAASjE,GAAK,IAAM,GACxCkE,GAA0B,SAASlE,GAAK,KAAK,MAAM,GAAG,EAAE,GAAA,EAAK,CAAA,GAI7D7G,GAAM,MACLC,EAAM,EAEH,8EAAA,CAAA,UAAW4G,GAAK,IAAM,CAAA,CAAA,EAG1BqD,GAAUrD,EAAI,IAIhB7G,GAAM,MAAMC,EAAM,EAAA,iBAAA,CAAA,OAIpB4J,EAAU,EAAA,GAGX,cAAO,iBAAiB,UAAWa,CAAa,EAEhDD,GAAA,MAAAA,EAAU,iBAAiB,WAAYE,IACvCF,GAAA,MAAAA,EAAU,iBAAiB,OAAQI,IACnCJ,GAAA,MAAAA,EAAU,iBAAiB,YAAaG,SAGvC,OAAO,oBAAoB,UAAWF,CAAa,EAEnDD,GAAA,MAAAA,EAAU,oBAAoB,WAAYE,IAC1CF,GAAA,MAAAA,EAAU,oBAAoB,OAAQI,IACtCJ,GAAA,MAAAA,EAAU,oBAAoB,YAAaG,qBAiCtCnL,EAAA,EAAA2J,EAAa,EAAI,EACjBY,gDAsBiBP,EAAcuB,0GAGtBtB,EAAgBsB,8CAEdxP,GAAC,CACb,QAAQ,IAAIA,CAAC,EACb+O,GAA2B/O,EAAE,MAAM,KAE3BA,GAAC,CACT,QAAQ,IAAIA,CAAC,EACb6O,GAAU7O,EAAE,MAAM,MAEPA,GAAC,OACZ,QAAQ,IAAIA,CAAC,MACb4D,EAAK,IACDA,GAEF,OAAM7D,EAAAC,GAAA,YAAAA,EAAG,SAAH,YAAAD,EAAW,OAAQ,MACtB,GAAAC,EAAE,OACL,cAAe,kDAQRmO,EAAaqB,0EAIZxP,GAAC,KACZ6N,EAAkB7N,EAAE,MAAM,EAC1B+N,GAAA,MAAAA,EAAqB,SAaArI,GAAA6B,GAAUA,EAAM,KAAOsG,EAAgB,WAczD5J,EAAA,EAAA4J,EAAkB,MAAS,8CAgBpBG,EAAiBwB,0BAChBpB,EAAU,KAAA,iCAKjBA,GAAcA,EAAW,OAAS,EACjB,MAAM,KAAKA,CAAU,EAC7B,QAAS/C,GAAI,KACnB,YAAa,aAAc,aAAc,WAAW,EAAE,SAASA,EAAK,IAAM,EAAA,IAC1EkD,EAAoB,SAAW,EAAC,CACnC/J,GAAM,MAAMC,EAAM,EAAE,+CAA+C,CAAA,EACnER,EAAA,GAAAmK,EAAa,IAAI,OACjBJ,EAAkB,MAAQ,GAAEA,CAAA,SAGzB,IAAAxO,OAAa,WACjBA,GAAO,OAAUmM,IAAK,KACrB/H,EAAK,IACDA,GAEF,KAAM,QACN,IAAQ,GAAA+H,GAAM,OAAO,MAAM,MAG7B1H,EAAA,GAAAmK,EAAa,IAAI,OACjBJ,EAAkB,MAAQ,GAAEA,CAAA,GAE7BxO,GAAO,cAAc6L,CAAI,OAEzBiE,GAAoB,SAASjE,EAAK,IAAM,GACxCkE,GAA0B,SAASlE,EAAK,KAAK,MAAM,GAAG,EAAE,GAAE,EAAG,CAAA,GAE7DqD,GAAUrD,CAAI,OACd2C,EAAkB,MAAQ,GAAEA,CAAA,IAE5BxJ,GAAM,MACLC,EAAM,EAAC,8EAAA,CAEJ,UAAW4G,EAAK,IAAM,CAAA,CAAA,EAG1BqD,GAAUrD,CAAI,OACd2C,EAAkB,MAAQ,GAAEA,CAAA,KAI9BxJ,GAAM,MAAMC,EAAM,EAAC,iBAAA,CAAA,uDASnBR,EAAA,GAAAgF,EAAY,EAAK,QAEXjE,GAAI,GACVjF,EAAA,SAAS,eAAe,eAAe,IAAvC,MAAAA,EAA0C,iBAExBC,GAAC,cACbyP,EAAWzP,EAAE,WACnB6D,EAAM,GAAMA,CAAM,GAAG4L,CAAQ,GAAA,EAE7BxL,EAAA,GAAAgF,EAAY,EAAK,QAEXjE,GAAI,GACVjF,GAAA,SAAS,eAAe,eAAe,IAAvC,MAAAA,GAA0C,UAEtC6L,GAAA,YAAAA,EAAW,iBAAkB,KAChC8B,EAAa7J,CAAM,GAgCD6L,GAAA3M,GAAQ,CAAAwL,EAAoB,SAASxL,CAAE,SAqInDa,EAAM,OAAO+L,EAAS,CAAC,UA0BLC,GAAA,CAAArK,EAAGvF,EAAGiD,GAAG6D,OAC1BwH,EAAiB,SAAStO,EAAE,EAAE,KAAM6P,GAAA,YAAAA,EAAQ,OAAQ,UAAY,WACnEtK,EAAEvF,EAAE,EAAE,EAAA,CACL,KAAMA,EAAE,KACR,YAAaA,EAAE,KAAK,YACpB,QAAS,KAGJuF,WAGPyI,EAAkB,MAAK,sBAGjBhJ,GAAI,EACV+I,GAAA,MAAAA,EAAqB,4GAuBZA,EAAmByB,iCAKlB3L,EAAM,KAAA,sBACJ7D,GAAC,EAEZ,CAAA8P,GAEA,EAAA,iBAAkB,QAClB,UAAU,eAAiB,GAC3B,UAAU,iBAAmB,MAI1B9P,EAAE,MAAQ,SAAY,CAAAA,EAAE,UAC3BA,EAAE,eAAc,EAIb6D,IAAW,IAAM7D,EAAE,MAAQ,SAAO,CAAKA,EAAE,UAC5C0N,EAAa7J,CAAM,aAIH7D,GAAC,QACb,MAAA+P,EAAgB/P,EAAE,SAAWA,EAAE,WAGjC6D,IAAW,IAAMkM,GAAiB/P,EAAE,IAAI,YAAW,IAAO,IAAG,CAChEA,EAAE,eAAc,EAChB,QAAQ,IAAI,YAAY,QAElBgQ,GAAgB,CAAA,GAClB,SAAS,uBAAuB,4BAA4B,CAAA,EAC7D,GAAE,EAAG,EAERA,IAAA,MAAAA,GAAkB,QAGf,GAAAnM,IAAW,IAAM7D,EAAE,KAAO,UAAS,CACtCA,EAAE,eAAc,QAEViQ,GAAkB,CAAA,GACpB,SAAS,uBAAuB,cAAc,CAAA,EAC/C,GAAE,EAAG,EAEFC,GAAU,CAAA,GACZ,SAAS,uBAAuB,0BAA0B,CAAA,EAC3D,GAAE,EAAG,EAER,QAAQ,IAAID,EAAkB,EAE9BA,GAAmB,eAAiB,CAAA,MAAO,QAAQ,CAAA,EACnDC,IAAA,MAAAA,GAAY,QAyBR,GAtBA,CAAA,IAAK,IAAK,GAAG,EAAE,SAASrM,EAAO,OAAO,CAAC,CAAA,GAAM7D,EAAE,MAAQ,YAC3DA,EAAE,eAAc,GAEfiO,GAAkBC,GAAoBC,GAAe,SAAQ,EAErC,CAAA,GACrB,SAAS,uBAAuB,gCAAgC,CAAA,EACjE,GAAE,EAAG,EACY,eAAiB,CAAA,MAAO,QAAQ,CAAA,GAGhD,CAAA,IAAK,IAAK,GAAG,EAAE,SAAStK,EAAO,OAAO,CAAC,CAAA,GAAM7D,EAAE,MAAQ,cAC3DA,EAAE,eAAc,GAEfiO,GAAkBC,GAAoBC,GAAe,WAAU,EAEvC,CAAA,GACrB,SAAS,uBAAuB,gCAAgC,CAAA,EACjE,GAAE,EAAG,EACY,eAAiB,CAAA,MAAO,QAAQ,CAAA,GAGhD,CAAA,IAAK,IAAK,GAAG,EAAE,SAAStK,EAAO,OAAO,CAAC,CAAA,GAAM7D,EAAE,MAAQ,QAAO,CAClEA,EAAE,eAAc,QAEVmQ,GAAmB,CAAA,GACrB,SAAS,uBAAuB,gCAAgC,CAAA,EACjE,GAAE,EAAG,EAEJnQ,EAAE,SACLiE,EAAA,EAAAJ,KAAYA,CAAM;AAAA,CAAA,EACRsM,GACVA,IAAA,MAAAA,GAAqB,SAErBpQ,GAAA,SAAS,eAAe,qBAAqB,IAA7C,MAAAA,GAAgD,QAI7C,GAAA,CAAA,IAAK,IAAK,GAAG,EAAE,SAAS8D,EAAO,OAAO,CAAC,CAAA,GAAM7D,EAAE,MAAQ,MAAK,CAChEA,EAAE,eAAc,QAEVmQ,GAAmB,CAAA,GACrB,SAAS,uBAAuB,gCAAgC,CAAA,EACjE,GAAE,EAAG,EAERA,IAAA,MAAAA,GAAqB,gBACXnQ,EAAE,MAAQ,MAAK,OACnBiF,GAAQC,GAAgBrB,CAAM,KAEhCoB,GAAM,OAAS,EAAC,CACb,MAAAE,GAAOF,GAAM,GAAG,CAAC,EACjBmL,GAAavM,MAEnBA,EAASA,EAAO,UAAU,GAAGsB,IAAA,YAAAA,GAAM,UAAW,CAAC,CAAA,QACzCH,GAAI,EAEVhF,EAAE,OAAO,UAAYA,EAAE,OAAO,aAC9BiE,EAAA,EAAAJ,EAASuM,EAAU,QACbpL,GAAI,EAEVhF,EAAE,eAAc,EAChBA,EAAE,OAAO,kBAAkBmF,IAAA,YAAAA,GAAM,WAAYA,GAAK,SAAW,CAAC,EAG/DnF,EAAE,OAAO,MAAM,OAAS,GACxBA,EAAE,OAAO,MAAM,OAAS,KAAK,IAAIA,EAAE,OAAO,aAAc,GAAG,EAAI,KAG5DA,EAAE,MAAQ,WACb,QAAQ,IAAI,QAAQ,EACpBiE,EAAA,EAAA4J,EAAkB,MAAS,MAIlB7N,GAAC,CACXA,EAAE,OAAO,MAAM,OAAS,GACxBA,EAAE,OAAO,MAAM,OAAS,KAAK,IAAIA,EAAE,OAAO,aAAc,GAAG,EAAI,KAC/DiE,EAAA,GAAAkD,EAAO,IAAI,KAEDnH,GAAC,CACXA,EAAE,OAAO,MAAM,OAAS,GACxBA,EAAE,OAAO,MAAM,OAAS,KAAK,IAAIA,EAAE,OAAO,aAAc,GAAG,EAAI,SAErDA,GAAC,CACL,MAAAqQ,EAAgBrQ,EAAE,eAAiB,OAAO,iBAE5CqQ,GAAiBA,EAAc,iBACvBzL,MAAQyL,EAAc,MAC5B,GAAAzL,GAAK,KAAK,QAAQ,OAAO,OAAQ,OAC9BE,GAAOF,GAAK,YACZpF,OAAa,WAEnBA,GAAO,OAAM,SAAaQ,GAAC,CAC1BiE,EAAA,EAAAL,EACI,CAAA,GAAAA,EAEF,CAAA,KAAM,QACN,IAAQ,GAAA5D,GAAE,OAAO,MAAM,EAAA,CAAA,CAAA,GAK1BR,GAAO,cAAcsF,EAAI,qBAgBN,MAAA,UAAU,aAC1B,aAAY,CAAG,MAAO,EAAI,CAAA,EAC1B,MAAK,SAAWP,EAAG,CACnB,OAAAC,GAAM,MACLC,EAAM,EAAC,yDAAA,CAGL,MAAOF,CAAA,CAAA,CAAA,EAIH,QAIRN,EAAA,GAAAgF,EAAY,EAAI,QAGjBzE,GAAM,MAAMC,EAAM,EAAE,6CAA6C,CAAA,oBA8B9DqJ,EAAe,OAAS,EAAC,CAC5BtJ,GAAM,MAAMC,EAAM,EAAE,+BAA+B,CAAA,SAKhD,GAAAoH,EAAQ,MAAM,IAAI,SAAW,MAAK,CACrCrH,GAAM,MACLC,EAAM,EAAE,yDAAyD,CAAA,aAO5D,MAAA,UAAU,aAAa,aAAe,CAAA,MAAO,EAAI,CAAA,EAGvD6L,GAAgB,IAAI,EAAI,OACb,CAEX9L,GAAM,MAAMC,EAAM,EAAE,gDAAgD,CAAA,WAwCvEkJ,aAzfJD,EAAa7J,CAAM,ugBAvZzBI,EAAA,GAAGsK,MAA2BV,EAAmB,CAAAA,CAAe,EAAIC,CAAe,EAAE,OACnFvG,GAAU,gBAAA,QAAAgJ,IAAA1Q,IAAAC,IAAAC,EAAA0H,EAAQ,KAAM+I,IAAMA,GAAE,KAAOjJ,CAAK,IAAlC,YAAAxH,EAAqC,OAArC,YAAAD,GAA2C,OAA3C,YAAAD,GAAiD,eAAjD,YAAA0Q,GAA+D,SAAU,GAAA,CAAA,sBAG9E1M,GACFkK,IACH9J,EAAA,GAAA8J,EAAoB,MAAM,OAAS,GAAAA,CAAA,EACnC9J,EAAA,GAAA8J,EAAoB,MAAM,OAAS,KAAK,IAAIA,EAAoB,aAAc,GAAG,EAAI,KAAAA,CAAA,qjBCCjExN,EAAK,CAAA,EAAC,EAAE,cAAc,2QADzCa,EAqBKC,EAAA6F,EAAA3F,CAAA,wDApBchB,EAAK,CAAA,EAAC,EAAE,cAAc,o0BACvCa,EAiBQC,EAAAgB,EAAAd,CAAA,EAVPC,EASKa,EAAAqF,CAAA,EADJlG,EAAuEkG,EAAAC,CAAA,4LApD5DpH,EAAK,CAAA,EAAC,EAAE,gBAAgB,EAC9B,MAAAA,KAAQ,IAAGmF,EAAA,GAKNnF,EAAa,EAAA,IAAA,iBAAbA,EAAa,EAAA,yFAKvB,OAAAA,QAAqB,EAAC,mbAf5Ba,EA8DKC,EAAAM,EAAAJ,CAAA,EA7DJC,EAYKG,EAAAD,CAAA,EAXJF,EAUKE,EAAAR,CAAA,6FARUX,EAAK,CAAA,EAAC,EAAE,gBAAgB,GAC9BuB,EAAA,IAAA2O,EAAA,MAAAlQ,KAAQ,IAAGmF,EAAA,0BAKNnF,EAAa,EAAA,sKA0DSA,EAAK,CAAA,EAAC,EAAE,gBAAgB,EAAA,gQAD/Da,EAEKC,EAAA6F,EAAA3F,CAAA,EADJC,EAAwE0F,EAAA7E,CAAA,4BAAtD9B,EAAgB,CAAA,CAAA,6BAAIA,EAAK,CAAA,EAAC,EAAE,gBAAgB,EAAA,KAAAwB,GAAAmG,EAAAC,CAAA,2DArExD5H,EAAc,CAAA,CAAA,uBAAnB,OAAI0C,GAAA,4DAmEF,IAAAyN,EAAAnQ,OAAmBA,EAAO,CAAA,GAAA+B,GAAA/B,CAAA,sSApE/Ba,EAkEKC,EAAA6F,EAAA3F,CAAA,8GAjEGhB,EAAc,CAAA,CAAA,oBAAnB,OAAI0C,GAAA,EAAA,4GAAJ,OAAIA,EAAAgF,EAAA,OAAAhF,GAAA,YAmEF1C,OAAmBA,EAAO,CAAA,iGAnE5B,OAAI0C,GAAA,0IAMmBsE,IAAK,CACxB,MAAOA,EAAM,GACb,MAAOA,EAAM,KACN,MAAAA,mGApCP,MAAA7D,EAAOC,GAAW,MAAM,sBAEnB,GAAA,CAAA,eAAAmK,EAAA,CAAkB,EAAE,CAAA,EAAAnL,GACpB,SAAAgO,EAAW,EAAA,EAAAhO,GAEX,eAAAiO,EAAiB,EAAA,EAAAjO,EAEtB,MAAAkO,EAAA,SAAA,IACiB/C,EAAe,OAAQgD,GAAOA,IAAO,EAAE,EAC3C,OAAA,CACjBtM,GAAM,MAAMC,EAAM,EAAE,iCAAiC,CAAA,SAGtDsM,GAAS,IAAA,CAAA,GAASnF,EAAW,OAAQkC,CAAA,CAAA,QAC/BkD,GAAmB,aAAa,OAAS,GAAIpF,CAAA,CAAA,EAEnDpH,GAAM,QAAQC,EAAM,EAAE,uBAAuB,CAAA,wDAwDvCqJ,EAAe,OAAOmD,EAAkB,CAAC,kMArDzCnD,EAAe,OAAS,GAAKrG,EAAQ,OAAS,GACpDxD,EAAA,EAAA6J,EAAiBA,EAAe,IAAKvG,GACpCE,EAAQ,IAAK+I,GAAMA,EAAE,EAAE,EAAE,SAASjJ,CAAK,EAAIA,EAAQ,EAAA,CAAA,gbC2GlBhH,EAAK,CAAA,EAAC,EAAE,OAAO,EAAA,urBAZ/Ca,EAWKC,EAAAqG,EAAAnG,CAAA,EALJC,EAICkG,EAAAC,CAAA,WAEFvG,EAAsDC,EAAA6F,EAAA3F,CAAA,6BAAtBhB,EAAK,CAAA,EAAC,EAAE,OAAO,EAAA,KAAAwB,GAAA+D,EAAAF,CAAA,2DA2BdrF,EAAK,CAAA,EAAC,EAAE,UAAU,EAAA,2tBAflDa,EAaKC,EAAAqG,EAAAnG,CAAA,EALJC,EAICkG,EAAAC,CAAA,WAGFvG,EAAyDC,EAAA6F,EAAA3F,CAAA,6BAAzBhB,EAAK,CAAA,EAAC,EAAE,UAAU,EAAA,KAAAwB,GAAA+D,EAAAF,CAAA,qDAaJrF,EAAK,CAAA,EAAC,EAAE,qBAAqB,EAAA,gLAA1Ea,EAAiFC,EAAA6F,EAAA3F,CAAA,6BAApChB,EAAK,CAAA,EAAC,EAAE,qBAAqB,EAAA,KAAAwB,GAAAmG,EAAAC,CAAA,yCAQ7B5H,EAAK,CAAA,EAAC,EAAE,mBAAmB,EAAA,gLAAxEa,EAA+EC,EAAA6F,EAAA3F,CAAA,6BAAlChB,EAAK,CAAA,EAAC,EAAE,mBAAmB,EAAA,KAAAwB,GAAAmG,EAAAC,CAAA,yCAS3B5H,EAAK,CAAA,EAAC,EAAE,qBAAqB,EAAA,gLAA1Ea,EAAiFC,EAAA6F,EAAA3F,CAAA,6BAApChB,EAAK,CAAA,EAAC,EAAE,qBAAqB,EAAA,KAAAwB,GAAAmG,EAAAC,CAAA,4kDA1B/DE,cACA,gwBAiCC6I,EAAA,IAAAC,GAAA,CAAA,MAAA,CAAA,OAAA5Q,KAAK,EAAE,CAAA,CAAA,iaAHtBa,EAAgEC,EAAA2G,EAAAzG,CAAA,WAEhEH,EAEKC,EAAA6F,EAAA3F,CAAA,2JADUO,EAAA,IAAAsP,EAAA,OAAA7Q,KAAK,kbArHR,uCAGA8H,6MANdjH,EA2HKC,EAAA6F,EAAA3F,CAAA,gkBAzMG,OAAA8P,CAAW,EAAAC,GAUb5N,EAAOC,GAAW,MAAM,0BAEnB,aAAA4N,EAAwB,EAAA,EAAA5O,EACxB,CAAA,aAAA6O,CAAA,EAAA7O,EACA,CAAA,gBAAA8O,CAAA,EAAA9O,EAIA,CAAA,KAAA+O,CAAA,EAAA/O,EACA,CAAA,QAAA+F,EAAA,IAAA,MAEL,MAAAiJ,EAAA,SAAA,CACC,MAAAC,EAAQF,EAAK,KACnB,QAAQ,IAAI,WAAYA,CAAI,EAEtB,MAAAG,EAAWD,EAAM,SAAS,OAAQ,CAAArM,EAAGuM,EAAS7O,EAAG6D,OAC5CvB,CAAC,OAAOuM,EAAQ,KAAK,aAAA;AAAA,EAAkBA,EAAQ,OAAO;AAAA;AAAA,EAC9D,QAEChN,EAAW,IAAA,KAAA,CAAM+M,CAAQ,EAAA,CAC5B,KAAM,YAAA,CAAA,EAGPR,EAAOvM,EAAA,QAAc8M,EAAM,KAAK,MAAA,GAG3BG,EAAA,SAAA,CACC,MAAAH,EAAQF,EAAK,KACnB,QAAQ,IAAI,WAAYA,CAAI,EAEtB,MAAA5M,EAAA,MAAakN,GAAkBJ,CAAK,EAGpCnL,EAAM,OAAO,IAAI,gBAAgB3B,CAAI,EAGrCS,EAAI,SAAS,cAAc,GAAG,EACpCA,EAAE,KAAOkB,EACTlB,EAAE,SAAA,QAAmBqM,EAAM,KAAK,OAGhC,SAAS,KAAK,YAAYrM,CAAC,EAC3BA,EAAE,MAAA,EAGF,SAAS,KAAK,YAAYA,CAAC,EAG3B,OAAO,IAAI,gBAAgBkB,CAAG,GAGzBwL,EAAA,SAAA,CACD,IAAAnN,EAAA,IAAW,KAAM,CAAA,KAAK,UAAW,CAAA4M,CAAI,KACxC,KAAM,kBAAA,CAAA,EAEPL,EAAOvM,iBAAqB,KAAK,IAAA,CAAA,OAAA,UAqD9B0M,YAoDES,YAQAN,YASAI,OArHM/R,GAAC,CACRA,EAAE,SAAW,IAChB0I,seCfsDnI,EAAY,CAAA,CAAA,6NAAZA,EAAY,CAAA,i1CAkB/Da,EAoBQC,EAAAgB,EAAAd,CAAA,k2BAMMhB,EAAC,CAAA,EACZ,YACA,IAAE,0FAAA,UAJNa,EAwBQC,EAAAgB,EAAAd,CAAA,EAfPC,EAcKa,EAAA6E,CAAA,iEArBS3G,EAAC,CAAA,EACZ,YACA,IAAE,8MA0BC,KAAAA,MAAM,8JAANuB,EAAA,OAAAoQ,EAAA,KAAA3R,MAAM,qZAaJ4L,GAAAC,EAAA,IAAAC,EAAA9L,MAAM,iBAAiB,GAAAU,EAAAmL,EAAA,MAAAC,CAAA,kRAN/BjL,EAYQC,EAAAgB,EAAAd,CAAA,EARPC,EAOKa,EAAA6E,CAAA,EANJ1F,EAKC0F,EAAAkF,CAAA,UAJKtK,EAAA,MAAA,CAAAqK,GAAAC,EAAA,IAAAC,EAAA9L,MAAM,iBAAiB,kIA5GkBA,EAAO,CAAA,CAAA,EAAnCA,EAAkB,CAAA,IAAA,gBAAlBA,EAAkB,CAAA,sEAsBpCA,EAAiB,CAAA,GAAAS,GAAAT,CAAA,EAQjBM,EAAAN,EAAgB,CAAA,GAAAA,EAAQ,CAAA,GAAAA,KAAK,IAAEC,GAAAD,CAAA,2BAkClBA,EAAK,CAAA,EAAC,EAAE,UAAU,4CA4B/B,IAAAQ,EAAAR,QAAU,QAAS+B,GAAA/B,CAAA,g9BAvFhBA,EAAC,CAAA,EACN,YACA,IAAE,+EAAA,oXANTa,EAuHKC,EAAA8Q,EAAA5Q,CAAA,EAtHJC,EAqHK2Q,EAAA7Q,CAAA,EApHJE,EAmHKF,EAAAM,CAAA,EAlHJJ,EAgBKI,EAAAF,CAAA,EAXJF,EAUQE,EAAAW,CAAA,EAHPb,EAEKa,EAAAnB,CAAA,sBAGPM,EAIKI,EAAAD,CAAA,wBAELH,EA0FKI,EAAAH,CAAA,wIArH+ClB,EAAO,CAAA,2BAAnCA,EAAkB,CAAA,+CAKjCA,EAAC,CAAA,EACN,YACA,IAAE,kGAeAA,EAAiB,CAAA,oGAQjBA,EAAgB,CAAA,GAAAA,EAAQ,CAAA,GAAAA,KAAK,iIAkChBA,EAAK,CAAA,EAAC,EAAE,UAAU,sDA4B/BA,QAAU,4dA3GZ,MAAAmD,EAAOC,GAAW,MAAM,sBAEnB,GAAA,CAAA,YAAAyO,CAAA,EAAAzP,GACA,MAAA0P,EAAgBC,CAAA,EAAA3P,GAChB,aAAA4O,EAAwB,EAAA,EAAA5O,EAExB,CAAA,KAAA+O,CAAA,EAAA/O,EACA,CAAA,eAAAmL,CAAA,EAAAnL,GAEA,kBAAA4P,EAAoB,EAAA,EAAA5P,EAE3B6P,EAAqB,GACrBC,EAAwB,iBAGFD,EAAkB/S,sBAavCiT,GAAY,IAAG,CAAEC,CAAY,yCAsB5B1O,EAAA,EAAAuO,GAAsBA,CAAkB,UAGxCvO,EAAA,EAAAwO,GAAyBA,CAAqB,UAiC9CL,OAyBSpS,GAAC,CACNA,EAAE,SAAW,iBAChB4S,GAAkB,IAAI,EAAI,+xBC9F1B7S,EAAAQ,EAAM,EAAA,IAAN,YAAAR,EAAQ,QAAS,UAAQ,yQAF5BqB,EAIKC,EAAAK,EAAAH,CAAA,EAHJC,EAEKE,EAAAR,CAAA,+CADHnB,EAAAQ,EAAM,EAAA,IAAN,YAAAR,EAAQ,QAAS,UAAQ,KAAAgC,GAAAC,EAAAvB,CAAA,ihBATvBF,EAAO,CAAA,CAAA,uBAAZ,OAAI0C,GAAA,gQAAC1C,EAAO,CAAA,CAAA,oBAAZ,OAAI0C,GAAA,EAAA,oHAAJ,OAAIA,EAAAgF,EAAA,OAAAhF,GAAA,0CAAJ,OAAI,GAAA,0UALM,sCAGAoF,6MANdjH,EAuBKC,EAAA6F,EAAA3F,CAAA,orBA5CQoC,GAAW,MAAM,QACxBpB,EAAWC,KAIN,GAAA,CAAA,QAAAkG,EAAA,IAAA,MACA,CAAA,QAAAmK,CAAA,EAAAlQ,EAEPgG,EAAO,eAyBNpG,EAAS,SAAUuQ,EAAO,QAAQ,oCApB3B9S,GAAC,CACRA,EAAE,SAAW,IAChB0I,8kBC2jBMnI,EAAM,CAAA,GAAAwS,GAAAxS,CAAA,yBA4EJA,EAAM,CAAA,KAAAK,iEA8GNL,EAAM,CAAA,EAAA,kDAqEJA,EAAO,CAAA,EAAAC,GAEFD,EAAiB,CAAA,EAAAS,s+CAtQlCI,EAsSKC,EAAA6B,EAAA3B,CAAA,EArSJC,EAoSK0B,EAAAC,CAAA,EAjSJ3B,EAgSK2B,EAAAC,CAAA,wBApNJ5B,EA2GK4B,EAAAlC,CAAA,qBAELM,EAsGK4B,EAAA9B,CAAA,EArGJE,EA0DKF,EAAAI,CAAA,wBAELF,EAmBKF,EAAAG,CAAA,EAlBJD,EAiBQC,EAAAuR,CAAA,EATPxR,EAQKwR,EAAArR,CAAA,qBAIPH,EAmBKF,EAAAM,CAAA,EAlBJJ,EAiBQI,EAAAqR,CAAA,qEA5RL1S,EAAM,CAAA,gdAUJA,EAAK,CAAA,EAAAqM,GAaArM,MAAWA,EAAiB,CAAA,EAAA2S,wPAtBvC9R,EAuEQC,EAAAgB,EAAAd,CAAA,sRAVIhB,EAAQ,CAAA,EAAG,IAAM,EACvB,iBACAA,EAAQ,CAAA,EAAG,IAAM,EACjB,WACAA,KAAW,IAAM,EACjB,UACA,WAAS,qDAAA,UAPba,EAQCC,EAAA6F,EAAA3F,CAAA,2BAPShB,EAAQ,CAAA,EAAG,IAAM,EACvB,iBACAA,EAAQ,CAAA,EAAG,IAAM,EACjB,WACAA,KAAW,IAAM,EACjB,UACA,WAAS,gKAvCL;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SAwBP,mKAxBO;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SAwBP,+mBA7BDa,EAmCAC,EAAAqG,EAAAnG,CAAA,EA9BEC,EAwBOkG,EAAAoF,CAAA,SAAAtL,EAAoDkG,EAAAqF,CAAA,EAAAvL,EAK1DkG,EAAAsF,CAAA,EAAAxL,EAAkEkG,EAAAuF,CAAA,yEArCnE1M,EAAK,CAAA,CAAA,oEAALA,EAAK,CAAA,CAAA,0FARYA,EAAQ,CAAA,EAAG,IAAM,EAChC,MACAA,EAAQ,CAAA,EAAG,IAAM,EACjB,OACAA,KAAW,IAAM,EACjB,OACA,OAAK,KAAA,2DARTa,EAWKC,EAAA6F,EAAA3F,CAAA,8BADHhB,EAAK,CAAA,CAAA,6BARYA,EAAQ,CAAA,EAAG,IAAM,EAChC,MACAA,EAAQ,CAAA,EAAG,IAAM,EACjB,OACAA,KAAW,IAAM,EACjB,OACA,OAAK,KAAA,+rCAiIVa,EAgCKC,EAAAK,EAAAH,CAAA,EA7BJC,EAKCE,EAAAyR,CAAA,SAED3R,EAAkDE,EAAA0R,CAAA,SAElD5R,EAmBKE,EAAAR,CAAA,EAlBJM,EAiBQN,EAAAmB,CAAA,gHA7FJ9B,EAAK,CAAA,EAAA8S,GAaA9S,MAAWA,EAAiB,CAAA,EAAAsM,0KArBvCzL,EAqEQC,EAAAgB,EAAAd,CAAA,sRATIhB,EAAQ,CAAA,EAAG,IAAM,EACvB,WACAA,EAAQ,CAAA,EAAG,IAAM,EACjB,UACAA,EAAQ,CAAA,EAAG,IAAM,EACjB,iBACA,WAAS,qDAAA,UAPba,EAQCC,EAAA6F,EAAA3F,CAAA,2BAPShB,EAAQ,CAAA,EAAG,IAAM,EACvB,WACAA,EAAQ,CAAA,EAAG,IAAM,EACjB,UACAA,EAAQ,CAAA,EAAG,IAAM,EACjB,iBACA,WAAS,gKAvCL;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,UAwBP,mKAxBO;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,UAwBP,+mBA7BDa,EAmCAC,EAAAqG,EAAAnG,CAAA,EA9BEC,EAwBOkG,EAAAoF,CAAA,SAAAtL,EAAoDkG,EAAAqF,CAAA,EAAAvL,EAK1DkG,EAAAsF,CAAA,EAAAxL,EAAkEkG,EAAAuF,CAAA,yEArCnE1M,EAAK,CAAA,CAAA,oEAALA,EAAK,CAAA,CAAA,0FARYA,EAAQ,CAAA,EAAG,IAAM,EAChC,KACAA,EAAQ,CAAA,EAAG,IAAM,EACjB,KACAA,KAAW,IAAM,EACjB,OACA,MAAI,KAAA,2DARRa,EAWKC,EAAA6F,EAAA3F,CAAA,8BADHhB,EAAK,CAAA,CAAA,6BARYA,EAAQ,CAAA,EAAG,IAAM,EAChC,KACAA,EAAQ,CAAA,EAAG,IAAM,EACjB,KACAA,KAAW,IAAM,EACjB,OACA,MAAI,KAAA,yEAsHSA,EAAK,CAAA,EAAC,EAAE,QAAQ,4JAAhBA,EAAK,CAAA,EAAC,EAAE,QAAQ,gMAxBxBA,EAAiB,CAAA,iLAAjBA,EAAiB,CAAA,wmCAyB1Ba,EA2BQC,EAAAgB,EAAAd,CAAA,43BA5CRH,EAaQC,EAAAgB,EAAAd,CAAA,4CAmDNhB,EAAK,CAAA,EAAC,EAAE,cAAc,EAAA,kFAAtBA,EAAK,CAAA,EAAC,EAAE,cAAc,EAAA,KAAAwB,GAAA,EAAAoG,CAAA,uCAFtB5H,EAAK,CAAA,EAAC,EAAE,kBAAkB,EAAA,kFAA1BA,EAAK,CAAA,EAAC,EAAE,kBAAkB,EAAA,KAAAwB,GAAA,EAAAoG,CAAA,uCAF1B5H,EAAK,CAAA,EAAC,EAAE,aAAa,EAAA,kFAArBA,EAAK,CAAA,EAAC,EAAE,aAAa,EAAA,KAAAwB,GAAA,EAAAoG,CAAA,2CAtQ1B5H,EAAgB,CAAA,GAAA+B,GAAA/B,CAAA,8FAAhBA,EAAgB,CAAA,+QAvjBd,MAAAmD,EAAOC,GAAW,MAAM,sBAEnB,GAAA,CAAA,YAAA2P,CAAA,EAAA3Q,EAEA,CAAA,aAAA+K,CAAA,EAAA/K,EACA,CAAA,aAAAgL,CAAA,EAAAhL,EAEA,CAAA,MAAAiB,CAAA,EAAAjB,EAEA,CAAA,OAAA4Q,CAAA,EAAA5Q,EACA,CAAA,QAAA6Q,CAAA,EAAA7Q,EAEPuG,EAAU,GACVC,EAAY,GAEZsK,EAAoB,GAEpBC,EAAQ,KAERC,EAAS,GACTC,EAAe,KAEfC,EAAgB,GAEhB3I,EAAW,EACX4I,EAAqB,GACrB/J,EACAC,EAAA,CAAA,EAEA+J,EAAA,CAAA,EACAC,EAA6B,KAE3B,MAAAC,EAAA,SAAA,CACC,MAAApB,EAAA,MAAgB,UAAU,aAAa,iBAAA,EAC7C5O,EAAA,EAAA8P,EAAoBlB,EAAQ,OAAQC,IAAWA,GAAO,OAAS,YAAY,CAAA,EAErE,UAAU,aAAa,iBAC5B7O,EAAA,EAAA8P,EAAA,CACI,GAAAA,GAEF,SAAU,SACV,MAAO,kBAKV,QAAQ,IAAIA,CAAiB,EACzBC,IAA+B,MAAQD,EAAkB,OAAS,OACrEC,EAA6BD,EAAkB,CAAC,EAAE,QAAA,GAI9CG,EAAA,SAAA,IACC,MAAAD,EAAA,EAEFL,IAAiB,KAAA,KACpBD,EAAS,EAAA,EACH,MAAA3O,GAAA,MAEC,MAAAmP,GAAA,CACE,OAAA5P,EAAA,CACR,QAAQ,MAAM,2BAA4BA,CAAG,KAK1C4P,GAAA,SAAA,OACChB,EAAQ,SAAS,eAAe,aAAa,EAC/CA,IACCa,IAA+B,SAClCJ,EAAA,MAAqB,UAAU,aAAa,gBAAA,CAC3C,MAAA,CACC,OAAQ,QAAA,EAET,MAAO,KAGRA,EAAA,MAAqB,UAAU,aAAa,aAAA,CAC3C,MAAA,CACC,SAAUI,GAA+B,MAAOA,CAAA,EAA+B,UAK9EJ,IACG,MAAAK,EAAA,EACNd,EAAM,UAAYS,QACZT,EAAM,UAKTiB,GAAA,SAAA,CACDR,GACYA,EAAa,YACrB,QAASS,IAAUA,GAAM,KAAA,CAAA,EAGjCT,EAAe,MAGVU,EAAA,IAAA,OACCnB,EAAQ,SAAS,eAAe,aAAa,EAC7CC,GAAS,SAAS,eAAe,eAAe,EAEjD,GAAA,CAAAA,gBAICmB,GAAUnB,GAAO,WAAW,IAAI,EAGtCA,GAAO,MAAQD,EAAM,WACrBC,GAAO,OAASD,EAAM,YAGtBoB,GAAQ,UAAUpB,EAAO,EAAG,EAAGA,EAAM,WAAYA,EAAM,WAAW,QAG5DqB,GAAUpB,GAAO,UAAU,WAAW,EAC5C,eAAQ,IAAIoB,EAAO,EAEZA,IAGFC,EAAA,SAAA,CACC,MAAAL,GAAA,MACNT,EAAS,EAAA,GAGJ1J,EAAe,IAGfkB,EAA2B,MAAAC,GAAA,CAG1B,MAAApG,GAAA,QACAqG,GAAOC,GAAWF,EAAW,eAAe,EAE5CG,GAAA,MAAYC,GAAgB,aAAa,MAAOH,EAAI,EAAE,MAAOI,KAClEjH,GAAM,MAAMiH,EAAK,EACV,OAGJ,GAAAF,KACH,QAAQ,IAAIA,GAAI,IAAI,EAEhBA,GAAI,OAAS,IAAA,OACVmJ,GAAmB,MAAAhH,EAAanC,GAAI,KAAA,CAAQ,KAAM,EAAA,CAAA,EACxD,QAAQ,IAAImJ,EAAU,IAKnBC,GAAA,MAA+BC,EAAY,KAAA,CAC5C,GAAAC,EAAA,CACH,QAAQ,IAAI,OAAQ,+BAAgC,6BAA6B,QAG3EC,GAAe9K,EAAY,MAAM,CAAC,EASpC,GAPJA,EAAA,CAAA,EACAD,EAAgB,GAEZ6K,GACHlJ,KAGGvC,EAAA,CAIC,OAHJD,EAAU,EAAA,MACVwK,EAAQ,IAAA,EAEJE,EAAA,OACGjP,GAAW2P,SAEjB1Q,EAEE,CAAA,CAAA,KAAM,QACN,IAAKe,EAAA,CAAA,CAAA,QAKFyG,GAAgB,IAAA,KAAK0J,IAAgB,KAAM,WAAA,CAAA,EAC3C,MAAA3J,EAAkBC,EAAS,EAEjCjC,EAAY,OACZD,EAAU,EAAA,QAGXc,EAAA,CAAA,EACAD,EAAgB,IAIZ2B,GAAA,SAAA,OACChB,EAAe,MAAA,UAAU,aAAa,aAAA,CAAe,MAAO,EAAA,CAAA,EAClEX,EAAA,IAAoB,cAAcW,CAAM,EAExCX,EAAc,QAAA,IAAA,CACb,QAAQ,IAAI,mBAAmB,EAC/BC,EAAA,CAAA,EACAS,GAAaC,CAAM,GAGpBX,EAAc,gBAAmB4B,IAAA,CAC5BmI,GACH9J,EAAY,KAAK2B,GAAM,IAAI,GAI7B5B,EAAc,OAAU/J,IAAA,CACvB,QAAQ,IAAI,oBAAqBA,EAAC,EAClC2U,MAGD5K,EAAc,MAAA,GAITI,GAAgBxK,GAAA,KACjByK,GAAa,UACRnH,GAAI,EAAGA,GAAItD,EAAK,OAAQsD,KAAA,OAC1BoH,IAAmB1K,EAAKsD,EAAC,EAAI,KAAO,IAC1CmH,IAAcC,GAAkBA,UAE1B,KAAK,KAAKD,GAAazK,EAAK,MAAM,GAGpC8K,GAAgBC,GAAA,OACfC,GAAmB,IAAA,aACnBC,GAAoBD,GAAa,wBAAwBD,CAAM,EAE/DG,GAAWF,GAAa,iBAC9BE,GAAS,YAAcZ,EACvBW,GAAkB,QAAQC,EAAQ,EAE5B,MAAAC,GAAeD,GAAS,kBAExBE,GAAA,IAAiB,WAAWD,EAAY,EACxCE,GAAqB,IAAA,WAAWH,GAAS,OAAO,EAElD,IAAAkK,GAAgB,KAAK,MACzBjB,EAAqB,GAErB,QAAQ,IAAI,6BAA8BiB,GAAejB,CAAkB,GAErE,IAAA,CACC,MAAA7I,GAAA,IAAA,KACAlB,GAAkB,CAAA8K,SAkCnB,GA9BApB,GAEH5I,GAAS,YAAc,EACvBA,GAAS,YAAc,KAEvBA,GAAS,YAAcZ,EACvBY,GAAS,YAAc,KAGxBA,GAAS,sBAAsBG,EAAc,EAC7CH,GAAS,qBAAqBE,EAAU,EAGxC9G,EAAA,EAAAiH,EAAWf,GAAaa,EAAc,CAAA,EAGrBD,GAAW,KAAMtL,IAAUA,GAAQ,CAAC,IAGpD,QAAQ,IAAI,OAAQ,+BAAgC,mBAAmB,EAElEqU,IACJA,EAAqB,GACrBkB,KAGDD,GAAgB,KAAK,OAIlBjB,GACC,KAAK,MAAQiB,GAAgB,MAChC5L,EAAY,GAERY,GAAA,CACH,QAAQ,IAAI,OAAQ,+BAAgC,qBAAqB,EACzEA,EAAc,KAAA,SAMjB,OAAO,sBAAsBkB,EAAY,GAG1C,OAAO,sBAAsBA,EAAY,OAMvC,IAAAgK,GAAA,CAAA,EACAC,GAAmB,KACnBC,EAAmB,WAEjBC,GAA+BlV,GAChC2U,MACQ,QAASvU,IAAA,CACf,IAAA+U,GAAA,CAAA,QACEC,GAAgB,6BAEjB,GADJD,GAAA,MAAe,gBAAgB,YAC3BA,GAAO,OAAS,EAAA,CACnB,cAAcC,EAAa,EAErB,MAAAC,KACLxV,GAAAsV,IAAA,YAAAA,GACG,OACAG,IAAM,iBAAA,OAAAA,GAAE,cAAc1V,IAAAC,GAAA6L,GAAA,YAAAA,EAAW,QAAX,YAAA7L,GAAkB,MAAlB,YAAAD,GAAuB,UAASyQ,IAAA1Q,GAAAgM,GAAA,YAAAA,EAAS,QAAT,YAAAhM,GAAgB,MAAhB,YAAA0Q,GAAqB,YAF9E,YAAAxQ,GAIG,GAAG,KAAM,OAEboV,EAAA,IAAuB,yBAAyBjV,CAAO,EAEnDqV,KACHJ,EAAiB,MAAQI,IAG1B,gBAAgB,MAAMJ,CAAgB,EACtCA,EAAiB,MAAe,MAAAnV,IAAA,WACrB,QAASyV,IAAM,WAAWA,GAAG,GAAG,CAAA,EAC1CnV,GAAQN,EAAC,KAGT,OAGG,QAAQ,UAIX0V,GAAaC,GACdd,MACQ,QAASvU,IAAA,OACbsV,GAAe,SAAS,eAAe,cAAc,EAEvDA,KACHA,GAAa,IAAMD,EAAM,IACzBC,GAAa,MAAQ,GAErBA,GACE,OACA,KAAA,IAAA,CACAA,GAAa,MAAQ,KAErB,MAAOnK,IAAA,CACP,QAAQ,MAAMA,EAAK,IAGrBmK,GAAa,QAAiB,MAAA5V,IAAA,WACnB,QAASyV,IAAM,WAAWA,GAAG,GAAG,CAAA,EAC1CnV,GAAQN,EAAC,MAKL,QAAQ,UAIXgV,EAAA,SAAA,KACLvB,EAAoB,EAAA,EAGhBI,GACHlG,IAGGwH,IACH,gBAAgB,OAAA,EAChBA,EAAmB,YAGdS,EAAe,SAAS,eAAe,cAAc,EACvDA,IACHA,EAAa,MAAQ,GACrBA,EAAa,MAAA,EACbA,EAAa,YAAc,QAIzBC,EAA2B,IAAA,gBAGzB,MAAAC,GAAiB,IAAA,IACjBC,GAAiB,IAAA,IAEjBC,GAAoB,MAAA9V,GAAA,iBACpB,GAAA,CAAA4V,GAAW,IAAI5V,CAAO,MAGrB,IAAA0L,GAAA,YAAAA,EAAW,kBAAmB,GAAA,CAC3B8H,MAAAA,GAAAA,MAAcuC,GAAc,aAAa,MAAOzC,EAAStT,EAASqT,CAAM,EAC1EG,IACHqC,GAAW,IAAI7V,EAASwT,EAAK,KAI3B7H,EAAQ,MAAM,IAAI,SAAW,GAAA,CAC1B,MAAAN,GAAA,MAAY2K,GACjB,aAAa,QACbpW,IAAAC,GAAA6L,GAAA,YAAAA,EAAW,QAAX,YAAA7L,GAAkB,MAAlB,YAAAD,GAAuB,UAASyQ,IAAA1Q,GAAAgM,GAAA,YAAAA,EAAS,QAAT,YAAAhM,GAAgB,MAAhB,YAAA0Q,GAAqB,OACrDrQ,CAAA,EACC,MAAOuL,KACR,QAAQ,MAAMA,EAAK,EACZ,OAGJ,GAAAF,GAAA,CACG,MAAAzG,GAAA,MAAayG,GAAI,OACjB4K,GAAU,IAAI,gBAAgBrR,EAAI,EACxCgR,GAAW,IAAI5V,EAAa,IAAA,MAAMiW,EAAO,CAAA,QAG1CL,GAAW,IAAI5V,EAAS,EAAI,CAErB,OAAAuL,GAAA,CACR,QAAQ,MAAM,6BAA8BA,EAAK,EAI5C,OAAAqK,GAAW,IAAI5V,CAAO,GAG1B,IAAAmH,GAAA,CAAA,EAEE,MAAA+O,GAAA,MAA6BrT,EAAIsT,KAAA,OAC9BA,GAAO,SACV,GAAAhP,GAAStE,CAAE,GAAKsE,GAAStE,CAAE,EAAE,OAAS,EAAA,OAEnC7C,GAAUmH,GAAStE,CAAE,EAAE,MAAA,EAEzB,GAAA+S,GAAW,IAAI5V,EAAO,OAIpB0L,GAAA,YAAAA,EAAW,kBAAmB,KAAUmK,GAAW,IAAI7V,EAAO,MAClEwT,EAAQqC,GAAW,IAAI7V,EAAO,CAAA,MAE9BwT,EAAQ,IAAA,EAGL7H,EAAQ,MAAM,IAAI,SAAW,OAE/B,QAAQ,IACP,OACA,+BAAA,8BAC8B3L,EAAO,EAAA,QAGhCyV,GAAQG,GAAW,IAAI5V,EAAO,EAC9B,MAAAwV,GAAUC,EAAK,EACrB,QAAQ,iCAAiCzV,EAAO,EAAA,YACtC,QAASI,IAAY,WAAWA,GAAS,GAAG,CAAA,CAC9C,OAAAmL,GAAA,CACR,QAAQ,MAAM,uBAAwBA,EAAK,OAGtC,MAAA2J,GAA4BlV,EAAO,OAI1CmH,GAAStE,CAAE,EAAE,QAAQ7C,EAAO,EAC5B,QAAQ,kBAAkBA,EAAO,gDAAA,YACvB,QAASI,IAAY,WAAWA,GAAS,GAAG,CAAA,UAE7C2U,GAAiBlS,CAAE,GAAKsE,GAAStE,CAAE,GAAKsE,GAAStE,CAAE,EAAE,SAAW,EAAA,KAE1E0Q,EAAoB,EAAA,uBAIV,QAASnT,IAAY,WAAWA,GAAS,GAAG,CAAA,EAGxD,QAAQ,2DAA2DyC,CAAE,EAAA,GAGtEC,GAAA,SAAA,CACC0I,WAEM4K,EAA0B,MAAAtW,IAAA,CACvB,KAAA,CAAA,GAAA+C,EAAA,EAAO/C,GAAE,OAEjB6T,EAAgB,GAEZqB,KAAqBnS,KACxB,QAAQ,gDAAgDA,EAAE,EAAA,EAE1DmS,GAAmBnS,GACf8S,GACHA,EAAqB,MAAA,EAEtBA,EAA2B,IAAA,oBAE3BpC,EAAoB,EAAA,EAEpB2C,GAAoBrT,GAAI8S,EAAqB,MAAM,IAI/CU,GAA0B,MAAAvW,IAAA,CACvB,KAAA,CAAA,GAAA+C,GAAI,QAAA7C,IAAYF,GAAE,UAMtBkV,KAAqBnS,GAAA,CACxB,QAAQ,IAAA,sCAA0CA,EAAE,KAAK7C,EAAO,EAAA,MAG3DmH,GAAStE,EAAE,IAAM,OACpBsE,GAAStE,EAAE,GAAK7C,EAAO,EAEvBmH,GAAStE,EAAE,EAAE,KAAK7C,EAAO,EAG1B,QAAQ,IAAIA,EAAO,EAEnB8V,GAAW9V,EAAO,CACV,OAAAuL,GAAA,CACR,QAAQ,MAAM,iCAAkCA,EAAK,KAKlD+K,GAA2B,MAAAxW,IAAA,CACxB,KAAA,CAAA,GAAA+C,GAAI,QAAA7C,IAAYF,GAAE,OAE1BiV,GAAiBlS,EAAE,EAAI,GAEvB8Q,EAAgB,IAGjB,OAAAP,EAAY,iBAAiB,aAAcgD,CAAgB,EAC3DhD,EAAY,iBAAiB,OAAQiD,EAAgB,EACrDjD,EAAY,iBAAiB,cAAekD,EAAiB,YAG5DlD,EAAY,oBAAoB,aAAcgD,CAAgB,EAC9DhD,EAAY,oBAAoB,OAAQiD,EAAgB,EACxDjD,EAAY,oBAAoB,cAAekD,EAAiB,EAEhEX,EAAqB,MAAA,EACf,MAAA7Q,GAAA,EAEA,MAAAgQ,EAAA,EAEA,MAAAL,GAAsB,EAAK,EAC3B,MAAAF,EAAA,mBAgBEhB,GACHuB,aA0EIvB,GACHuB,aAoFCP,cAwBgBzU,GAAC,CAClB,QAAQ,IAAIA,EAAE,MAAM,MACpBgU,EAA6BhU,EAAE,MAAM,QAC/BoU,GAAe,QACfD,GAAgB,gBAwBf,MAAA,UAAU,aAAa,aAAe,CAAA,MAAO,EAAI,CAAA,EACvDD,aA+BET,GACHuB,kBAoBD1E,GAAgB,IAAI,EAAK,ooBCmctB,UAAAvQ,EAAAQ,EAAkB,CAAA,IAAlB,YAAAR,EAAkB,GAAG,KAAM,YAC5BQ,EAAO,EAAA,8MADNuB,EAAA,CAAA,EAAA,MAAA2U,EAAA,UAAA1W,EAAAQ,EAAkB,CAAA,IAAlB,YAAAR,EAAkB,GAAG,KAAM,4BAC5BQ,EAAO,EAAA,ySAeAA,EAAQ,EAAA,EAAC,OAAS,wNAK5B,IAAAmQ,EAAAnQ,MAAS,OAAS,GAAKA,EAAS,EAAA,EAAA,SAAW,IAAMA,EAAO,EAAA,GAAIA,EAAe,CAAA,EAAA,QAAU,GAACC,GAAAD,CAAA,8GAwC/EA,EAAO,EAAA,kDAOAA,EAAK,EAAA,EAAC,OAAS,6fAcd,iBAAAA,KAAiB,OAAMA,EAAA,EAAA,EAAA,EAAA,8hCAvBCA,EAAU,CAAA,EAAG,OAAS,YAAW,oNAnD7CA,EAAC,EAAA,EAC9B,8BACA,IAAE,kCAAA,UAHNa,EAwFKC,EAAAI,EAAAF,CAAA,4CA/CJC,EA8CKC,EAAAE,CAAA,EA7CJH,EAyBKG,EAAAD,CAAA,EAfJF,EAcKE,EAAAR,CAAA,+JAzDQX,EAAQ,EAAA,EAAC,OAAS,4JAK5BA,MAAS,OAAS,GAAKA,EAAS,EAAA,EAAA,SAAW,IAAMA,EAAO,EAAA,GAAIA,EAAe,CAAA,EAAA,QAAU,4IAwC9EA,EAAO,EAAA,kEAOAA,EAAK,EAAA,EAAC,OAAS,+QATUA,EAAU,CAAA,EAAG,OAAS,2CAuB9CuB,EAAA,CAAA,EAAA,SAAA4U,GAAA,iBAAAnW,KAAiB,OAAMA,EAAA,EAAA,EAAA,CAAA,CAAA,8cA1EXA,EAAC,EAAA,EAC9B,8BACA,IAAE,uSAgBKoW,EAAAC,GAAArW,MAAS,OAAMA,EAAA,EAAA,CAAA,CAAA,uBAApB,OAAI0C,GAAA,+XAH+B1C,EAAY,EAAA,EAAG,8BAAgC,GAAE,UADxFa,EAuBKC,EAAAK,EAAAH,CAAA,EApBJC,EAmBKE,EAAAR,CAAA,iFAlBGyV,EAAAC,GAAArW,MAAS,OAAMA,EAAA,EAAA,CAAA,CAAA,oBAApB,OAAI0C,GAAA,EAAA,4GAAJ,OAAIA,EAAAgF,EAAA,OAAAhF,GAAA,wEAH+B1C,EAAY,EAAA,EAAG,8BAAgC,mDAGlF,OAAI0C,GAAA,ybAvCR4T,GAAA,MAAAC,EAAA;AAAA,KAAAvW,EAAA,EAAA,KACKA,EAAK,EAAA,EAAC,OAAS,GAAQ,GAAAA,EAAM,EAAA,EAAA,MAAM,EAAG,EAAE,CAAA,MAASA,WAAWA,EAAW,EAAA,CAAA,MACvEA,EAAW,EAAA,CAAA,IAAA;AAAA,SAMdA,EAAgB,EAAA,GAAAS,GAAAT,CAAA,MAWfA,EAAU,CAAA,GAAKA,EAAM,CAAA,GAAIA,EAAU,CAAA,IAAA+B,GAAA/B,CAAA,+UAbzCa,EAAwDC,EAAAsU,EAAApU,CAAA,mEANrD,CAAAM,GAAAC,EAAA,CAAA,EAAA,SAAAgV,KAAAA,EAAA;AAAA,KAAAvW,EAAA,EAAA,KACKA,EAAK,EAAA,EAAC,OAAS,GAAQ,GAAAA,EAAM,EAAA,EAAA,MAAM,EAAG,EAAE,CAAA,MAASA,WAAWA,EAAW,EAAA,CAAA,MACvEA,EAAW,EAAA,CAAA,IAAA;AAAA,kBAMdA,EAAgB,EAAA,oHAWfA,EAAU,CAAA,GAAKA,EAAM,CAAA,GAAIA,EAAU,CAAA,4NA9tCpCwW,GAAa,oSATX,MAAArT,EAA2BC,GAAW,MAAM,2BAEvC,WAAAqT,EAAa,EAAA,EAAArU,EACpBsU,EAAS,SAEP3D,EAAkB,IAAA,gBAEpB4D,EAAmB,GACnBtJ,EAAa,GAEbuJ,EAEA5E,EAAoB,GAEpBzE,EAAA,CAAkB,EAAE,EACpBD,EAEAuJ,EAAA,CAAA,EAGA7O,EAAA,CAAA,EACAC,EAAmB,GAEnBkJ,EAAO,KAGPW,GAAQ,GACRxO,GAAS,GACTD,EAAA,CAAA,EACAyD,EAAA,CAAA,EACAgQ,EAAA,CACH,YACA,UAAW,IAAA,EAiCZrU,GAAA,SAAA,CACMsU,GAOE1L,EAAU,iBAAmB,KAC5B,MAAA2L,GAAK,GAAG,EAPfhE,GAAO,UAAiB,MAAA9T,GAAA,CAClBA,GACE,MAAA2S,EAAA,MAcJ,MAAAA,EAAA,SAAA,QACL,OAAO,QAAQ,aAAaiF,EAAQ,MAAO,GAAA,GAAA,EACrC,MAAA9D,GAAO,IAAI,EAAE,MAEnB3F,EAAa,EAAA,OAEbyE,GAAQ,EAAA,EACRpO,EAAA,GAAAoD,EAAA,CAAA,CAAA,EACApD,EAAA,EAAAoT,EAAA,CACC,YACA,UAAW,IAAA,CAAA,EAGRG,EAAM,IAAI,aAAa,IAAI,QAAQ,EACtCvT,EAAA,EAAA6J,GAAiB/N,GAAAyX,EAAM,IAAI,aAAa,IAAI,QAAQ,IAAnC,YAAAzX,GAAsC,MAAM,IAAG,EACtD6L,GAAA,MAAAA,EAAW,OACrB3H,EAAA,EAAA6J,EAAiBlC,GAAA,YAAAA,EAAW,MAAA,EAClBC,GAAA,MAAAA,EAAS,gBACnB,QAAQ,KAAIA,GAAA,YAAAA,EAAS,eAAe,MAAM,OAAQ,EAAE,MACpDiC,EAAiBjC,GAAA,YAAAA,EAAS,eAAe,MAAM,IAAG,GAElD5H,EAAA,EAAA6J,EAAA,CAAkB,EAAE,CAAA,EAGjB0J,EAAM,IAAI,aAAa,IAAI,GAAG,IACjCvT,EAAA,GAAAJ,GAAS2T,EAAM,IAAI,aAAa,IAAI,GAAG,GAAK,EAAA,EAExC3T,KACG,MAAAmB,GAAA,EACN0I,GAAa7J,EAAM,QAIrBiK,EAAiBA,EAAe,IAAK0F,GACpC/L,EAAQ,IAAK+I,IAAMA,GAAE,EAAE,EAAE,SAASgD,CAAO,EAAIA,EAAU,EAAA,CAAA,QAGlDiE,EAAqB,MAAAC,GAAgB,aAAa,KAAK,EAEzDD,EACH1G,GAAS,IAAI0G,EAAa,EAAE,EAE5B1G,GAAS,IAAI,KAAK,MAAM,aAAa,QAAQ,UAAU,GAAK,IAAI,CAAA,QAG3D4G,EAAY,SAAS,eAAe,eAAe,EACzD,WAAiB,IAAAA,GAAA,YAAAA,EAAW,QAAS,CAAC,GAGjCC,GAAA,SAAA,CAOD,GANJrE,GAAO,IAAIyD,CAAU,EACrB/S,EAAA,GAAAyN,EAAA,MAAamG,GAAY,aAAa,MAAOP,CAAO,EAAE,MAAa7L,MAAAA,IAC5D,MAAA8L,GAAK,GAAG,EACP,QAGJ7F,EAAA,CACU,MAAAoG,GAAA,EACP,MAAAC,EAAcrG,EAAK,KAErB,GAAAqG,EAAA,CACH,QAAQ,IAAIA,CAAW,MAEvBjK,IACEiK,GAAA,YAAAA,EAAa,mBAAyB,OACpCA,EAAY,OACX,CAAAA,EAAY,QAAU,EAAE,CAAA,MAC7BV,IACEU,GAAA,YAAAA,EAAa,oBAA0B,OACrCA,EAAY,QACZC,GAAyBD,EAAY,QAAQ,CAAA,EACjD9T,EAAA,GAAAoO,GAAQ0F,EAAY,KAAA,QAEdN,EAAqB,MAAAC,GAAgB,aAAa,KAAK,EAEzD,OAAAD,QACG1G,GAAS,IAAI0G,EAAa,EAAE,EAE5B,MAAA1G,GAAS,IAAI,KAAK,MAAM,aAAa,QAAQ,UAAU,GAAK,IAAI,CAAA,QAGjEA,GAAS,IAAA,CACX,GAAAnF,EACH,OAAQmM,EAAY,QAAUnM,EAAU,OACxC,OAAQmM,EAAY,SAAWnM,EAAU,aAG1CgC,EAAa,EAAA,EACP,MAAA5I,GAAA,EAEFqC,EAAS,OAAS,GACrBpD,EAAA,EAAAoT,EAAQ,SAAShQ,EAAS,GAAA,EAAK,EAAE,EAAE,EAAE,KAAO,GAAAgQ,CAAA,EAEvC,MAAArS,GAAA,EAEC,OAEA,QAAA,OAKJwJ,GAAA,SAAA,CACC,MAAAxJ,GAAA,EACFmS,GACHlT,EAAA,EAAAkT,EAAyB,UAAYA,EAAyB,aAAAA,CAAA,GAI1Dc,GAAsBC,GAAA,OACrBpG,EAAUuF,EAAQ,SAASa,CAAiB,SAC9CpG,EAAQ,aACAmG,GAAmBnG,EAAQ,QAAQ,EAAGA,CAAO,GAEhDA,CAAO,GAIXqG,GAAA,MAA8B3E,EAASnM,IAAAA,CACtC,MAAA+Q,GAAQ,KACb,cAAe,UAAA,CAAA,EAGV,MAAA7M,GAAA,MAAY8M,GAAc,aAAa,MAAA,CAC5C,MAAO7E,EACP,SAAUnM,EAAS,IAAKmJ,IAAA,CACvB,GAAIA,EAAE,GACN,KAAMA,EAAE,KACR,QAASA,EAAE,QACX,UAAWA,EAAE,aAEd,QAAS8G,IACP,MAAO7L,IACT,QAAQ,MAAMA,CAAK,EACZ,UAGJF,KAAQ,KAEA,UAAAuG,KAAWvG,GAAI,aACzB8L,EAAQ,SAASvF,EAAQ,EAAE,EAAA,IACvBuF,EAAQ,SAASvF,EAAQ,EAAE,EAC1B,GAAAuF,EAAQ,SAASvF,EAAQ,EAAE,EAAE,UAAYA,EAAQ,SAChD,gBAAiBuF,EAAQ,SAASvF,EAAQ,EAAE,EAAE,YAEhD,GAAAA,OAMDwG,GAAA,MAA6B9E,EAAiBD,EAAiB,KAC7D,iBACNgF,GAAA,MAAAA,EAAS,KAAK,QAAA,CACb,OAAQ,OACR,MAAO/E,EACP,QAASD,KAER,KAOE7F,GAAA,MAAsB8K,GAAc,KAAAC,EAAO,EAAA,EAAA,KAAA,CAC5C,IAAA/D,GAAA,CAAA,EAOA,GANJ,QAAQ,IAAI,eAAgB4C,CAAO,MAEnCxJ,EAAiBA,EAAe,IAAK0F,GACpC/L,EAAQ,IAAK+I,IAAMA,GAAE,EAAE,EAAE,SAASgD,CAAO,EAAIA,EAAU,EAAA,CAAA,EAGpD1F,EAAe,SAAS,EAAE,EAC7BtJ,GAAM,MAAMC,EAAM,EAAE,oBAAoB,CAAA,UAC9B4C,EAAS,QAAU,GAAKA,EAAS,GAAG,EAAE,EAAE,MAAQ,GAE1D,QAAQ,IAAI,MAAM,UAElBzD,EAAM,OAAS,GACfA,EAAM,OAAQyH,GAASA,EAAK,gBAAkB,EAAK,EAAE,OAAS,EAG9D7G,GAAM,MACLC,EAAM,EAAA,kKAAA,CAAA,aAMDsJ,EAAsB,SAAS,eAAe,eAAe,EAE/DA,IACHA,EAAoB,MAAQ,GAC5BA,EAAoB,MAAM,OAAS,IAG9B,MAAA2K,GAAS,KAAK,MAAM,KAAK,UAAU9U,CAAK,CAAA,EAC9CK,EAAA,GAAAL,EAAA,CAAA,CAAA,OAEAC,GAAS,EAAA,MAGL8U,EAAgBC,KAChBC,GAAA,CACH,GAAIF,EACJ,SAAUtR,EAAS,SAAW,EAAIA,EAAS,GAAG,EAAE,EAAE,GAAK,KACvD,YAAA,CAAA,EACA,KAAM,OACN,QAASmR,EACT,MAAOE,GAAO,OAAS,EAAIA,GAAS,OACpC,UAAW,KAAK,MAAM,KAAK,IAAA,EAAQ,GAAI,EACvC,OAAQ5K,EAAe,QAAQ0C,EAAGsI,IAAShL,EAAe,QAAQ0C,CAAC,IAAMsI,CAAI,OAI9EzB,EAAQ,SAASsB,CAAa,EAAIE,GAAAxB,CAAA,EAClCpT,EAAA,EAAAoT,EAAQ,UAAYsB,EAAAtB,CAAA,EAGhBhQ,EAAS,SAAW,GACvBgQ,EAAQ,SAAShQ,EAAS,GAAG,EAAE,EAAE,EAAE,EAAE,YAAY,KAAKsR,CAAa,EAI9D,MAAA3T,GAAA,EACN0P,GAAmB,MAAAqE,EAAWP,EAAYG,EAAA,CAAiB,QAAS,EAAA,CAAA,EAG9D,OAAAjE,IAGFqE,EAAA,MAAoBlV,EAAQmV,EAAA,CAAY,QAAAxF,GAAU,KAAM,QAAAyF,EAAU,EAAA,EAAA,CAAA,IAAA,CACnE,IAAAvE,GAAA,CAAA,EAGA0C,EAAmB5D,IACnBA,EAAO,EACR3F,IAAoB,OACnB,CAAAA,EAAgB,EAAE,EACnBC,EAGG,MAAAoL,GAAA,CAAA,YACK1F,KAAW4D,EAAAA,OACf7P,GAAQE,EAAQ,OAAQ+I,IAAMA,GAAE,KAAOgD,CAAO,EAAE,GAAG,CAAC,EAEtD,GAAAjM,GAAA,KACC2Q,GAAoBU,KACpBO,GAAA,CACH,SAAAH,EACA,GAAId,GACJ,YAAA,CAAA,EACA,KAAM,YACN,QAAS,GACT,MAAO3Q,GAAM,GACb,UAAWA,GAAM,MAAQA,GAAM,GAC/B,YAAa,KACb,UAAW,KAAK,MAAM,KAAK,IAAA,EAAQ,GAAI,OAIxC8P,EAAQ,SAASa,EAAiB,EAAIiB,GAAA9B,CAAA,EACtCpT,EAAA,EAAAoT,EAAQ,UAAYa,GAAAb,CAAA,EAGhB2B,IAAa,UAChB3B,EAAQ,SAAS2B,CAAQ,EAAE,YAAA,CAAA,GACvB3B,EAAQ,SAAS2B,CAAQ,EAAE,YAC9Bd,EAAA,EAAAb,CAAA,EAIF6B,GAAmB1F,CAAO,EAAI0E,IAG1B,MAAAlT,GAAA,EAGFiU,GAAW5R,EAAS,QAAU,IAC7BuE,EAAU,iBAAmB,IAChC3H,EAAA,GAAAyN,EAAA,MAAa0H,GAAc,aAAa,MAAA,CACvC,GAAI9B,EACJ,MAAO7S,EAAM,EAAE,UAAU,EACzB,OAAQqJ,EACR,OAAQlC,EAAU,QAAU,OAC5B,QAAA,CAAA,GACKA,EAAU,QAAA,CAAA,CAAA,EAEf,SAAAvE,EACA,QAAAgQ,EACA,KAAA,CAAA,EACA,UAAW,KAAK,IAAA,WAEXgC,GAAM,IAAA,MAAUC,GAAY,aAAa,KAAK,CAAA,QAC9C/F,GAAO,IAAI7B,EAAK,EAAE,GAElB,MAAA6B,GAAO,IAAI,OAAO,EAEnB,MAAAvO,GAAA,GAGD,MAAAuU,EAAU,KAAK,MAAM,KAAK,UAAUjC,CAAO,CAAA,eAE3C,QAAQ,IACbF,EAAiB,IAAW5D,MAAAA,GAAAA,cAC3B,QAAQ,IAAI,UAAWA,CAAO,QACxBjM,GAAQE,EAAQ,OAAQ+I,IAAMA,GAAE,KAAOgD,CAAO,EAAE,GAAG,CAAC,EAEtD,GAAAjM,GAAA,CAEeF,EAAS,KAAMyK,IAChC,QAAA,OAAA/R,GAAA+R,GAAQ,QAAR,YAAA/R,GAAe,KAAMsL,IAASA,GAAK,OAAS,SAAO,GAGhD,IAAexL,IAAAC,IAAAC,GAAAwH,GAAM,OAAN,YAAAxH,GAAY,OAAZ,YAAAD,GAAkB,eAAlB,YAAAD,GAAgC,SAAU,KAC5D2E,GAAM,MACLC,EAAM,EAAE,6CACP,UAAW8C,GAAM,MAAQA,GAAM,EAAA,CAAA,CAAA,EAK9B,IAAA2Q,GAAoBgB,GAAmB1F,CAAO,EAC9C2F,GAAkB9B,EAAQ,SAASa,EAAiB,EAEpDsB,GAAc,KACd,KAAA5N,GAAA,YAAAA,EAAW,SAAU,KACpB4N,KAAgB,KAAA,CACb,MAAAjO,GAAA,MAAYkO,GAAY,aAAa,MAAO5V,CAAM,EAAE,MAAO4H,KAChEjH,GAAM,MAAMiH,EAAK,EACV,OAEJF,KACCA,GAAI,UAAU,CAAC,EAAE,OAAS,IAC7BiO,GAAcjO,GAAI,UAAU,OAAQ,CAAAmO,GAAKpT,GAAKqT,KAAA,CACvC,MAAAC,GAAqBrO,GAAI,UAAUoO,EAAK,EAAE,CAAC,EAAE,WAC7CE,GAAoB,IAAA,KAAKD,GAAqB,GAAI,EACtD,cACA,MAAM,GAAG,EAAE,CAAC,EACd,OAAAF,GAAI,QAAQC,GAAQ,CAAC,MAAME,EAAa,MAAMvT,GAAI,CAAC,CAAA,EAAA,EAC5CoT,SAIT,QAAQ,IAAIF,EAAW,GAI1BL,GAAgB,YAAcK,SAExBM,GAAyB,MAAAxB,GAAoB/Q,GAAM,GAAIgS,CAAO,EAChE/Q,SACGuR,GAAoBxS,GAAM,GAAIyR,EAAUd,EAAiB,MAG5D8B,GAAY,MACZzS,IAAA,YAAAA,GAAO,YAAa,SACvByS,GAAA,MAAkBC,GAAiB1S,GAAO1D,EAAQqU,GAAmBqB,CAAO,EAClEhS,KACVyS,GAAA,MAAkBE,GAAiB3S,GAAO1D,EAAQqU,GAAmBqB,CAAO,GAE7E7E,GAAW,KAAKsF,EAAS,EAErBF,IAAkB,cAAcA,EAAgB,OAEpDtV,GAAM,MAAMC,EAAM,EAAA,8BAAA,CAAmC,QAAA+O,CAAAA,CAAAA,CAAAA,WAKlD6F,GAAM,IAAA,MAAUC,GAAY,aAAa,KAAK,CAAA,EAC7C5E,IAGFwF,GAA0B,MAAA3S,EAAOiR,EAAYN,GAAmBqB,IAAA,8BACjES,GAAY,WAEVb,EAAkB9B,EAAQ,SAASa,EAAiB,EAGpD,MAAAlT,GAAA,EAGNwJ,KAEM,MAAA2L,GAAA,CACLvO,EAAU,UAAWuN,GAAA,YAAAA,EAAiB,cAAe,OAElD,KAAM,SACN,QAAA,GAAYiB,IACXxO,GAAA,YAAAA,EAAW,SAAU,GACrByO,EAAM,KACNzO,GAAA,MAAAA,EAAW,aACF,MAAA0O,GAAyB,aAAa,KAAK,EACjD,MAAA,CAAA,IAEHnB,GAAA,YAAAA,EAAiB,cAAe;;;IACNA,GAAA,YAAAA,EAAiB,cAAA,CAAA,GAAmB,KAAK;AAAA,CAAI,CAAA,GACpE,EACJ,IAEA,OACA,GAAA9R,CAEF,EAAA,OAAQyK,YAAY,OAAA/R,GAAA+R,IAAA,YAAAA,GAAS,UAAT,YAAA/R,GAAkB,OACtC,EAAA,IAAA,CAAK+R,GAASyI,GAAKzT,KAAA,QAEb,MAAA0T,GAAA,CACL,KAAM1I,GAAQ,KACd,QAASA,GAAQ,SAIZ2I,IAAY1a,GAAA+R,GAAQ,QAAR,YAAA/R,GACf,OAAQsL,IAASA,GAAK,OAAS,SAChC,IAAKA,IAASA,GAAK,IAAI,MAAMA,GAAK,IAAI,QAAQ,GAAG,EAAI,CAAC,GAGpD,OAAAoP,IAAaA,GAAU,OAAS,GAAK3I,GAAQ,OAAS,SACzD0I,GAAY,OAASC,IAEfD,SAGLE,EAAiB,GAGrBP,GAAa,SAASvV,GAAM+U,KAAA,CACvB/U,GAAK,SACR8V,EAAiBf,MAKnBQ,GAAa,SAASvV,GAAM+U,KAAA,CACvBA,KAAUe,UACN9V,GAAK,SAIV,IAAA+V,EAAA,CAAA,KAEA7a,IAAAC,GAAAwH,GAAA,YAAAA,EAAO,OAAP,YAAAxH,GAAa,OAAb,YAAAD,GAAmB,YAAa,MACnC6a,EAAOpT,EAAM,KAAK,KAAK,WAGxBoT,EAAA,CACI,GAAAA,KACAtT,EACD,OAAQyK,KAAYA,IAAA,YAAAA,GAAS,QAAS,IAAI,EAC1C,IAAKA,IACLA,GAAQ,MAAM,OAAQlN,IACpB,CAAA,MAAO,aAAc,oBAAoB,EAAE,SAASA,GAAK,IAAI,CAG/D,CAAA,EAAA,KAAK,CAAC,CACP,EAAA,OAAA,CACAA,GAAM+U,GAAOiB,KACbA,GAAM,UAAW3X,IAAM,KAAK,UAAUA,EAAC,IAAM,KAAK,UAAU2B,EAAI,CAAO,IAAA+U,EAAA,EAGzErG,EAAY,cACP,IAAA,YAAY,aACf,CAAA,OAAA,CACC,GAAI4E,GAAA,CAAA,CAAA,EAKD,MAAAlT,GAAA,QAECuG,GAAKsP,EAAU,EAAU,MAAAC,GAAuB,aAAa,MAAA,CACnE,MAAOvT,EAAM,GACb,SAAU4S,GACV,QAAA,IACKvO,EAAU,QAAA,CAAA,EACd,OACC/L,GAAA+L,GAAA,YAAAA,EAAW,SAAX,YAAA/L,GAAmB,OAAQ,OACxB+L,EAAU,OAAO,KAAK,IAAKmP,IAC3B,mBAAmB,KAAK,MAAM,IAAMA,GAAI,QAAQ,MAAO,KAAK,EAAI,GAAG,CAAA,CAAA,EAEnE,OACJ,cAAaxK,GAAA3E,GAAA,YAAAA,EAAW,SAAX,YAAA2E,GAAmB,aAAc,OAC9C,iBAAgByK,GAAApP,GAAA,YAAAA,EAAW,SAAX,YAAAoP,GAAmB,oBAAqB,QAEzD,OAAQpP,EAAU,eAAiB,OACnC,WAAYA,EAAU,WAAa,OACnC,SAAUrD,EAAgB,OAAS,EAAIA,EAAkB,OACzD,KAAMoS,EAAK,OAAS,EAAIA,EAAO,OAC/B,UAAWA,EAAK,OAAS,EACzB,QAASrD,IAGN,GAAA/L,IAAOA,GAAI,GAAA,CACd,QAAQ,IAAI,aAAcsP,EAAU,EAE9B,MAAArb,GAAS+L,GAAI,KACjB,YAAA,IAAgB,mBAChB,YAAY0P,GAAY;AAAA,CAAI,CAC5B,EAAA,UAAA,EAEK,OAAA,CACE,KAAA,CAAA,MAAAxb,GAAO,KAAAC,UAAeF,GAAO,KAAA,EACjC,GAAAE,IAAQwX,GAAoBqC,IAAYjC,EAAA,CAIvC,GAHJ6B,EAAgB,KAAO,kBAGnBjC,EACH2D,GAAW,MAAM,qBAAqB,OAEhCxT,MAAAA,GAAW4Q,GAAmBC,EAAiB,QAC/CC,GAAqB5Q,EAAM,GAAIF,EAAQ,EAG9C2S,GAAYb,EAAgB,sBAKxB+B,GAAQzb,GAAM,MAAM;AAAA,CAAI,YAEjB0b,MAAQD,MACdC,KAAS,GAAA,CACZ,QAAQ,IAAIA,EAAI,MACZxb,GAAO,KAAK,MAAMwb,EAAI,KAEtB,cAAexb,GAAA,CAClBwZ,EAAgB,UAAYxZ,GAAK,sBAI9B,WAAYA,GACT,MAAAA,GAGH,GAAAA,GAAK,MAAQ,GAAA,CACZ,GAAAwZ,EAAgB,SAAW,IAAMxZ,GAAK,QAAQ,SAAW;AAAA,YAG5DwZ,EAAgB,SAAWxZ,GAAK,QAAQ,cAElCyb,GAAYC,GAAyBlC,EAAgB,OAAO,EAClEiC,GAAU,IAAA,EAITA,GAAU,OAAS,GACnBA,GAAUA,GAAU,OAAS,CAAC,IAAMjC,EAAgB,eAEpDA,EAAgB,aAAeiC,GAAUA,GAAU,OAAS,CAAC,EAC7D9H,EAAY,kBACP,YAAY,QACf,OAAA,CAAU,GAAI4E,GAAmB,QAASkD,GAAUA,GAAU,OAAS,CAAC,4BA8BxE,GAtBJjC,EAAgB,KAAO,GAEnBA,EAAgB,SAAW,KAC9BA,EAAgB,MAAA,CACf,KAAM,IACN,QAAA,2DAIFA,EAAgB,QAAUxZ,GAAK,SAAW,KAC1CwZ,EAAgB,KAAA,CACf,eAAgBxZ,GAAK,eACrB,cAAeA,GAAK,cACpB,aAAcA,GAAK,aACnB,gBAAiBA,GAAK,gBACtB,kBAAmBA,GAAK,kBACxB,qBAAsBA,GAAK,qBAC3B,WAAYA,GAAK,WACjB,cAAeA,GAAK,8BAIjBiM,EAAU,sBAAwB,SAAS,SAAA,EAAA,OACxC0P,GAAmB,IAAA,aAAA,GAAgB/T,EAAM,EAAE,IAChD,KAAM4R,EAAgB,QACtB,KAAA,GAAS7M,EAAc,0BAIrBV,GAAA,YAAAA,EAAW,mBAAoB,KAClC2P,GAAgBpC,EAAgB,OAAO,EAGpCvN,EAAU,sBAAyB,CAAAiJ,IAChC,MAAA7P,GAAA,GACNwW,GAAA,SAAS,eAAA,gBAA+BrC,EAAgB,EAAE,EAAK,IAA/D,MAAAqC,GAA+D,UAK3D/P,OAAAA,GAAAA,CACR,QAAQ,IAAIA,EAAK,EACb,WAAYA,IACfjH,GAAM,MAAMiH,GAAM,MAAM,QAKtBmC,GACHY,KAIE8I,GAAWiC,IACV3N,EAAU,iBAAmB,WAChC8F,EAAa,MAAA+J,GAAe,aAAa,MAAOlC,EAAA,CAC/C,SAAAlS,EACA,QAAAgQ,EACA,OAAQvJ,WAEHuL,GAAM,IAAA,MAAUC,GAAY,aAAa,KAAK,CAAA,WAIlD/N,KAAQ,KAAA,CACLE,MAAAA,GAAAA,MAAcF,GAAI,OACxB,QAAQ,IAAIE,EAAK,EACb,WAAYA,IACfjH,GAAM,MAAMiH,GAAM,MAAM,EACxB0N,EAAgB,MAAA,CAAU,QAAS1N,GAAM,MAAA,IAEzCjH,GAAM,MAAMiH,GAAM,KAAK,EACvB0N,EAAgB,MAAA,CAAU,QAAS1N,GAAM,KAAA,QAG1CjH,GAAM,MACLC,EAAM,EAAA,wDAAA,CAA6D,SAAU,QAAA,CAAA,CAAA,EAE9E0U,EAAgB,MAAA,CACf,QAAS1U,EAAM,2DACd,SAAU,SAAA,GAIb0U,EAAgB,KAAO,kBAIxBjC,EAAmB,GACb,MAAAlS,GAAA,EAEF,IAAA0W,KAAeC,GAAAN,GAAyBlC,EAAgB,OAAO,IAAhD,YAAAwC,GAAmD,GAAA,MAAU,GAqB5E,GApBAD,IACHpI,EAAY,kBACP,YAAY,QACf,OAAA,CAAU,GAAI4E,GAAmB,QAASwD,OAI7CpI,EAAY,kBACP,YAAY,eACf,OAAA,CACC,GAAI4E,GACJ,QAASiB,EAAgB,YAKxBvL,GACHY,KAGGnH,EAAS,QAAU,GAAKA,EAAS,GAAG,CAAC,EAAE,UAAY,GAAA,CACtD,OAAO,QAAQ,aAAagQ,EAAQ,MAAO,SAAUkC,CAAO,EAAA,EACtD,MAAAqC,GAAA,MAAeC,GAAkBrD,CAAU,EAC3C,MAAAsD,GAAavC,EAASqC,EAAM,EAG5B,OAAA5B,IAGFC,GAA0B,MAAA1S,EAAOiR,EAAYN,GAAmBqB,IAAA,+CACjES,GAAY,WACVb,EAAkB9B,EAAQ,SAASa,EAAiB,EAEtD,IAAAyC,GAAA,CAAA,KAEA7a,IAAAC,EAAAwH,GAAA,YAAAA,EAAO,OAAP,YAAAxH,EAAa,OAAb,YAAAD,GAAmB,YAAa,MACnC6a,GAAOpT,EAAM,KAAK,KAAK,WAGxBoT,GAAA,CACI,GAAAA,MACAtT,EACD,OAAQyK,KAAYA,IAAA,YAAAA,GAAS,QAAS,IAAI,EAC1C,IAAKA,IACLA,GAAQ,MAAM,OAAQlN,IACpB,CAAA,MAAO,aAAc,oBAAoB,EAAE,SAASA,GAAK,IAAI,CAG/D,CAAA,EAAA,KAAK,CAAC,CACP,EAAA,OAAA,CACAA,GAAM+U,GAAOiB,KACbA,GAAM,UAAW3X,IAAM,KAAK,UAAUA,EAAC,IAAM,KAAK,UAAU2B,EAAI,CAAO,IAAA+U,EAAA,EAGzEnL,KAEA8E,EAAY,cACP,IAAA,YAAY,aACf,CAAA,OAAA,CACC,GAAI4E,GAAA,CAAA,CAAA,EAID,MAAAlT,GAAA,MAGE,KAAA,CAAAuG,GAAKsP,EAAU,EAAU,MAAAkB,GAC/B,aAAa,OAEZ,MAAOxU,EAAM,GACb,OAAQ,GACR,iBACCyT,IAAAzK,IAAA1Q,GAAA0H,EAAM,OAAN,YAAA1H,GAAY,OAAZ,YAAA0Q,GAAkB,eAAlB,YAAAyK,GAAgC,QAAS,IAEtC,cAAe,EAAA,EAEf,OACJ,SAAA,CACCpP,EAAU,UAAWuN,GAAA,YAAAA,EAAiB,cAAe,OAElD,KAAM,SACN,QAAA,GAAYiB,IACXxO,GAAA,YAAAA,EAAW,SAAU,GACrByO,EAAM,KACNzO,GAAA,MAAAA,EAAW,aACF,MAAA0O,GAAyB,aAAa,KAAK,EACjD,MAAA,CAAA,IAEHnB,GAAA,YAAAA,EAAiB,cAAe;;;IACNA,GAAA,YAAAA,EAAiB,cAAA,CAAA,GAAmB,KAAK;AAAA,CAAI,CAAA,GACpE,EACJ,IAEA,OACA,GAAA9R,CAEF,EAAA,OAAQyK,YAAY,OAAA/R,GAAA+R,IAAA,YAAAA,GAAS,UAAT,YAAA/R,GAAkB,OACtC,EAAA,IAAA,CAAK+R,GAASyI,GAAKzT,KAAA,QAAA,OACnB,KAAMgL,GAAQ,UACT/R,GAAA+R,GAAQ,QAAR,YAAA/R,GAAe,OAAQsL,IAASA,GAAK,OAAS,SAAS,QAAS,GACrEyG,GAAQ,OAAS,QAEd,QAAA,EAEE,KAAM,OACN,KACChL,GAAI,OAAS,IAAMyT,GAChBzI,GAAQ,SACRA,IAAA,YAAAA,GAAS,YAAaA,GAAQ,SAEhC,GAAAA,GAAQ,MACT,OAAQzG,IAASA,GAAK,OAAS,OAAO,EACtC,IAAKA,KAAA,CACL,KAAM,YACN,UAAA,CACC,IAAKA,GAAK,GAAA,QAMd,QACCvE,GAAI,OAAS,IAAMyT,GAChBzI,GAAQ,SACRA,IAAA,YAAAA,GAAS,YAAaA,GAAQ,YAGvC,OAAM0J,GAAA5P,GAAA,YAAAA,EAAW,SAAX,YAAA4P,GAAmB,OAAQ,OACjC,OACCG,GAAA/P,GAAA,YAAAA,EAAW,SAAX,YAAA+P,GAAmB,OAAQ,OACxB/P,EAAU,OAAO,KAAK,IAAKmP,IAC3B,mBAAmB,KAAK,MAAM,IAAMA,GAAI,QAAQ,MAAO,KAAK,EAAI,GAAG,CAAA,CAAA,EAEnE,OACJ,cAAaiB,GAAApQ,GAAA,YAAAA,EAAW,SAAX,YAAAoQ,GAAmB,cAAe,OAC/C,QAAOC,GAAArQ,GAAA,YAAAA,EAAW,SAAX,YAAAqQ,GAAmB,QAAS,OACnC,oBAAmBC,GAAAtQ,GAAA,YAAAA,EAAW,SAAX,YAAAsQ,GAAmB,oBAAqB,OAC3D,aAAYC,GAAAvQ,GAAA,YAAAA,EAAW,SAAX,YAAAuQ,GAAmB,aAAc,OAC7C,SAAU5T,EAAgB,OAAS,EAAIA,EAAkB,OACzD,KAAMoS,GAAK,OAAS,EAAIA,GAAO,OAC/B,UAAWA,GAAK,OAAS,EACzB,QAASrD,MAEP8E,EAAmB,OAIjB,MAAApX,GAAA,EAENwJ,KAEIjD,IAAOA,GAAI,IAAMA,GAAI,KAAA,CAClB,MAAA8Q,GAAA,MAAmBrd,GAAuBuM,GAAI,KAAMK,EAAU,gBAAgB,MAChF0Q,GAAY,qBAECC,MAAUF,GAAA,CAClB,KAAA,CAAA,MAAA5c,GAAO,KAAAC,GAAM,UAAA8c,GAAW,MAAA/Q,GAAO,MAAAgR,EAAU,EAAAF,GAC7C9Q,GAAAA,GAAAA,OACGiR,EAAkBjR,GAAO,KAAMlE,EAAO4R,CAAe,QAGxD,GAAAzZ,IAAQwX,GAAoBqC,IAAYjC,EAAA,CAIvC,GAHJ6B,EAAgB,KAAO,kBAGnBjC,EACH2D,GAAW,MAAM,qBAAqB,OAEhCxT,MAAAA,GAAW4Q,GAAmBC,EAAiB,QAE/CC,GAAqB5Q,EAAM,GAAIF,EAAQ,EAG9C2S,GAAYb,EAAgB,cASzB,GAJAsD,KACHH,GAAYG,IAGTD,GAAA,CACHrD,EAAgB,UAAYqD,eAIzB,EAAArD,EAAgB,SAAW,IAAM1Z,IAAS;AAAA,KAG7C0Z,EAAgB,SAAW1Z,SAErB2b,GAAYC,GAAyBlC,EAAgB,OAAO,EAClEiC,GAAU,IAAA,EAITA,GAAU,OAAS,GACnBA,GAAUA,GAAU,OAAS,CAAC,IAAMjC,EAAgB,eAEpDA,EAAgB,aAAeiC,GAAUA,GAAU,OAAS,CAAC,EAC7D9H,EAAY,kBACP,YAAY,QACf,OAAA,CAAU,GAAI4E,GAAmB,QAASkD,GAAUA,GAAU,OAAS,CAAC,sBAQxExN,GACHY,MAIE,GAAA5C,EAAU,sBAAwB,SAAS,SAAA,EAAA,OACxC0P,GAAmB,IAAA,aAAA,GAAgB/T,EAAM,EAAE,IAChD,KAAM4R,EAAgB,QACtB,KAAA,GAAS7M,EAAc,wBAIrBV,EAAU,kBACb2P,GAAgBpC,EAAgB,OAAO,EAGpCvN,EAAU,sBAAyB,CAAAiJ,IAChC,MAAA7P,GAAA,GAEN2X,GAAA,SAAS,eAAA,gBAA+BxD,EAAgB,EAAE,EAAK,IAA/D,MAAAwD,GAA+D,SAG5DL,KACHnD,EAAgB,KAAA,CAAA,GAAYmD,GAAW,OAAQ,EAAA,GAG5ChF,GAAWiC,IACV3N,EAAU,iBAAmB,WAChC8F,EAAa,MAAA+J,GAAe,aAAa,MAAOlC,EAAA,CAC/C,OAAQzL,EACR,SAAAzG,EACA,QAAAgQ,WAEKgC,GAAM,IAAA,MAAUC,GAAY,aAAa,KAAK,CAAA,cAIhDoD,EAAkB,KAAMnR,GAAKhE,EAAO4R,CAAe,CAElD1N,OAAAA,GAAAA,OACFiR,EAAkBjR,GAAO,KAAMlE,EAAO4R,CAAe,iBAI5DjC,EAAmB,GACb,MAAAlS,GAAA,EAEF,IAAA0W,IAAekB,GAAAvB,GAAyBlC,EAAgB,OAAO,IAAhD,YAAAyD,GAAmD,GAAA,MAAU,GAsB5E,GArBAlB,GACHpI,EAAY,kBACP,YAAY,QACf,OAAA,CAAU,GAAI4E,GAAmB,QAASwD,MAK7CpI,EAAY,kBACP,YAAY,eACf,OAAA,CACC,GAAI4E,GACJ,QAASiB,EAAgB,YAKxBvL,GACHY,KAGGnH,EAAS,QAAU,EAAA,CACtB,OAAO,QAAQ,aAAagQ,EAAQ,MAAO,SAAUkC,CAAO,EAAA,EAEtD,MAAAqC,GAAA,MAAeC,GAAkBrD,CAAU,EAC3C,MAAAsD,GAAavC,EAASqC,EAAM,EAG5B,OAAA5B,IAGF0C,EAA2BjR,MAAAA,EAAOF,EAAsBhE,GAAO4R,IAAA,KAChE0D,GAAe,GACfC,EAEArR,EACHqR,EAAarR,EACHF,IAAQ,OAClBuR,EAAA,MAAmBvR,EAAI,QAExB,QAAQ,MAAMuR,CAAU,EACpB,WAAYA,GACftY,GAAM,MAAMsY,EAAW,MAAM,EAC7BD,GAAeC,EAAW,QAChB,UAAWA,EACjB,YAAaA,EAAW,OAC3BtY,GAAM,MAAMsY,EAAW,MAAM,OAAO,EACpCD,GAAeC,EAAW,MAAM,UAEhCtY,GAAM,MAAMsY,EAAW,KAAK,EAC5BD,GAAeC,EAAW,OAEjB,YAAaA,IACvBtY,GAAM,MAAMsY,EAAW,OAAO,EAC9BD,GAAeC,EAAW,SAG3B3D,EAAgB,MAAA,CACf,QACC1U,EAAM,EACL,wDAAA,CAAA,SAAU8C,GAAM,MAAQA,GAAM,KAE/B;AAAA,EACAsV,IAEF1D,EAAgB,KAAO,mBAKlBxL,EAAA,IAAA,CACLuJ,EAAmB,GACnB,QAAQ,IAAI,cAAc,GAGrB6F,GAA4B,MAAAjL,GAAA,CAG7B,GAFJ,QAAQ,IAAI,oBAAoB,EAE5BzK,EAAS,QAAU,EAAA,KAClBwR,EAAcxB,EAAQ,SAASvF,EAAQ,QAAQ,EAC/C0G,GAAaK,EAAY,UAExBA,GAAA,YAAAA,EAAa,SAAA,CAAA,GAAc/K,CAAc,GAAG,QAAU,QAEpDiL,EAAWP,GAAYK,EAAY,EAAE,EAIrC,MAAAE,EAAWP,GAAYK,EAAY,GAAM,CAAA,QAAS/G,EAAQ,KAAA,CAAA,IAK7DkL,GAAA,SAAA,CACL,QAAQ,IAAI,oBAAoB,EAC1B,MAAAzD,EAAU,KAAK,MAAM,KAAK,UAAUjC,CAAO,CAAA,EAE7C,GAAAjQ,EAAS,QAAU,GAAKA,EAAS,GAAG,EAAE,EAAE,MAAQ,GAAA,OAC7C8R,EAAkB9B,EAAQ,SAASA,EAAQ,SAAS,EAC1D8B,EAAgB,KAAO,GACjB,MAAAnU,GAAA,QAEAuC,GAAQE,EAAQ,OAAQ+I,GAAMA,EAAE,KAAO2I,EAAgB,KAAK,EAAE,GAAG,CAAC,EAEpE5R,MACCA,IAAA,YAAAA,GAAO,YAAa,eACjB0S,GACL1S,GACA8P,EAAQ,SAAS8B,EAAgB,QAAQ,EAAE,QAC3CA,EAAgB,GAChBI,CAAA,QAGKW,GACL3S,GACA8P,EAAQ,SAAS8B,EAAgB,QAAQ,EAAE,QAC3CA,EAAgB,GAChBI,CAAA,QAIH/U,GAAM,MAAMC,EAAM,EAAmC,8BAAA,CAAA,OAAA,CAAA,CAAA,GAIjDoX,GAA2B,MAAArD,GAAA,OAC5B,QAAAzY,EAAA6L,GAAA,YAAAA,EAAW,QAAX,YAAA7L,EAAkB,OAAQ,GACT,MAAAkd,GACnB,aAAa,MACbnP,EAAe,CAAC,EAChB0K,EACAlB,GACC,MAAO7L,IACR,QAAQ,MAAMA,CAAK,EACZ,gBAKE+M,CAAU,IAIhBsD,GAAA,MAAsBvC,EAASqC,IAAA,CAChCrC,IAAYjC,QACfjF,GAAQuJ,CAAA,GAGLhQ,EAAU,iBAAmB,MAChC3H,EAAA,GAAAyN,EAAA,MAAa+J,GAAe,aAAa,MAAOlC,EAAA,CAAW,MAAOqC,CAAA,CAAA,CAAA,QAC5DvC,GAAM,IAAA,MAAUC,GAAY,aAAa,KAAK,CAAA,IAIhDS,GAAA,MAA6BxS,EAAeyR,EAAkBkE,KAAA,OAC7D/D,EAAkB9B,EAAQ,SAAS6F,EAAU,EAEnD/D,EAAgB,cAAA,EAEd,KAAM,GACN,OAAQ,aACR,YAAa1U,EAAM,EAAE,yBAAyB,yBAK1CZ,GAASwT,EAAQ,SAAS2B,CAAQ,EAAE,QACtC,IAAAmE,EAAA,MAAoBC,GAAoB,aAAa,MAAO7V,EAAOF,EAAUxD,EAAM,EAAE,MACvF4H,IACA,QAAQ,IAAIA,CAAK,EACV5H,KAIJsZ,IACJ3Y,GAAM,QAAQC,EAAM,EAAE,2BAA2B,CAAA,EACjD0U,EAAgB,cAAc,KAAA,CAC7B,KAAM,GACN,MAAO,GACP,OAAQ,aACR,YAAa,8CAMfA,EAAgB,cAAc,KAAA,CAC7B,KAAM,GACN,OAAQ,aACR,YAAa1U,EAAM,EAAmC,8BAAA,CAAA,YAAA0Y,EAAA,mBAIjD,MAAAE,GAAA,MAAgBC,GAAa,aAAa,MAAOH,CAAW,EAAE,MAAO1R,IAC1E,QAAQ,IAAIA,CAAK,EACjBjH,GAAM,MAAMiH,CAAK,EAEV,OAGJ4R,IACHlE,EAAgB,cAAc,KAAA,CAC7B,KAAM,GACN,OAAQ,aACR,YAAa1U,EAAM,EAAE,2BAA8B,CAAA,MAAO4Y,GAAQ,UAAU,OAAA,EAC5E,MAAOF,EACP,KAAME,GAAQ,cAGXlE,GAAA,YAAAA,EAAiB,QAAS,MAC7BA,EAAgB,MAAA,IAGjBA,EAAgB,MAAM,KAAA,CACrB,gBAAiBkE,GAAQ,gBACzB,KAAMF,EACN,KAAM,qBACN,KAAME,GAAQ,6BAKflE,EAAgB,cAAc,KAAA,CAC7B,KAAM,GACN,MAAO,GACP,OAAQ,aACR,YAAa,6CAMVrB,GAAA,SACQ,MAAAyF,GAAY,aAAa,MAAOjG,CAAO,EAAE,MAAa7L,MAAAA,+FA+CvCjG,GAAOA,EAAE,YAAe,CAAA,KAAK,MAAM,aAAa,QAAQ,oBAAoB,GAAK,IAAI,EAAE,SAASA,EAAE,EAAE,EAAI,MAGlHxF,GAAC,OACPwd,EAAWxd,EAAE,OAEnB,aAAa,QACZ,qBACA,KAAK,UAEH,CAAAwd,KACG,KAAK,MAAM,aAAa,QAAQ,oBAAoB,GAAK,IAAI,CAAA,EAC/D,OAAQza,IAAO0a,EAAS,KAAMjY,GAAMA,EAAE,KAAOzC,EAAE,CAAA,CAAA,CAAA,gKAc5CoU,EAAwB3H,oBACvBxP,GAAC,CACZiE,EAAA,EAAA2J,EACCuJ,EAAyB,aAAeA,EAAyB,WACjEA,EAAyB,aAAe,CAAC,GA0BAzH,GAAA,CAAAnK,EAAGvF,EAAGiD,GAAG6D,IAAG,gBAChDS,GAAQE,EAAQ,KAAM+I,GAAMA,EAAE,KAAOxQ,CAAC,EACxC,QAAAF,IAAAC,EAAAwH,IAAA,YAAAA,GAAO,OAAP,YAAAxH,EAAa,OAAb,YAAAD,GAAmB,UAAW,WAClB,IAAG,CAAA,GAAKyF,EAAM,GAAAgC,GAAM,KAAK,KAAK,OAAO,CAAA,CAAA,EAE9ChC,mQAtyCXtB,EAAA,EAAGmT,EAAmBvJ,IAAoB,OAAa,CAAAA,EAAgB,EAAE,EAAIC,CAAA,kBAiB7E,GAAOuJ,EAAQ,YAAc,KAAA,CACxB,IAAAqG,EAAA,CAAA,EAEAC,EAAiBtG,EAAQ,SAASA,EAAQ,SAAS,OAChDsG,IAAmB,MACzBD,EAAU,QAAa,CAAA,GAAAC,CAAA,CAAA,EACvBA,EACCA,EAAe,WAAa,KAAOtG,EAAQ,SAASsG,EAAe,QAAQ,EAAI,UAEjFtW,EAAWqW,CAAA,OAEXzZ,EAAA,GAAAoD,EAAA,CAAA,CAAA,mBAGM2P,iBAEL,QAAQ,IAAIA,CAAU,EAClBA,GAAqB,MAAAY,KAAA,CAClB,MAAA5S,GAAA,MACNiS,EAAS,EAAA,EAET,OAAO,WAAA,IAAiBzI,KAAkB,CAAC,QACrCmJ,EAAY,SAAS,eAAe,eAAe,EACzDA,GAAA,MAAAA,EAAW,aAEL,MAAAJ,GAAK,GAAG"}