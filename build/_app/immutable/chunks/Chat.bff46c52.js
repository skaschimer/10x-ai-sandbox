import{s as Ke,F as gt,G as _t,H as pt,I as vt,A as ae,e as Fe,i as O,d as h,J as Xt,B as Tt,C as Vn,p as Ie,f as I,g as S,h as E,M as mt,Z as jt,y as te,z as bt,U as el,r as ge,W as Gt,o as tl,l as ve,a as J,m as be,c as Q,j as f,w as g,n as Me,S as Ye,Q as wt,L as Bt,t as Ve,u as ye,v as Ee,X as Oe,k as ht,T as zt,R as vl,P as zn,N as Rn}from"./scheduler.2ec89978.js";import{S as xe,i as $e,a as H,t as z,g as Pe,c as ze,h as Bn,j as Nn,k as Yt,f as Ue,b as ce,d as ue,m as fe,e as de}from"./index.276f3600.js";import{g as jn}from"./globals.7f7f1b26.js";import{e as nt}from"./each.de3f9353.js";import{a as De}from"./Toaster.svelte_svelte_type_style_lang.a694d3ca.js";import{M as Fn,m as qn}from"./Messages.6031e370.js";import"./dayjs.min.75d9117a.js";import{g as rl}from"./navigation.0037273e.js";import{p as Wn}from"./stores.789225c3.js";import{p as Zn,q as Gn,h as ll,c as Jt,g as St,k as Kt,r as Jn,u as cl,m as An,a as xt,S as bl,x as wl,y as $t,W as Ln,j as Pt,l as Qn,s as Xn,v as Yn,i as Wt,O as Kn}from"./index.3b6ce8f7.js";import{h as Hn,r as ol,i as kl,j as ul,v as yl,p as El,s as xn,k as Qt,a as Il,l as $n}from"./index.1d78794b.js";import{i as es}from"./index.b3521b72.js";import{e as ts,p as Sl,c as ls,b as Zt,z as Dl,k as il,m as ns,A as ss}from"./index.180e8f9a.js";import{f as rs}from"./index.b8c0187f.js";import{i as os,j as is,k as as,l as cs}from"./index.2afe7741.js";import{T as us,S as fs,U as ds,q as hs}from"./ShareChatModal.8e510329.js";import{r as ms,s as gs,t as _s,v as ps}from"./index.6e6a3a3f.js";import{f as Ml}from"./index.703080a4.js";import{A as vs}from"./AddFilesPlaceholder.cd6db517.js";import"./sha256.65a6c54a.js";import{T as Nt}from"./Tooltip.3c52e2f2.js";import{f as On,h as bs}from"./updater.c075227d.js";import{D as fl,M as Rt}from"./Dropdown.9f1b9537.js";import{s as ws,g as ks,u as ys,a as Es,M as dl}from"./menu-trigger.1d870800.js";import{f as nl}from"./index.e8e699b3.js";import{S as Un}from"./Switch.97783cfe.js";import{t as hl,s as Is}from"./index.6fcd4f2e.js";import{S as Ss}from"./Selector.89e9dfa8.js";import{d as Ds}from"./index.f2df4749.js";import{g as Ft}from"./spread.8a54911c.js";import{f as Ms}from"./FileSaver.min.898eb36f.js";import{b as Ts}from"./index.08c6a3d7.js";import"./paths.8088bd10.js";import{M as Cs}from"./MenuLines.2c8cd836.js";import"./index.c4ca6160.js";const Vs=n=>({subIds:n&1}),Tl=n=>({subIds:n[0]});function Bs(n){let e;const t=n[6].default,l=gt(t,n,n[5],Tl);return{c(){l&&l.c()},l(s){l&&l.l(s)},m(s,o){l&&l.m(s,o),e=!0},p(s,[o]){l&&l.p&&(!e||o&33)&&_t(l,t,s,s[5],e?vt(t,s[5],o,Vs):pt(s[5]),Tl)},i(s){e||(H(l,s),e=!0)},o(s){z(l,s),e=!1},d(s){l&&l.d(s)}}}function Ns(n,e,t){let l,{$$slots:s={},$$scope:o}=e,{disabled:r=void 0}=e,{open:i=void 0}=e,{onOpenChange:a=void 0}=e;const{updateOption:u,ids:c,states:{subOpen:d}}=ws({disabled:r,onOpenChange:({next:v})=>(i!==v&&(a==null||a(v),t(2,i=v)),v)}),m=Ds([c.menu,c.trigger],([v,y])=>({menu:v,trigger:y}));return ae(n,m,v=>t(0,l=v)),n.$$set=v=>{"disabled"in v&&t(3,r=v.disabled),"open"in v&&t(2,i=v.open),"onOpenChange"in v&&t(4,a=v.onOpenChange),"$$scope"in v&&t(5,o=v.$$scope)},n.$$.update=()=>{n.$$.dirty&4&&i!==void 0&&d.set(i),n.$$.dirty&8&&u("disabled",r)},[l,m,i,r,a,o,s]}class As extends xe{constructor(e){super(),$e(this,e,Ns,Bs,Ke,{disabled:3,open:2,onOpenChange:4})}}const Ls=n=>({builder:n[0]&256}),Cl=n=>({builder:n[8]}),Hs=n=>({builder:n[0]&256}),Vl=n=>({builder:n[8]}),Os=n=>({builder:n[0]&256}),Bl=n=>({builder:n[8]}),Us=n=>({builder:n[0]&256}),Nl=n=>({builder:n[8]}),Ps=n=>({builder:n[0]&256}),Al=n=>({builder:n[8]}),zs=n=>({builder:n[0]&256}),Ll=n=>({builder:n[8]});function Rs(n){let e,t,l,s;const o=n[28].default,r=gt(o,n,n[27],Cl);let i=[n[8],n[13]],a={};for(let u=0;u<i.length;u+=1)a=Tt(a,i[u]);return{c(){e=I("div"),r&&r.c(),this.h()},l(u){e=S(u,"DIV",{});var c=E(e);r&&r.l(c),c.forEach(h),this.h()},h(){mt(e,a)},m(u,c){O(u,e,c),r&&r.m(e,null),n[33](e),t=!0,l||(s=[jt(n[8].action(e)),te(e,"m-focusout",n[12]),te(e,"m-keydown",n[12]),te(e,"m-pointermove",n[12])],l=!0)},p(u,c){r&&r.p&&(!t||c[0]&134217984)&&_t(r,o,u,u[27],t?vt(o,u[27],c,Ls):pt(u[27]),Cl),mt(e,a=Ft(i,[c[0]&256&&u[8],c[0]&8192&&u[13]]))},i(u){t||(H(r,u),t=!0)},o(u){z(r,u),t=!1},d(u){u&&h(e),r&&r.d(u),n[33](null),l=!1,bt(s)}}}function js(n){let e,t,l,s,o;const r=n[28].default,i=gt(r,n,n[27],Vl);let a=[n[8],n[13]],u={};for(let c=0;c<a.length;c+=1)u=Tt(u,a[c]);return{c(){e=I("div"),i&&i.c(),this.h()},l(c){e=S(c,"DIV",{});var d=E(e);i&&i.l(d),d.forEach(h),this.h()},h(){mt(e,u)},m(c,d){O(c,e,d),i&&i.m(e,null),n[32](e),l=!0,s||(o=[jt(n[8].action(e)),te(e,"m-focusout",n[12]),te(e,"m-keydown",n[12]),te(e,"m-pointermove",n[12])],s=!0)},p(c,d){n=c,i&&i.p&&(!l||d[0]&134217984)&&_t(i,r,n,n[27],l?vt(r,n[27],d,Hs):pt(n[27]),Vl),mt(e,u=Ft(a,[d[0]&256&&n[8],d[0]&8192&&n[13]]))},i(c){l||(H(i,c),t&&t.end(1),l=!0)},o(c){z(i,c),c&&(t=Bn(e,n[5],n[6])),l=!1},d(c){c&&h(e),i&&i.d(c),n[32](null),c&&t&&t.end(),s=!1,bt(o)}}}function Fs(n){let e,t,l,s,o;const r=n[28].default,i=gt(r,n,n[27],Bl);let a=[n[8],n[13]],u={};for(let c=0;c<a.length;c+=1)u=Tt(u,a[c]);return{c(){e=I("div"),i&&i.c(),this.h()},l(c){e=S(c,"DIV",{});var d=E(e);i&&i.l(d),d.forEach(h),this.h()},h(){mt(e,u)},m(c,d){O(c,e,d),i&&i.m(e,null),n[31](e),l=!0,s||(o=[jt(n[8].action(e)),te(e,"m-focusout",n[12]),te(e,"m-keydown",n[12]),te(e,"m-pointermove",n[12])],s=!0)},p(c,d){n=c,i&&i.p&&(!l||d[0]&134217984)&&_t(i,r,n,n[27],l?vt(r,n[27],d,Os):pt(n[27]),Bl),mt(e,u=Ft(a,[d[0]&256&&n[8],d[0]&8192&&n[13]]))},i(c){l||(H(i,c),c&&(t||el(()=>{t=Nn(e,n[3],n[4]),t.start()})),l=!0)},o(c){z(i,c),l=!1},d(c){c&&h(e),i&&i.d(c),n[31](null),s=!1,bt(o)}}}function qs(n){let e,t,l,s,o,r;const i=n[28].default,a=gt(i,n,n[27],Nl);let u=[n[8],n[13]],c={};for(let d=0;d<u.length;d+=1)c=Tt(c,u[d]);return{c(){e=I("div"),a&&a.c(),this.h()},l(d){e=S(d,"DIV",{});var m=E(e);a&&a.l(m),m.forEach(h),this.h()},h(){mt(e,c)},m(d,m){O(d,e,m),a&&a.m(e,null),n[30](e),s=!0,o||(r=[jt(n[8].action(e)),te(e,"m-focusout",n[12]),te(e,"m-keydown",n[12]),te(e,"m-pointermove",n[12])],o=!0)},p(d,m){n=d,a&&a.p&&(!s||m[0]&134217984)&&_t(a,i,n,n[27],s?vt(i,n[27],m,Us):pt(n[27]),Nl),mt(e,c=Ft(u,[m[0]&256&&n[8],m[0]&8192&&n[13]]))},i(d){s||(H(a,d),d&&el(()=>{s&&(l&&l.end(1),t=Nn(e,n[3],n[4]),t.start())}),s=!0)},o(d){z(a,d),t&&t.invalidate(),d&&(l=Bn(e,n[5],n[6])),s=!1},d(d){d&&h(e),a&&a.d(d),n[30](null),d&&l&&l.end(),o=!1,bt(r)}}}function Ws(n){let e,t,l,s,o;const r=n[28].default,i=gt(r,n,n[27],Al);let a=[n[8],n[13]],u={};for(let c=0;c<a.length;c+=1)u=Tt(u,a[c]);return{c(){e=I("div"),i&&i.c(),this.h()},l(c){e=S(c,"DIV",{});var d=E(e);i&&i.l(d),d.forEach(h),this.h()},h(){mt(e,u)},m(c,d){O(c,e,d),i&&i.m(e,null),n[29](e),l=!0,s||(o=[jt(n[8].action(e)),te(e,"m-focusout",n[12]),te(e,"m-keydown",n[12]),te(e,"m-pointermove",n[12])],s=!0)},p(c,d){n=c,i&&i.p&&(!l||d[0]&134217984)&&_t(i,r,n,n[27],l?vt(r,n[27],d,Ps):pt(n[27]),Al),mt(e,u=Ft(a,[d[0]&256&&n[8],d[0]&8192&&n[13]]))},i(c){l||(H(i,c),c&&el(()=>{l&&(t||(t=Yt(e,n[1],n[2],!0)),t.run(1))}),l=!0)},o(c){z(i,c),c&&(t||(t=Yt(e,n[1],n[2],!1)),t.run(0)),l=!1},d(c){c&&h(e),i&&i.d(c),n[29](null),c&&t&&t.end(),s=!1,bt(o)}}}function Zs(n){let e;const t=n[28].default,l=gt(t,n,n[27],Ll);return{c(){l&&l.c()},l(s){l&&l.l(s)},m(s,o){l&&l.m(s,o),e=!0},p(s,o){l&&l.p&&(!e||o[0]&134217984)&&_t(l,t,s,s[27],e?vt(t,s[27],o,zs):pt(s[27]),Ll)},i(s){e||(H(l,s),e=!0)},o(s){z(l,s),e=!1},d(s){l&&l.d(s)}}}function Gs(n){let e,t,l,s;const o=[Zs,Ws,qs,Fs,js,Rs],r=[];function i(a,u){return a[7]&&a[9]?0:a[1]&&a[9]?1:a[3]&&a[5]&&a[9]?2:a[3]&&a[9]?3:a[5]&&a[9]?4:a[9]?5:-1}return~(e=i(n))&&(t=r[e]=o[e](n)),{c(){t&&t.c(),l=Fe()},l(a){t&&t.l(a),l=Fe()},m(a,u){~e&&r[e].m(a,u),O(a,l,u),s=!0},p(a,u){let c=e;e=i(a),e===c?~e&&r[e].p(a,u):(t&&(Pe(),z(r[c],1,1,()=>{r[c]=null}),ze()),~e?(t=r[e],t?t.p(a,u):(t=r[e]=o[e](a),t.c()),H(t,1),t.m(l.parentNode,l)):t=null)},i(a){s||(H(t),s=!0)},o(a){z(t),s=!1},d(a){a&&h(l),~e&&r[e].d(a)}}}function Js(n,e,t){let l;const s=["transition","transitionConfig","inTransition","inTransitionConfig","outTransition","outTransitionConfig","asChild","id","side","align","sideOffset","alignOffset","collisionPadding","avoidCollisions","collisionBoundary","sameWidth","fitViewport","strategy","overlap","el"];let o=Xt(e,s),r,i,{$$slots:a={},$$scope:u}=e,{transition:c=void 0}=e,{transitionConfig:d=void 0}=e,{inTransition:m=void 0}=e,{inTransitionConfig:v=void 0}=e,{outTransition:y=void 0}=e,{outTransitionConfig:b=void 0}=e,{asChild:_=!1}=e,{id:p=void 0}=e,{side:w="right"}=e,{align:T="start"}=e,{sideOffset:D=0}=e,{alignOffset:N=0}=e,{collisionPadding:M=8}=e,{avoidCollisions:L=!0}=e,{collisionBoundary:C=void 0}=e,{sameWidth:W=!1}=e,{fitViewport:j=!1}=e,{strategy:U="absolute"}=e,{overlap:q=!1}=e,{el:oe=void 0}=e;const{elements:{subMenu:K},states:{subOpen:P},ids:V,getAttrs:A}=ks();ae(n,K,G=>t(26,r=G)),ae(n,P,G=>t(9,i=G));const X=On(),re=A("sub-content");function le(G){Ie[G?"unshift":"push"](()=>{oe=G,t(0,oe)})}function he(G){Ie[G?"unshift":"push"](()=>{oe=G,t(0,oe)})}function qe(G){Ie[G?"unshift":"push"](()=>{oe=G,t(0,oe)})}function Re(G){Ie[G?"unshift":"push"](()=>{oe=G,t(0,oe)})}function tt(G){Ie[G?"unshift":"push"](()=>{oe=G,t(0,oe)})}return n.$$set=G=>{e=Tt(Tt({},e),Vn(G)),t(13,o=Xt(e,s)),"transition"in G&&t(1,c=G.transition),"transitionConfig"in G&&t(2,d=G.transitionConfig),"inTransition"in G&&t(3,m=G.inTransition),"inTransitionConfig"in G&&t(4,v=G.inTransitionConfig),"outTransition"in G&&t(5,y=G.outTransition),"outTransitionConfig"in G&&t(6,b=G.outTransitionConfig),"asChild"in G&&t(7,_=G.asChild),"id"in G&&t(14,p=G.id),"side"in G&&t(15,w=G.side),"align"in G&&t(16,T=G.align),"sideOffset"in G&&t(17,D=G.sideOffset),"alignOffset"in G&&t(18,N=G.alignOffset),"collisionPadding"in G&&t(19,M=G.collisionPadding),"avoidCollisions"in G&&t(20,L=G.avoidCollisions),"collisionBoundary"in G&&t(21,C=G.collisionBoundary),"sameWidth"in G&&t(22,W=G.sameWidth),"fitViewport"in G&&t(23,j=G.fitViewport),"strategy"in G&&t(24,U=G.strategy),"overlap"in G&&t(25,q=G.overlap),"el"in G&&t(0,oe=G.el),"$$scope"in G&&t(27,u=G.$$scope)},n.$$.update=()=>{n.$$.dirty[0]&16384&&p&&V.menu.set(p),n.$$.dirty[0]&67108864&&t(8,l=r),n.$$.dirty[0]&256&&Object.assign(l,re),n.$$.dirty[0]&67076096&&ys({side:w,align:T,sideOffset:D,alignOffset:N,collisionPadding:M,avoidCollisions:L,collisionBoundary:C,sameWidth:W,fitViewport:j,strategy:U,overlap:q})},[oe,c,d,m,v,y,b,_,l,i,K,P,X,o,p,w,T,D,N,M,L,C,W,j,U,q,r,u,a,le,he,qe,Re,tt]}class Qs extends xe{constructor(e){super(),$e(this,e,Js,Gs,Ke,{transition:1,transitionConfig:2,inTransition:3,inTransitionConfig:4,outTransition:5,outTransitionConfig:6,asChild:7,id:14,side:15,align:16,sideOffset:17,alignOffset:18,collisionPadding:19,avoidCollisions:20,collisionBoundary:21,sameWidth:22,fitViewport:23,strategy:24,overlap:25,el:0},null,[-1,-1])}}const Xs=n=>({builder:n&4}),Hl=n=>({builder:n[2]}),Ys=n=>({builder:n&4}),Ol=n=>({builder:n[2]});function Ks(n){let e,t,l,s;const o=n[13].default,r=gt(o,n,n[12],Hl);let i=[n[2],n[6]],a={};for(let u=0;u<i.length;u+=1)a=Tt(a,i[u]);return{c(){e=I("div"),r&&r.c(),this.h()},l(u){e=S(u,"DIV",{});var c=E(e);r&&r.l(c),c.forEach(h),this.h()},h(){mt(e,a)},m(u,c){O(u,e,c),r&&r.m(e,null),n[14](e),t=!0,l||(s=[jt(n[2].action(e)),te(e,"m-click",n[5]),te(e,"m-focusin",n[5]),te(e,"m-focusout",n[5]),te(e,"m-keydown",n[5]),te(e,"m-pointerleave",n[5]),te(e,"m-pointermove",n[5])],l=!0)},p(u,c){r&&r.p&&(!t||c&4100)&&_t(r,o,u,u[12],t?vt(o,u[12],c,Xs):pt(u[12]),Hl),mt(e,a=Ft(i,[c&4&&u[2],c&64&&u[6]]))},i(u){t||(H(r,u),t=!0)},o(u){z(r,u),t=!1},d(u){u&&h(e),r&&r.d(u),n[14](null),l=!1,bt(s)}}}function xs(n){let e;const t=n[13].default,l=gt(t,n,n[12],Ol);return{c(){l&&l.c()},l(s){l&&l.l(s)},m(s,o){l&&l.m(s,o),e=!0},p(s,o){l&&l.p&&(!e||o&4100)&&_t(l,t,s,s[12],e?vt(t,s[12],o,Ys):pt(s[12]),Ol)},i(s){e||(H(l,s),e=!0)},o(s){z(l,s),e=!1},d(s){l&&l.d(s)}}}function $s(n){let e,t,l,s;const o=[xs,Ks],r=[];function i(a,u){return a[1]?0:1}return e=i(n),t=r[e]=o[e](n),{c(){t.c(),l=Fe()},l(a){t.l(a),l=Fe()},m(a,u){r[e].m(a,u),O(a,l,u),s=!0},p(a,[u]){let c=e;e=i(a),e===c?r[e].p(a,u):(Pe(),z(r[c],1,1,()=>{r[c]=null}),ze(),t=r[e],t?t.p(a,u):(t=r[e]=o[e](a),t.c()),H(t,1),t.m(l.parentNode,l))},i(a){s||(H(t),s=!0)},o(a){z(t),s=!1},d(a){a&&h(l),r[e].d(a)}}}function er(n,e,t){let l,s;const o=["disabled","asChild","id","el"];let r=Xt(e,o),i,a,{$$slots:u={},$$scope:c}=e,{disabled:d=!1}=e,{asChild:m=!1}=e,{id:v=void 0}=e,{el:y=void 0}=e;const{elements:{subTrigger:b},ids:_,getAttrs:p,options:w}=Es();ae(n,b,M=>t(11,a=M));const{disabled:T}=w;ae(n,T,M=>t(10,i=M));const D=On();function N(M){Ie[M?"unshift":"push"](()=>{y=M,t(0,y)})}return n.$$set=M=>{e=Tt(Tt({},e),Vn(M)),t(6,r=Xt(e,o)),"disabled"in M&&t(7,d=M.disabled),"asChild"in M&&t(1,m=M.asChild),"id"in M&&t(8,v=M.id),"el"in M&&t(0,y=M.el),"$$scope"in M&&t(12,c=M.$$scope)},n.$$.update=()=>{n.$$.dirty&256&&v&&_.trigger.set(v),n.$$.dirty&2048&&t(2,l=a),n.$$.dirty&1152&&t(9,s={...p("sub-trigger"),...bs(d||i)}),n.$$.dirty&516&&Object.assign(l,s)},[y,m,l,b,T,D,r,d,v,s,i,a,c,u,N]}class tr extends xe{constructor(e){super(),$e(this,e,er,$s,Ke,{disabled:7,asChild:1,id:8,el:0})}}function lr(n){let e,t,l,s,o,r,i;return a(),{feed:u,reset:a};function a(){e=!0,t="",l=0,s=-1,o=void 0,r=void 0,i=""}function u(d){t=t?t+d:d,e&&nr(t)&&(t=t.slice(Pn.length)),e=!1;const m=t.length;let v=0,y=!1;for(;v<m;){y&&(t[v]===`
`&&++v,y=!1);let b=-1,_=s,p;for(let w=l;b<0&&w<m;++w)p=t[w],p===":"&&_<0?_=w-v:p==="\r"?(y=!0,b=w-v):p===`
`&&(b=w-v);if(b<0){l=m-v,s=_;break}else l=0,s=-1;c(t,v,_,b),v+=b+1}v===m?t="":v>0&&(t=t.slice(v))}function c(d,m,v,y){if(y===0){i.length>0&&(n({type:"event",id:o,event:r||void 0,data:i.slice(0,-1)}),i="",o=void 0),r=void 0;return}const b=v<0,_=d.slice(m,m+(b?y:v));let p=0;b?p=y:d[m+v+1]===" "?p=v+2:p=v+1;const w=m+p,T=y-p,D=d.slice(w,w+T).toString();if(_==="data")i+=D?"".concat(D,`
`):`
`;else if(_==="event")r=D;else if(_==="id"&&!D.includes("\0"))o=D;else if(_==="retry"){const N=parseInt(D,10);Number.isNaN(N)||n({type:"reconnect-interval",value:N})}}}const Pn=[239,187,191];function nr(n){return Pn.every((e,t)=>n.charCodeAt(t)===e)}class sr extends TransformStream{constructor(){let e;super({start(t){e=lr(l=>{l.type==="event"&&t.enqueue(l)})},transform(t){e.feed(t)}})}}async function rr(n,e){const t=n.pipeThrough(new TextDecoderStream).pipeThrough(new sr).getReader();let l=or(t);return e&&(l=ir(l)),l}async function*or(n){var t,l,s;for(var e=0;;){const{value:o,done:r}=await n.read();if(r){yield{done:!0,value:"",cost:e};break}if(!o)continue;const i=o.data;try{if(i.startsWith("[DONE]")){yield{done:!0,value:"",cost:e};break}const a=JSON.parse(i);if(a.cost&&(e=a.cost),a.error){yield{done:!0,value:"",error:a.error,cost:e};break}if(a.citations){yield{done:!1,value:"",citations:a.citations,cost:e};continue}yield{done:!1,value:((s=(l=(t=a.choices)==null?void 0:t[0])==null?void 0:l.delta)==null?void 0:s.content)??"",usage:a.usage}}catch(a){console.error("Error extracting delta from SSE event:",a),console.error("Error extracting delta from SSE event with data:",i)}}}async function*ir(n){for await(const e of n){if(e.done){yield e;return}if(e.citations){yield e;continue}let t=e.value;if(t.length<5){yield{done:!1,value:t};continue}for(;t!="";){const l=Math.min(Math.floor(Math.random()*3)+1,t.length);yield{done:!1,value:t.slice(0,l)},(document==null?void 0:document.visibilityState)!=="hidden"&&await ar(5),t=t.slice(l)}}}const ar=n=>new Promise(e=>setTimeout(e,n));function Ul(n){let e,t=n[2]&&Pl(n);return{c(){t&&t.c(),e=Fe()},l(l){t&&t.l(l),e=Fe()},m(l,s){t&&t.m(l,s),O(l,e,s)},p(l,s){l[2]?t?(t.p(l,s),s&4&&H(t,1)):(t=Pl(l),t.c(),H(t,1),t.m(e.parentNode,e)):t&&(Pe(),z(t,1,1,()=>{t=null}),ze())},d(l){l&&h(e),t&&t.d(l)}}}function Pl(n){let e,t,l,s,o=n[1].type+"",r,i,a,u,c,d=n[1].content+"",m,v,y,b,_,p,w=n[1].url&&zl(),T=n[1].url&&Rl(),D=n[1].dismissible&&jl(n);return{c(){e=I("div"),t=I("div"),l=I("div"),s=I("div"),r=ve(o),a=J(),w&&w.c(),u=J(),c=I("div"),m=ve(d),v=J(),T&&T.c(),y=J(),b=I("div"),D&&D.c(),this.h()},l(N){e=S(N,"DIV",{class:!0});var M=E(e);t=S(M,"DIV",{class:!0});var L=E(t);l=S(L,"DIV",{class:!0});var C=E(l);s=S(C,"DIV",{class:!0});var W=E(s);r=be(W,o),W.forEach(h),a=Q(C),w&&w.l(C),C.forEach(h),u=Q(L),c=S(L,"DIV",{class:!0});var j=E(c);m=be(j,d),j.forEach(h),L.forEach(h),v=Q(M),T&&T.l(M),y=Q(M),b=S(M,"DIV",{class:!0});var U=E(b);D&&D.l(U),U.forEach(h),M.forEach(h),this.h()},h(){f(s,"class",i="text-xs font-black "+(n[3][n[1].type]??n[3].info)+" w-fit px-2 rounded uppercase line-clamp-1 mr-0.5"),f(l,"class","flex justify-between self-start"),f(c,"class","flex-1 text-xs text-gray-700 dark:text-white"),f(t,"class","flex flex-col md:flex-row md:items-center flex-1 text-sm w-fit gap-1.5"),f(b,"class","flex self-start"),f(e,"class","top-0 left-0 right-0 p-2 mx-4 px-3 flex justify-center items-center relative rounded-xl border border-gray-50 dark:border-gray-850 text-gray-800 dark:text-gary-100 bg-white dark:bg-gray-900 backdrop-blur-xl z-30")},m(N,M){O(N,e,M),g(e,t),g(t,l),g(l,s),g(s,r),g(l,a),w&&w.m(l,null),g(t,u),g(t,c),g(c,m),g(e,v),T&&T.m(e,null),g(e,y),g(e,b),D&&D.m(b,null),p=!0},p(N,M){(!p||M&2)&&o!==(o=N[1].type+"")&&Me(r,o),(!p||M&2&&i!==(i="text-xs font-black "+(N[3][N[1].type]??N[3].info)+" w-fit px-2 rounded uppercase line-clamp-1 mr-0.5"))&&f(s,"class",i),N[1].url?w||(w=zl(),w.c(),w.m(l,null)):w&&(w.d(1),w=null),(!p||M&2)&&d!==(d=N[1].content+"")&&Me(m,d),N[1].url?T||(T=Rl(),T.c(),T.m(e,y)):T&&(T.d(1),T=null),N[1].dismissible?D?D.p(N,M):(D=jl(N),D.c(),D.m(b,null)):D&&(D.d(1),D=null)},i(N){p||(N&&el(()=>{p&&(_||(_=Yt(e,Ml,{delay:100,duration:300},!0)),_.run(1))}),p=!0)},o(N){N&&(_||(_=Yt(e,Ml,{delay:100,duration:300},!1)),_.run(0)),p=!1},d(N){N&&h(e),w&&w.d(),T&&T.d(),D&&D.d(),N&&_&&_.end()}}}function zl(n){let e,t='<a class="text-gray-700 dark:text-white text-xs font-bold underline" href="/assets/files/whitepaper.pdf" target="_blank">Learn More</a> <div class="ml-1 text-gray-400 group-hover:text-gray-600 dark:group-hover:text-white"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" fill="currentColor" class="w-4 h-4"><path fill-rule="evenodd" d="M4.22 11.78a.75.75 0 0 1 0-1.06L9.44 5.5H5.75a.75.75 0 0 1 0-1.5h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V6.56l-5.22 5.22a.75.75 0 0 1-1.06 0Z" clip-rule="evenodd"></path></svg></div>';return{c(){e=I("div"),e.innerHTML=t,this.h()},l(l){e=S(l,"DIV",{class:!0,"data-svelte-h":!0}),Ye(e)!=="svelte-1ofrdjc"&&(e.innerHTML=t),this.h()},h(){f(e,"class","flex md:hidden group w-fit md:items-center")},m(l,s){O(l,e,s)},d(l){l&&h(e)}}}function Rl(n){let e,t='<a class="text-gray-700 dark:text-white text-xs font-bold underline" href="/" target="_blank">Learn More</a> <div class="ml-1 text-gray-400 group-hover:text-gray-600 dark:group-hover:text-white"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" fill="currentColor" class="size-4"><path fill-rule="evenodd" d="M4.22 11.78a.75.75 0 0 1 0-1.06L9.44 5.5H5.75a.75.75 0 0 1 0-1.5h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V6.56l-5.22 5.22a.75.75 0 0 1-1.06 0Z" clip-rule="evenodd"></path></svg></div>';return{c(){e=I("div"),e.innerHTML=t,this.h()},l(l){e=S(l,"DIV",{class:!0,"data-svelte-h":!0}),Ye(e)!=="svelte-15ujvd1"&&(e.innerHTML=t),this.h()},h(){f(e,"class","hidden md:flex group w-fit md:items-center")},m(l,s){O(l,e,s)},d(l){l&&h(e)}}}function jl(n){let e,t="Ã—",l,s;return{c(){e=I("button"),e.textContent=t,this.h()},l(o){e=S(o,"BUTTON",{class:!0,"data-svelte-h":!0}),Ye(e)!=="svelte-17pf3tf"&&(e.textContent=t),this.h()},h(){f(e,"class","-mt-[3px] ml-1.5 mr-1 text-gray-400 dark:hover:text-white h-1")},m(o,r){O(o,e,r),l||(s=te(e,"click",n[5]),l=!0)},p:ge,d(o){o&&h(e),l=!1,s()}}}function cr(n){let e,t=!n[0]&&Ul(n);return{c(){t&&t.c(),e=Fe()},l(l){t&&t.l(l),e=Fe()},m(l,s){t&&t.m(l,s),O(l,e,s)},p(l,[s]){l[0]?t&&(t.d(1),t=null):t?t.p(l,s):(t=Ul(l),t.c(),t.m(e.parentNode,e))},i:ge,o:ge,d(l){l&&h(e),t&&t.d(l)}}}function ur(n,e,t){const l=Gt();let{banner:s={id:"",type:"info",title:"",content:"",url:"",dismissable:!0,timestamp:Math.floor(Date.now()/1e3)}}=e,{dismissed:o=!1}=e,r=!1;const i={info:"bg-blue-500/20 text-blue-700 dark:text-blue-200 ",success:"bg-green-500/20 text-green-700 dark:text-green-200",warning:"bg-yellow-500/20 text-yellow-700 dark:text-yellow-200",error:"bg-red-500/20 text-red-700 dark:text-red-200"},a=c=>{t(0,o=!0),l("dismiss",c)};tl(()=>{t(2,r=!0)});const u=()=>{a(s.id)};return n.$$set=c=>{"banner"in c&&t(1,s=c.banner),"dismissed"in c&&t(0,o=c.dismissed)},[o,s,r,i,a,u]}class fr extends xe{constructor(e){super(),$e(this,e,ur,cr,Ke,{banner:1,dismissed:0})}}function Fl(n,e,t){const l=n.slice();return l[12]=e[t],l[14]=t,l}function ql(n){let e,t,l,s='<div class="text-lg font-semibold mt-2">/</div>',o,r,i,a,u,c,d='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-3 h-3"><path stroke-linecap="round" stroke-linejoin="round" d="m11.25 11.25.041-.02a.75.75 0 0 1 1.063.852l-.708 2.836a.75.75 0 0 0 1.063.853l.041-.021M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9-3.75h.008v.008H12V8.25Z"></path></svg>',m,v,y=n[2].t("Tip: Update multiple variable slots consecutively by pressing the tab key in the chat input after each replacement.")+"",b,_=nt(n[1]),p=[];for(let w=0;w<_.length;w+=1)p[w]=Wl(Fl(n,_,w));return{c(){e=I("div"),t=I("div"),l=I("div"),l.innerHTML=s,o=J(),r=I("div"),i=I("div");for(let w=0;w<p.length;w+=1)p[w].c();a=J(),u=I("div"),c=I("div"),c.innerHTML=d,m=J(),v=I("div"),b=ve(y),this.h()},l(w){e=S(w,"DIV",{class:!0});var T=E(e);t=S(T,"DIV",{class:!0});var D=E(t);l=S(D,"DIV",{class:!0,"data-svelte-h":!0}),Ye(l)!=="svelte-17yak1f"&&(l.innerHTML=s),o=Q(D),r=S(D,"DIV",{class:!0});var N=E(r);i=S(N,"DIV",{class:!0});var M=E(i);for(let W=0;W<p.length;W+=1)p[W].l(M);M.forEach(h),a=Q(N),u=S(N,"DIV",{class:!0});var L=E(u);c=S(L,"DIV",{"data-svelte-h":!0}),Ye(c)!=="svelte-cdi12d"&&(c.innerHTML=d),m=Q(L),v=S(L,"DIV",{class:!0});var C=E(v);b=be(C,y),C.forEach(h),L.forEach(h),N.forEach(h),D.forEach(h),T.forEach(h),this.h()},h(){f(l,"class","bg-gray-50 dark:bg-gray-850 w-10 rounded-l-lg text-center"),f(i,"class","m-1 overflow-y-auto p-1 rounded-r-lg space-y-0.5 scrollbar-hidden"),f(v,"class","line-clamp-1"),f(u,"class","px-2 pb-1 text-xs text-gray-600 dark:text-gray-100 bg-white dark:bg-gray-900 rounded-br-xl flex items-center space-x-1"),f(r,"class","max-h-60 flex flex-col w-full rounded-r-lg bg-white dark:bg-gray-900 dark:text-gray-100"),f(t,"class","flex w-full dark:border dark:border-gray-850 rounded-lg"),f(e,"class","pl-1 pr-12 mb-3 text-left w-full absolute bottom-0 left-0 right-0")},m(w,T){O(w,e,T),g(e,t),g(t,l),g(t,o),g(t,r),g(r,i);for(let D=0;D<p.length;D+=1)p[D]&&p[D].m(i,null);g(r,a),g(r,u),g(u,c),g(u,m),g(u,v),g(v,b)},p(w,T){if(T&19){_=nt(w[1]);let D;for(D=0;D<_.length;D+=1){const N=Fl(w,_,D);p[D]?p[D].p(N,T):(p[D]=Wl(N),p[D].c(),p[D].m(i,null))}for(;D<p.length;D+=1)p[D].d(1);p.length=_.length}T&4&&y!==(y=w[2].t("Tip: Update multiple variable slots consecutively by pressing the tab key in the chat input after each replacement.")+"")&&Me(b,y)},d(w){w&&h(e),Bt(p,w)}}}function Wl(n){let e,t,l=n[12].command+"",s,o,r,i=n[12].title+"",a,u,c,d,m;function v(){return n[10](n[12])}function y(){return n[11](n[14])}return{c(){e=I("button"),t=I("div"),s=ve(l),o=J(),r=I("div"),a=ve(i),u=J(),this.h()},l(b){e=S(b,"BUTTON",{class:!0,type:!0});var _=E(e);t=S(_,"DIV",{class:!0});var p=E(t);s=be(p,l),p.forEach(h),o=Q(_),r=S(_,"DIV",{class:!0});var w=E(r);a=be(w,i),w.forEach(h),u=Q(_),_.forEach(h),this.h()},h(){f(t,"class","font-medium text-black dark:text-gray-100"),f(r,"class","text-xs text-gray-600 dark:text-gray-100"),f(e,"class",c="px-3 py-1.5 rounded-xl w-full text-left "+(n[14]===n[0]?"  bg-gray-50 dark:bg-gray-850 selected-command-option-button":"")),f(e,"type","button")},m(b,_){O(b,e,_),g(e,t),g(t,s),g(e,o),g(e,r),g(r,a),g(e,u),d||(m=[te(e,"click",v),te(e,"mousemove",y),te(e,"focus",hr)],d=!0)},p(b,_){n=b,_&2&&l!==(l=n[12].command+"")&&Me(s,l),_&2&&i!==(i=n[12].title+"")&&Me(a,i),_&1&&c!==(c="px-3 py-1.5 rounded-xl w-full text-left "+(n[14]===n[0]?"  bg-gray-50 dark:bg-gray-850 selected-command-option-button":""))&&f(e,"class",c)},d(b){b&&h(e),d=!1,bt(m)}}}function dr(n){let e,t=n[1].length>0&&ql(n);return{c(){t&&t.c(),e=Fe()},l(l){t&&t.l(l),e=Fe()},m(l,s){t&&t.m(l,s),O(l,e,s)},p(l,[s]){l[1].length>0?t?t.p(l,s):(t=ql(l),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},i:ge,o:ge,d(l){l&&h(e),t&&t.d(l)}}}const hr=()=>{};function mr(n,e,t){let l,s;ae(n,Zn,b=>t(9,s=b));const o=wt("i18n");ae(n,o,b=>t(2,l=b));let{files:r}=e,{prompt:i=""}=e,a=0,u=[];const c=()=>{t(0,a=Math.max(0,a-1))},d=()=>{t(0,a=Math.min(a+1,u.length-1))},m=async b=>{let _=b.content;if(b.content.includes("{{CLIPBOARD}}")){const T=await navigator.clipboard.readText().catch(M=>(De.error(l.t("Failed to read clipboard contents")),"{{CLIPBOARD}}"));console.log(T);const D=await navigator.clipboard.read();let N=null;for(const M of D)for(const L of M.types)if(L.startsWith("image/")){const C=await M.getType(L);N=URL.createObjectURL(C),console.log(`Image URL (${L}): ${N}`)}N&&t(6,r=[...r,{type:"image",url:N}]),_=b.content.replaceAll("{{CLIPBOARD}}",T)}t(5,i=_);const p=document.getElementById("chat-textarea");await Ve(),p.style.height="",p.style.height=Math.min(p.scrollHeight,200)+"px",p==null||p.focus(),await Ve();const w=Hn(i);if(w.length>0){const T=w.at(0);p.setSelectionRange(T==null?void 0:T.startIndex,T.endIndex+1)}},v=b=>{m(b)},y=b=>{t(0,a=b)};return n.$$set=b=>{"files"in b&&t(6,r=b.files),"prompt"in b&&t(5,i=b.prompt)},n.$$.update=()=>{n.$$.dirty&544&&t(1,u=s.filter(b=>b.command.includes(i)).sort((b,_)=>b.title.localeCompare(_.title))),n.$$.dirty&32&&i&&t(0,a=0)},[a,u,l,o,m,i,r,c,d,s,v,y]}class gr extends xe{constructor(e){super(),$e(this,e,mr,dr,Ke,{files:6,prompt:5,selectUp:7,selectDown:8})}get selectUp(){return this.$$.ctx[7]}get selectDown(){return this.$$.ctx[8]}}function Zl(n,e,t){const l=n.slice();return l[19]=e[t],l[21]=t,l}function Gl(n){let e,t,l,s='<div class="text-lg font-semibold mt-2">#</div>',o,r,i,a,u,c,d=nt(n[3]),m=[];for(let _=0;_<d.length;_+=1)m[_]=Jl(Zl(n,d,_));function v(_,p){var w,T;if(p&1&&(u=null),p&1&&(c=null),u==null&&(u=!!_[0].split(" ").some(kr)),u)return br;if(c==null&&(c=!!((T=(w=_[0].split(" "))==null?void 0:w.at(0))!=null&&T.substring(1).startsWith("http"))),c)return vr}let y=v(n,-1),b=y&&y(n);return{c(){e=I("div"),t=I("div"),l=I("div"),l.innerHTML=s,o=J(),r=I("div"),i=I("div");for(let _=0;_<m.length;_+=1)m[_].c();a=J(),b&&b.c(),this.h()},l(_){e=S(_,"DIV",{class:!0});var p=E(e);t=S(p,"DIV",{class:!0});var w=E(t);l=S(w,"DIV",{class:!0,"data-svelte-h":!0}),Ye(l)!=="svelte-1bz58rh"&&(l.innerHTML=s),o=Q(w),r=S(w,"DIV",{class:!0});var T=E(r);i=S(T,"DIV",{class:!0});var D=E(i);for(let N=0;N<m.length;N+=1)m[N].l(D);a=Q(D),b&&b.l(D),D.forEach(h),T.forEach(h),w.forEach(h),p.forEach(h),this.h()},h(){f(l,"class","bg-gray-50 dark:bg-gray-850 w-10 rounded-l-lg text-center"),f(i,"class","m-1 overflow-y-auto p-1 rounded-r-xl space-y-0.5 scrollbar-hidden"),f(r,"class","max-h-60 flex flex-col w-full rounded-r-xl bg-white dark:bg-gray-900 dark:text-gray-100"),f(t,"class","flex w-full dark:border dark:border-gray-850 rounded-lg"),f(e,"class","pl-1 pr-12 mb-3 text-left w-full absolute bottom-0 left-0 right-0")},m(_,p){O(_,e,p),g(e,t),g(t,l),g(t,o),g(t,r),g(r,i);for(let w=0;w<m.length;w+=1)m[w]&&m[w].m(i,null);g(i,a),b&&b.m(i,null)},p(_,p){if(p&46){d=nt(_[3]);let w;for(w=0;w<d.length;w+=1){const T=Zl(_,d,w);m[w]?m[w].p(T,p):(m[w]=Jl(T),m[w].c(),m[w].m(i,a))}for(;w<m.length;w+=1)m[w].d(1);m.length=d.length}y===(y=v(_,p))&&b?b.p(_,p):(b&&b.d(1),b=y&&y(_),b&&(b.c(),b.m(i,null)))},d(_){_&&h(e),Bt(m,_),b&&b.d()}}}function _r(n){let e,t,l=n[19].name+"",s,o,r=n[19].filename+"",i,a,u,c,d=n[19].title+"",m;return{c(){e=I("div"),t=ve("#"),s=ve(l),o=ve(" ("),i=ve(r),a=ve(")"),u=J(),c=I("div"),m=ve(d),this.h()},l(v){e=S(v,"DIV",{class:!0});var y=E(e);t=be(y,"#"),s=be(y,l),o=be(y," ("),i=be(y,r),a=be(y,")"),y.forEach(h),u=Q(v),c=S(v,"DIV",{class:!0});var b=E(c);m=be(b,d),b.forEach(h),this.h()},h(){f(e,"class","font-medium text-black dark:text-gray-100 line-clamp-1"),f(c,"class","text-xs text-gray-600 dark:text-gray-100 line-clamp-1")},m(v,y){O(v,e,y),g(e,t),g(e,s),g(e,o),g(e,i),g(e,a),O(v,u,y),O(v,c,y),g(c,m)},p(v,y){y&8&&l!==(l=v[19].name+"")&&Me(s,l),y&8&&r!==(r=v[19].filename+"")&&Me(i,r),y&8&&d!==(d=v[19].title+"")&&Me(m,d)},d(v){v&&(h(e),h(u),h(c))}}}function pr(n){var a;let e,t=(((a=n[19])==null?void 0:a.title)??`#${n[19].name}`)+"",l,s,o,r=n[1].t("Collection")+"",i;return{c(){e=I("div"),l=ve(t),s=J(),o=I("div"),i=ve(r),this.h()},l(u){e=S(u,"DIV",{class:!0});var c=E(e);l=be(c,t),c.forEach(h),s=Q(u),o=S(u,"DIV",{class:!0});var d=E(o);i=be(d,r),d.forEach(h),this.h()},h(){f(e,"class","font-medium text-black dark:text-gray-100 line-clamp-1"),f(o,"class","text-xs text-gray-600 dark:text-gray-100 line-clamp-1")},m(u,c){O(u,e,c),g(e,l),O(u,s,c),O(u,o,c),g(o,i)},p(u,c){var d;c&8&&t!==(t=(((d=u[19])==null?void 0:d.title)??`#${u[19].name}`)+"")&&Me(l,t),c&2&&r!==(r=u[1].t("Collection")+"")&&Me(i,r)},d(u){u&&(h(e),h(s),h(o))}}}function Jl(n){let e,t,l,s;function o(c,d){return c[19].type==="collection"?pr:_r}let r=o(n),i=r(n);function a(){return n[14](n[19])}function u(){return n[15](n[21])}return{c(){e=I("button"),i.c(),this.h()},l(c){e=S(c,"BUTTON",{class:!0,type:!0});var d=E(e);i.l(d),d.forEach(h),this.h()},h(){f(e,"class",t="px-3 py-1.5 rounded-xl w-full text-left "+(n[21]===n[2]?" bg-gray-50 dark:bg-gray-850 dark:text-gray-100 selected-command-option-button":"")),f(e,"type","button")},m(c,d){O(c,e,d),i.m(e,null),l||(s=[te(e,"click",a),te(e,"mousemove",u),te(e,"focus",yr)],l=!0)},p(c,d){n=c,r===(r=o(n))&&i?i.p(n,d):(i.d(1),i=r(n),i&&(i.c(),i.m(e,null))),d&4&&t!==(t="px-3 py-1.5 rounded-xl w-full text-left "+(n[21]===n[2]?" bg-gray-50 dark:bg-gray-850 dark:text-gray-100 selected-command-option-button":""))&&f(e,"class",t)},d(c){c&&h(e),i.d(),l=!1,bt(s)}}}function vr(n){var d,m;let e,t,l=((m=(d=n[0].split(" "))==null?void 0:d.at(0))==null?void 0:m.substring(1))+"",s,o,r,i=n[1].t("Web")+"",a,u,c;return{c(){e=I("button"),t=I("div"),s=ve(l),o=J(),r=I("div"),a=ve(i),this.h()},l(v){e=S(v,"BUTTON",{class:!0,type:!0});var y=E(e);t=S(y,"DIV",{class:!0});var b=E(t);s=be(b,l),b.forEach(h),o=Q(y),r=S(y,"DIV",{class:!0});var _=E(r);a=be(_,i),_.forEach(h),y.forEach(h),this.h()},h(){f(t,"class","font-medium text-black line-clamp-1"),f(r,"class","text-xs text-gray-600 line-clamp-1"),f(e,"class","px-3 py-1.5 rounded-xl w-full text-left bg-gray-100 selected-command-option-button"),f(e,"type","button")},m(v,y){O(v,e,y),g(e,t),g(t,s),g(e,o),g(e,r),g(r,a),u||(c=te(e,"click",n[17]),u=!0)},p(v,y){var b,_;y&1&&l!==(l=((_=(b=v[0].split(" "))==null?void 0:b.at(0))==null?void 0:_.substring(1))+"")&&Me(s,l),y&2&&i!==(i=v[1].t("Web")+"")&&Me(a,i)},d(v){v&&h(e),u=!1,c()}}}function br(n){var d,m;let e,t,l=((m=(d=n[0].split(" "))==null?void 0:d.at(0))==null?void 0:m.substring(1))+"",s,o,r,i=n[1].t("Youtube")+"",a,u,c;return{c(){e=I("button"),t=I("div"),s=ve(l),o=J(),r=I("div"),a=ve(i),this.h()},l(v){e=S(v,"BUTTON",{class:!0,type:!0});var y=E(e);t=S(y,"DIV",{class:!0});var b=E(t);s=be(b,l),b.forEach(h),o=Q(y),r=S(y,"DIV",{class:!0});var _=E(r);a=be(_,i),_.forEach(h),y.forEach(h),this.h()},h(){f(t,"class","font-medium text-black line-clamp-1"),f(r,"class","text-xs text-gray-600 line-clamp-1"),f(e,"class","px-3 py-1.5 rounded-xl w-full text-left bg-gray-100 selected-command-option-button"),f(e,"type","button")},m(v,y){O(v,e,y),g(e,t),g(t,s),g(e,o),g(e,r),g(r,a),u||(c=te(e,"click",n[16]),u=!0)},p(v,y){var b,_;y&1&&l!==(l=((_=(b=v[0].split(" "))==null?void 0:b.at(0))==null?void 0:_.substring(1))+"")&&Me(s,l),y&2&&i!==(i=v[1].t("Youtube")+"")&&Me(a,i)},d(v){v&&h(e),u=!1,c()}}}function wr(n){var s,o;let e=n[3].length>0||((o=(s=n[0].split(" "))==null?void 0:s.at(0))==null?void 0:o.substring(1).startsWith("http")),t,l=e&&Gl(n);return{c(){l&&l.c(),t=Fe()},l(r){l&&l.l(r),t=Fe()},m(r,i){l&&l.m(r,i),O(r,t,i)},p(r,[i]){var a,u;i&9&&(e=r[3].length>0||((u=(a=r[0].split(" "))==null?void 0:a.at(0))==null?void 0:u.substring(1).startsWith("http"))),e?l?l.p(r,i):(l=Gl(r),l.c(),l.m(t.parentNode,t)):l&&(l.d(1),l=null)},i:ge,o:ge,d(r){r&&h(t),l&&l.d(r)}}}const kr=n=>n.substring(1).startsWith("https://www.youtube.com")||n.substring(1).startsWith("https://youtu.be"),yr=()=>{};function Er(n,e,t){let l,s,o;ae(n,Gn,M=>t(13,s=M));const r=wt("i18n");ae(n,r,M=>t(1,o=M));let{prompt:i=""}=e;const a=Gt();let u=0,c=[],d=[],m=[];const v=()=>{t(2,u=Math.max(0,u-1))},y=()=>{t(2,u=Math.min(u+1,c.length-1))},b=async M=>{a("select",M),t(0,i=ol(i));const L=document.getElementById("chat-textarea");await Ve(),L==null||L.focus(),await Ve()},_=async M=>{a("url",M),t(0,i=ol(i));const L=document.getElementById("chat-textarea");await Ve(),L==null||L.focus(),await Ve()},p=async M=>{a("youtube",M),t(0,i=ol(i));const L=document.getElementById("chat-textarea");await Ve(),L==null||L.focus(),await Ve()},w=M=>{console.log(M),b(M)},T=M=>{t(2,u=M)},D=()=>{var L,C;const M=(C=(L=i.split(" "))==null?void 0:L.at(0))==null?void 0:C.substring(1);kl(M)?p(M):De.error(o.t("Oops! Looks like the URL is invalid. Please double-check and try again."))},N=()=>{var L,C;const M=(C=(L=i.split(" "))==null?void 0:L.at(0))==null?void 0:C.substring(1);kl(M)?_(M):De.error(o.t("Oops! Looks like the URL is invalid. Please double-check and try again."))};return n.$$set=M=>{"prompt"in M&&t(0,i=M.prompt)},n.$$.update=()=>{n.$$.dirty&8194&&t(11,m=[...s.length>0?[{name:"All Documents",type:"collection",title:o.t("All Documents"),collection_names:s.map(M=>M.collection_name)}]:[],...s.reduce((M,L,C,W)=>{var j;return[...new Set([...M,...(((j=L==null?void 0:L.content)==null?void 0:j.tags)??[]).map(U=>U.name)])]},[]).map(M=>({name:M,type:"collection",collection_names:s.filter(L=>{var C;return(((C=L==null?void 0:L.content)==null?void 0:C.tags)??[]).map(W=>W.name).includes(M)}).map(L=>L.collection_name)}))]),n.$$.dirty&2049&&t(12,l=m.filter(M=>{var L,C;return M.name.includes(((C=(L=i.split(" "))==null?void 0:L.at(0))==null?void 0:C.substring(1))??"")}).sort((M,L)=>M.name.localeCompare(L.name))),n.$$.dirty&8193&&t(10,d=s.filter(M=>{var L,C;return M.name.includes(((C=(L=i.split(" "))==null?void 0:L.at(0))==null?void 0:C.substring(1))??"")}).sort((M,L)=>M.title.localeCompare(L.title))),n.$$.dirty&5120&&t(3,c=[...l,...d]),n.$$.dirty&4097&&i&&(t(2,u=0),console.log(l))},[i,o,u,c,r,b,_,p,v,y,d,m,l,s,w,T,D,N]}class Ir extends xe{constructor(e){super(),$e(this,e,Er,wr,Ke,{prompt:0,selectUp:8,selectDown:9})}get selectUp(){return this.$$.ctx[8]}get selectDown(){return this.$$.ctx[9]}}function Ql(n,e,t){const l=n.slice();return l[16]=e[t],l[18]=t,l}function Xl(n){let e,t=n[2].length>0&&Yl(n);return{c(){t&&t.c(),e=Fe()},l(l){t&&t.l(l),e=Fe()},m(l,s){t&&t.m(l,s),O(l,e,s)},p(l,s){l[2].length>0?t?t.p(l,s):(t=Yl(l),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},d(l){l&&h(e),t&&t.d(l)}}}function Yl(n){let e,t,l,s='<div class="text-lg font-semibold mt-2">@</div>',o,r,i,a=nt(n[2]),u=[];for(let c=0;c<a.length;c+=1)u[c]=Kl(Ql(n,a,c));return{c(){e=I("div"),t=I("div"),l=I("div"),l.innerHTML=s,o=J(),r=I("div"),i=I("div");for(let c=0;c<u.length;c+=1)u[c].c();this.h()},l(c){e=S(c,"DIV",{class:!0});var d=E(e);t=S(d,"DIV",{class:!0});var m=E(t);l=S(m,"DIV",{class:!0,"data-svelte-h":!0}),Ye(l)!=="svelte-1wyzeqe"&&(l.innerHTML=s),o=Q(m),r=S(m,"DIV",{class:!0});var v=E(r);i=S(v,"DIV",{class:!0});var y=E(i);for(let b=0;b<u.length;b+=1)u[b].l(y);y.forEach(h),v.forEach(h),m.forEach(h),d.forEach(h),this.h()},h(){f(l,"class","bg-gray-50 dark:bg-gray-850 w-10 rounded-l-lg text-center"),f(i,"class","m-1 overflow-y-auto p-1 rounded-r-lg space-y-0.5 scrollbar-hidden"),f(r,"class","max-h-60 flex flex-col w-full rounded-r-lg bg-white dark:bg-gray-900 dark:text-gray-100"),f(t,"class","flex w-full dark:border dark:border-gray-850 rounded-lg"),f(e,"class","pl-1 pr-12 mb-3 text-left w-full absolute bottom-0 left-0 right-0")},m(c,d){O(c,e,d),g(e,t),g(t,l),g(t,o),g(t,r),g(r,i);for(let m=0;m<u.length;m+=1)u[m]&&u[m].m(i,null)},p(c,d){if(d&22){a=nt(c[2]);let m;for(m=0;m<a.length;m+=1){const v=Ql(c,a,m);u[m]?u[m].p(v,d):(u[m]=Kl(v),u[m].c(),u[m].m(i,null))}for(;m<u.length;m+=1)u[m].d(1);u.length=a.length}},d(c){c&&h(e),Bt(u,c)}}}function Kl(n){let e,t,l=n[16].name+"",s,o,r,i,a;function u(){return n[11](n[16])}function c(){return n[12](n[18])}return{c(){e=I("button"),t=I("div"),s=ve(l),o=J(),this.h()},l(d){e=S(d,"BUTTON",{class:!0,type:!0});var m=E(e);t=S(m,"DIV",{class:!0});var v=E(t);s=be(v,l),v.forEach(h),o=Q(m),m.forEach(h),this.h()},h(){f(t,"class","font-medium text-black dark:text-gray-100 line-clamp-1"),f(e,"class",r="px-3 py-1.5 rounded-xl w-full text-left "+(n[18]===n[1]?"  bg-gray-50 dark:bg-gray-850  selected-command-option-button":"")),f(e,"type","button")},m(d,m){O(d,e,m),g(e,t),g(t,s),g(e,o),i||(a=[te(e,"click",u),te(e,"mousemove",c),te(e,"focus",Dr)],i=!0)},p(d,m){n=d,m&4&&l!==(l=n[16].name+"")&&Me(s,l),m&2&&r!==(r="px-3 py-1.5 rounded-xl w-full text-left "+(n[18]===n[1]?"  bg-gray-50 dark:bg-gray-850  selected-command-option-button":""))&&f(e,"class",r)},d(d){d&&h(e),i=!1,bt(a)}}}function Sr(n){let e=n[0].charAt(0)==="@",t,l=e&&Xl(n);return{c(){l&&l.c(),t=Fe()},l(s){l&&l.l(s),t=Fe()},m(s,o){l&&l.m(s,o),O(s,t,o)},p(s,[o]){o&1&&(e=s[0].charAt(0)==="@"),e?l?l.p(s,o):(l=Xl(s),l.c(),l.m(t.parentNode,t)):l&&(l.d(1),l=null)},i:ge,o:ge,d(s){s&&h(t),l&&l.d(s)}}}const Dr=()=>{};function Mr(n,e,t){let l;ae(n,ll,p=>t(10,l=p));const s=wt("i18n");ae(n,s,p=>t(13,p));const o=Gt();let{prompt:r=""}=e,{user:i=null}=e,{chatInputPlaceholder:a=""}=e,{messages:u=[]}=e,c=0,d=[];const m=()=>{t(1,c=Math.max(0,c-1))},v=()=>{t(1,c=Math.min(c+1,d.length-1))},y=async p=>{t(0,r=""),o("select",p)},b=p=>{y(p)},_=p=>{t(1,c=p)};return n.$$set=p=>{"prompt"in p&&t(0,r=p.prompt),"user"in p&&t(5,i=p.user),"chatInputPlaceholder"in p&&t(6,a=p.chatInputPlaceholder),"messages"in p&&t(7,u=p.messages)},n.$$.update=()=>{n.$$.dirty&1025&&t(2,d=l.filter(p=>{var w,T;return p.name.includes(((T=(w=r.split(" "))==null?void 0:w.at(0))==null?void 0:T.substring(1))??"")}).sort((p,w)=>p.name.localeCompare(w.name))),n.$$.dirty&1&&r&&t(1,c=0)},[r,c,d,s,y,i,a,u,m,v,l,b,_]}class Tr extends xe{constructor(e){super(),$e(this,e,Mr,Sr,Ke,{prompt:0,user:5,chatInputPlaceholder:6,messages:7,selectUp:8,selectDown:9})}get selectUp(){return this.$$.ctx[8]}get selectDown(){return this.$$.ctx[9]}}function Cr(n){let e,t;return{c(){e=ye("svg"),t=ye("path"),this.h()},l(l){e=Ee(l,"svg",{xmlns:!0,fill:!0,viewBox:!0,"stroke-width":!0,stroke:!0,class:!0});var s=E(e);t=Ee(s,"path",{"stroke-linecap":!0,"stroke-linejoin":!0,d:!0}),E(t).forEach(h),s.forEach(h),this.h()},h(){f(t,"stroke-linecap","round"),f(t,"stroke-linejoin","round"),f(t,"d","M6 18 18 6M6 6l12 12"),f(e,"xmlns","http://www.w3.org/2000/svg"),f(e,"fill","none"),f(e,"viewBox","0 0 24 24"),f(e,"stroke-width",n[1]),f(e,"stroke","currentColor"),f(e,"class",n[0])},m(l,s){O(l,e,s),g(e,t)},p(l,[s]){s&2&&f(e,"stroke-width",l[1]),s&1&&f(e,"class",l[0])},i:ge,o:ge,d(l){l&&h(e)}}}function Vr(n,e,t){let{className:l="size-3.5"}=e,{strokeWidth:s="2"}=e;return n.$$set=o=>{"className"in o&&t(0,l=o.className),"strokeWidth"in o&&t(1,s=o.strokeWidth)},[l,s]}class Br extends xe{constructor(e){super(),$e(this,e,Vr,Cr,Ke,{className:0,strokeWidth:1})}}function Nr(n){let e,t,l;return{c(){e=ye("svg"),t=ye("path"),l=ye("path"),this.h()},l(s){e=Ee(s,"svg",{xmlns:!0,viewBox:!0,fill:!0,class:!0});var o=E(e);t=Ee(o,"path",{"fill-rule":!0,d:!0,"clip-rule":!0}),E(t).forEach(h),l=Ee(o,"path",{d:!0}),E(l).forEach(h),o.forEach(h),this.h()},h(){f(t,"fill-rule","evenodd"),f(t,"d","M5.625 1.5H9a3.75 3.75 0 0 1 3.75 3.75v1.875c0 1.036.84 1.875 1.875 1.875H16.5a3.75 3.75 0 0 1 3.75 3.75v7.875c0 1.035-.84 1.875-1.875 1.875H5.625a1.875 1.875 0 0 1-1.875-1.875V3.375c0-1.036.84-1.875 1.875-1.875Zm6.905 9.97a.75.75 0 0 0-1.06 0l-3 3a.75.75 0 1 0 1.06 1.06l1.72-1.72V18a.75.75 0 0 0 1.5 0v-4.19l1.72 1.72a.75.75 0 1 0 1.06-1.06l-3-3Z"),f(t,"clip-rule","evenodd"),f(l,"d","M14.25 5.25a5.23 5.23 0 0 0-1.279-3.434 9.768 9.768 0 0 1 6.963 6.963A5.23 5.23 0 0 0 16.5 7.5h-1.875a.375.375 0 0 1-.375-.375V5.25Z"),f(e,"xmlns","http://www.w3.org/2000/svg"),f(e,"viewBox","0 0 24 24"),f(e,"fill","currentColor"),f(e,"class",n[0])},m(s,o){O(s,e,o),g(e,t),g(e,l)},p(s,[o]){o&1&&f(e,"class",s[0])},i:ge,o:ge,d(s){s&&h(e)}}}function Ar(n,e,t){let{className:l="size-4"}=e;return n.$$set=s=>{"className"in s&&t(0,l=s.className)},[l]}class Lr extends xe{constructor(e){super(),$e(this,e,Ar,Nr,Ke,{className:0})}}function Hr(n){let e,t;return{c(){e=ye("svg"),t=ye("path"),this.h()},l(l){e=Ee(l,"svg",{xmlns:!0,viewBox:!0,fill:!0,class:!0});var s=E(e);t=Ee(s,"path",{d:!0}),E(t).forEach(h),s.forEach(h),this.h()},h(){f(t,"d","M21.721 12.752a9.711 9.711 0 0 0-.945-5.003 12.754 12.754 0 0 1-4.339 2.708 18.991 18.991 0 0 1-.214 4.772 17.165 17.165 0 0 0 5.498-2.477ZM14.634 15.55a17.324 17.324 0 0 0 .332-4.647c-.952.227-1.945.347-2.966.347-1.021 0-2.014-.12-2.966-.347a17.515 17.515 0 0 0 .332 4.647 17.385 17.385 0 0 0 5.268 0ZM9.772 17.119a18.963 18.963 0 0 0 4.456 0A17.182 17.182 0 0 1 12 21.724a17.18 17.18 0 0 1-2.228-4.605ZM7.777 15.23a18.87 18.87 0 0 1-.214-4.774 12.753 12.753 0 0 1-4.34-2.708 9.711 9.711 0 0 0-.944 5.004 17.165 17.165 0 0 0 5.498 2.477ZM21.356 14.752a9.765 9.765 0 0 1-7.478 6.817 18.64 18.64 0 0 0 1.988-4.718 18.627 18.627 0 0 0 5.49-2.098ZM2.644 14.752c1.682.971 3.53 1.688 5.49 2.099a18.64 18.64 0 0 0 1.988 4.718 9.765 9.765 0 0 1-7.478-6.816ZM13.878 2.43a9.755 9.755 0 0 1 6.116 3.986 11.267 11.267 0 0 1-3.746 2.504 18.63 18.63 0 0 0-2.37-6.49ZM12 2.276a17.152 17.152 0 0 1 2.805 7.121c-.897.23-1.837.353-2.805.353-.968 0-1.908-.122-2.805-.353A17.151 17.151 0 0 1 12 2.276ZM10.122 2.43a18.629 18.629 0 0 0-2.37 6.49 11.266 11.266 0 0 1-3.746-2.504 9.754 9.754 0 0 1 6.116-3.985Z"),f(e,"xmlns","http://www.w3.org/2000/svg"),f(e,"viewBox","0 0 24 24"),f(e,"fill","currentColor"),f(e,"class",n[0])},m(l,s){O(l,e,s),g(e,t)},p(l,[s]){s&1&&f(e,"class",l[0])},i:ge,o:ge,d(l){l&&h(e)}}}function Or(n,e,t){let{className:l="size-4"}=e;return n.$$set=s=>{"className"in s&&t(0,l=s.className)},[l]}class Ur extends xe{constructor(e){super(),$e(this,e,Or,Hr,Ke,{className:0})}}function Pr(n){let e,t;return{c(){e=ye("svg"),t=ye("path"),this.h()},l(l){e=Ee(l,"svg",{xmlns:!0,viewBox:!0,fill:!0,class:!0});var s=E(e);t=Ee(s,"path",{"fill-rule":!0,d:!0,"clip-rule":!0}),E(t).forEach(h),s.forEach(h),this.h()},h(){f(t,"fill-rule","evenodd"),f(t,"d","M12 6.75a5.25 5.25 0 0 1 6.775-5.025.75.75 0 0 1 .313 1.248l-3.32 3.319c.063.475.276.934.641 1.299.365.365.824.578 1.3.64l3.318-3.319a.75.75 0 0 1 1.248.313 5.25 5.25 0 0 1-5.472 6.756c-1.018-.086-1.87.1-2.309.634L7.344 21.3A3.298 3.298 0 1 1 2.7 16.657l8.684-7.151c.533-.44.72-1.291.634-2.309A5.342 5.342 0 0 1 12 6.75ZM4.117 19.125a.75.75 0 0 1 .75-.75h.008a.75.75 0 0 1 .75.75v.008a.75.75 0 0 1-.75.75h-.008a.75.75 0 0 1-.75-.75v-.008Z"),f(t,"clip-rule","evenodd"),f(e,"xmlns","http://www.w3.org/2000/svg"),f(e,"viewBox","0 0 24 24"),f(e,"fill","currentColor"),f(e,"class",n[0])},m(l,s){O(l,e,s),g(e,t)},p(l,[s]){s&1&&f(e,"class",l[0])},i:ge,o:ge,d(l){l&&h(e)}}}function zr(n,e,t){let{className:l="size-4"}=e;return n.$$set=s=>{"className"in s&&t(0,l=s.className)},[l]}class Rr extends xe{constructor(e){super(),$e(this,e,zr,Pr,Ke,{className:0})}}function xl(n,e,t){const l=n.slice();return l[17]=e[t],l[18]=e,l[19]=t,l}function jr(n){let e;const t=n[9].default,l=gt(t,n,n[16],null);return{c(){l&&l.c()},l(s){l&&l.l(s)},m(s,o){l&&l.m(s,o),e=!0},p(s,o){l&&l.p&&(!e||o&65536)&&_t(l,t,s,s[16],e?vt(t,s[16],o,null):pt(s[16]),null)},i(s){e||(H(l,s),e=!0)},o(s){z(l,s),e=!1},d(s){l&&l.d(s)}}}function Fr(n){let e,t;return e=new Nt({props:{content:n[7].t("More"),$$slots:{default:[jr]},$$scope:{ctx:n}}}),{c(){ce(e.$$.fragment)},l(l){ue(e.$$.fragment,l)},m(l,s){fe(e,l,s),t=!0},p(l,s){const o={};s&128&&(o.content=l[7].t("More")),s&65536&&(o.$$scope={dirty:s,ctx:l}),e.$set(o)},i(l){t||(H(e.$$.fragment,l),t=!0)},o(l){z(e.$$.fragment,l),t=!1},d(l){de(e,l)}}}function $l(n){let e,t,l,s,o=nt(Object.keys(n[1])),r=[];for(let a=0;a<o.length;a+=1)r[a]=en(xl(n,o,a));const i=a=>z(r[a],1,1,()=>{r[a]=null});return{c(){e=I("div");for(let a=0;a<r.length;a+=1)r[a].c();t=J(),l=I("hr"),this.h()},l(a){e=S(a,"DIV",{class:!0});var u=E(e);for(let c=0;c<r.length;c+=1)r[c].l(u);u.forEach(h),t=Q(a),l=S(a,"HR",{class:!0}),this.h()},h(){f(e,"class","max-h-28 overflow-y-auto scrollbar-hidden"),f(l,"class","border-gray-100 dark:border-gray-800 my-1")},m(a,u){O(a,e,u);for(let c=0;c<r.length;c+=1)r[c]&&r[c].m(e,null);O(a,t,u),O(a,l,u),s=!0},p(a,u){if(u&3){o=nt(Object.keys(a[1]));let c;for(c=0;c<o.length;c+=1){const d=xl(a,o,c);r[c]?(r[c].p(d,u),H(r[c],1)):(r[c]=en(d),r[c].c(),H(r[c],1),r[c].m(e,null))}for(Pe(),c=o.length;c<r.length;c+=1)i(c);ze()}},i(a){if(!s){for(let u=0;u<o.length;u+=1)H(r[u]);s=!0}},o(a){r=r.filter(Boolean);for(let u=0;u<r.length;u+=1)z(r[u]);s=!1},d(a){a&&(h(e),h(t),h(l)),Bt(r,a)}}}function qr(n){let e,t=n[1][n[17]].name+"",l;return{c(){e=I("div"),l=ve(t),this.h()},l(s){e=S(s,"DIV",{class:!0});var o=E(e);l=be(o,t),o.forEach(h),this.h()},h(){f(e,"class","line-clamp-1")},m(s,o){O(s,e,o),g(e,l)},p(s,o){o&2&&t!==(t=s[1][s[17]].name+"")&&Me(l,t)},d(s){s&&h(e)}}}function en(n){var y;let e,t,l,s,o,r,i,a,u,c;l=new Rr({}),o=new Nt({props:{content:((y=n[1][n[17]])==null?void 0:y.description)??"",className:"flex-1",$$slots:{default:[qr]},$$scope:{ctx:n}}});function d(b){n[10](b,n[17])}function m(...b){return n[11](n[17],...b)}let v={};return n[1][n[17]].enabled!==void 0&&(v.state=n[1][n[17]].enabled),i=new Un({props:v}),Ie.push(()=>Ue(i,"state",d)),i.$on("change",m),{c(){e=I("div"),t=I("div"),ce(l.$$.fragment),s=J(),ce(o.$$.fragment),r=J(),ce(i.$$.fragment),u=J(),this.h()},l(b){e=S(b,"DIV",{class:!0});var _=E(e);t=S(_,"DIV",{class:!0});var p=E(t);ue(l.$$.fragment,p),s=Q(p),ue(o.$$.fragment,p),p.forEach(h),r=Q(_),ue(i.$$.fragment,_),u=Q(_),_.forEach(h),this.h()},h(){f(t,"class","flex-1 flex items-center gap-2"),f(e,"class","flex gap-2 items-center px-3 py-2 text-sm font-medium cursor-pointer rounded-xl")},m(b,_){O(b,e,_),g(e,t),fe(l,t,null),g(t,s),fe(o,t,null),g(e,r),fe(i,e,null),g(e,u),c=!0},p(b,_){var T;n=b;const p={};_&2&&(p.content=((T=n[1][n[17]])==null?void 0:T.description)??""),_&65538&&(p.$$scope={dirty:_,ctx:n}),o.$set(p);const w={};!a&&_&2&&(a=!0,w.state=n[1][n[17]].enabled,Oe(()=>a=!1)),i.$set(w)},i(b){c||(H(l.$$.fragment,b),H(o.$$.fragment,b),H(i.$$.fragment,b),c=!0)},o(b){z(l.$$.fragment,b),z(o.$$.fragment,b),z(i.$$.fragment,b),c=!1},d(b){b&&h(e),de(l),de(o),de(i)}}}function tn(n){let e,t,l,s,o,r=n[7].t("Web Search")+"",i,a,u,c,d,m,v;l=new Ur({});function y(_){n[12](_)}let b={};return n[2]!==void 0&&(b.state=n[2]),u=new Un({props:b}),Ie.push(()=>Ue(u,"state",y)),{c(){e=I("div"),t=I("div"),ce(l.$$.fragment),s=J(),o=I("div"),i=ve(r),a=J(),ce(u.$$.fragment),d=J(),m=I("hr"),this.h()},l(_){e=S(_,"DIV",{class:!0});var p=E(e);t=S(p,"DIV",{class:!0});var w=E(t);ue(l.$$.fragment,w),s=Q(w),o=S(w,"DIV",{class:!0});var T=E(o);i=be(T,r),T.forEach(h),w.forEach(h),a=Q(p),ue(u.$$.fragment,p),p.forEach(h),d=Q(_),m=S(_,"HR",{class:!0}),this.h()},h(){f(o,"class","line-clamp-1"),f(t,"class","flex-1 flex items-center gap-2"),f(e,"class","flex gap-2 items-center px-3 py-2 text-sm font-medium cursor-pointer rounded-xl"),f(m,"class","border-gray-100 dark:border-gray-800 my-1")},m(_,p){O(_,e,p),g(e,t),fe(l,t,null),g(t,s),g(t,o),g(o,i),g(e,a),fe(u,e,null),O(_,d,p),O(_,m,p),v=!0},p(_,p){(!v||p&128)&&r!==(r=_[7].t("Web Search")+"")&&Me(i,r);const w={};!c&&p&4&&(c=!0,w.state=_[2],Oe(()=>c=!1)),u.$set(w)},i(_){v||(H(l.$$.fragment,_),H(u.$$.fragment,_),v=!0)},o(_){z(l.$$.fragment,_),z(u.$$.fragment,_),v=!1},d(_){_&&(h(e),h(d),h(m)),de(l),de(u)}}}function Wr(n){let e,t,l,s=n[7].t("Upload Files")+"",o,r;return e=new Lr({}),{c(){ce(e.$$.fragment),t=J(),l=I("div"),o=ve(s),this.h()},l(i){ue(e.$$.fragment,i),t=Q(i),l=S(i,"DIV",{class:!0});var a=E(l);o=be(a,s),a.forEach(h),this.h()},h(){f(l,"class","line-clamp-1")},m(i,a){fe(e,i,a),O(i,t,a),O(i,l,a),g(l,o),r=!0},p(i,a){(!r||a&128)&&s!==(s=i[7].t("Upload Files")+"")&&Me(o,s)},i(i){r||(H(e.$$.fragment,i),r=!0)},o(i){z(e.$$.fragment,i),r=!1},d(i){i&&(h(t),h(l)),de(e,i)}}}function Zr(n){var a,u;let e=Object.keys(n[1]).length>0,t,l,s,o,r=e&&$l(n),i=((u=(a=n[6])==null?void 0:a.features)==null?void 0:u.enable_web_search)&&tn(n);return s=new Rt({props:{class:"flex gap-2 items-center px-3 py-2 text-sm  font-medium cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800  rounded-xl",$$slots:{default:[Wr]},$$scope:{ctx:n}}}),s.$on("click",n[13]),{c(){r&&r.c(),t=J(),i&&i.c(),l=J(),ce(s.$$.fragment)},l(c){r&&r.l(c),t=Q(c),i&&i.l(c),l=Q(c),ue(s.$$.fragment,c)},m(c,d){r&&r.m(c,d),O(c,t,d),i&&i.m(c,d),O(c,l,d),fe(s,c,d),o=!0},p(c,d){var v,y;d&2&&(e=Object.keys(c[1]).length>0),e?r?(r.p(c,d),d&2&&H(r,1)):(r=$l(c),r.c(),H(r,1),r.m(t.parentNode,t)):r&&(Pe(),z(r,1,1,()=>{r=null}),ze()),(y=(v=c[6])==null?void 0:v.features)!=null&&y.enable_web_search?i?(i.p(c,d),d&64&&H(i,1)):(i=tn(c),i.c(),H(i,1),i.m(l.parentNode,l)):i&&(Pe(),z(i,1,1,()=>{i=null}),ze());const m={};d&65664&&(m.$$scope={dirty:d,ctx:c}),s.$set(m)},i(c){o||(H(r),H(i),H(s.$$.fragment,c),o=!0)},o(c){z(r),z(i),z(s.$$.fragment,c),o=!1},d(c){c&&(h(t),h(l)),r&&r.d(c),i&&i.d(c),de(s,c)}}}function Gr(n){let e,t,l;return t=new dl({props:{class:"w-full max-w-[200px] rounded-xl px-1 py-1  border-gray-300/30 dark:border-gray-700/50 z-50 bg-white dark:bg-gray-850 dark:text-white shadow",sideOffset:15,alignOffset:-8,side:"top",align:"start",transition:nl,$$slots:{default:[Zr]},$$scope:{ctx:n}}}),{c(){e=I("div"),ce(t.$$.fragment),this.h()},l(s){e=S(s,"DIV",{slot:!0});var o=E(e);ue(t.$$.fragment,o),o.forEach(h),this.h()},h(){f(e,"slot","content")},m(s,o){O(s,e,o),fe(t,e,null),l=!0},p(s,o){const r={};o&65743&&(r.$$scope={dirty:o,ctx:s}),t.$set(r)},i(s){l||(H(t.$$.fragment,s),l=!0)},o(s){z(t.$$.fragment,s),l=!1},d(s){s&&h(e),de(t)}}}function Jr(n){let e,t,l;function s(r){n[14](r)}let o={$$slots:{content:[Gr],default:[Fr]},$$scope:{ctx:n}};return n[5]!==void 0&&(o.show=n[5]),e=new fl({props:o}),Ie.push(()=>Ue(e,"show",s)),e.$on("change",n[15]),{c(){ce(e.$$.fragment)},l(r){ue(e.$$.fragment,r)},m(r,i){fe(e,r,i),l=!0},p(r,[i]){const a={};i&65743&&(a.$$scope={dirty:i,ctx:r}),!t&&i&32&&(t=!0,a.show=r[5],Oe(()=>t=!1)),e.$set(a)},i(r){l||(H(e.$$.fragment,r),l=!0)},o(r){z(e.$$.fragment,r),l=!1},d(r){de(e,r)}}}function Qr(n,e,t){let l,s;ae(n,Jt,D=>t(6,l=D));let{$$slots:o={},$$scope:r}=e;const i=wt("i18n");ae(n,i,D=>t(7,s=D));let{uploadFilesHandler:a}=e,{selectedToolIds:u=[]}=e,{webSearchEnabled:c}=e,{tools:d={}}=e,{onClose:m}=e,v=!1;function y(D,N){n.$$.not_equal(d[N].enabled,D)&&(d[N].enabled=D,t(1,d),t(0,u))}const b=(D,N)=>{t(0,u=N.detail?[...u,D]:u.filter(M=>M!==D))};function _(D){c=D,t(2,c)}const p=()=>{a()};function w(D){v=D,t(5,v)}const T=D=>{D.detail===!1&&m()};return n.$$set=D=>{"uploadFilesHandler"in D&&t(3,a=D.uploadFilesHandler),"selectedToolIds"in D&&t(0,u=D.selectedToolIds),"webSearchEnabled"in D&&t(2,c=D.webSearchEnabled),"tools"in D&&t(1,d=D.tools),"onClose"in D&&t(4,m=D.onClose),"$$scope"in D&&t(16,r=D.$$scope)},n.$$.update=()=>{n.$$.dirty&3&&t(1,d=Object.fromEntries(Object.keys(d).map(D=>[D,{...d[D],enabled:u.includes(D)}])))},[u,d,c,a,m,v,l,s,i,o,y,b,_,p,w,T,r]}class Xr extends xe{constructor(e){super(),$e(this,e,Qr,Jr,Ke,{uploadFilesHandler:3,selectedToolIds:0,webSearchEnabled:2,tools:1,onClose:4})}}function Yr(n){let e,t;return{c(){e=ye("svg"),t=ye("path"),this.h()},l(l){e=Ee(l,"svg",{"aria-hidden":!0,xmlns:!0,fill:!0,viewBox:!0,"stroke-width":!0,stroke:!0,class:!0});var s=E(e);t=Ee(s,"path",{"fill-rule":!0,d:!0,"clip-rule":!0}),E(t).forEach(h),s.forEach(h),this.h()},h(){f(t,"fill-rule","evenodd"),f(t,"d","M12 5a7 7 0 0 0-7 7v1.17c.313-.11.65-.17 1-.17h2a1 1 0 0 1 1 1v6a1 1 0 0 1-1 1H6a3 3 0 0 1-3-3v-6a9 9 0 0 1 18 0v6a3 3 0 0 1-3 3h-2a1 1 0 0 1-1-1v-6a1 1 0 0 1 1-1h2c.35 0 .687.06 1 .17V12a7 7 0 0 0-7-7Z"),f(t,"clip-rule","evenodd"),f(e,"aria-hidden","true"),f(e,"xmlns","http://www.w3.org/2000/svg"),f(e,"fill","currentColor"),f(e,"viewBox","0 0 24 24"),f(e,"stroke-width",n[1]),f(e,"stroke","currentColor"),f(e,"class",n[0])},m(l,s){O(l,e,s),g(e,t)},p(l,[s]){s&2&&f(e,"stroke-width",l[1]),s&1&&f(e,"class",l[0])},i:ge,o:ge,d(l){l&&h(e)}}}function Kr(n,e,t){let{className:l="w-4 h-4"}=e,{strokeWidth:s="0"}=e;return n.$$set=o=>{"className"in o&&t(0,l=o.className),"strokeWidth"in o&&t(1,s=o.strokeWidth)},[l,s]}class xr extends xe{constructor(e){super(),$e(this,e,Kr,Yr,Ke,{className:0,strokeWidth:1})}}function ln(n,e,t){const l=n.slice();return l[29]=e[t],l}function nn(n){let e,t;return{c(){e=I("div"),this.h()},l(l){e=S(l,"DIV",{class:!0,style:!0}),E(e).forEach(h),this.h()},h(){f(e,"class",t="w-[2px] "+(n[0]?" bg-gray-500 dark:bg-gray-400   ":"bg-indigo-500 dark:bg-indigo-400  ")+" inline-block h-full"),ht(e,"height",Math.min(100,Math.max(14,n[29]*100))+"%")},m(l,s){O(l,e,s)},p(l,s){s[0]&1&&t!==(t="w-[2px] "+(l[0]?" bg-gray-500 dark:bg-gray-400   ":"bg-indigo-500 dark:bg-indigo-400  ")+" inline-block h-full")&&f(e,"class",t),s[0]&4&&ht(e,"height",Math.min(100,Math.max(14,l[29]*100))+"%")},d(l){l&&h(e)}}}function $r(n){let e,t='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2.5" stroke="currentColor" class="size-4"><path stroke-linecap="round" stroke-linejoin="round" d="m4.5 12.75 6 6 9-13.5"></path></svg>',l,s;return{c(){e=I("button"),e.innerHTML=t,this.h()},l(o){e=S(o,"BUTTON",{type:!0,class:!0,"data-svelte-h":!0}),Ye(e)!=="svelte-1qzkal"&&(e.innerHTML=t),this.h()},h(){f(e,"type","button"),f(e,"class","p-1.5 bg-indigo-500 text-white dark:bg-indigo-500 dark:text-blue-950 rounded-full")},m(o,r){O(o,e,r),l||(s=te(e,"click",n[10]),l=!0)},p:ge,d(o){o&&h(e),l=!1,s()}}}function eo(n){let e,t=`<svg width="24" height="24" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" fill="currentColor"><style>.spinner_OSmW {
							transform-origin: center;
							animation: spinner_T6mA 0.75s step-end infinite;
						}
						@keyframes spinner_T6mA {
							8.3% {
								transform: rotate(30deg);
							}
							16.6% {
								transform: rotate(60deg);
							}
							25% {
								transform: rotate(90deg);
							}
							33.3% {
								transform: rotate(120deg);
							}
							41.6% {
								transform: rotate(150deg);
							}
							50% {
								transform: rotate(180deg);
							}
							58.3% {
								transform: rotate(210deg);
							}
							66.6% {
								transform: rotate(240deg);
							}
							75% {
								transform: rotate(270deg);
							}
							83.3% {
								transform: rotate(300deg);
							}
							91.6% {
								transform: rotate(330deg);
							}
							100% {
								transform: rotate(360deg);
							}
						}
					</style><g class="spinner_OSmW"><rect x="11" y="1" width="2" height="5" opacity=".14"></rect><rect x="11" y="1" width="2" height="5" transform="rotate(30 12 12)" opacity=".29"></rect><rect x="11" y="1" width="2" height="5" transform="rotate(60 12 12)" opacity=".43"></rect><rect x="11" y="1" width="2" height="5" transform="rotate(90 12 12)" opacity=".57"></rect><rect x="11" y="1" width="2" height="5" transform="rotate(120 12 12)" opacity=".71"></rect><rect x="11" y="1" width="2" height="5" transform="rotate(150 12 12)" opacity=".86"></rect><rect x="11" y="1" width="2" height="5" transform="rotate(180 12 12)"></rect></g></svg>`;return{c(){e=I("div"),e.innerHTML=t,this.h()},l(l){e=S(l,"DIV",{class:!0,"data-svelte-h":!0}),Ye(e)!=="svelte-otpw2s"&&(e.innerHTML=t),this.h()},h(){f(e,"class","text-gray-500 rounded-full cursor-not-allowed")},m(l,s){O(l,e,s)},p:ge,d(l){l&&h(e)}}}function to(n){let e,t,l,s,o,r,i,a,u,c,d,m,v=n[5](n[1])+"",y,b,_,p,w,T,D,N=nt(n[2].slice().reverse()),M=[];for(let j=0;j<N.length;j+=1)M[j]=nn(ln(n,N,j));function L(j,U){return j[0]?eo:$r}let C=L(n),W=C(n);return{c(){e=I("div"),t=I("div"),l=I("button"),s=ye("svg"),o=ye("path"),i=J(),a=I("div"),u=I("div");for(let j=0;j<M.length;j+=1)M[j].c();c=J(),d=I("div"),m=I("div"),y=ve(v),_=J(),p=I("div"),W.c(),this.h()},l(j){e=S(j,"DIV",{class:!0});var U=E(e);t=S(U,"DIV",{class:!0});var q=E(t);l=S(q,"BUTTON",{type:!0,class:!0});var oe=E(l);s=Ee(oe,"svg",{xmlns:!0,fill:!0,viewBox:!0,"stroke-width":!0,stroke:!0,class:!0});var K=E(s);o=Ee(K,"path",{"stroke-linecap":!0,"stroke-linejoin":!0,d:!0}),E(o).forEach(h),K.forEach(h),oe.forEach(h),q.forEach(h),i=Q(U),a=S(U,"DIV",{class:!0,dir:!0});var P=E(a);u=S(P,"DIV",{class:!0});var V=E(u);for(let le=0;le<M.length;le+=1)M[le].l(V);V.forEach(h),P.forEach(h),c=Q(U),d=S(U,"DIV",{class:!0});var A=E(d);m=S(A,"DIV",{class:!0});var X=E(m);y=be(X,v),X.forEach(h),A.forEach(h),_=Q(U),p=S(U,"DIV",{class:!0});var re=E(p);W.l(re),re.forEach(h),U.forEach(h),this.h()},h(){f(o,"stroke-linecap","round"),f(o,"stroke-linejoin","round"),f(o,"d","M6 18 18 6M6 6l12 12"),f(s,"xmlns","http://www.w3.org/2000/svg"),f(s,"fill","none"),f(s,"viewBox","0 0 24 24"),f(s,"stroke-width","3"),f(s,"stroke","currentColor"),f(s,"class","size-4"),f(l,"type","button"),f(l,"class",r="p-1.5 "+(n[0]?" bg-gray-200 dark:bg-gray-700/50":"bg-indigo-400/20 text-indigo-600 dark:text-indigo-300 ")+" rounded-full"),f(t,"class","flex items-center mr-1"),f(u,"class","flex-1 flex items-center gap-0.5 h-6"),f(a,"class","flex flex-1 self-center items-center justify-between ml-2 mx-1 overflow-hidden h-6"),f(a,"dir","rtl"),f(m,"class",b="text-sm "+(n[0]?" text-gray-500  dark:text-gray-400  ":" text-indigo-400 ")+" font-medium flex-1 mx-auto text-center"),f(d,"class","mx-1.5 pr-1 flex justify-center items-center"),f(p,"class","flex items-center mr-1"),f(e,"class",w=(n[0]?" bg-gray-100/50 dark:bg-gray-850/50":"bg-indigo-300/10 dark:bg-indigo-500/10 ")+" rounded-full flex p-2.5")},m(j,U){O(j,e,U),g(e,t),g(t,l),g(l,s),g(s,o),g(e,i),g(e,a),g(a,u);for(let q=0;q<M.length;q+=1)M[q]&&M[q].m(u,null);g(e,c),g(e,d),g(d,m),g(m,y),g(e,_),g(e,p),W.m(p,null),T||(D=te(l,"click",n[9]),T=!0)},p(j,U){if(U[0]&1&&r!==(r="p-1.5 "+(j[0]?" bg-gray-200 dark:bg-gray-700/50":"bg-indigo-400/20 text-indigo-600 dark:text-indigo-300 ")+" rounded-full")&&f(l,"class",r),U[0]&5){N=nt(j[2].slice().reverse());let q;for(q=0;q<N.length;q+=1){const oe=ln(j,N,q);M[q]?M[q].p(oe,U):(M[q]=nn(oe),M[q].c(),M[q].m(u,null))}for(;q<M.length;q+=1)M[q].d(1);M.length=N.length}U[0]&2&&v!==(v=j[5](j[1])+"")&&Me(y,v),U[0]&1&&b!==(b="text-sm "+(j[0]?" text-gray-500  dark:text-gray-400  ":" text-indigo-400 ")+" font-medium flex-1 mx-auto text-center")&&f(m,"class",b),C===(C=L(j))&&W?W.p(j,U):(W.d(1),W=C(j),W&&(W.c(),W.m(p,null))),U[0]&1&&w!==(w=(j[0]?" bg-gray-100/50 dark:bg-gray-850/50":"bg-indigo-300/10 dark:bg-indigo-500/10 ")+" rounded-full flex p-2.5")&&f(e,"class",w)},i:ge,o:ge,d(j){j&&h(e),Bt(M,j),W.d(),T=!1,D()}}}const sn=300;function lo(n,e,t){let l,s,o;ae(n,St,P=>t(18,s=P)),ae(n,Jt,P=>t(19,o=P));const r=wt("i18n");ae(n,r,P=>t(17,l=P));const i=Gt();let{recording:a=!1}=e,u=!1,c=!1,d=0,m=null,v="";const y=()=>{m=setInterval(()=>{t(1,d++,d)},1e3)},b=()=>{clearInterval(m),t(1,d=0)},_=P=>{const V=Math.floor(P/60),A=P%60,X=A<10?`0${A}`:A;return`${V}:${X}`};let p,w,T=[];const D=-45;let N=Array(sn).fill(0);const M=P=>{let V=0;for(let A=0;A<P.length;A++){const X=(P[A]-128)/128;V+=X*X}return Math.sqrt(V/P.length)},L=P=>{P=P*10;const A=Math.pow(P,1.5);return Math.min(1,Math.max(.01,A))},C=P=>{const V=new AudioContext,A=V.createMediaStreamSource(P),X=V.createAnalyser();X.minDecibels=D,A.connect(X);const re=X.frequencyBinCount,le=new Uint8Array(re),he=new Uint8Array(X.fftSize);(()=>{const Re=()=>{if(!(!a||u)){if(a&&!u){X.getByteTimeDomainData(he),X.getByteFrequencyData(le);const tt=M(he);N.push(L(tt)),N.length>=sn&&N.shift(),t(2,N)}window.requestAnimationFrame(Re)}};window.requestAnimationFrame(Re)})()},W=async P=>{await Ve();const V=ul(P,"recording.wav"),A=await hl(localStorage.token,V).catch(X=>(De.error(X),null));A&&(console.log(A.text),i("confirm",A.text))},j=async()=>{var V,A;y();const P=await navigator.mediaDevices.getUserMedia({audio:!0});if(w=new MediaRecorder(P),w.onstart=()=>{console.log("Recording started"),T=[],C(P)},w.ondataavailable=X=>T.push(X.data),w.onstop=async()=>{var X,re;if(console.log("Recording stopped"),(((re=(X=s==null?void 0:s.audio)==null?void 0:X.stt)==null?void 0:re.engine)??"")==="web")T=[];else{if(c){const le=new Blob(T,{type:"audio/wav"});await W(le),c=!1,t(0,u=!1)}T=[],t(8,a=!1)}},w.start(),(o.audio.stt.engine==="web"||(((A=(V=s==null?void 0:s.audio)==null?void 0:V.stt)==null?void 0:A.engine)??"")==="web")&&("SpeechRecognition"in window||"webkitSpeechRecognition"in window)){p=new(window.SpeechRecognition||window.webkitSpeechRecognition),p.continuous=!0;const X=2e3;let re;p.start(),p.onresult=async le=>{var qe;clearTimeout(re),console.log(le);const he=le.results[Object.keys(le.results).length-1][0].transcript;v=`${v}${he}`,await Ve(),(qe=document.getElementById("chat-textarea"))==null||qe.focus(),re=setTimeout(()=>{console.log("Speech recognition turned off due to inactivity."),p.stop()},X)},p.onend=function(){console.log("recognition ended"),q(),i("confirm",v),c=!1,t(0,u=!1)},p.onerror=function(le){console.log(le),De.error(l.t("Speech recognition error: {{error}}",{error:le.error})),i("cancel"),U()}}},U=async()=>{a&&w&&await w.stop(),b(),T=[]},q=async()=>{t(0,u=!0),c=!0,a&&w&&await w.stop(),clearInterval(m)},oe=async()=>{i("cancel"),U()},K=async()=>{await q()};return n.$$set=P=>{"recording"in P&&t(8,a=P.recording)},n.$$.update=()=>{n.$$.dirty[0]&256&&(a?j():U())},[u,d,N,r,i,_,U,q,a,oe,K]}class no extends xe{constructor(e){super(),$e(this,e,lo,to,Ke,{recording:8},null,[-1,-1])}}function rn(n,e,t){const l=n.slice();return l[75]=e[t],l[77]=t,l}function on(n){let e,t,l,s,o,r,i;return o=new vs({}),{c(){e=I("div"),t=I("div"),l=I("div"),s=I("div"),ce(o.$$.fragment),this.h()},l(a){e=S(a,"DIV",{class:!0,id:!0,role:!0,"aria-label":!0});var u=E(e);t=S(u,"DIV",{class:!0});var c=E(t);l=S(c,"DIV",{class:!0});var d=E(l);s=S(d,"DIV",{class:!0});var m=E(s);ue(o.$$.fragment,m),m.forEach(h),d.forEach(h),c.forEach(h),u.forEach(h),this.h()},h(){f(s,"class","max-w-md"),f(l,"class","m-auto pt-64 flex flex-col justify-center"),f(t,"class","absolute w-full h-full backdrop-blur bg-gray-800/40 flex justify-center"),f(e,"class",r="fixed "+(n[25]?"left-0 md:left-[260px] md:w-[calc(100%-260px)]":"left-0")+" w-full h-full flex z-50 touch-none pointer-events-none"),f(e,"id","dropzone"),f(e,"role","region"),f(e,"aria-label","Drag and Drop Container")},m(a,u){O(a,e,u),g(e,t),g(t,l),g(l,s),fe(o,s,null),i=!0},p(a,u){(!i||u[0]&33554432&&r!==(r="fixed "+(a[25]?"left-0 md:left-[260px] md:w-[calc(100%-260px)]":"left-0")+" w-full h-full flex z-50 touch-none pointer-events-none"))&&f(e,"class",r)},i(a){i||(H(o.$$.fragment,a),i=!0)},o(a){z(o.$$.fragment,a),i=!1},d(a){a&&h(e),de(o)}}}function an(n){let e,t,l='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5"><path fill-rule="evenodd" d="M10 3a.75.75 0 01.75.75v10.638l3.96-4.158a.75.75 0 111.08 1.04l-5.25 5.5a.75.75 0 01-1.08 0l-5.25-5.5a.75.75 0 111.08-1.04l3.96 4.158V3.75A.75.75 0 0110 3z" clip-rule="evenodd"></path></svg>',s,o;return{c(){e=I("div"),t=I("button"),t.innerHTML=l,this.h()},l(r){e=S(r,"DIV",{class:!0});var i=E(e);t=S(i,"BUTTON",{class:!0,"data-svelte-h":!0}),Ye(t)!=="svelte-a2mahu"&&(t.innerHTML=l),i.forEach(h),this.h()},h(){f(t,"class","bg-white border border-gray-100 dark:border-none dark:bg-white/20 p-1.5 rounded-full"),f(e,"class","absolute -top-12 left-0 right-0 flex justify-center z-30")},m(r,i){O(r,e,i),g(e,t),s||(o=te(t,"click",n[36]),s=!0)},p:ge,d(r){r&&h(e),s=!1,o()}}}function so(n){let e,t,l;function s(r){n[41](r)}let o={};return n[1]!==void 0&&(o.prompt=n[1]),e=new Ir({props:o}),n[40](e),Ie.push(()=>Ue(e,"prompt",s)),e.$on("youtube",n[42]),e.$on("url",n[43]),e.$on("select",n[44]),{c(){ce(e.$$.fragment)},l(r){ue(e.$$.fragment,r)},m(r,i){fe(e,r,i),l=!0},p(r,i){const a={};!t&&i[0]&2&&(t=!0,a.prompt=r[1],Oe(()=>t=!1)),e.$set(a)},i(r){l||(H(e.$$.fragment,r),l=!0)},o(r){z(e.$$.fragment,r),l=!1},d(r){n[40](null),de(e,r)}}}function ro(n){let e,t,l,s;function o(a){n[38](a)}function r(a){n[39](a)}let i={};return n[1]!==void 0&&(i.prompt=n[1]),n[3]!==void 0&&(i.files=n[3]),e=new gr({props:i}),n[37](e),Ie.push(()=>Ue(e,"prompt",o)),Ie.push(()=>Ue(e,"files",r)),{c(){ce(e.$$.fragment)},l(a){ue(e.$$.fragment,a)},m(a,u){fe(e,a,u),s=!0},p(a,u){const c={};!t&&u[0]&2&&(t=!0,c.prompt=a[1],Oe(()=>t=!1)),!l&&u[0]&8&&(l=!0,c.files=a[3],Oe(()=>l=!1)),e.$set(c)},i(a){s||(H(e.$$.fragment,a),s=!0)},o(a){z(e.$$.fragment,a),s=!1},d(a){n[37](null),de(e,a)}}}function cn(n){let e,t,l,s,o,r,i,a,u=n[0].name+"",c,d,m,v,y,b,_,p;return y=new Br({}),{c(){e=I("div"),t=I("div"),l=I("img"),o=J(),r=I("div"),i=ve("Talking to "),a=I("span"),c=ve(u),d=J(),m=I("div"),v=I("button"),ce(y.$$.fragment),this.h()},l(w){e=S(w,"DIV",{class:!0});var T=E(e);t=S(T,"DIV",{class:!0});var D=E(t);l=S(D,"IMG",{crossorigin:!0,alt:!0,class:!0,src:!0}),o=Q(D),r=S(D,"DIV",{});var N=E(r);i=be(N,"Talking to "),a=S(N,"SPAN",{class:!0});var M=E(a);c=be(M,u),M.forEach(h),N.forEach(h),D.forEach(h),d=Q(T),m=S(T,"DIV",{});var L=E(m);v=S(L,"BUTTON",{class:!0});var C=E(v);ue(y.$$.fragment,C),C.forEach(h),L.forEach(h),T.forEach(h),this.h()},h(){var w,T,D;f(l,"crossorigin","anonymous"),f(l,"alt","model profile"),f(l,"class","size-5 max-w-[28px] object-cover rounded-full"),zt(l.src,s=((D=(T=(w=n[13].find(n[49]))==null?void 0:w.info)==null?void 0:T.meta)==null?void 0:D.profile_image_url)??(n[24].language==="dg-DG"?"/doge.png":`${xt}/static/favicon.png`))||f(l,"src",s),f(a,"class","font-medium"),f(t,"class","flex items-center gap-2 text-sm dark:text-gray-500"),f(v,"class","flex items-center"),f(e,"class","px-3 py-2.5 text-left w-full flex justify-between items-center absolute bottom-0 left-0 right-0 bg-gradient-to-t from-50% from-white dark:from-gray-900")},m(w,T){O(w,e,T),g(e,t),g(t,l),g(t,o),g(t,r),g(r,i),g(r,a),g(a,c),g(e,d),g(e,m),g(m,v),fe(y,v,null),b=!0,_||(p=te(v,"click",n[50]),_=!0)},p(w,T){var D,N,M;(!b||T[0]&16785409&&!zt(l.src,s=((M=(N=(D=w[13].find(w[49]))==null?void 0:D.info)==null?void 0:N.meta)==null?void 0:M.profile_image_url)??(w[24].language==="dg-DG"?"/doge.png":`${xt}/static/favicon.png`)))&&f(l,"src",s),(!b||T[0]&1)&&u!==(u=w[0].name+"")&&Me(c,u)},i(w){b||(H(y.$$.fragment,w),b=!0)},o(w){z(y.$$.fragment,w),b=!1},d(w){w&&h(e),de(y),_=!1,p()}}}function oo(n){let e,t,l,s,o,r,i,a,u,c,d,m,v,y=n[10].length==0||n[10].at(-1).done==!0,b,_,p,w,T,D,N,M,L,C=n[3].length>0&&un(n);function W(V){n[62](V)}function j(V){n[63](V)}let U={tools:n[27].reduce(n[59],{}),uploadFilesHandler:n[60],onClose:n[61],$$slots:{default:[go]},$$scope:{ctx:n}};n[5]!==void 0&&(U.webSearchEnabled=n[5]),n[4]!==void 0&&(U.selectedToolIds=n[4]),r=new Xr({props:U}),Ie.push(()=>Ue(r,"webSearchEnabled",W)),Ie.push(()=>Ue(r,"selectedToolIds",j));let q=y&&hn(n);const oe=[vo,po],K=[];function P(V,A){return A[0]&1024&&(w=null),w==null&&(w=V[10].length==0||V[10].at(-1).done==!0),w?0:1}return T=P(n,[-1,-1,-1]),D=K[T]=oe[T](n),{c(){e=I("form"),t=I("div"),C&&C.c(),l=J(),s=I("div"),o=I("div"),ce(r.$$.fragment),u=J(),c=I("textarea"),m=J(),v=I("div"),q&&q.c(),_=J(),p=I("div"),D.c(),this.h()},l(V){e=S(V,"FORM",{class:!0});var A=E(e);t=S(A,"DIV",{class:!0,dir:!0});var X=E(t);C&&C.l(X),l=Q(X),s=S(X,"DIV",{class:!0});var re=E(s);o=S(re,"DIV",{class:!0});var le=E(o);ue(r.$$.fragment,le),le.forEach(h),u=Q(re),c=S(re,"TEXTAREA",{id:!0,class:!0,placeholder:!0,rows:!0}),E(c).forEach(h),m=Q(re),v=S(re,"DIV",{class:!0});var he=E(v);q&&q.l(he),he.forEach(h),re.forEach(h),X.forEach(h),_=Q(A),p=S(A,"DIV",{class:!0});var qe=E(p);D.l(qe),qe.forEach(h),A.forEach(h),this.h()},h(){var V;f(o,"class","ml-0.5 self-end mb-1.5 flex space-x-1"),f(c,"id","chat-textarea"),f(c,"class","scrollbar-hidden bg-gray-50 dark:bg-gray-850 dark:text-gray-100 outline-none w-full py-3 px-1 rounded-xl resize-none h-[48px] svelte-141e0sl"),f(c,"placeholder",d=n[22]!==""?n[22]:n[24].t("Send a Message")),f(c,"rows","1"),f(v,"class","self-end mb-2 flex space-x-1 mr-1"),f(s,"class","flex"),f(t,"class","flex-1 flex flex-col relative w-full rounded-3xl px-1.5 bg-gray-50 dark:bg-gray-850 dark:text-gray-100"),f(t,"dir",b=((V=n[26])==null?void 0:V.chatDirection)??"LTR"),f(p,"class","flex items-end w-10"),f(e,"class","w-full flex gap-1.5")},m(V,A){O(V,e,A),g(e,t),C&&C.m(t,null),g(t,l),g(t,s),g(s,o),fe(r,o,null),g(s,u),g(s,c),n[64](c),vl(c,n[1]),g(s,m),g(s,v),q&&q.m(v,null),g(e,_),g(e,p),K[T].m(p,null),N=!0,M||(L=[te(c,"input",n[65]),te(c,"keypress",n[66]),te(c,"keydown",n[67]),te(c,"input",n[68]),te(c,"focus",n[69]),te(c,"paste",n[70]),te(e,"submit",zn(n[74]))],M=!0)},p(V,A){var le;V[3].length>0?C?(C.p(V,A),A[0]&8&&H(C,1)):(C=un(V),C.c(),H(C,1),C.m(t,l)):C&&(Pe(),z(C,1,1,()=>{C=null}),ze());const X={};A[0]&402653696&&(X.tools=V[27].reduce(V[59],{})),A[0]&32768&&(X.uploadFilesHandler=V[60]),A[0]&4096&&(X.onClose=V[61]),A[2]&65536&&(X.$$scope={dirty:A,ctx:V}),!i&&A[0]&32&&(i=!0,X.webSearchEnabled=V[5],Oe(()=>i=!1)),!a&&A[0]&16&&(a=!0,X.selectedToolIds=V[4],Oe(()=>a=!1)),r.$set(X),(!N||A[0]&20971520&&d!==(d=V[22]!==""?V[22]:V[24].t("Send a Message")))&&f(c,"placeholder",d),A[0]&2&&vl(c,V[1]),A[0]&1024&&(y=V[10].length==0||V[10].at(-1).done==!0),y?q?(q.p(V,A),A[0]&1024&&H(q,1)):(q=hn(V),q.c(),H(q,1),q.m(v,null)):q&&(Pe(),z(q,1,1,()=>{q=null}),ze()),(!N||A[0]&67108864&&b!==(b=((le=V[26])==null?void 0:le.chatDirection)??"LTR"))&&f(t,"dir",b);let re=T;T=P(V,A),T===re?K[T].p(V,A):(Pe(),z(K[re],1,1,()=>{K[re]=null}),ze(),D=K[T],D?D.p(V,A):(D=K[T]=oe[T](V),D.c()),H(D,1),D.m(p,null))},i(V){N||(H(C),H(r.$$.fragment,V),H(q),H(D),N=!0)},o(V){z(C),z(r.$$.fragment,V),z(q),z(D),N=!1},d(V){V&&h(e),C&&C.d(),de(r),n[64](null),q&&q.d(),K[T].d(),M=!1,bt(L)}}}function io(n){let e,t,l;function s(r){n[54](r)}let o={};return n[14]!==void 0&&(o.recording=n[14]),e=new no({props:o}),Ie.push(()=>Ue(e,"recording",s)),e.$on("cancel",n[55]),e.$on("confirm",n[56]),{c(){ce(e.$$.fragment)},l(r){ue(e.$$.fragment,r)},m(r,i){fe(e,r,i),l=!0},p(r,i){const a={};!t&&i[0]&16384&&(t=!0,a.recording=r[14],Oe(()=>t=!1)),e.$set(a)},i(r){l||(H(e.$$.fragment,r),l=!0)},o(r){z(e.$$.fragment,r),l=!1},d(r){de(e,r)}}}function un(n){let e,t,l=nt(n[3]),s=[];for(let r=0;r<l.length;r+=1)s[r]=dn(rn(n,l,r));const o=r=>z(s[r],1,1,()=>{s[r]=null});return{c(){e=I("div");for(let r=0;r<s.length;r+=1)s[r].c();this.h()},l(r){e=S(r,"DIV",{class:!0});var i=E(e);for(let a=0;a<s.length;a+=1)s[a].l(i);i.forEach(h),this.h()},h(){f(e,"class","mx-2 mt-2 mb-1 flex flex-wrap gap-2")},m(r,i){O(r,e,i);for(let a=0;a<s.length;a+=1)s[a]&&s[a].m(e,null);t=!0},p(r,i){if(i[0]&25166089){l=nt(r[3]);let a;for(a=0;a<l.length;a+=1){const u=rn(r,l,a);s[a]?(s[a].p(u,i),H(s[a],1)):(s[a]=dn(u),s[a].c(),H(s[a],1),s[a].m(e,null))}for(Pe(),a=l.length;a<s.length;a+=1)o(a);ze()}},i(r){if(!t){for(let i=0;i<l.length;i+=1)H(s[i]);t=!0}},o(r){s=s.filter(Boolean);for(let i=0;i<s.length;i+=1)z(s[i]);t=!1},d(r){r&&h(e),Bt(s,r)}}}function ao(n){var v;let e,t,l='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-6 h-6"><path d="M7.5 3.375c0-1.036.84-1.875 1.875-1.875h.375a3.75 3.75 0 0 1 3.75 3.75v1.875C13.5 8.161 14.34 9 15.375 9h1.875A3.75 3.75 0 0 1 21 12.75v3.375C21 17.16 20.16 18 19.125 18h-9.75A1.875 1.875 0 0 1 7.5 16.125V3.375Z"></path><path d="M15 5.25a5.23 5.23 0 0 0-1.279-3.434 9.768 9.768 0 0 1 6.963 6.963A5.23 5.23 0 0 0 17.25 7.5h-1.875A.375.375 0 0 1 15 7.125V5.25ZM4.875 6H6v10.125A3.375 3.375 0 0 0 9.375 19.5H16.5v1.125c0 1.035-.84 1.875-1.875 1.875h-9.75A1.875 1.875 0 0 1 3 20.625V7.875C3 6.839 3.84 6 4.875 6Z"></path></svg>',s,o,r,i=(((v=n[75])==null?void 0:v.title)??`#${n[75].name}`)+"",a,u,c,d=n[24].t("Collection")+"",m;return{c(){e=I("div"),t=I("div"),t.innerHTML=l,s=J(),o=I("div"),r=I("div"),a=ve(i),u=J(),c=I("div"),m=ve(d),this.h()},l(y){e=S(y,"DIV",{class:!0});var b=E(e);t=S(b,"DIV",{class:!0,"data-svelte-h":!0}),Ye(t)!=="svelte-1kdy8bu"&&(t.innerHTML=l),s=Q(b),o=S(b,"DIV",{class:!0});var _=E(o);r=S(_,"DIV",{class:!0});var p=E(r);a=be(p,i),p.forEach(h),u=Q(_),c=S(_,"DIV",{class:!0});var w=E(c);m=be(w,d),w.forEach(h),_.forEach(h),b.forEach(h),this.h()},h(){f(t,"class","p-2.5 bg-red-400 text-white rounded-lg"),f(r,"class","dark:text-gray-100 text-sm font-medium line-clamp-1"),f(c,"class","text-gray-500 text-sm"),f(o,"class","flex flex-col justify-center -space-y-0.5"),f(e,"class","h-16 w-[15rem] flex items-center space-x-3 px-2.5 dark:bg-gray-600 rounded-xl border border-gray-200 dark:border-none")},m(y,b){O(y,e,b),g(e,t),g(e,s),g(e,o),g(o,r),g(r,a),g(o,u),g(o,c),g(c,m)},p(y,b){var _;b[0]&8&&i!==(i=(((_=y[75])==null?void 0:_.title)??`#${y[75].name}`)+"")&&Me(a,i),b[0]&16777216&&d!==(d=y[24].t("Collection")+"")&&Me(m,d)},i:ge,o:ge,d(y){y&&h(e)}}}function co(n){let e,t,l,s,o,r=n[75].name+"",i,a,u,c=n[24].t("Document")+"",d;function m(b,_){return b[75].upload_status?ho:fo}let v=m(n),y=v(n);return{c(){e=I("div"),t=I("div"),y.c(),l=J(),s=I("div"),o=I("div"),i=ve(r),a=J(),u=I("div"),d=ve(c),this.h()},l(b){e=S(b,"DIV",{class:!0});var _=E(e);t=S(_,"DIV",{class:!0});var p=E(t);y.l(p),p.forEach(h),l=Q(_),s=S(_,"DIV",{class:!0});var w=E(s);o=S(w,"DIV",{class:!0});var T=E(o);i=be(T,r),T.forEach(h),a=Q(w),u=S(w,"DIV",{class:!0});var D=E(u);d=be(D,c),D.forEach(h),w.forEach(h),_.forEach(h),this.h()},h(){f(t,"class","p-2.5 bg-red-400 text-white rounded-lg"),f(o,"class","dark:text-gray-100 text-sm font-medium line-clamp-1"),f(u,"class","text-gray-500 text-sm"),f(s,"class","flex flex-col justify-center -space-y-0.5"),f(e,"class","h-16 w-[15rem] flex items-center space-x-3 px-2.5 dark:bg-gray-600 rounded-xl border border-gray-200 dark:border-none")},m(b,_){O(b,e,_),g(e,t),y.m(t,null),g(e,l),g(e,s),g(s,o),g(o,i),g(s,a),g(s,u),g(u,d)},p(b,_){v!==(v=m(b))&&(y.d(1),y=v(b),y&&(y.c(),y.m(t,null))),_[0]&8&&r!==(r=b[75].name+"")&&Me(i,r),_[0]&16777216&&c!==(c=b[24].t("Document")+"")&&Me(d,c)},i:ge,o:ge,d(b){b&&h(e),y.d()}}}function uo(n){let e,t,l,s,o,r=(n[0]?n[23].length===0:n[8].length!==n[23].length)&&fn(n);return{c(){e=I("div"),t=I("img"),s=J(),r&&r.c(),this.h()},l(i){e=S(i,"DIV",{class:!0});var a=E(e);t=S(a,"IMG",{src:!0,alt:!0,class:!0}),s=Q(a),r&&r.l(a),a.forEach(h),this.h()},h(){zt(t.src,l=n[75].url)||f(t,"src",l),f(t,"alt","input"),f(t,"class","h-16 w-16 rounded-xl object-cover"),f(e,"class","relative")},m(i,a){O(i,e,a),g(e,t),g(e,s),r&&r.m(e,null),o=!0},p(i,a){(!o||a[0]&8&&!zt(t.src,l=i[75].url))&&f(t,"src",l),(i[0]?i[23].length===0:i[8].length!==i[23].length)?r?(r.p(i,a),a[0]&8388865&&H(r,1)):(r=fn(i),r.c(),H(r,1),r.m(e,null)):r&&(Pe(),z(r,1,1,()=>{r=null}),ze())},i(i){o||(H(r),o=!0)},o(i){z(r),o=!1},d(i){i&&h(e),r&&r.d()}}}function fo(n){let e,t,l,s,o,r;return{c(){e=ye("svg"),t=ye("style"),l=ve(`.spinner_qM83 {
																		animation: spinner_8HQG 1.05s infinite;
																	}
																	.spinner_oXPr {
																		animation-delay: 0.1s;
																	}
																	.spinner_ZTLf {
																		animation-delay: 0.2s;
																	}
																	@keyframes spinner_8HQG {
																		0%,
																		57.14% {
																			animation-timing-function: cubic-bezier(0.33, 0.66, 0.66, 1);
																			transform: translate(0);
																		}
																		28.57% {
																			animation-timing-function: cubic-bezier(0.33, 0, 0.66, 0.33);
																			transform: translateY(-6px);
																		}
																		100% {
																			transform: translate(0);
																		}
																	}
																`),s=ye("circle"),o=ye("circle"),r=ye("circle"),this.h()},l(i){e=Ee(i,"svg",{class:!0,fill:!0,viewBox:!0,xmlns:!0});var a=E(e);t=Ee(a,"style",{});var u=E(t);l=be(u,`.spinner_qM83 {
																		animation: spinner_8HQG 1.05s infinite;
																	}
																	.spinner_oXPr {
																		animation-delay: 0.1s;
																	}
																	.spinner_ZTLf {
																		animation-delay: 0.2s;
																	}
																	@keyframes spinner_8HQG {
																		0%,
																		57.14% {
																			animation-timing-function: cubic-bezier(0.33, 0.66, 0.66, 1);
																			transform: translate(0);
																		}
																		28.57% {
																			animation-timing-function: cubic-bezier(0.33, 0, 0.66, 0.33);
																			transform: translateY(-6px);
																		}
																		100% {
																			transform: translate(0);
																		}
																	}
																`),u.forEach(h),s=Ee(a,"circle",{class:!0,cx:!0,cy:!0,r:!0}),E(s).forEach(h),o=Ee(a,"circle",{class:!0,cx:!0,cy:!0,r:!0}),E(o).forEach(h),r=Ee(a,"circle",{class:!0,cx:!0,cy:!0,r:!0}),E(r).forEach(h),a.forEach(h),this.h()},h(){f(s,"class","spinner_qM83"),f(s,"cx","4"),f(s,"cy","12"),f(s,"r","2.5"),f(o,"class","spinner_qM83 spinner_oXPr"),f(o,"cx","12"),f(o,"cy","12"),f(o,"r","2.5"),f(r,"class","spinner_qM83 spinner_ZTLf"),f(r,"cx","20"),f(r,"cy","12"),f(r,"r","2.5"),f(e,"class","w-6 h-6 translate-y-[0.5px]"),f(e,"fill","currentColor"),f(e,"viewBox","0 0 24 24"),f(e,"xmlns","http://www.w3.org/2000/svg")},m(i,a){O(i,e,a),g(e,t),g(t,l),g(e,s),g(e,o),g(e,r)},d(i){i&&h(e)}}}function ho(n){let e,t,l;return{c(){e=ye("svg"),t=ye("path"),l=ye("path"),this.h()},l(s){e=Ee(s,"svg",{xmlns:!0,viewBox:!0,fill:!0,class:!0});var o=E(e);t=Ee(o,"path",{"fill-rule":!0,d:!0,"clip-rule":!0}),E(t).forEach(h),l=Ee(o,"path",{d:!0}),E(l).forEach(h),o.forEach(h),this.h()},h(){f(t,"fill-rule","evenodd"),f(t,"d","M5.625 1.5c-1.036 0-1.875.84-1.875 1.875v17.25c0 1.035.84 1.875 1.875 1.875h12.75c1.035 0 1.875-.84 1.875-1.875V12.75A3.75 3.75 0 0 0 16.5 9h-1.875a1.875 1.875 0 0 1-1.875-1.875V5.25A3.75 3.75 0 0 0 9 1.5H5.625ZM7.5 15a.75.75 0 0 1 .75-.75h7.5a.75.75 0 0 1 0 1.5h-7.5A.75.75 0 0 1 7.5 15Zm.75 2.25a.75.75 0 0 0 0 1.5H12a.75.75 0 0 0 0-1.5H8.25Z"),f(t,"clip-rule","evenodd"),f(l,"d","M12.971 1.816A5.23 5.23 0 0 1 14.25 5.25v1.875c0 .207.168.375.375.375H16.5a5.23 5.23 0 0 1 3.434 1.279 9.768 9.768 0 0 0-6.963-6.963Z"),f(e,"xmlns","http://www.w3.org/2000/svg"),f(e,"viewBox","0 0 24 24"),f(e,"fill","currentColor"),f(e,"class","w-6 h-6")},m(s,o){O(s,e,o),g(e,t),g(e,l)},d(s){s&&h(e)}}}function fn(n){let e,t;return e=new Nt({props:{className:" absolute top-1 left-1",content:n[24].t("{{ models }}",{models:[...n[0]?[n[0]]:n[8]].filter(n[57]).join(", ")}),$$slots:{default:[mo]},$$scope:{ctx:n}}}),{c(){ce(e.$$.fragment)},l(l){ue(e.$$.fragment,l)},m(l,s){fe(e,l,s),t=!0},p(l,s){const o={};s[0]&25166081&&(o.content=l[24].t("{{ models }}",{models:[...l[0]?[l[0]]:l[8]].filter(l[57]).join(", ")})),s[2]&65536&&(o.$$scope={dirty:s,ctx:l}),e.$set(o)},i(l){t||(H(e.$$.fragment,l),t=!0)},o(l){z(e.$$.fragment,l),t=!1},d(l){de(e,l)}}}function mo(n){let e,t;return{c(){e=ye("svg"),t=ye("path"),this.h()},l(l){e=Ee(l,"svg",{xmlns:!0,viewBox:!0,fill:!0,class:!0});var s=E(e);t=Ee(s,"path",{"fill-rule":!0,d:!0,"clip-rule":!0}),E(t).forEach(h),s.forEach(h),this.h()},h(){f(t,"fill-rule","evenodd"),f(t,"d","M9.401 3.003c1.155-2 4.043-2 5.197 0l7.355 12.748c1.154 2-.29 4.5-2.599 4.5H4.645c-2.309 0-3.752-2.5-2.598-4.5L9.4 3.003ZM12 8.25a.75.75 0 0 1 .75.75v3.75a.75.75 0 0 1-1.5 0V9a.75.75 0 0 1 .75-.75Zm0 8.25a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5Z"),f(t,"clip-rule","evenodd"),f(e,"xmlns","http://www.w3.org/2000/svg"),f(e,"viewBox","0 0 24 24"),f(e,"fill","currentColor"),f(e,"class","size-4 fill-yellow-300")},m(l,s){O(l,e,s),g(e,t)},p:ge,d(l){l&&h(e)}}}function dn(n){let e,t,l,s,o,r,i='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-4 h-4"><path d="M6.28 5.22a.75.75 0 00-1.06 1.06L8.94 10l-3.72 3.72a.75.75 0 101.06 1.06L10 11.06l3.72 3.72a.75.75 0 101.06-1.06L11.06 10l3.72-3.72a.75.75 0 00-1.06-1.06L10 8.94 6.28 5.22z"></path></svg>',a,u,c,d;const m=[uo,co,ao],v=[];function y(_,p){return _[75].type==="image"?0:_[75].type==="doc"?1:_[75].type==="collection"?2:-1}~(t=y(n))&&(l=v[t]=m[t](n));function b(){return n[58](n[77])}return{c(){e=I("div"),l&&l.c(),s=J(),o=I("div"),r=I("button"),r.innerHTML=i,a=J(),this.h()},l(_){e=S(_,"DIV",{class:!0});var p=E(e);l&&l.l(p),s=Q(p),o=S(p,"DIV",{class:!0});var w=E(o);r=S(w,"BUTTON",{class:!0,type:!0,"data-svelte-h":!0}),Ye(r)!=="svelte-6u4utr"&&(r.innerHTML=i),w.forEach(h),a=Q(p),p.forEach(h),this.h()},h(){f(r,"class","bg-gray-400 text-white border border-white rounded-full group-hover:visible invisible transition"),f(r,"type","button"),f(o,"class","absolute -top-1 -right-1"),f(e,"class","relative group")},m(_,p){O(_,e,p),~t&&v[t].m(e,null),g(e,s),g(e,o),g(o,r),g(e,a),u=!0,c||(d=te(r,"click",b),c=!0)},p(_,p){n=_;let w=t;t=y(n),t===w?~t&&v[t].p(n,p):(l&&(Pe(),z(v[w],1,1,()=>{v[w]=null}),ze()),~t?(l=v[t],l?l.p(n,p):(l=v[t]=m[t](n),l.c()),H(l,1),l.m(e,s)):l=null)},i(_){u||(H(l),u=!0)},o(_){z(l),u=!1},d(_){_&&h(e),~t&&v[t].d(),c=!1,d()}}}function go(n){let e,t='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" fill="currentColor" class="size-5"><path d="M8.75 3.75a.75.75 0 0 0-1.5 0v3.5h-3.5a.75.75 0 0 0 0 1.5h3.5v3.5a.75.75 0 0 0 1.5 0v-3.5h3.5a.75.75 0 0 0 0-1.5h-3.5v-3.5Z"></path></svg>';return{c(){e=I("button"),e.innerHTML=t,this.h()},l(l){e=S(l,"BUTTON",{class:!0,type:!0,"data-svelte-h":!0}),Ye(e)!=="svelte-1948p7i"&&(e.innerHTML=t),this.h()},h(){f(e,"class","bg-gray-50 hover:bg-gray-100 text-gray-800 dark:bg-gray-850 dark:text-white dark:hover:bg-gray-800 transition rounded-full p-2 outline-none focus:outline-none"),f(e,"type","button")},m(l,s){O(l,e,s)},p:ge,d(l){l&&h(e)}}}function hn(n){let e,t;return e=new Nt({props:{content:n[24].t("Record voice"),$$slots:{default:[_o]},$$scope:{ctx:n}}}),{c(){ce(e.$$.fragment)},l(l){ue(e.$$.fragment,l)},m(l,s){fe(e,l,s),t=!0},p(l,s){const o={};s[0]&16777216&&(o.content=l[24].t("Record voice")),s[0]&16793600|s[2]&65536&&(o.$$scope={dirty:s,ctx:l}),e.$set(o)},i(l){t||(H(e.$$.fragment,l),t=!0)},o(l){z(e.$$.fragment,l),t=!1},d(l){de(e,l)}}}function _o(n){let e,t='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5 translate-y-[0.5px]"><path d="M7 4a3 3 0 016 0v6a3 3 0 11-6 0V4z"></path><path d="M5.5 9.643a.75.75 0 00-1.5 0V10c0 3.06 2.29 5.585 5.25 5.954V17.5h-1.5a.75.75 0 000 1.5h4.5a.75.75 0 000-1.5h-1.5v-1.546A6.001 6.001 0 0016 10v-.357a.75.75 0 00-1.5 0V10a4.5 4.5 0 01-9 0v-.357z"></path></svg>',l,s;return{c(){e=I("button"),e.innerHTML=t,this.h()},l(o){e=S(o,"BUTTON",{id:!0,class:!0,type:!0,"data-svelte-h":!0}),Ye(e)!=="svelte-47fjze"&&(e.innerHTML=t),this.h()},h(){f(e,"id","voice-input-button"),f(e,"class","text-gray-600 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-850 transition rounded-full p-1.5 mr-0.5 self-center"),f(e,"type","button")},m(o,r){O(o,e,r),l||(s=te(e,"click",n[71]),l=!0)},p:ge,d(o){o&&h(e),l=!1,s()}}}function po(n){let e,t,l='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="size-6"><path fill-rule="evenodd" d="M2.25 12c0-5.385 4.365-9.75 9.75-9.75s9.75 4.365 9.75 9.75-4.365 9.75-9.75 9.75S2.25 17.385 2.25 12zm6-2.438c0-.724.588-1.312 1.313-1.312h4.874c.725 0 1.313.588 1.313 1.313v4.874c0 .725-.588 1.313-1.313 1.313H9.564a1.312 1.312 0 01-1.313-1.313V9.564z" clip-rule="evenodd"></path></svg>',s,o;return{c(){e=I("div"),t=I("button"),t.innerHTML=l,this.h()},l(r){e=S(r,"DIV",{class:!0});var i=E(e);t=S(i,"BUTTON",{class:!0,"data-svelte-h":!0}),Ye(t)!=="svelte-5uu99u"&&(t.innerHTML=l),i.forEach(h),this.h()},h(){f(t,"class","bg-white hover:bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-white dark:hover:bg-gray-800 transition rounded-full p-1.5"),f(e,"class","flex items-center mb-1.5")},m(r,i){O(r,e,i),g(e,t),s||(o=te(t,"click",n[73]),s=!0)},p:ge,i:ge,o:ge,d(r){r&&h(e),s=!1,o()}}}function vo(n){let e,t,l,s;const o=[wo,bo],r=[];function i(a,u){return a[1]===""?0:1}return e=i(n),t=r[e]=o[e](n),{c(){t.c(),l=Fe()},l(a){t.l(a),l=Fe()},m(a,u){r[e].m(a,u),O(a,l,u),s=!0},p(a,u){let c=e;e=i(a),e===c?r[e].p(a,u):(Pe(),z(r[c],1,1,()=>{r[c]=null}),ze(),t=r[e],t?t.p(a,u):(t=r[e]=o[e](a),t.c()),H(t,1),t.m(l.parentNode,l))},i(a){s||(H(t),s=!0)},o(a){z(t),s=!1},d(a){a&&h(l),r[e].d(a)}}}function bo(n){let e,t,l;return t=new Nt({props:{content:n[24].t("Send message"),$$slots:{default:[ko]},$$scope:{ctx:n}}}),{c(){e=I("div"),ce(t.$$.fragment),this.h()},l(s){e=S(s,"DIV",{class:!0});var o=E(e);ue(t.$$.fragment,o),o.forEach(h),this.h()},h(){f(e,"class","flex items-center mb-1")},m(s,o){O(s,e,o),fe(t,e,null),l=!0},p(s,o){const r={};o[0]&16777216&&(r.content=s[24].t("Send message")),o[0]&2|o[2]&65536&&(r.$$scope={dirty:o,ctx:s}),t.$set(r)},i(s){l||(H(t.$$.fragment,s),l=!0)},o(s){z(t.$$.fragment,s),l=!1},d(s){s&&h(e),de(t)}}}function wo(n){let e,t,l;return t=new Nt({props:{content:n[24].t("Call"),$$slots:{default:[yo]},$$scope:{ctx:n}}}),{c(){e=I("div"),ce(t.$$.fragment),this.h()},l(s){e=S(s,"DIV",{class:!0});var o=E(e);ue(t.$$.fragment,o),o.forEach(h),this.h()},h(){f(e,"class","flex items-center mb-1")},m(s,o){O(s,e,o),fe(t,e,null),l=!0},p(s,o){const r={};o[0]&16777216&&(r.content=s[24].t("Call")),o[0]&1090519296|o[2]&65536&&(r.$$scope={dirty:o,ctx:s}),t.$set(r)},i(s){l||(H(t.$$.fragment,s),l=!0)},o(s){z(t.$$.fragment,s),l=!1},d(s){s&&h(e),de(t)}}}function ko(n){let e,t,l,s,o;return{c(){e=I("button"),t=ye("svg"),l=ye("path"),this.h()},l(r){e=S(r,"BUTTON",{id:!0,class:!0,type:!0});var i=E(e);t=Ee(i,"svg",{xmlns:!0,viewBox:!0,fill:!0,class:!0});var a=E(t);l=Ee(a,"path",{"fill-rule":!0,d:!0,"clip-rule":!0}),E(l).forEach(h),a.forEach(h),i.forEach(h),this.h()},h(){f(l,"fill-rule","evenodd"),f(l,"d","M8 14a.75.75 0 0 1-.75-.75V4.56L4.03 7.78a.75.75 0 0 1-1.06-1.06l4.5-4.5a.75.75 0 0 1 1.06 0l4.5 4.5a.75.75 0 0 1-1.06 1.06L8.75 4.56v8.69A.75.75 0 0 1 8 14Z"),f(l,"clip-rule","evenodd"),f(t,"xmlns","http://www.w3.org/2000/svg"),f(t,"viewBox","0 0 16 16"),f(t,"fill","currentColor"),f(t,"class","size-6"),f(e,"id","send-message-button"),f(e,"class",s=(n[1]!==""?"bg-black text-white hover:bg-gray-900 dark:bg-white dark:text-black dark:hover:bg-gray-100 ":"text-white bg-gray-200 dark:text-gray-900 dark:bg-gray-700 disabled")+" transition rounded-full p-1.5 m-0.5 self-center"),f(e,"type","submit"),e.disabled=o=n[1]===""},m(r,i){O(r,e,i),g(e,t),g(t,l)},p(r,i){i[0]&2&&s!==(s=(r[1]!==""?"bg-black text-white hover:bg-gray-900 dark:bg-white dark:text-black dark:hover:bg-gray-100 ":"text-white bg-gray-200 dark:text-gray-900 dark:bg-gray-700 disabled")+" transition rounded-full p-1.5 m-0.5 self-center")&&f(e,"class",s),i[0]&2&&o!==(o=r[1]==="")&&(e.disabled=o)},d(r){r&&h(e)}}}function yo(n){let e,t,l,s,o;return t=new xr({props:{className:"size-6"}}),{c(){e=I("button"),ce(t.$$.fragment),this.h()},l(r){e=S(r,"BUTTON",{class:!0,type:!0});var i=E(e);ue(t.$$.fragment,i),i.forEach(h),this.h()},h(){f(e,"class","text-gray-600 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-850 transition rounded-full p-2 self-center"),f(e,"type","button")},m(r,i){O(r,e,i),fe(t,e,null),l=!0,s||(o=te(e,"click",n[72]),s=!0)},p:ge,i(r){l||(H(t.$$.fragment,r),l=!0)},o(r){z(t.$$.fragment,r),l=!1},d(r){r&&h(e),de(t),s=!1,o()}}}function Eo(n){let e,t,l,s,o,r,i,a,u,c,d,m,v,y,b,_,p,w,T,D,N,M,L,C,W,j,U=n[24].t("LLMs can make mistakes. Verify important information.")+"",q,oe,K,P,V,A,X,re,le=n[20]&&on(n),he=n[2]===!1&&n[10].length>0&&an(n);const qe=[ro,so],Re=[];function tt(Y,we){return we[0]&2&&(a=null),we[0]&2&&(u=null),a==null&&(a=Y[1].charAt(0)==="/"),a?0:(u==null&&(u=Y[1].charAt(0)==="#"),u?1:-1)}~(c=tt(n,[-1,-1,-1]))&&(d=Re[c]=qe[c](n));function G(Y){n[46](Y)}function rt(Y){n[47](Y)}let lt={messages:n[10]};n[1]!==void 0&&(lt.prompt=n[1]),n[22]!==void 0&&(lt.chatInputPlaceholder=n[22]),v=new Tr({props:lt}),n[45](v),Ie.push(()=>Ue(v,"prompt",G)),Ie.push(()=>Ue(v,"chatInputPlaceholder",rt)),v.$on("select",n[48]);let R=n[0]!==void 0&&cn(n);const ie=[io,oo],Ne=[];function Je(Y,we){return Y[14]?0:1}return L=Je(n),C=Ne[L]=ie[L](n),{c(){le&&le.c(),e=J(),t=I("div"),l=I("div"),s=I("div"),o=I("div"),he&&he.c(),r=J(),i=I("div"),d&&d.c(),m=J(),ce(v.$$.fragment),_=J(),R&&R.c(),p=J(),w=I("div"),T=I("div"),D=I("div"),N=I("input"),M=J(),C.c(),W=J(),j=I("div"),q=ve(U),oe=J(),K=I("span"),P=ve("$"),V=ve(n[11]),this.h()},l(Y){le&&le.l(Y),e=Q(Y),t=S(Y,"DIV",{class:!0});var we=E(t);l=S(we,"DIV",{class:!0});var at=E(l);s=S(at,"DIV",{class:!0});var ot=E(s);o=S(ot,"DIV",{class:!0});var ut=E(o);he&&he.l(ut),ut.forEach(h),r=Q(ot),i=S(ot,"DIV",{class:!0});var ft=E(i);d&&d.l(ft),m=Q(ft),ue(v.$$.fragment,ft),_=Q(ft),R&&R.l(ft),ft.forEach(h),ot.forEach(h),at.forEach(h),p=Q(we),w=S(we,"DIV",{class:!0});var At=E(w);T=S(At,"DIV",{class:!0});var Lt=E(T);D=S(Lt,"DIV",{class:!0});var dt=E(D);N=S(dt,"INPUT",{type:!0}),M=Q(dt),C.l(dt),W=Q(dt),j=S(dt,"DIV",{class:!0});var Dt=E(j);q=be(Dt,U),oe=Q(Dt),K=S(Dt,"SPAN",{class:!0});var Z=E(K);P=be(Z,"$"),V=be(Z,n[11]),Z.forEach(h),Dt.forEach(h),dt.forEach(h),Lt.forEach(h),At.forEach(h),we.forEach(h),this.h()},h(){f(o,"class","relative"),f(i,"class","w-full relative"),f(s,"class","flex flex-col max-w-6xl px-2.5 md:px-6 w-full"),f(l,"class","-mb-0.5 mx-auto inset-x-0 bg-transparent flex justify-center"),f(N,"type","file"),N.hidden=!0,N.multiple=!0,f(K,"class","ml-2 px-2 py-1 bg-gray-200 text-gray-700 rounded-full text-xs"),f(j,"class","mt-1.5 text-xs text-gray-500 text-center line-clamp-1"),f(D,"class","pb-2"),f(T,"class","max-w-6xl px-2.5 md:px-6 mx-auto inset-x-0"),f(w,"class","bg-white dark:bg-gray-900"),f(t,"class","w-full")},m(Y,we){le&&le.m(Y,we),O(Y,e,we),O(Y,t,we),g(t,l),g(l,s),g(s,o),he&&he.m(o,null),g(s,r),g(s,i),~c&&Re[c].m(i,null),g(i,m),fe(v,i,null),g(i,_),R&&R.m(i,null),g(t,p),g(t,w),g(w,T),g(T,D),g(D,N),n[51](N),g(D,M),Ne[L].m(D,null),g(D,W),g(D,j),g(j,q),g(j,oe),g(j,K),g(K,P),g(K,V),A=!0,X||(re=[te(N,"change",n[52]),te(N,"change",n[53])],X=!0)},p(Y,we){Y[20]?le?(le.p(Y,we),we[0]&1048576&&H(le,1)):(le=on(Y),le.c(),H(le,1),le.m(e.parentNode,e)):le&&(Pe(),z(le,1,1,()=>{le=null}),ze()),Y[2]===!1&&Y[10].length>0?he?he.p(Y,we):(he=an(Y),he.c(),he.m(o,null)):he&&(he.d(1),he=null);let at=c;c=tt(Y,we),c===at?~c&&Re[c].p(Y,we):(d&&(Pe(),z(Re[at],1,1,()=>{Re[at]=null}),ze()),~c?(d=Re[c],d?d.p(Y,we):(d=Re[c]=qe[c](Y),d.c()),H(d,1),d.m(i,m)):d=null);const ot={};we[0]&1024&&(ot.messages=Y[10]),!y&&we[0]&2&&(y=!0,ot.prompt=Y[1],Oe(()=>y=!1)),!b&&we[0]&4194304&&(b=!0,ot.chatInputPlaceholder=Y[22],Oe(()=>b=!1)),v.$set(ot),Y[0]!==void 0?R?(R.p(Y,we),we[0]&1&&H(R,1)):(R=cn(Y),R.c(),H(R,1),R.m(i,null)):R&&(Pe(),z(R,1,1,()=>{R=null}),ze());let ut=L;L=Je(Y),L===ut?Ne[L].p(Y,we):(Pe(),z(Ne[ut],1,1,()=>{Ne[ut]=null}),ze(),C=Ne[L],C?C.p(Y,we):(C=Ne[L]=ie[L](Y),C.c()),H(C,1),C.m(D,W)),(!A||we[0]&16777216)&&U!==(U=Y[24].t("LLMs can make mistakes. Verify important information.")+"")&&Me(q,U),(!A||we[0]&2048)&&Me(V,Y[11])},i(Y){A||(H(le),H(d),H(v.$$.fragment,Y),H(R),H(C),A=!0)},o(Y){z(le),z(d),z(v.$$.fragment,Y),z(R),z(C),A=!1},d(Y){Y&&(h(e),h(t)),le&&le.d(Y),he&&he.d(),~c&&Re[c].d(),n[45](null),de(v),R&&R.d(),n[51](null),Ne[L].d(),X=!1,bt(re)}}}function Io(n,e,t){let l,s,o,r,i,a,u,c;ae(n,ll,k=>t(13,s=k)),ae(n,Kt,k=>t(25,o=k)),ae(n,St,k=>t(26,r=k)),ae(n,Jn,k=>t(27,i=k)),ae(n,cl,k=>t(28,a=k)),ae(n,An,k=>t(29,u=k)),ae(n,Jt,k=>t(30,c=k));const d=wt("i18n");ae(n,d,k=>t(24,l=k));let{submitPrompt:m}=e,{stopResponse:v}=e,{autoScroll:y=!0}=e,{atSelectedModel:b}=e,{selectedModels:_}=e,p=!1,w,T,D,N,M,L,C=!1,W=null,j="",{files:U=[]}=e,{availableToolIds:q=[]}=e,{selectedToolIds:oe=[]}=e,{webSearchEnabled:K=!1}=e,{prompt:P=""}=e,{messages:V=[]}=e,A=[];const X=()=>{const k=document.getElementById("messages-container");k.scrollTop=k.scrollHeight},re=async k=>{console.log(k);const $={type:"doc",name:k.name,collection_name:"",upload_status:!1,error:""};try{if(t(3,U=[...U,$]),["audio/mpeg","audio/wav"].includes(k.type)){const se=await hl(localStorage.token,k).catch(Ce=>(De.error(Ce),null));if(se){console.log(se);const Ce=new Blob([se.text],{type:"text/plain"});k=ul(Ce,`${k.name}.txt`)}}const ne=await os(localStorage.token,"",k);ne&&($.upload_status=!0,$.collection_name=ne.collection_name,t(3,U))}catch(ne){t(3,U=U.filter(se=>se.name!==k.name)),De.error(ne)}},le=async k=>{console.log(k);const $={type:"doc",name:k,collection_name:"",upload_status:!1,url:k,error:""};try{t(3,U=[...U,$]);const ne=await is(localStorage.token,"",k);ne&&($.upload_status=!0,$.collection_name=ne.collection_name,t(3,U))}catch(ne){t(3,U=U.filter(se=>se.name!==k)),De.error(ne)}},he=async k=>{console.log(k);const $={type:"doc",name:k,collection_name:"",upload_status:!1,url:k,error:""};try{t(3,U=[...U,$]);const ne=await as(localStorage.token,k);ne&&($.upload_status=!0,$.collection_name=ne.collection_name,t(3,U))}catch(ne){t(3,U=U.filter(se=>se.name!==k)),De.error(ne)}};let{dollarAmount:qe=0}=e;tl(()=>{window.setTimeout(()=>w==null?void 0:w.focus(),0);const k=document.querySelector("body"),$=Ge=>{Ge.key==="Escape"&&(console.log("Escape"),t(20,C=!1))},ne=Ge=>{Ge.preventDefault(),t(20,C=!0)},se=()=>{t(20,C=!1)},Ce=async Ge=>{var kt,ct;if(Ge.preventDefault(),console.log(Ge),(kt=Ge.dataTransfer)!=null&&kt.files){const yt=Array.from((ct=Ge.dataTransfer)==null?void 0:ct.files);yt&&yt.length>0?yt.forEach(et=>{if(console.log(et,et.name.split(".").at(-1)),["image/gif","image/webp","image/jpeg","image/png"].includes(et.type)){if(A.length===0){De.error(l.t("Selected model(s) do not support image inputs"));return}let Et=new FileReader;Et.onload=It=>{t(3,U=[...U,{type:"image",url:`${It.target.result}`}])},Et.readAsDataURL(et)}else bl.includes(et.type)||wl.includes(et.name.split(".").at(-1))||De.error(l.t("Unknown File Type '{{file_type}}', but accepting and treating as plain text",{file_type:et.type})),re(et)}):De.error(l.t("File not found."))}t(20,C=!1)};return window.addEventListener("keydown",$),k==null||k.addEventListener("dragover",ne),k==null||k.addEventListener("drop",Ce),k==null||k.addEventListener("dragleave",se),()=>{window.removeEventListener("keydown",$),k==null||k.removeEventListener("dragover",ne),k==null||k.removeEventListener("drop",Ce),k==null||k.removeEventListener("dragleave",se)}});const Re=()=>{t(2,y=!0),X()};function tt(k){Ie[k?"unshift":"push"](()=>{D=k,t(16,D)})}function G(k){P=k,t(1,P)}function rt(k){U=k,t(3,U)}function lt(k){Ie[k?"unshift":"push"](()=>{N=k,t(17,N)})}function R(k){P=k,t(1,P)}const ie=k=>{console.log(k),he(k.detail)},Ne=k=>{console.log(k),le(k.detail)},Je=k=>{var $;console.log(k),t(3,U=[...U,{type:(($=k==null?void 0:k.detail)==null?void 0:$.type)??"doc",...k.detail,upload_status:!0}])};function Y(k){Ie[k?"unshift":"push"](()=>{M=k,t(18,M)})}function we(k){P=k,t(1,P)}function at(k){j=k,t(22,j)}const ot=k=>{t(0,b=k.detail),w==null||w.focus()},ut=k=>k.id===b.id,ft=()=>{t(0,b=void 0)};function At(k){Ie[k?"unshift":"push"](()=>{T=k,t(15,T)})}function Lt(){L=this.files,t(19,L)}const dt=async()=>{L&&L.length>0?Array.from(L).forEach($=>{if(["image/gif","image/webp","image/jpeg","image/png"].includes($.type)){if(A.length===0){De.error(l.t("Selected model(s) do not support image inputs")),t(19,L=null),t(15,T.value="",T);return}let ne=new FileReader;ne.onload=se=>{t(3,U=[...U,{type:"image",url:`${se.target.result}`}]),t(19,L=null),t(15,T.value="",T)},ne.readAsDataURL($)}else bl.includes($.type)||wl.includes($.name.split(".").at(-1))?(re($),t(15,T.value="",T)):(De.error(l.t("Unknown File Type '{{file_type}}', but accepting and treating as plain text",{file_type:$.type})),re($),t(15,T.value="",T))}):De.error(l.t("File not found."))};function Dt(k){p=k,t(14,p)}const Z=async()=>{var k;t(14,p=!1),await Ve(),(k=document.getElementById("chat-textarea"))==null||k.focus()},Se=async k=>{var ne;const $=k.detail;t(1,P=`${P}${$} `),t(14,p=!1),await Ve(),(ne=document.getElementById("chat-textarea"))==null||ne.focus(),((r==null?void 0:r.speechAutoSend)??!1)&&m(P)},me=k=>!A.includes(k),_e=k=>{U.splice(k,1),t(3,U)},He=(k,$,ne,se)=>((q.includes($.id)||((a==null?void 0:a.role)??"user")==="admin")&&(k[$.id]={name:$.name,description:$.meta.description,enabled:!1}),k),We=()=>{T.click()},st=async()=>{await Ve(),w==null||w.focus()};function it(k){K=k,t(5,K)}function Ot(k){oe=k,t(4,oe)}function Ct(k){Ie[k?"unshift":"push"](()=>{w=k,t(12,w),t(1,P)})}function Ut(){P=this.value,t(1,P)}const qt=k=>{(!u||!("ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0))&&(k.key==="Enter"&&!k.shiftKey&&k.preventDefault(),P!==""&&k.key==="Enter"&&!k.shiftKey&&m(P))},sl=async k=>{var ne;const $=k.ctrlKey||k.metaKey;if(P===""&&$&&k.key.toLowerCase()==="r"){k.preventDefault(),console.log("regenerate");const se=[...document.getElementsByClassName("regenerate-response-button")].at(-1);se==null||se.click()}if(P===""&&k.key=="ArrowUp"){k.preventDefault();const se=[...document.getElementsByClassName("user-message")].at(-1),Ce=[...document.getElementsByClassName("edit-user-message-button")].at(-1);console.log(se),se.scrollIntoView({block:"center"}),Ce==null||Ce.click()}if(["/","#","@"].includes(P.charAt(0))&&k.key==="ArrowUp"&&(k.preventDefault(),(D||N||M).selectUp(),[...document.getElementsByClassName("selected-command-option-button")].at(-1).scrollIntoView({block:"center"})),["/","#","@"].includes(P.charAt(0))&&k.key==="ArrowDown"&&(k.preventDefault(),(D||N||M).selectDown(),[...document.getElementsByClassName("selected-command-option-button")].at(-1).scrollIntoView({block:"center"})),["/","#","@"].includes(P.charAt(0))&&k.key==="Enter"){k.preventDefault();const se=[...document.getElementsByClassName("selected-command-option-button")].at(-1);k.shiftKey?t(1,P=`${P}
`):se?se==null||se.click():(ne=document.getElementById("send-message-button"))==null||ne.click()}if(["/","#","@"].includes(P.charAt(0))&&k.key==="Tab"){k.preventDefault();const se=[...document.getElementsByClassName("selected-command-option-button")].at(-1);se==null||se.click()}else if(k.key==="Tab"){const se=Hn(P);if(se.length>0){const Ce=se.at(0),Ge=P;t(1,P=P.substring(0,(Ce==null?void 0:Ce.endIndex)+1)),await Ve(),k.target.scrollTop=k.target.scrollHeight,t(1,P=Ge),await Ve(),k.preventDefault(),k.target.setSelectionRange(Ce==null?void 0:Ce.startIndex,Ce.endIndex+1)}k.target.style.height="",k.target.style.height=Math.min(k.target.scrollHeight,200)+"px"}k.key==="Escape"&&(console.log("Escape"),t(0,b=void 0))},B=k=>{k.target.style.height="",k.target.style.height=Math.min(k.target.scrollHeight,200)+"px",t(21,W=null)},x=k=>{k.target.style.height="",k.target.style.height=Math.min(k.target.scrollHeight,200)+"px"},pe=k=>{const $=k.clipboardData||window.clipboardData;if($&&$.items){for(const ne of $.items)if(ne.type.indexOf("image")!==-1){const se=ne.getAsFile(),Ce=new FileReader;Ce.onload=function(Ge){t(3,U=[...U,{type:"image",url:`${Ge.target.result}`}])},Ce.readAsDataURL(se)}}},ee=async()=>{try{await navigator.mediaDevices.getUserMedia({audio:!0}).catch(function($){return De.error(l.t("Permission denied when accessing microphone: {{error}}",{error:$})),null})&&t(14,p=!0)}catch{De.error(l.t("Permission denied when accessing microphone"))}},Ae=async()=>{if(_.length>1){De.error(l.t("Select only one model to call"));return}if(c.audio.stt.engine==="web"){De.error(l.t("Call feature is not supported when using Web STT engine"));return}try{await navigator.mediaDevices.getUserMedia({audio:!0}),$t.set(!0)}catch{De.error(l.t("Permission denied when accessing media devices"))}},F=()=>{v()},je=()=>{m(P)};return n.$$set=k=>{"submitPrompt"in k&&t(6,m=k.submitPrompt),"stopResponse"in k&&t(7,v=k.stopResponse),"autoScroll"in k&&t(2,y=k.autoScroll),"atSelectedModel"in k&&t(0,b=k.atSelectedModel),"selectedModels"in k&&t(8,_=k.selectedModels),"files"in k&&t(3,U=k.files),"availableToolIds"in k&&t(9,q=k.availableToolIds),"selectedToolIds"in k&&t(4,oe=k.selectedToolIds),"webSearchEnabled"in k&&t(5,K=k.webSearchEnabled),"prompt"in k&&t(1,P=k.prompt),"messages"in k&&t(10,V=k.messages),"dollarAmount"in k&&t(11,qe=k.dollarAmount)},n.$$.update=()=>{n.$$.dirty[0]&8449&&t(23,A=[...b?[b]:_].filter(k=>{var $,ne,se,Ce;return((Ce=(se=(ne=($=s.find(Ge=>Ge.id===k))==null?void 0:$.info)==null?void 0:ne.meta)==null?void 0:se.capabilities)==null?void 0:Ce.vision)??!0})),n.$$.dirty[0]&4098&&P&&w&&(t(12,w.style.height="",w),t(12,w.style.height=Math.min(w.scrollHeight,200)+"px",w))},[b,P,y,U,oe,K,m,v,_,q,V,qe,w,s,p,T,D,N,M,L,C,W,j,A,l,o,r,i,a,u,c,d,X,re,le,he,Re,tt,G,rt,lt,R,ie,Ne,Je,Y,we,at,ot,ut,ft,At,Lt,dt,Dt,Z,Se,me,_e,He,We,st,it,Ot,Ct,Ut,qt,sl,B,x,pe,ee,Ae,F,je]}class So extends xe{constructor(e){super(),$e(this,e,Io,Eo,Ke,{submitPrompt:6,stopResponse:7,autoScroll:2,atSelectedModel:0,selectedModels:8,files:3,availableToolIds:9,selectedToolIds:4,webSearchEnabled:5,prompt:1,messages:10,dollarAmount:11},null,[-1,-1,-1])}}function mn(n,e,t){const l=n.slice();return l[11]=e[t],l[12]=e,l[13]=t,l}function Do(n){let e,t,l;return t=new Nt({props:{content:n[4].t("Remove Model"),$$slots:{default:[To]},$$scope:{ctx:n}}}),{c(){e=I("div"),ce(t.$$.fragment),this.h()},l(s){e=S(s,"DIV",{class:!0});var o=E(e);ue(t.$$.fragment,o),o.forEach(h),this.h()},h(){f(e,"class","self-center disabled:text-gray-600 disabled:hover:text-gray-600 mr-2")},m(s,o){O(s,e,o),fe(t,e,null),l=!0},p(s,o){const r={};o&16&&(r.content=s[4].t("Remove Model")),o&16387&&(r.$$scope={dirty:o,ctx:s}),t.$set(r)},i(s){l||(H(t.$$.fragment,s),l=!0)},o(s){z(t.$$.fragment,s),l=!1},d(s){s&&h(e),de(t)}}}function Mo(n){return{c:ge,l:ge,m:ge,p:ge,i:ge,o:ge,d:ge}}function To(n){let e,t,l,s,o;function r(){return n[9](n[13])}return{c(){e=I("button"),t=ye("svg"),l=ye("path"),this.h()},l(i){e=S(i,"BUTTON",{});var a=E(e);t=Ee(a,"svg",{xmlns:!0,fill:!0,viewBox:!0,"stroke-width":!0,stroke:!0,class:!0});var u=E(t);l=Ee(u,"path",{"stroke-linecap":!0,"stroke-linejoin":!0,d:!0}),E(l).forEach(h),u.forEach(h),a.forEach(h),this.h()},h(){f(l,"stroke-linecap","round"),f(l,"stroke-linejoin","round"),f(l,"d","M19.5 12h-15"),f(t,"xmlns","http://www.w3.org/2000/svg"),f(t,"fill","none"),f(t,"viewBox","0 0 24 24"),f(t,"stroke-width","2"),f(t,"stroke","currentColor"),f(t,"class","size-3.5"),e.disabled=n[1]},m(i,a){O(i,e,a),g(e,t),g(t,l),s||(o=te(e,"click",r),s=!0)},p(i,a){n=i,a&2&&(e.disabled=n[1])},d(i){i&&h(e),s=!1,o()}}}function gn(n){let e,t,l,s,o,r,i,a,u,c;function d(_){n[8](_,n[11],n[12],n[13])}let m={placeholder:n[4].t("Select a model"),items:n[3].map(pn)};n[11]!==void 0&&(m.value=n[11]),s=new Ss({props:m}),Ie.push(()=>Ue(s,"value",d));const v=[Mo,Do],y=[];function b(_,p){return _[13]===0?0:1}return i=b(n),a=y[i]=v[i](n),{c(){e=I("div"),t=I("div"),l=I("div"),ce(s.$$.fragment),r=J(),a.c(),u=J(),this.h()},l(_){e=S(_,"DIV",{class:!0});var p=E(e);t=S(p,"DIV",{class:!0});var w=E(t);l=S(w,"DIV",{class:!0});var T=E(l);ue(s.$$.fragment,T),T.forEach(h),w.forEach(h),r=Q(p),a.l(p),u=Q(p),p.forEach(h),this.h()},h(){f(l,"class","mr-1 max-w-full"),f(t,"class","overflow-hidden w-full"),f(e,"class","flex w-full max-w-fit")},m(_,p){O(_,e,p),g(e,t),g(t,l),fe(s,l,null),g(e,r),y[i].m(e,null),g(e,u),c=!0},p(_,p){n=_;const w={};p&16&&(w.placeholder=n[4].t("Select a model")),p&8&&(w.items=n[3].map(pn)),!o&&p&1&&(o=!0,w.value=n[11],Oe(()=>o=!1)),s.$set(w),a.p(n,p)},i(_){c||(H(s.$$.fragment,_),H(a),c=!0)},o(_){z(s.$$.fragment,_),z(a),c=!1},d(_){_&&h(e),de(s),y[i].d()}}}function _n(n){let e,t,l=n[4].t("Set as default")+"",s,o,r;return{c(){e=I("div"),t=I("button"),s=ve(l),this.h()},l(i){e=S(i,"DIV",{class:!0});var a=E(e);t=S(a,"BUTTON",{});var u=E(t);s=be(u,l),u.forEach(h),a.forEach(h),this.h()},h(){f(e,"class","text-left mt-0.5 ml-1 text-[0.7rem] text-gray-500")},m(i,a){O(i,e,a),g(e,t),g(t,s),o||(r=te(t,"click",n[7]),o=!0)},p(i,a){a&16&&l!==(l=i[4].t("Set as default")+"")&&Me(s,l)},d(i){i&&h(e),o=!1,r()}}}function Co(n){let e,t,l,s,o=nt(n[0]),r=[];for(let u=0;u<o.length;u+=1)r[u]=gn(mn(n,o,u));const i=u=>z(r[u],1,1,()=>{r[u]=null});let a=n[2]&&!n[5]&&_n(n);return{c(){e=I("div");for(let u=0;u<r.length;u+=1)r[u].c();t=J(),a&&a.c(),l=Fe(),this.h()},l(u){e=S(u,"DIV",{class:!0});var c=E(e);for(let d=0;d<r.length;d+=1)r[d].l(c);c.forEach(h),t=Q(u),a&&a.l(u),l=Fe(),this.h()},h(){f(e,"class","flex flex-col w-full items-center md:items-start")},m(u,c){O(u,e,c);for(let d=0;d<r.length;d+=1)r[d]&&r[d].m(e,null);O(u,t,c),a&&a.m(u,c),O(u,l,c),s=!0},p(u,[c]){if(c&27){o=nt(u[0]);let d;for(d=0;d<o.length;d+=1){const m=mn(u,o,d);r[d]?(r[d].p(m,c),H(r[d],1)):(r[d]=gn(m),r[d].c(),H(r[d],1),r[d].m(e,null))}for(Pe(),d=o.length;d<r.length;d+=1)i(d);ze()}u[2]&&!u[5]?a?a.p(u,c):(a=_n(u),a.c(),a.m(l.parentNode,l)):a&&(a.d(1),a=null)},i(u){if(!s){for(let c=0;c<o.length;c+=1)H(r[c]);s=!0}},o(u){r=r.filter(Boolean);for(let c=0;c<r.length;c+=1)z(r[c]);s=!1},d(u){u&&(h(e),h(t),h(l)),Bt(r,u),a&&a.d(u)}}}const pn=n=>({value:n.id,label:n.name,model:n});function Vo(n,e,t){let l,s,o,r;ae(n,ll,y=>t(3,l=y)),ae(n,St,y=>t(10,o=y)),ae(n,An,y=>t(5,r=y));const i=wt("i18n");ae(n,i,y=>t(4,s=y));let{selectedModels:a=[""]}=e,{disabled:u=!1}=e,{showSetDefault:c=!0}=e;const d=async()=>{if(a.filter(b=>b==="").length){De.error(s.t("Choose a model before saving..."));return}St.set({...o,models:a}),await ts(localStorage.token,{ui:o}),De.success(s.t("Default model updated"))};function m(y,b,_,p){_[p]=y,t(0,a),t(3,l)}const v=y=>{a.splice(y,1),t(0,a),t(3,l)};return n.$$set=y=>{"selectedModels"in y&&t(0,a=y.selectedModels),"disabled"in y&&t(1,u=y.disabled),"showSetDefault"in y&&t(2,c=y.showSetDefault)},n.$$.update=()=>{n.$$.dirty&9&&a.length>0&&l.length>0&&t(0,a=a.map(y=>l.map(b=>b.id).includes(y)?y:""))},[a,u,c,l,s,r,i,d,m,v]}class Bo extends xe{constructor(e){super(),$e(this,e,Vo,Co,Ke,{selectedModels:0,disabled:1,showSetDefault:2})}}function No(n){let e;const t=n[10].default,l=gt(t,n,n[16],null);return{c(){l&&l.c()},l(s){l&&l.l(s)},m(s,o){l&&l.m(s,o),e=!0},p(s,o){l&&l.p&&(!e||o&65536)&&_t(l,t,s,s[16],e?vt(t,s[16],o,null):pt(s[16]),null)},i(s){e||(H(l,s),e=!0)},o(s){z(l,s),e=!1},d(s){l&&l.d(s)}}}function Ao(n){let e,t,l,s,o=n[3].t("Share")+"",r;return{c(){e=ye("svg"),t=ye("path"),l=J(),s=I("div"),r=ve(o),this.h()},l(i){e=Ee(i,"svg",{xmlns:!0,viewBox:!0,fill:!0,class:!0});var a=E(e);t=Ee(a,"path",{"fill-rule":!0,d:!0,"clip-rule":!0}),E(t).forEach(h),a.forEach(h),l=Q(i),s=S(i,"DIV",{class:!0});var u=E(s);r=be(u,o),u.forEach(h),this.h()},h(){f(t,"fill-rule","evenodd"),f(t,"d","M15.75 4.5a3 3 0 1 1 .825 2.066l-8.421 4.679a3.002 3.002 0 0 1 0 1.51l8.421 4.679a3 3 0 1 1-.729 1.31l-8.421-4.678a3 3 0 1 1 0-4.132l8.421-4.679a3 3 0 0 1-.096-.755Z"),f(t,"clip-rule","evenodd"),f(e,"xmlns","http://www.w3.org/2000/svg"),f(e,"viewBox","0 0 24 24"),f(e,"fill","currentColor"),f(e,"class","size-4"),f(s,"class","flex items-center")},m(i,a){O(i,e,a),g(e,t),O(i,l,a),O(i,s,a),g(s,r)},p(i,a){a&8&&o!==(o=i[3].t("Share")+"")&&Me(r,o)},d(i){i&&(h(e),h(l),h(s))}}}function Lo(n){let e,t,l,s,o=n[3].t("Download")+"",r;return{c(){e=ye("svg"),t=ye("path"),l=J(),s=I("div"),r=ve(o),this.h()},l(i){e=Ee(i,"svg",{xmlns:!0,fill:!0,viewBox:!0,"stroke-width":!0,stroke:!0,class:!0});var a=E(e);t=Ee(a,"path",{"stroke-linecap":!0,"stroke-linejoin":!0,d:!0}),E(t).forEach(h),a.forEach(h),l=Q(i),s=S(i,"DIV",{class:!0});var u=E(s);r=be(u,o),u.forEach(h),this.h()},h(){f(t,"stroke-linecap","round"),f(t,"stroke-linejoin","round"),f(t,"d","M3 16.5v2.25A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75V16.5M16.5 12 12 16.5m0 0L7.5 12m4.5 4.5V3"),f(e,"xmlns","http://www.w3.org/2000/svg"),f(e,"fill","none"),f(e,"viewBox","0 0 24 24"),f(e,"stroke-width","1.5"),f(e,"stroke","currentColor"),f(e,"class","size-4"),f(s,"class","flex items-center")},m(i,a){O(i,e,a),g(e,t),O(i,l,a),O(i,s,a),g(s,r)},p(i,a){a&8&&o!==(o=i[3].t("Download")+"")&&Me(r,o)},d(i){i&&(h(e),h(l),h(s))}}}function Ho(n){let e,t=n[3].t("Export chat (.json)")+"",l;return{c(){e=I("div"),l=ve(t),this.h()},l(s){e=S(s,"DIV",{class:!0});var o=E(e);l=be(o,t),o.forEach(h),this.h()},h(){f(e,"class","flex items-center line-clamp-1")},m(s,o){O(s,e,o),g(e,l)},p(s,o){o&8&&t!==(t=s[3].t("Export chat (.json)")+"")&&Me(l,t)},d(s){s&&h(e)}}}function Oo(n){let e,t=n[3].t("Plain text (.txt)")+"",l;return{c(){e=I("div"),l=ve(t),this.h()},l(s){e=S(s,"DIV",{class:!0});var o=E(e);l=be(o,t),o.forEach(h),this.h()},h(){f(e,"class","flex items-center line-clamp-1")},m(s,o){O(s,e,o),g(e,l)},p(s,o){o&8&&t!==(t=s[3].t("Plain text (.txt)")+"")&&Me(l,t)},d(s){s&&h(e)}}}function Uo(n){let e,t=n[3].t("PDF document (.pdf)")+"",l;return{c(){e=I("div"),l=ve(t),this.h()},l(s){e=S(s,"DIV",{class:!0});var o=E(e);l=be(o,t),o.forEach(h),this.h()},h(){f(e,"class","flex items-center line-clamp-1")},m(s,o){O(s,e,o),g(e,l)},p(s,o){o&8&&t!==(t=s[3].t("PDF document (.pdf)")+"")&&Me(l,t)},d(s){s&&h(e)}}}function Po(n){let e,t,l,s,o,r;return e=new Rt({props:{class:"flex gap-2 items-center px-3 py-2 text-sm  cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 rounded-md",$$slots:{default:[Ho]},$$scope:{ctx:n}}}),e.$on("click",n[12]),l=new Rt({props:{class:"flex gap-2 items-center px-3 py-2 text-sm  cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 rounded-md",$$slots:{default:[Oo]},$$scope:{ctx:n}}}),l.$on("click",n[13]),o=new Rt({props:{class:"flex gap-2 items-center px-3 py-2 text-sm  cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 rounded-md",$$slots:{default:[Uo]},$$scope:{ctx:n}}}),o.$on("click",n[14]),{c(){ce(e.$$.fragment),t=J(),ce(l.$$.fragment),s=J(),ce(o.$$.fragment)},l(i){ue(e.$$.fragment,i),t=Q(i),ue(l.$$.fragment,i),s=Q(i),ue(o.$$.fragment,i)},m(i,a){fe(e,i,a),O(i,t,a),fe(l,i,a),O(i,s,a),fe(o,i,a),r=!0},p(i,a){const u={};a&65544&&(u.$$scope={dirty:a,ctx:i}),e.$set(u);const c={};a&65544&&(c.$$scope={dirty:a,ctx:i}),l.$set(c);const d={};a&65544&&(d.$$scope={dirty:a,ctx:i}),o.$set(d)},i(i){r||(H(e.$$.fragment,i),H(l.$$.fragment,i),H(o.$$.fragment,i),r=!0)},o(i){z(e.$$.fragment,i),z(l.$$.fragment,i),z(o.$$.fragment,i),r=!1},d(i){i&&(h(t),h(s)),de(e,i),de(l,i),de(o,i)}}}function zo(n){let e,t,l,s;return e=new tr({props:{class:"flex gap-2 items-center px-3 py-2 text-sm  cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 rounded-md",$$slots:{default:[Lo]},$$scope:{ctx:n}}}),l=new Qs({props:{class:"w-full rounded-lg px-1 py-1.5 border border-gray-300/30 dark:border-gray-700/50 z-50 bg-white dark:bg-gray-850 dark:text-white shadow-lg",transition:nl,sideOffset:8,$$slots:{default:[Po]},$$scope:{ctx:n}}}),{c(){ce(e.$$.fragment),t=J(),ce(l.$$.fragment)},l(o){ue(e.$$.fragment,o),t=Q(o),ue(l.$$.fragment,o)},m(o,r){fe(e,o,r),O(o,t,r),fe(l,o,r),s=!0},p(o,r){const i={};r&65544&&(i.$$scope={dirty:r,ctx:o}),e.$set(i);const a={};r&65544&&(a.$$scope={dirty:r,ctx:o}),l.$set(a)},i(o){s||(H(e.$$.fragment,o),H(l.$$.fragment,o),s=!0)},o(o){z(e.$$.fragment,o),z(l.$$.fragment,o),s=!1},d(o){o&&h(t),de(e,o),de(l,o)}}}function Ro(n){let e,t,l,s,o,r,i,a,u;return e=new Rt({props:{class:"flex gap-2 items-center px-3 py-2 text-sm  cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 rounded-md",id:"chat-share-button",$$slots:{default:[Ao]},$$scope:{ctx:n}}}),e.$on("click",n[11]),l=new As({props:{$$slots:{default:[zo]},$$scope:{ctx:n}}}),a=new us({props:{chatId:n[1].id}}),{c(){ce(e.$$.fragment),t=J(),ce(l.$$.fragment),s=J(),o=I("hr"),r=J(),i=I("div"),ce(a.$$.fragment),this.h()},l(c){ue(e.$$.fragment,c),t=Q(c),ue(l.$$.fragment,c),s=Q(c),o=S(c,"HR",{class:!0}),r=Q(c),i=S(c,"DIV",{class:!0});var d=E(i);ue(a.$$.fragment,d),d.forEach(h),this.h()},h(){f(o,"class","border-gray-100 dark:border-gray-800 mt-2.5 mb-1.5"),f(i,"class","flex p-1")},m(c,d){fe(e,c,d),O(c,t,d),fe(l,c,d),O(c,s,d),O(c,o,d),O(c,r,d),O(c,i,d),fe(a,i,null),u=!0},p(c,d){const m={};d&65544&&(m.$$scope={dirty:d,ctx:c}),e.$set(m);const v={};d&65544&&(v.$$scope={dirty:d,ctx:c}),l.$set(v);const y={};d&2&&(y.chatId=c[1].id),a.$set(y)},i(c){u||(H(e.$$.fragment,c),H(l.$$.fragment,c),H(a.$$.fragment,c),u=!0)},o(c){z(e.$$.fragment,c),z(l.$$.fragment,c),z(a.$$.fragment,c),u=!1},d(c){c&&(h(t),h(s),h(o),h(r),h(i)),de(e,c),de(l,c),de(a)}}}function jo(n){let e,t,l;return t=new dl({props:{class:"w-full max-w-[200px] rounded-xl px-1 py-1.5 border border-gray-300/30 dark:border-gray-700/50 z-50 bg-white dark:bg-gray-850 dark:text-white shadow-lg",sideOffset:8,side:"bottom",align:"end",transition:nl,$$slots:{default:[Ro]},$$scope:{ctx:n}}}),{c(){e=I("div"),ce(t.$$.fragment),this.h()},l(s){e=S(s,"DIV",{slot:!0});var o=E(e);ue(t.$$.fragment,o),o.forEach(h),this.h()},h(){f(e,"slot","content")},m(s,o){O(s,e,o),fe(t,e,null),l=!0},p(s,o){const r={};o&65547&&(r.$$scope={dirty:o,ctx:s}),t.$set(r)},i(s){l||(H(t.$$.fragment,s),l=!0)},o(s){z(t.$$.fragment,s),l=!1},d(s){s&&h(e),de(t)}}}function Fo(n){let e,t;return e=new fl({props:{$$slots:{content:[jo],default:[No]},$$scope:{ctx:n}}}),e.$on("change",n[15]),{c(){ce(e.$$.fragment)},l(l){ue(e.$$.fragment,l)},m(l,s){fe(e,l,s),t=!0},p(l,[s]){const o={};s&65547&&(o.$$scope={dirty:s,ctx:l}),e.$set(o)},i(l){t||(H(e.$$.fragment,l),t=!0)},o(l){z(e.$$.fragment,l),t=!1},d(l){de(e,l)}}}function qo(n,e,t){let l,{$$slots:s={},$$scope:o}=e;const{saveAs:r}=Ms,i=wt("i18n");ae(n,i,N=>t(3,l=N));let{shareEnabled:a=!1}=e,{shareHandler:u}=e,{downloadHandler:c}=e,{chat:d}=e,{onClose:m=()=>{}}=e;const v=async()=>{const N=d.chat;console.log("download",d);const M=N.messages.reduce((C,W,j,U)=>`${C}### ${W.role.toUpperCase()}
${W.content}

`,"");let L=new Blob([M],{type:"text/plain"});r(L,`chat-${N.title}.txt`)},y=async()=>{const N=d.chat;console.log("download",d);const M=await Ts(N),L=window.URL.createObjectURL(M),C=document.createElement("a");C.href=L,C.download=`chat-${N.title}.pdf`,document.body.appendChild(C),C.click(),document.body.removeChild(C),window.URL.revokeObjectURL(L)},b=async()=>{let N=new Blob([JSON.stringify([d])],{type:"application/json"});r(N,`chat-export-${Date.now()}.json`)},_=()=>{u()},p=()=>{b()},w=()=>{v()},T=()=>{y()},D=N=>{N.detail===!1&&m()};return n.$$set=N=>{"shareEnabled"in N&&t(8,a=N.shareEnabled),"shareHandler"in N&&t(0,u=N.shareHandler),"downloadHandler"in N&&t(9,c=N.downloadHandler),"chat"in N&&t(1,d=N.chat),"onClose"in N&&t(2,m=N.onClose),"$$scope"in N&&t(16,o=N.$$scope)},[u,d,m,l,i,v,y,b,a,c,s,_,p,w,T,D,o]}class Wo extends xe{constructor(e){super(),$e(this,e,qo,Fo,Ke,{shareEnabled:8,shareHandler:0,downloadHandler:9,chat:1,onClose:2})}}function vn(n){let e,t,l;function s(r){n[15](r)}let o={showSetDefault:!n[2]};return n[0]!==void 0&&(o.selectedModels=n[0]),e=new Bo({props:o}),Ie.push(()=>Ue(e,"selectedModels",s)),{c(){ce(e.$$.fragment)},l(r){ue(e.$$.fragment,r)},m(r,i){fe(e,r,i),l=!0},p(r,i){const a={};i&4&&(a.showSetDefault=!r[2]),!t&&i&1&&(t=!0,a.selectedModels=r[0],Oe(()=>t=!1)),e.$set(a)},i(r){l||(H(e.$$.fragment,r),l=!0)},o(r){z(e.$$.fragment,r),l=!1},d(r){de(e,r)}}}function bn(n){let e,t;return e=new Wo({props:{chat:n[3],shareEnabled:n[2],shareHandler:n[16],downloadHandler:n[17],$$slots:{default:[Zo]},$$scope:{ctx:n}}}),{c(){ce(e.$$.fragment)},l(l){ue(e.$$.fragment,l)},m(l,s){fe(e,l,s),t=!0},p(l,s){const o={};s&8&&(o.chat=l[3]),s&4&&(o.shareEnabled=l[2]),s&32&&(o.shareHandler=l[16]),s&64&&(o.downloadHandler=l[17]),s&2097152&&(o.$$scope={dirty:s,ctx:l}),e.$set(o)},i(l){t||(H(e.$$.fragment,l),t=!0)},o(l){z(e.$$.fragment,l),t=!1},d(l){de(e,l)}}}function Zo(n){let e,t='<div class="m-auto self-center"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-5"><path stroke-linecap="round" stroke-linejoin="round" d="M6.75 12a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0ZM12.75 12a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0ZM18.75 12a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0Z"></path></svg></div>';return{c(){e=I("button"),e.innerHTML=t,this.h()},l(l){e=S(l,"BUTTON",{class:!0,id:!0,"data-svelte-h":!0}),Ye(e)!=="svelte-9m6068"&&(e.innerHTML=t),this.h()},h(){f(e,"class","hidden md:flex cursor-pointer px-2 py-2 rounded-xl hover:bg-gray-100 dark:hover:bg-gray-850 transition"),f(e,"id","chat-context-menu-button")},m(l,s){O(l,e,s)},p:ge,d(l){l&&h(e)}}}function Go(n){let e,t,l='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5"><path d="M5.433 13.917l1.262-3.155A4 4 0 017.58 9.42l6.92-6.918a2.121 2.121 0 013 3l-6.92 6.918c-.383.383-.84.685-1.343.886l-3.154 1.262a.5.5 0 01-.65-.65z"></path><path d="M3.5 5.75c0-.69.56-1.25 1.25-1.25H10A.75.75 0 0010 3H4.75A2.75 2.75 0 002 5.75v9.5A2.75 2.75 0 004.75 18h9.5A2.75 2.75 0 0017 15.25V10a.75.75 0 00-1.5 0v5.25c0 .69-.56 1.25-1.25 1.25h-9.5c-.69 0-1.25-.56-1.25-1.25v-9.5z"></path></svg>',s,o,r;return{c(){e=I("button"),t=I("div"),t.innerHTML=l,this.h()},l(i){e=S(i,"BUTTON",{id:!0,class:!0});var a=E(e);t=S(a,"DIV",{class:!0,"data-svelte-h":!0}),Ye(t)!=="svelte-1fcii9y"&&(t.innerHTML=l),a.forEach(h),this.h()},h(){f(t,"class","m-auto self-center"),f(e,"id","new-chat-button"),f(e,"class",s="flex "+(n[8]?"md:hidden":"")+" cursor-pointer px-2 py-2 rounded-xl hover:bg-gray-100 dark:hover:bg-gray-850 transition")},m(i,a){O(i,e,a),g(e,t),o||(r=te(e,"click",n[18]),o=!0)},p(i,a){a&256&&s!==(s="flex "+(i[8]?"md:hidden":"")+" cursor-pointer px-2 py-2 rounded-xl hover:bg-gray-100 dark:hover:bg-gray-850 transition")&&f(e,"class",s)},d(i){i&&h(e),o=!1,r()}}}function wn(n){let e,t;return e=new ds({props:{className:"max-w-[200px]",role:n[10].role,$$slots:{default:[Jo]},$$scope:{ctx:n}}}),e.$on("show",n[19]),{c(){ce(e.$$.fragment)},l(l){ue(e.$$.fragment,l)},m(l,s){fe(e,l,s),t=!0},p(l,s){const o={};s&1024&&(o.role=l[10].role),s&2098176&&(o.$$scope={dirty:s,ctx:l}),e.$set(o)},i(l){t||(H(e.$$.fragment,l),t=!0)},o(l){z(e.$$.fragment,l),t=!1},d(l){de(e,l)}}}function Jo(n){let e,t,l,s;return{c(){e=I("button"),t=I("div"),l=I("img"),this.h()},l(o){e=S(o,"BUTTON",{class:!0,"aria-label":!0});var r=E(e);t=S(r,"DIV",{class:!0});var i=E(t);l=S(i,"IMG",{src:!0,class:!0,alt:!0,draggable:!0}),i.forEach(h),r.forEach(h),this.h()},h(){zt(l.src,s=n[10].profile_image_url)||f(l,"src",s),f(l,"class","size-6 object-cover rounded-full"),f(l,"alt","User profile"),f(l,"draggable","false"),f(t,"class","self-center"),f(e,"class","select-none flex rounded-xl p-1.5 w-full hover:bg-gray-100 dark:hover:bg-gray-850 transition"),f(e,"aria-label","User Menu")},m(o,r){O(o,e,r),g(e,t),g(t,l)},p(o,r){r&1024&&!zt(l.src,s=o[10].profile_image_url)&&f(l,"src",s)},d(o){o&&h(e)}}}function Qo(n){let e,t,l,s,o,r,i,a,u,c,d,m,v,y,b,_,p,w,T,D,N;function M(U){n[13](U)}let L={chatId:n[7]};n[5]!==void 0&&(L.show=n[5]),e=new fs({props:L}),Ie.push(()=>Ue(e,"show",M)),c=new Cs({});let C=n[4]&&vn(n),W=n[2]&&n[3]&&n[3].id&&bn(n);p=new Nt({props:{content:n[9].t("New Chat"),$$slots:{default:[Go]},$$scope:{ctx:n}}});let j=n[10]!==void 0&&wn(n);return{c(){ce(e.$$.fragment),l=J(),s=I("nav"),o=I("div"),r=I("div"),i=I("div"),a=I("button"),u=I("div"),ce(c.$$.fragment),m=J(),v=I("div"),C&&C.c(),y=J(),b=I("div"),W&&W.c(),_=J(),ce(p.$$.fragment),w=J(),j&&j.c(),this.h()},l(U){ue(e.$$.fragment,U),l=Q(U),s=S(U,"NAV",{id:!0,class:!0});var q=E(s);o=S(q,"DIV",{class:!0});var oe=E(o);r=S(oe,"DIV",{class:!0});var K=E(r);i=S(K,"DIV",{class:!0});var P=E(i);a=S(P,"BUTTON",{id:!0,class:!0});var V=E(a);u=S(V,"DIV",{class:!0});var A=E(u);ue(c.$$.fragment,A),A.forEach(h),V.forEach(h),P.forEach(h),m=Q(K),v=S(K,"DIV",{class:!0});var X=E(v);C&&C.l(X),X.forEach(h),y=Q(K),b=S(K,"DIV",{class:!0});var re=E(b);W&&W.l(re),_=Q(re),ue(p.$$.fragment,re),w=Q(re),j&&j.l(re),re.forEach(h),K.forEach(h),oe.forEach(h),q.forEach(h),this.h()},h(){f(u,"class","m-auto self-center"),f(a,"id","sidebar-toggle-button"),f(a,"class","cursor-pointer px-2 py-2 flex rounded-xl hover:bg-gray-100 dark:hover:bg-gray-850 transition"),f(i,"class",d=(n[8]?"md:hidden":"")+" mr-3 self-start flex flex-none items-center text-gray-600 dark:text-gray-400"),f(v,"class","flex-1 overflow-hidden max-w-full"),f(b,"class","self-start flex flex-none items-center text-gray-600 dark:text-gray-400"),f(r,"class","flex items-center w-full max-w-full"),f(o,"class","flex max-w-full w-full mx-auto px-5 pt-0.5 md:px-[1rem]"),f(s,"id","nav"),f(s,"class","sticky py-2.5 top-0 flex flex-row justify-center z-30")},m(U,q){fe(e,U,q),O(U,l,q),O(U,s,q),g(s,o),g(o,r),g(r,i),g(i,a),g(a,u),fe(c,u,null),g(r,m),g(r,v),C&&C.m(v,null),g(r,y),g(r,b),W&&W.m(b,null),g(b,_),fe(p,b,null),g(b,w),j&&j.m(b,null),T=!0,D||(N=te(a,"click",n[14]),D=!0)},p(U,[q]){const oe={};q&128&&(oe.chatId=U[7]),!t&&q&32&&(t=!0,oe.show=U[5],Oe(()=>t=!1)),e.$set(oe),(!T||q&256&&d!==(d=(U[8]?"md:hidden":"")+" mr-3 self-start flex flex-none items-center text-gray-600 dark:text-gray-400"))&&f(i,"class",d),U[4]?C?(C.p(U,q),q&16&&H(C,1)):(C=vn(U),C.c(),H(C,1),C.m(v,null)):C&&(Pe(),z(C,1,1,()=>{C=null}),ze()),U[2]&&U[3]&&U[3].id?W?(W.p(U,q),q&12&&H(W,1)):(W=bn(U),W.c(),H(W,1),W.m(b,_)):W&&(Pe(),z(W,1,1,()=>{W=null}),ze());const K={};q&512&&(K.content=U[9].t("New Chat")),q&2097410&&(K.$$scope={dirty:q,ctx:U}),p.$set(K),U[10]!==void 0?j?(j.p(U,q),q&1024&&H(j,1)):(j=wn(U),j.c(),H(j,1),j.m(b,null)):j&&(Pe(),z(j,1,1,()=>{j=null}),ze())},i(U){T||(H(e.$$.fragment,U),H(c.$$.fragment,U),H(C),H(W),H(p.$$.fragment,U),H(j),T=!0)},o(U){z(e.$$.fragment,U),z(c.$$.fragment,U),z(C),z(W),z(p.$$.fragment,U),z(j),T=!1},d(U){U&&(h(l),h(s)),de(e,U),de(c),C&&C.d(),W&&W.d(),de(p),j&&j.d(),D=!1,N()}}}function Xo(n,e,t){let l,s,o,r,i;ae(n,Ln,C=>t(20,l=C)),ae(n,Pt,C=>t(7,s=C)),ae(n,Kt,C=>t(8,o=C)),ae(n,cl,C=>t(10,i=C));const a=wt("i18n");ae(n,a,C=>t(9,r=C));let{initNewChat:u}=e,{title:c=l}=e,{shareEnabled:d=!1}=e,{chat:m}=e,{selectedModels:v}=e,{showModelSelector:y=!0}=e,b=!1,_=!1;function p(C){b=C,t(5,b)}const w=()=>{Kt.set(!o)};function T(C){v=C,t(0,v)}const D=()=>{t(5,b=!b)},N=()=>{t(6,_=!_)},M=()=>{u()},L=C=>{C.detail==="archived-chat"&&Qn.set(!0)};return n.$$set=C=>{"initNewChat"in C&&t(1,u=C.initNewChat),"title"in C&&t(12,c=C.title),"shareEnabled"in C&&t(2,d=C.shareEnabled),"chat"in C&&t(3,m=C.chat),"selectedModels"in C&&t(0,v=C.selectedModels),"showModelSelector"in C&&t(4,y=C.showModelSelector)},[v,u,d,m,y,b,_,s,o,r,i,a,c,p,w,T,D,N,M,L]}class Yo extends xe{constructor(e){super(),$e(this,e,Xo,Qo,Ke,{initNewChat:1,title:12,shareEnabled:2,chat:3,selectedModels:0,showModelSelector:4})}}function kn(n,e,t){const l=n.slice();return l[10]=e[t],l}function Ko(n){let e;const t=n[4].default,l=gt(t,n,n[8],null);return{c(){l&&l.c()},l(s){l&&l.l(s)},m(s,o){l&&l.m(s,o),e=!0},p(s,o){l&&l.p&&(!e||o&256)&&_t(l,t,s,s[8],e?vt(t,s[8],o,null):pt(s[8]),null)},i(s){e||(H(l,s),e=!0)},o(s){z(l,s),e=!1},d(s){l&&l.d(s)}}}function xo(n){var r;let e,t,l=(((r=n[10])==null?void 0:r.label)??"Camera")+"",s,o;return{c(){e=I("div"),t=I("div"),s=ve(l),o=J(),this.h()},l(i){e=S(i,"DIV",{class:!0});var a=E(e);t=S(a,"DIV",{class:!0});var u=E(t);s=be(u,l),u.forEach(h),a.forEach(h),o=Q(i),this.h()},h(){f(t,"class","line-clamp-1"),f(e,"class","flex items-center")},m(i,a){O(i,e,a),g(e,t),g(t,s),O(i,o,a)},p(i,a){var u;a&2&&l!==(l=(((u=i[10])==null?void 0:u.label)??"Camera")+"")&&Me(s,l)},d(i){i&&(h(e),h(o))}}}function yn(n){let e,t;function l(){return n[5](n[10])}return e=new Rt({props:{class:"flex gap-2 items-center px-3 py-2 text-sm  cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 rounded-md",$$slots:{default:[xo]},$$scope:{ctx:n}}}),e.$on("click",l),{c(){ce(e.$$.fragment)},l(s){ue(e.$$.fragment,s)},m(s,o){fe(e,s,o),t=!0},p(s,o){n=s;const r={};o&258&&(r.$$scope={dirty:o,ctx:n}),e.$set(r)},i(s){t||(H(e.$$.fragment,s),t=!0)},o(s){z(e.$$.fragment,s),t=!1},d(s){de(e,s)}}}function $o(n){let e,t,l=nt(n[1]),s=[];for(let r=0;r<l.length;r+=1)s[r]=yn(kn(n,l,r));const o=r=>z(s[r],1,1,()=>{s[r]=null});return{c(){for(let r=0;r<s.length;r+=1)s[r].c();e=Fe()},l(r){for(let i=0;i<s.length;i+=1)s[i].l(r);e=Fe()},m(r,i){for(let a=0;a<s.length;a+=1)s[a]&&s[a].m(r,i);O(r,e,i),t=!0},p(r,i){if(i&10){l=nt(r[1]);let a;for(a=0;a<l.length;a+=1){const u=kn(r,l,a);s[a]?(s[a].p(u,i),H(s[a],1)):(s[a]=yn(u),s[a].c(),H(s[a],1),s[a].m(e.parentNode,e))}for(Pe(),a=l.length;a<s.length;a+=1)o(a);ze()}},i(r){if(!t){for(let i=0;i<l.length;i+=1)H(s[i]);t=!0}},o(r){s=s.filter(Boolean);for(let i=0;i<s.length;i+=1)z(s[i]);t=!1},d(r){r&&h(e),Bt(s,r)}}}function ei(n){let e,t,l;return t=new dl({props:{class:"w-full max-w-[180px] rounded-lg px-1 py-1.5 border border-gray-300/30 dark:border-gray-700/50 z-[9999] bg-white dark:bg-gray-900 dark:text-white shadow-sm",sideOffset:6,side:"top",align:"start",transition:nl,$$slots:{default:[$o]},$$scope:{ctx:n}}}),{c(){e=I("div"),ce(t.$$.fragment),this.h()},l(s){e=S(s,"DIV",{slot:!0});var o=E(e);ue(t.$$.fragment,o),o.forEach(h),this.h()},h(){f(e,"slot","content")},m(s,o){O(s,e,o),fe(t,e,null),l=!0},p(s,o){const r={};o&258&&(r.$$scope={dirty:o,ctx:s}),t.$set(r)},i(s){l||(H(t.$$.fragment,s),l=!0)},o(s){z(t.$$.fragment,s),l=!1},d(s){s&&h(e),de(t)}}}function ti(n){let e,t,l;function s(r){n[6](r)}let o={$$slots:{content:[ei],default:[Ko]},$$scope:{ctx:n}};return n[2]!==void 0&&(o.show=n[2]),e=new fl({props:o}),Ie.push(()=>Ue(e,"show",s)),e.$on("change",n[7]),{c(){ce(e.$$.fragment)},l(r){ue(e.$$.fragment,r)},m(r,i){fe(e,r,i),l=!0},p(r,[i]){const a={};i&258&&(a.$$scope={dirty:i,ctx:r}),!t&&i&4&&(t=!0,a.show=r[2],Oe(()=>t=!1)),e.$set(a)},i(r){l||(H(e.$$.fragment,r),l=!0)},o(r){z(e.$$.fragment,r),l=!1},d(r){de(e,r)}}}function li(n,e,t){let{$$slots:l={},$$scope:s}=e;wt("i18n");const o=Gt();let{onClose:r=()=>{}}=e,{devices:i}=e,a=!1;const u=m=>{o("change",m.deviceId)};function c(m){a=m,t(2,a)}const d=m=>{m.detail===!1&&r()};return n.$$set=m=>{"onClose"in m&&t(0,r=m.onClose),"devices"in m&&t(1,i=m.devices),"$$scope"in m&&t(8,s=m.$$scope)},[r,i,a,o,l,u,c,d,s]}class ni extends xe{constructor(e){super(),$e(this,e,li,ti,Ke,{onClose:0,devices:1})}}function En(n){let e,t,l,s,o,r,i,a,u,c,d,m,v,y,b,_,p,w='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="size-5"><path d="M6.28 5.22a.75.75 0 0 0-1.06 1.06L8.94 10l-3.72 3.72a.75.75 0 1 0 1.06 1.06L10 11.06l3.72 3.72a.75.75 0 1 0 1.06-1.06L11.06 10l3.72-3.72a.75.75 0 0 0-1.06-1.06L10 8.94 6.28 5.22Z"></path></svg>',T,D,N,M=n[3]&&In(n);function L(V,A){return V[3]?ii:ai}let C=L(n),W=C(n);const j=[hi,di],U=[];function q(V,A){return V[3]?0:1}u=q(n),c=U[u]=j[u](n);function oe(V,A){return V[0]?vi:V[1]?pi:_i}let K=oe(n),P=K(n);return{c(){e=I("div"),t=I("div"),l=I("div"),M&&M.c(),s=J(),o=I("div"),W.c(),r=J(),i=I("div"),a=I("div"),c.c(),d=J(),m=I("div"),v=I("button"),y=I("div"),P.c(),b=J(),_=I("div"),p=I("button"),p.innerHTML=w,this.h()},l(V){e=S(V,"DIV",{class:!0});var A=E(e);t=S(A,"DIV",{class:!0});var X=E(t);l=S(X,"DIV",{class:!0});var re=E(l);M&&M.l(re),s=Q(re),o=S(re,"DIV",{class:!0});var le=E(o);W.l(le),le.forEach(h),r=Q(re),i=S(re,"DIV",{class:!0});var he=E(i);a=S(he,"DIV",{});var qe=E(a);c.l(qe),qe.forEach(h),d=Q(he),m=S(he,"DIV",{});var Re=E(m);v=S(Re,"BUTTON",{type:!0});var tt=E(v);y=S(tt,"DIV",{class:!0});var G=E(y);P.l(G),G.forEach(h),tt.forEach(h),Re.forEach(h),b=Q(he),_=S(he,"DIV",{});var rt=E(_);p=S(rt,"BUTTON",{class:!0,type:!0,"data-svelte-h":!0}),Ye(p)!=="svelte-khrbnh"&&(p.innerHTML=w),rt.forEach(h),he.forEach(h),re.forEach(h),X.forEach(h),A.forEach(h),this.h()},h(){f(o,"class","flex justify-center items-center flex-1 h-full w-full max-h-full"),f(y,"class","line-clamp-1 text-sm font-medium"),f(v,"type","button"),f(p,"class","p-3 rounded-full bg-gray-50 dark:bg-gray-900"),f(p,"type","button"),f(i,"class","flex justify-between items-center pb-2 w-full"),f(l,"class","max-w-lg w-full h-screen max-h-[100dvh] flex flex-col justify-between p-3 md:p-6"),f(t,"class","absolute w-full h-screen max-h-[100dvh] bg-white text-gray-700 dark:bg-black dark:text-gray-300 flex justify-center"),f(e,"class","absolute w-full h-screen max-h-[100dvh] flex z-[999] overflow-hidden")},m(V,A){O(V,e,A),g(e,t),g(t,l),M&&M.m(l,null),g(l,s),g(l,o),W.m(o,null),g(l,r),g(l,i),g(i,a),U[u].m(a,null),g(i,d),g(i,m),g(m,v),g(v,y),P.m(y,null),g(i,b),g(i,_),g(_,p),T=!0,D||(N=[te(v,"click",n[26]),te(p,"click",n[27])],D=!0)},p(V,A){V[3]?M?M.p(V,A):(M=In(V),M.c(),M.m(l,s)):M&&(M.d(1),M=null),C===(C=L(V))&&W?W.p(V,A):(W.d(1),W=C(V),W&&(W.c(),W.m(o,null)));let X=u;u=q(V),u===X?U[u].p(V,A):(Pe(),z(U[X],1,1,()=>{U[X]=null}),ze(),c=U[u],c?c.p(V,A):(c=U[u]=j[u](V),c.c()),H(c,1),c.m(a,null)),K===(K=oe(V))&&P?P.p(V,A):(P.d(1),P=K(V),P&&(P.c(),P.m(y,null)))},i(V){T||(H(c),T=!0)},o(V){z(c),T=!1},d(V){V&&h(e),M&&M.d(),W.d(),U[u].d(),P.d(),D=!1,bt(N)}}}function In(n){let e,t,l;function s(i,a){return i[2]?oi:i[0]||i[1]?ri:si}let o=s(n),r=o(n);return{c(){e=I("button"),r.c(),this.h()},l(i){e=S(i,"BUTTON",{type:!0,class:!0});var a=E(e);r.l(a),a.forEach(h),this.h()},h(){f(e,"type","button"),f(e,"class","flex justify-center items-center w-full h-20 min-h-20")},m(i,a){O(i,e,a),r.m(e,null),t||(l=te(e,"click",n[21]),t=!0)},p(i,a){o===(o=s(i))&&r?r.p(i,a):(r.d(1),r=o(i),r&&(r.c(),r.m(e,null)))},d(i){i&&h(e),r.d(),t=!1,l()}}}function si(n){let e,t;return{c(){e=I("div"),this.h()},l(l){e=S(l,"DIV",{class:!0}),E(e).forEach(h),this.h()},h(){f(e,"class",t=(n[4]*100>4?" size-[4.5rem]":n[4]*100>2?" size-16":n[4]*100>1?"size-14":"size-12")+" transition-all bg-black dark:bg-white rounded-full")},m(l,s){O(l,e,s)},p(l,s){s[0]&16&&t!==(t=(l[4]*100>4?" size-[4.5rem]":l[4]*100>2?" size-16":l[4]*100>1?"size-14":"size-12")+" transition-all bg-black dark:bg-white rounded-full")&&f(e,"class",t)},d(l){l&&h(e)}}}function ri(n){let e,t,l,s,o,r;return{c(){e=ye("svg"),t=ye("style"),l=ve(`.spinner_qM83 {
										animation: spinner_8HQG 1.05s infinite;
									}
									.spinner_oXPr {
										animation-delay: 0.1s;
									}
									.spinner_ZTLf {
										animation-delay: 0.2s;
									}
									@keyframes spinner_8HQG {
										0%,
										57.14% {
											animation-timing-function: cubic-bezier(0.33, 0.66, 0.66, 1);
											transform: translate(0);
										}
										28.57% {
											animation-timing-function: cubic-bezier(0.33, 0, 0.66, 0.33);
											transform: translateY(-6px);
										}
										100% {
											transform: translate(0);
										}
									}
								`),s=ye("circle"),o=ye("circle"),r=ye("circle"),this.h()},l(i){e=Ee(i,"svg",{class:!0,viewBox:!0,fill:!0,xmlns:!0});var a=E(e);t=Ee(a,"style",{});var u=E(t);l=be(u,`.spinner_qM83 {
										animation: spinner_8HQG 1.05s infinite;
									}
									.spinner_oXPr {
										animation-delay: 0.1s;
									}
									.spinner_ZTLf {
										animation-delay: 0.2s;
									}
									@keyframes spinner_8HQG {
										0%,
										57.14% {
											animation-timing-function: cubic-bezier(0.33, 0.66, 0.66, 1);
											transform: translate(0);
										}
										28.57% {
											animation-timing-function: cubic-bezier(0.33, 0, 0.66, 0.33);
											transform: translateY(-6px);
										}
										100% {
											transform: translate(0);
										}
									}
								`),u.forEach(h),s=Ee(a,"circle",{class:!0,cx:!0,cy:!0,r:!0}),E(s).forEach(h),o=Ee(a,"circle",{class:!0,cx:!0,cy:!0,r:!0}),E(o).forEach(h),r=Ee(a,"circle",{class:!0,cx:!0,cy:!0,r:!0}),E(r).forEach(h),a.forEach(h),this.h()},h(){f(s,"class","spinner_qM83"),f(s,"cx","4"),f(s,"cy","12"),f(s,"r","3"),f(o,"class","spinner_qM83 spinner_oXPr"),f(o,"cx","12"),f(o,"cy","12"),f(o,"r","3"),f(r,"class","spinner_qM83 spinner_ZTLf"),f(r,"cx","20"),f(r,"cy","12"),f(r,"r","3"),f(e,"class","size-12 text-gray-900 dark:text-gray-400"),f(e,"viewBox","0 0 24 24"),f(e,"fill","currentColor"),f(e,"xmlns","http://www.w3.org/2000/svg")},m(i,a){O(i,e,a),g(e,t),g(t,l),g(e,s),g(e,o),g(e,r)},p:ge,d(i){i&&h(e)}}}function oi(n){let e,t;return{c(){e=I("div"),t=ve(n[2]),this.h()},l(l){e=S(l,"DIV",{class:!0,style:!0});var s=E(e);t=be(s,n[2]),s.forEach(h),this.h()},h(){f(e,"class","transition-all rounded-full"),ht(e,"font-size",(n[4]*100>4?"4.5":n[4]*100>2?"4.25":n[4]*100>1?"3.75":"3.5")+"rem"),ht(e,"width","100%"),ht(e,"text-align","center")},m(l,s){O(l,e,s),g(e,t)},p(l,s){s[0]&4&&Me(t,l[2]),s[0]&16&&ht(e,"font-size",(l[4]*100>4?"4.5":l[4]*100>2?"4.25":l[4]*100>1?"3.75":"3.5")+"rem")},d(l){l&&h(e)}}}function ii(n){let e,t,l,s,o,r,i,a='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" fill="currentColor" class="size-6"><path d="M5.28 4.22a.75.75 0 0 0-1.06 1.06L6.94 8l-2.72 2.72a.75.75 0 1 0 1.06 1.06L8 9.06l2.72 2.72a.75.75 0 1 0 1.06-1.06L9.06 8l2.72-2.72a.75.75 0 0 0-1.06-1.06L8 6.94 5.28 4.22Z"></path></svg>',u,c;return{c(){e=I("div"),t=I("video"),l=J(),s=I("canvas"),o=J(),r=I("div"),i=I("button"),i.innerHTML=a,this.h()},l(d){e=S(d,"DIV",{class:!0});var m=E(e);t=S(m,"VIDEO",{id:!0,class:!0}),E(t).forEach(h),l=Q(m),s=S(m,"CANVAS",{id:!0,style:!0}),E(s).forEach(h),o=Q(m),r=S(m,"DIV",{class:!0});var v=E(r);i=S(v,"BUTTON",{type:!0,class:!0,"data-svelte-h":!0}),Ye(i)!=="svelte-zfg1vd"&&(i.innerHTML=a),v.forEach(h),m.forEach(h),this.h()},h(){f(t,"id","camera-feed"),t.autoplay=!0,f(t,"class","rounded-2xl h-full min-w-full object-cover object-center"),t.playsInline=!0,f(s,"id","camera-canvas"),ht(s,"display","none"),f(i,"type","button"),f(i,"class","p-1.5 text-white cursor-pointer backdrop-blur-xl bg-black/10 rounded-full"),f(r,"class","absolute top-4 md:top-8 left-4"),f(e,"class","relative flex video-container w-full max-h-full pt-2 pb-4 md:py-6 px-2 h-full")},m(d,m){O(d,e,m),g(e,t),g(e,l),g(e,s),g(e,o),g(e,r),g(r,i),u||(c=te(i,"click",n[23]),u=!0)},p:ge,d(d){d&&h(e),u=!1,c()}}}function ai(n){let e,t,l;function s(i,a){return i[2]?fi:i[0]||i[1]?ui:ci}let o=s(n),r=o(n);return{c(){e=I("button"),r.c(),this.h()},l(i){e=S(i,"BUTTON",{type:!0});var a=E(e);r.l(a),a.forEach(h),this.h()},h(){f(e,"type","button")},m(i,a){O(i,e,a),r.m(e,null),t||(l=te(e,"click",n[22]),t=!0)},p(i,a){o===(o=s(i))&&r?r.p(i,a):(r.d(1),r=o(i),r&&(r.c(),r.m(e,null)))},d(i){i&&h(e),r.d(),t=!1,l()}}}function ci(n){let e,t;return{c(){e=I("div"),this.h()},l(l){e=S(l,"DIV",{class:!0}),E(e).forEach(h),this.h()},h(){f(e,"class",t=(n[4]*100>4?" size-52":n[4]*100>2?"size-48":n[4]*100>1?"size-[11.5rem]":"size-44")+" transition-all bg-black dark:bg-white rounded-full")},m(l,s){O(l,e,s)},p(l,s){s[0]&16&&t!==(t=(l[4]*100>4?" size-52":l[4]*100>2?"size-48":l[4]*100>1?"size-[11.5rem]":"size-44")+" transition-all bg-black dark:bg-white rounded-full")&&f(e,"class",t)},d(l){l&&h(e)}}}function ui(n){let e,t,l,s,o,r;return{c(){e=ye("svg"),t=ye("style"),l=ve(`.spinner_qM83 {
											animation: spinner_8HQG 1.05s infinite;
										}
										.spinner_oXPr {
											animation-delay: 0.1s;
										}
										.spinner_ZTLf {
											animation-delay: 0.2s;
										}
										@keyframes spinner_8HQG {
											0%,
											57.14% {
												animation-timing-function: cubic-bezier(0.33, 0.66, 0.66, 1);
												transform: translate(0);
											}
											28.57% {
												animation-timing-function: cubic-bezier(0.33, 0, 0.66, 0.33);
												transform: translateY(-6px);
											}
											100% {
												transform: translate(0);
											}
										}
									`),s=ye("circle"),o=ye("circle"),r=ye("circle"),this.h()},l(i){e=Ee(i,"svg",{class:!0,viewBox:!0,fill:!0,xmlns:!0});var a=E(e);t=Ee(a,"style",{});var u=E(t);l=be(u,`.spinner_qM83 {
											animation: spinner_8HQG 1.05s infinite;
										}
										.spinner_oXPr {
											animation-delay: 0.1s;
										}
										.spinner_ZTLf {
											animation-delay: 0.2s;
										}
										@keyframes spinner_8HQG {
											0%,
											57.14% {
												animation-timing-function: cubic-bezier(0.33, 0.66, 0.66, 1);
												transform: translate(0);
											}
											28.57% {
												animation-timing-function: cubic-bezier(0.33, 0, 0.66, 0.33);
												transform: translateY(-6px);
											}
											100% {
												transform: translate(0);
											}
										}
									`),u.forEach(h),s=Ee(a,"circle",{class:!0,cx:!0,cy:!0,r:!0}),E(s).forEach(h),o=Ee(a,"circle",{class:!0,cx:!0,cy:!0,r:!0}),E(o).forEach(h),r=Ee(a,"circle",{class:!0,cx:!0,cy:!0,r:!0}),E(r).forEach(h),a.forEach(h),this.h()},h(){f(s,"class","spinner_qM83"),f(s,"cx","4"),f(s,"cy","12"),f(s,"r","3"),f(o,"class","spinner_qM83 spinner_oXPr"),f(o,"cx","12"),f(o,"cy","12"),f(o,"r","3"),f(r,"class","spinner_qM83 spinner_ZTLf"),f(r,"cx","20"),f(r,"cy","12"),f(r,"r","3"),f(e,"class","size-44 text-gray-900 dark:text-gray-400"),f(e,"viewBox","0 0 24 24"),f(e,"fill","currentColor"),f(e,"xmlns","http://www.w3.org/2000/svg")},m(i,a){O(i,e,a),g(e,t),g(t,l),g(e,s),g(e,o),g(e,r)},p:ge,d(i){i&&h(e)}}}function fi(n){let e,t;return{c(){e=I("div"),t=ve(n[2]),this.h()},l(l){e=S(l,"DIV",{class:!0,style:!0});var s=E(e);t=be(s,n[2]),s.forEach(h),this.h()},h(){f(e,"class","transition-all rounded-full"),ht(e,"font-size",(n[4]*100>4?"13":n[4]*100>2?"12":n[4]*100>1?"11.5":"11")+"rem"),ht(e,"width","100%"),ht(e,"text-align","center")},m(l,s){O(l,e,s),g(e,t)},p(l,s){s[0]&4&&Me(t,l[2]),s[0]&16&&ht(e,"font-size",(l[4]*100>4?"13":l[4]*100>2?"12":l[4]*100>1?"11.5":"11")+"rem")},d(l){l&&h(e)}}}function di(n){let e,t;return e=new Nt({props:{content:n[8].t("Camera"),$$slots:{default:[mi]},$$scope:{ctx:n}}}),{c(){ce(e.$$.fragment)},l(l){ue(e.$$.fragment,l)},m(l,s){fe(e,l,s),t=!0},p(l,s){const o={};s[0]&256&&(o.content=l[8].t("Camera")),s[1]&33554432&&(o.$$scope={dirty:s,ctx:l}),e.$set(o)},i(l){t||(H(e.$$.fragment,l),t=!0)},o(l){z(e.$$.fragment,l),t=!1},d(l){de(e,l)}}}function hi(n){let e,t;return e=new ni({props:{devices:n[5],$$slots:{default:[gi]},$$scope:{ctx:n}}}),e.$on("change",n[24]),{c(){ce(e.$$.fragment)},l(l){ue(e.$$.fragment,l)},m(l,s){fe(e,l,s),t=!0},p(l,s){const o={};s[0]&32&&(o.devices=l[5]),s[1]&33554432&&(o.$$scope={dirty:s,ctx:l}),e.$set(o)},i(l){t||(H(e.$$.fragment,l),t=!0)},o(l){z(e.$$.fragment,l),t=!1},d(l){de(e,l)}}}function mi(n){let e,t='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-5"><path stroke-linecap="round" stroke-linejoin="round" d="M6.827 6.175A2.31 2.31 0 0 1 5.186 7.23c-.38.054-.757.112-1.134.175C2.999 7.58 2.25 8.507 2.25 9.574V18a2.25 2.25 0 0 0 2.25 2.25h15A2.25 2.25 0 0 0 21.75 18V9.574c0-1.067-.75-1.994-1.802-2.169a47.865 47.865 0 0 0-1.134-.175 2.31 2.31 0 0 1-1.64-1.055l-.822-1.316a2.192 2.192 0 0 0-1.736-1.039 48.774 48.774 0 0 0-5.232 0 2.192 2.192 0 0 0-1.736 1.039l-.821 1.316Z"></path><path stroke-linecap="round" stroke-linejoin="round" d="M16.5 12.75a4.5 4.5 0 1 1-9 0 4.5 4.5 0 0 1 9 0ZM18.75 10.5h.008v.008h-.008V10.5Z"></path></svg>',l,s;return{c(){e=I("button"),e.innerHTML=t,this.h()},l(o){e=S(o,"BUTTON",{class:!0,type:!0,"data-svelte-h":!0}),Ye(e)!=="svelte-ehdlsa"&&(e.innerHTML=t),this.h()},h(){f(e,"class","p-3 rounded-full bg-gray-50 dark:bg-gray-900"),f(e,"type","button")},m(o,r){O(o,e,r),l||(s=te(e,"click",n[25]),l=!0)},p:ge,d(o){o&&h(e),l=!1,s()}}}function gi(n){let e,t='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="size-5"><path fill-rule="evenodd" d="M15.312 11.424a5.5 5.5 0 0 1-9.201 2.466l-.312-.311h2.433a.75.75 0 0 0 0-1.5H3.989a.75.75 0 0 0-.75.75v4.242a.75.75 0 0 0 1.5 0v-2.43l.31.31a7 7 0 0 0 11.712-3.138.75.75 0 0 0-1.449-.39Zm1.23-3.723a.75.75 0 0 0 .219-.53V2.929a.75.75 0 0 0-1.5 0V5.36l-.31-.31A7 7 0 0 0 3.239 8.188a.75.75 0 1 0 1.448.389A5.5 5.5 0 0 1 13.89 6.11l.311.31h-2.432a.75.75 0 0 0 0 1.5h4.243a.75.75 0 0 0 .53-.219Z" clip-rule="evenodd"></path></svg>';return{c(){e=I("button"),e.innerHTML=t,this.h()},l(l){e=S(l,"BUTTON",{class:!0,type:!0,"data-svelte-h":!0}),Ye(e)!=="svelte-t977tc"&&(e.innerHTML=t),this.h()},h(){f(e,"class","p-3 rounded-full bg-gray-50 dark:bg-gray-900"),f(e,"type","button")},m(l,s){O(l,e,s)},p:ge,d(l){l&&h(e)}}}function _i(n){let e=n[8].t("Listening...")+"",t;return{c(){t=ve(e)},l(l){t=be(l,e)},m(l,s){O(l,t,s)},p(l,s){s[0]&256&&e!==(e=l[8].t("Listening...")+"")&&Me(t,e)},d(l){l&&h(t)}}}function pi(n){let e=n[8].t("Tap to interrupt")+"",t;return{c(){t=ve(e)},l(l){t=be(l,e)},m(l,s){O(l,t,s)},p(l,s){s[0]&256&&e!==(e=l[8].t("Tap to interrupt")+"")&&Me(t,e)},d(l){l&&h(t)}}}function vi(n){let e=n[8].t("Thinking...")+"",t;return{c(){t=ve(e)},l(l){t=be(l,e)},m(l,s){O(l,t,s)},p(l,s){s[0]&256&&e!==(e=l[8].t("Thinking...")+"")&&Me(t,e)},d(l){l&&h(t)}}}function bi(n){let e,t,l=n[7]&&En(n);return{c(){l&&l.c(),e=Fe()},l(s){l&&l.l(s),e=Fe()},m(s,o){l&&l.m(s,o),O(s,e,o),t=!0},p(s,o){s[7]?l?(l.p(s,o),o[0]&128&&H(l,1)):(l=En(s),l.c(),H(l,1),l.m(e.parentNode,e)):l&&(Pe(),z(l,1,1,()=>{l=null}),ze())},i(s){t||(H(l),t=!0)},o(s){z(l),t=!1},d(s){s&&h(e),l&&l.d(s)}}}function wi(n,e,t){let l,s,o,r;ae(n,Jt,Z=>t(40,l=Z)),ae(n,St,Z=>t(41,s=Z)),ae(n,$t,Z=>t(7,o=Z));const i=wt("i18n");ae(n,i,Z=>t(8,r=Z));let{eventTarget:a}=e,{submitPrompt:u}=e,{stopResponse:c}=e,{files:d}=e,{chatId:m}=e,{modelId:v}=e,y=!1,b=!1,_=!1,p=null,w=!1,T=null,D=!1,N=0,M=!1,L,C=[],W=[],j=null;const U=async()=>{const Z=await navigator.mediaDevices.enumerateDevices();t(5,W=Z.filter(Se=>Se.kind==="videoinput")),navigator.mediaDevices.getDisplayMedia&&t(5,W=[...W,{deviceId:"screen",label:"Screen Share"}]),console.log(W),j===null&&W.length>0&&t(6,j=W[0].deviceId)},q=async()=>{if(await U(),T===null){t(3,w=!0),await Ve();try{await oe()}catch(Z){console.error("Error accessing webcam: ",Z)}}},oe=async()=>{const Z=document.getElementById("camera-feed");Z&&(j==="screen"?T=await navigator.mediaDevices.getDisplayMedia({video:{cursor:"always"},audio:!1}):T=await navigator.mediaDevices.getUserMedia({video:{deviceId:j?{exact:j}:void 0}}),T&&(await U(),Z.srcObject=T,await Z.play()))},K=async()=>{T&&T.getTracks().forEach(Se=>Se.stop()),T=null},P=()=>{const Z=document.getElementById("camera-feed"),Se=document.getElementById("camera-canvas");if(!Se)return;const me=Se.getContext("2d");Se.width=Z.videoWidth,Se.height=Z.videoHeight,me.drawImage(Z,0,0,Z.videoWidth,Z.videoHeight);const _e=Se.toDataURL("image/png");return console.log(_e),_e},V=async()=>{await K(),t(3,w=!1)},A=-55,X=async Z=>{await Ve();const Se=ul(Z,"recording.wav"),me=await hl(localStorage.token,Se).catch(_e=>(De.error(_e),null));if(me&&(console.log(me.text),me.text!=="")){const _e=await u(me.text,{_raw:!0});console.log(_e)}},re=async(Z=!0)=>{if(o){console.log("%c%s","color: red; font-size: 20px;","ðŸš¨ stopRecordingCallback ðŸš¨");const Se=C.slice(0);if(C=[],L=!1,Z&&le(),b){if(t(0,y=!0),t(2,p=null),T){const _e=P();t(15,d=[{type:"image",url:_e}])}const me=new Blob(Se,{type:"audio/wav"});await X(me),b=!1,t(0,y=!1)}}else C=[],L=!1},le=async()=>{const Z=await navigator.mediaDevices.getUserMedia({audio:!0});L=new MediaRecorder(Z),L.onstart=()=>{console.log("Recording started"),C=[],qe(Z)},L.ondataavailable=Se=>{M&&C.push(Se.data)},L.onstop=Se=>{console.log("Recording stopped",Se),re()},L.start()},he=Z=>{let Se=0;for(let me=0;me<Z.length;me++){const _e=(Z[me]-128)/128;Se+=_e*_e}return Math.sqrt(Se/Z.length)},qe=Z=>{const Se=new AudioContext,me=Se.createMediaStreamSource(Z),_e=Se.createAnalyser();_e.minDecibels=A,me.connect(_e);const He=_e.frequencyBinCount,We=new Uint8Array(He),st=new Uint8Array(_e.fftSize);let it=Date.now();M=!1,console.log("ðŸ”Š Sound detection started",it,M),(()=>{const Ct=()=>{if(!L||!o)return;if(_?(_e.maxDecibels=0,_e.minDecibels=-1):(_e.minDecibels=A,_e.maxDecibels=-30),_e.getByteTimeDomainData(st),_e.getByteFrequencyData(We),t(4,N=he(st)),We.some(qt=>qt>0)&&(console.log("%c%s","color: red; font-size: 20px;","ðŸ”Š Sound detected"),M||(M=!0,R()),it=Date.now()),M&&Date.now()-it>2e3&&(b=!0,L)){console.log("%c%s","color: red; font-size: 20px;","ðŸ”‡ Silence detected"),L.stop();return}window.requestAnimationFrame(Ct)};window.requestAnimationFrame(Ct)})()};let Re={},tt=null,G=null;const rt=Z=>o?new Promise(Se=>{let me=[];const _e=setInterval(async()=>{var He;if(me=await speechSynthesis.getVoices(),me.length>0){clearInterval(_e);const We=((He=me==null?void 0:me.filter(st=>{var it,Ot,Ct,Ut;return st.voiceURI===(((Ot=(it=s==null?void 0:s.audio)==null?void 0:it.tts)==null?void 0:Ot.voice)??((Ut=(Ct=l==null?void 0:l.audio)==null?void 0:Ct.tts)==null?void 0:Ut.voice))}))==null?void 0:He.at(0))??void 0;G=new SpeechSynthesisUtterance(Z),We&&(G.voice=We),speechSynthesis.speak(G),G.onend=async st=>{await new Promise(it=>setTimeout(it,200)),Se(st)}}},100)}):Promise.resolve(),lt=Z=>o?new Promise(Se=>{const me=document.getElementById("audioElement");me&&(me.src=Z.src,me.muted=!0,me.play().then(()=>{me.muted=!1}).catch(_e=>{console.error(_e)}),me.onended=async _e=>{await new Promise(He=>setTimeout(He,100)),Se(_e)})}):Promise.resolve(),R=async()=>{t(1,_=!1),D&&c(),G&&(speechSynthesis.cancel(),G=null);const Z=document.getElementById("audioElement");Z&&(Z.muted=!0,Z.pause(),Z.currentTime=0)};let ie=new AbortController;const Ne=new Map,Je=new Map,Y=async Z=>{var Se,me,_e,He;if(!Ne.has(Z))try{if((s==null?void 0:s.showEmojiInCall)??!1){const We=await ms(localStorage.token,v,Z,m);We&&Je.set(Z,We)}if(l.audio.tts.engine!==""){const We=await Is(localStorage.token,((me=(Se=s==null?void 0:s.audio)==null?void 0:Se.tts)==null?void 0:me.voice)??((He=(_e=l==null?void 0:l.audio)==null?void 0:_e.tts)==null?void 0:He.voice),Z).catch(st=>(console.error(st),null));if(We){const st=await We.blob(),it=URL.createObjectURL(st);Ne.set(Z,new Audio(it))}}else Ne.set(Z,!0)}catch(We){console.error("Error synthesizing speech:",We)}return Ne.get(Z)};let we={};const at=async(Z,Se)=>{for(;!Se.aborted;)if(we[Z]&&we[Z].length>0){const me=we[Z].shift();if(Ne.has(me))if(((s==null?void 0:s.showEmojiInCall)??!1)&&Je.has(me)?t(2,p=Je.get(me)):t(2,p=null),l.audio.tts.engine!=="")try{console.log("%c%s","color: red; font-size: 20px;",`Playing audio for content: ${me}`);const _e=Ne.get(me);await lt(_e),console.log(`Played audio for content: ${me}`),await new Promise(He=>setTimeout(He,200))}catch(_e){console.error("Error playing audio:",_e)}else await rt(me);else we[Z].unshift(me),console.log(`Audio for "${me}" not yet available in the cache, re-queued...`),await new Promise(_e=>setTimeout(_e,200))}else if(Re[Z]&&we[Z]&&we[Z].length===0){t(1,_=!1);break}else await new Promise(me=>setTimeout(me,200));console.log(`Audio monitoring and playing stopped for message ID ${Z}`)};tl(async()=>{le();const Z=async _e=>{const{id:He}=_e.detail;D=!0,tt!==He&&(console.log(`Received chat start event for message ID ${He}`),tt=He,ie&&ie.abort(),ie=new AbortController,t(1,_=!0),at(He,ie.signal))},Se=async _e=>{const{id:He,content:We}=_e.detail;if(tt===He){console.log(`Received chat event for message ID ${He}: ${We}`);try{we[He]===void 0?we[He]=[We]:we[He].push(We),console.log(We),Y(We)}catch(st){console.error("Failed to fetch or play audio:",st)}}},me=async _e=>{const{id:He,content:We}=_e.detail;Re[He]=!0,D=!1};return a.addEventListener("chat:start",Z),a.addEventListener("chat",Se),a.addEventListener("chat:finish",me),async()=>{a.removeEventListener("chat:start",Z),a.removeEventListener("chat",Se),a.removeEventListener("chat:finish",me),ie.abort(),await Ve(),await R(),await re(!1),await V()}});const ot=()=>{_&&R()},ut=()=>{_&&R()},ft=()=>{V()},At=async Z=>{console.log(Z.detail),t(6,j=Z.detail),await K(),await oe()},Lt=async()=>{await navigator.mediaDevices.getUserMedia({video:!0}),q()},dt=()=>{_&&R()},Dt=async()=>{$t.set(!1)};return n.$$set=Z=>{"eventTarget"in Z&&t(16,a=Z.eventTarget),"submitPrompt"in Z&&t(17,u=Z.submitPrompt),"stopResponse"in Z&&t(18,c=Z.stopResponse),"files"in Z&&t(15,d=Z.files),"chatId"in Z&&t(19,m=Z.chatId),"modelId"in Z&&t(20,v=Z.modelId)},[y,_,p,w,N,W,j,o,r,i,q,oe,K,V,R,d,a,u,c,m,v,ot,ut,ft,At,Lt,dt,Dt]}class ki extends xe{constructor(e){super(),$e(this,e,wi,bi,Ke,{eventTarget:16,submitPrompt:17,stopResponse:18,files:15,chatId:19,modelId:20},null,[-1,-1])}}const{document:al}=jn;function Sn(n,e,t){const l=n.slice();return l[69]=e[t],l}function Dn(n){var r;let e,t,l;function s(i){n[31](i)}let o={submitPrompt:n[26],stopResponse:n[28],modelId:((r=n[8])==null?void 0:r.at(0))??null,chatId:n[17],eventTarget:n[24]};return n[14]!==void 0&&(o.files=n[14]),e=new ki({props:o}),Ie.push(()=>Ue(e,"files",s)),{c(){ce(e.$$.fragment)},l(i){ue(e.$$.fragment,i)},m(i,a){fe(e,i,a),l=!0},p(i,a){var c;const u={};a[0]&256&&(u.modelId=((c=i[8])==null?void 0:c.at(0))??null),a[0]&131072&&(u.chatId=i[17]),!t&&a[0]&16384&&(t=!0,u.files=i[14],Oe(()=>t=!1)),e.$set(u)},i(i){l||(H(e.$$.fragment,i),l=!0)},o(i){z(e.$$.fragment,i),l=!1},d(i){de(e,i)}}}function Mn(n){let e,t,l,s,o,r,i,a,u,c,d,m,v,y,b,_,p,w,T,D,N,M,L,C,W,j,U;function q(R){n[32](R)}function oe(R){n[33](R)}let K={title:n[12],shareEnabled:n[15].length>0,chat:n[11],initNewChat:n[25]};n[1]!==void 0&&(K.selectedModels=n[1]),n[7]!==void 0&&(K.showModelSelector=n[7]),t=new Yo({props:K}),Ie.push(()=>Ue(t,"selectedModels",q)),Ie.push(()=>Ue(t,"showModelSelector",oe));let P=n[22].length>0&&n[15].length===0&&!n[17]&&n[1].length<=1&&Tn(n);function V(R){n[36](R)}function A(R){n[37](R)}function X(R){n[38](R)}function re(R){n[39](R)}let le={chatId:n[17],selectedModels:n[1],processing:Ei,bottomPadding:n[14].length>0,sendPrompt:n[27],continueGeneration:n[30],regenerateResponse:n[29]};n[3]!==void 0&&(le.history=n[3]),n[15]!==void 0&&(le.messages=n[15]),n[5]!==void 0&&(le.autoScroll=n[5]),n[13]!==void 0&&(le.prompt=n[13]),c=new Fn({props:le}),Ie.push(()=>Ue(c,"history",V)),Ie.push(()=>Ue(c,"messages",A)),Ie.push(()=>Ue(c,"autoScroll",X)),Ie.push(()=>Ue(c,"prompt",re));function he(R){n[43](R)}function qe(R){n[44](R)}function Re(R){n[45](R)}function tt(R){n[46](R)}function G(R){n[47](R)}function rt(R){n[48](R)}let lt={dollarAmount:n[16],availableToolIds:n[8].reduce(n[42],[]),selectedModels:n[1],messages:n[15],submitPrompt:n[26],stopResponse:n[28]};return n[14]!==void 0&&(lt.files=n[14]),n[13]!==void 0&&(lt.prompt=n[13]),n[5]!==void 0&&(lt.autoScroll=n[5]),n[9]!==void 0&&(lt.selectedToolIds=n[9]),n[10]!==void 0&&(lt.webSearchEnabled=n[10]),n[2]!==void 0&&(lt.atSelectedModel=n[2]),p=new So({props:lt}),Ie.push(()=>Ue(p,"files",he)),Ie.push(()=>Ue(p,"prompt",qe)),Ie.push(()=>Ue(p,"autoScroll",Re)),Ie.push(()=>Ue(p,"selectedToolIds",tt)),Ie.push(()=>Ue(p,"webSearchEnabled",G)),Ie.push(()=>Ue(p,"atSelectedModel",rt)),{c(){e=I("div"),ce(t.$$.fragment),o=J(),P&&P.c(),r=J(),i=I("div"),a=I("div"),u=I("div"),ce(c.$$.fragment),_=J(),ce(p.$$.fragment),this.h()},l(R){e=S(R,"DIV",{class:!0});var ie=E(e);ue(t.$$.fragment,ie),o=Q(ie),P&&P.l(ie),r=Q(ie),i=S(ie,"DIV",{class:!0});var Ne=E(i);a=S(Ne,"DIV",{class:!0,id:!0});var Je=E(a);u=S(Je,"DIV",{class:!0});var Y=E(u);ue(c.$$.fragment,Y),Y.forEach(h),Je.forEach(h),_=Q(Ne),ue(p.$$.fragment,Ne),Ne.forEach(h),ie.forEach(h),this.h()},h(){f(u,"class",b="h-full w-full flex flex-col "+(n[0]?"py-4":"pt-2 pb-4")),f(a,"class","pb-2.5 flex flex-col justify-between w-full flex-auto overflow-auto h-0 max-w-full"),f(a,"id","messages-container"),f(i,"class","flex flex-col flex-auto"),f(e,"class",C="h-screen max-h-[100dvh] "+(n[21]?"md:max-w-[calc(100%-260px)]":"")+" w-full max-w-full flex flex-col")},m(R,ie){O(R,e,ie),fe(t,e,null),g(e,o),P&&P.m(e,null),g(e,r),g(e,i),g(i,a),g(a,u),fe(c,u,null),n[40](a),g(i,_),fe(p,i,null),W=!0,j||(U=te(a,"scroll",n[41]),j=!0)},p(R,ie){const Ne={};ie[0]&4096&&(Ne.title=R[12]),ie[0]&32768&&(Ne.shareEnabled=R[15].length>0),ie[0]&2048&&(Ne.chat=R[11]),!l&&ie[0]&2&&(l=!0,Ne.selectedModels=R[1],Oe(()=>l=!1)),!s&&ie[0]&128&&(s=!0,Ne.showModelSelector=R[7],Oe(()=>s=!1)),t.$set(Ne),R[22].length>0&&R[15].length===0&&!R[17]&&R[1].length<=1?P?(P.p(R,ie),ie[0]&4358146&&H(P,1)):(P=Tn(R),P.c(),H(P,1),P.m(e,r)):P&&(Pe(),z(P,1,1,()=>{P=null}),ze());const Je={};ie[0]&131072&&(Je.chatId=R[17]),ie[0]&2&&(Je.selectedModels=R[1]),ie[0]&16384&&(Je.bottomPadding=R[14].length>0),!d&&ie[0]&8&&(d=!0,Je.history=R[3],Oe(()=>d=!1)),!m&&ie[0]&32768&&(m=!0,Je.messages=R[15],Oe(()=>m=!1)),!v&&ie[0]&32&&(v=!0,Je.autoScroll=R[5],Oe(()=>v=!1)),!y&&ie[0]&8192&&(y=!0,Je.prompt=R[13],Oe(()=>y=!1)),c.$set(Je),(!W||ie[0]&1&&b!==(b="h-full w-full flex flex-col "+(R[0]?"py-4":"pt-2 pb-4")))&&f(u,"class",b);const Y={};ie[0]&65536&&(Y.dollarAmount=R[16]),ie[0]&262400&&(Y.availableToolIds=R[8].reduce(R[42],[])),ie[0]&2&&(Y.selectedModels=R[1]),ie[0]&32768&&(Y.messages=R[15]),!w&&ie[0]&16384&&(w=!0,Y.files=R[14],Oe(()=>w=!1)),!T&&ie[0]&8192&&(T=!0,Y.prompt=R[13],Oe(()=>T=!1)),!D&&ie[0]&32&&(D=!0,Y.autoScroll=R[5],Oe(()=>D=!1)),!N&&ie[0]&512&&(N=!0,Y.selectedToolIds=R[9],Oe(()=>N=!1)),!M&&ie[0]&1024&&(M=!0,Y.webSearchEnabled=R[10],Oe(()=>M=!1)),!L&&ie[0]&4&&(L=!0,Y.atSelectedModel=R[2],Oe(()=>L=!1)),p.$set(Y),(!W||ie[0]&2097152&&C!==(C="h-screen max-h-[100dvh] "+(R[21]?"md:max-w-[calc(100%-260px)]":"")+" w-full max-w-full flex flex-col"))&&f(e,"class",C)},i(R){W||(H(t.$$.fragment,R),H(P),H(c.$$.fragment,R),H(p.$$.fragment,R),W=!0)},o(R){z(t.$$.fragment,R),z(P),z(c.$$.fragment,R),z(p.$$.fragment,R),W=!1},d(R){R&&h(e),de(t),P&&P.d(),de(c),n[40](null),de(p),j=!1,U()}}}function Tn(n){let e,t,l,s,o=nt(n[22].filter(n[34])),r=[];for(let a=0;a<o.length;a+=1)r[a]=Cn(Sn(n,o,a));const i=a=>z(r[a],1,1,()=>{r[a]=null});return{c(){e=I("div"),t=I("div");for(let a=0;a<r.length;a+=1)r[a].c();this.h()},l(a){e=S(a,"DIV",{class:!0});var u=E(e);t=S(u,"DIV",{class:!0});var c=E(t);for(let d=0;d<r.length;d+=1)r[d].l(c);c.forEach(h),u.forEach(h),this.h()},h(){f(t,"class","flex flex-col gap-1 w-full"),f(e,"class",l="absolute top-[4.25rem] w-full "+(n[21]?"md:max-w-[calc(100%-260px)]":""))},m(a,u){O(a,e,u),g(e,t);for(let c=0;c<r.length;c+=1)r[c]&&r[c].m(t,null);s=!0},p(a,u){if(u[0]&4194304){o=nt(a[22].filter(a[34]));let c;for(c=0;c<o.length;c+=1){const d=Sn(a,o,c);r[c]?(r[c].p(d,u),H(r[c],1)):(r[c]=Cn(d),r[c].c(),H(r[c],1),r[c].m(t,null))}for(Pe(),c=o.length;c<r.length;c+=1)i(c);ze()}(!s||u[0]&2097152&&l!==(l="absolute top-[4.25rem] w-full "+(a[21]?"md:max-w-[calc(100%-260px)]":"")))&&f(e,"class",l)},i(a){if(!s){for(let u=0;u<o.length;u+=1)H(r[u]);s=!0}},o(a){r=r.filter(Boolean);for(let u=0;u<r.length;u+=1)z(r[u]);s=!1},d(a){a&&h(e),Bt(r,a)}}}function Cn(n){let e,t;return e=new fr({props:{banner:n[69]}}),e.$on("dismiss",n[35]),{c(){ce(e.$$.fragment)},l(l){ue(e.$$.fragment,l)},m(l,s){fe(e,l,s),t=!0},p(l,s){const o={};s[0]&4194304&&(o.banner=l[69]),e.$set(o)},i(l){t||(H(e.$$.fragment,l),t=!0)},o(l){z(e.$$.fragment,l),t=!1},d(l){de(e,l)}}}function yi(n){let e,t,l,s,o,r,i,a;al.title=e=`
		`+(n[12]?`${n[12].length>30?`${n[12].slice(0,30)}...`:n[12]} | ${n[20]}`:`${n[20]}`)+`
	`;let u=n[19]&&Dn(n),c=(!n[0]||n[4]&&n[0])&&Mn(n);return{c(){t=J(),l=I("audio"),o=J(),u&&u.c(),r=J(),c&&c.c(),i=Fe(),this.h()},l(d){Rn("svelte-1123lr8",al.head).forEach(h),t=Q(d),l=S(d,"AUDIO",{id:!0,src:!0,style:!0}),E(l).forEach(h),o=Q(d),u&&u.l(d),r=Q(d),c&&c.l(d),i=Fe(),this.h()},h(){f(l,"id","audioElement"),zt(l.src,s="")||f(l,"src",s),ht(l,"display","none")},m(d,m){O(d,t,m),O(d,l,m),O(d,o,m),u&&u.m(d,m),O(d,r,m),c&&c.m(d,m),O(d,i,m),a=!0},p(d,m){(!a||m[0]&1052672)&&e!==(e=`
		`+(d[12]?`${d[12].length>30?`${d[12].slice(0,30)}...`:d[12]} | ${d[20]}`:`${d[20]}`)+`
	`)&&(al.title=e),d[19]?u?(u.p(d,m),m[0]&524288&&H(u,1)):(u=Dn(d),u.c(),H(u,1),u.m(r.parentNode,r)):u&&(Pe(),z(u,1,1,()=>{u=null}),ze()),!d[0]||d[4]&&d[0]?c?(c.p(d,m),m[0]&17&&H(c,1)):(c=Mn(d),c.c(),H(c,1),c.m(i.parentNode,i)):c&&(Pe(),z(c,1,1,()=>{c=null}),ze())},i(d){a||(H(u),H(c),a=!0)},o(d){z(u),z(c),a=!1},d(d){d&&(h(t),h(l),h(o),h(r),h(i)),u&&u.d(d),c&&c.d(d)}}}let Ei="";function Ii(n,e,t){let l,s,o,r,i,a,u,c,d,m,v,y;ae(n,Pt,B=>t(17,l=B)),ae(n,St,B=>t(52,o=B)),ae(n,ll,B=>t(18,r=B)),ae(n,$t,B=>t(19,i=B)),ae(n,cl,B=>t(53,a=B)),ae(n,Xn,B=>t(54,u=B)),ae(n,Wn,B=>t(55,c=B)),ae(n,Jt,B=>t(56,d=B)),ae(n,Ln,B=>t(20,m=B)),ae(n,Kt,B=>t(21,v=B)),ae(n,Yn,B=>t(22,y=B));const b=wt("i18n");ae(n,b,B=>t(51,s=B));let{chatIdProp:_=""}=e,p=!1;const w=new EventTarget;let T=!1,D=!0,N,M=!0,L=[""],C,W=[],j=[],U=!1,q=null,oe="",K="",P=[],V=[],A={messages:{},currentId:null},X=0;tl(async()=>{t(16,X=0),l?(o.saveChatHistory??!0)||await rl("/"):Pt.subscribe(async B=>{B||await re()})});const re=async()=>{var pe;window.history.replaceState(A.state,"","/"),await Pt.set(""),t(16,X=0),t(5,D=!0),t(12,oe=""),t(15,V=[]),t(3,A={messages:{},currentId:null}),c.url.searchParams.get("models")?t(1,L=(pe=c.url.searchParams.get("models"))==null?void 0:pe.split(",")):o!=null&&o.models?t(1,L=o==null?void 0:o.models):d!=null&&d.default_models?(console.log((d==null?void 0:d.default_models.split(","))??""),t(1,L=d==null?void 0:d.default_models.split(","))):t(1,L=[""]),c.url.searchParams.get("q")&&(t(13,K=c.url.searchParams.get("q")??""),K&&(await Ve(),G(K))),t(1,L=L.map(ee=>r.map(Ae=>Ae.id).includes(ee)?ee:""));const B=await Sl(localStorage.token);B?St.set(B.ui):St.set(JSON.parse(localStorage.getItem("settings")??"{}"));const x=document.getElementById("chat-textarea");setTimeout(()=>x==null?void 0:x.focus(),0)},le=async()=>{if(Pt.set(_),t(11,q=await ns(localStorage.token,l).catch(async B=>(await rl("/"),null))),q){await ut();const B=q.chat;if(B){console.log(B),t(1,L=((B==null?void 0:B.models)??void 0)!==void 0?B.models:[B.models??""]),t(3,A=((B==null?void 0:B.history)??void 0)!==void 0?B.history:$n(B.messages)),t(12,oe=B.title),t(16,X=B.cost??0),console.log("Found cost in stored chat",X);const x=await Sl(localStorage.token);return x?await St.set(x.ui):await St.set(JSON.parse(localStorage.getItem("settings")??"{}")),await St.set({...o,system:B.system??o.system,params:B.options??o.params}),t(5,D=!0),await Ve(),V.length>0&&t(3,A.messages[V.at(-1).id].done=!0,A),await Ve(),!0}else return null}},he=async()=>{await Ve(),N&&t(6,N.scrollTop=N.scrollHeight,N)},qe=B=>{const x=A.messages[B];return x.parentId?[...qe(x.parentId),x]:[x]},Re=async(B,x)=>{await qn.run({querySelector:".mermaid"});const pe=await _s(localStorage.token,{model:B,messages:x.map(ee=>({id:ee.id,role:ee.role,content:ee.content,timestamp:ee.timestamp})),chat_id:l}).catch(ee=>(console.error(ee),null));if(pe!==null)for(const ee of pe.messages)t(3,A.messages[ee.id]={...A.messages[ee.id],...A.messages[ee.id].content!==ee.content?{originalContent:A.messages[ee.id].content}:{},...ee},A)},tt=async(B,x="")=>setInterval(()=>{u==null||u.emit("usage",{action:"chat",model:B,chat_id:x})},1e3),G=async(B,{_raw:x=!1}={})=>{let pe=[];if(console.log("submitPrompt",l),t(1,L=L.map(ee=>r.map(Ae=>Ae.id).includes(ee)?ee:"")),L.includes(""))De.error(s.t("Model not selected"));else if(V.length!=0&&V.at(-1).done!=!0)console.log("wait");else if(P.length>0&&P.filter(ee=>ee.upload_status===!1).length>0)De.error(s.t("Oops! Hold tight! Your files are still in the processing oven. We're cooking them up to perfection. Please be patient and we'll let you know once they're ready."));else{const ee=document.getElementById("chat-textarea");ee&&(ee.value="",ee.style.height="");const Ae=JSON.parse(JSON.stringify(P));t(14,P=[]),t(13,K="");let F=yl(),je={id:F,parentId:V.length!==0?V.at(-1).id:null,childrenIds:[],role:"user",content:B,files:Ae.length>0?Ae:void 0,timestamp:Math.floor(Date.now()/1e3),models:L.filter((k,$)=>L.indexOf(k)===$)};t(3,A.messages[F]=je,A),t(3,A.currentId=F,A),V.length!==0&&A.messages[V.at(-1).id].childrenIds.push(F),await Ve(),pe=await rt(B,F,{newChat:!0})}return pe},rt=async(B,x,{modelId:pe=null,newChat:ee=!1}={})=>{let Ae=[],F=pe?[pe]:C!==void 0?[C.id]:L;const je={};for(const $ of F){const ne=r.filter(se=>se.id===$).at(0);if(ne){let se=yl(),Ce={parentId:x,id:se,childrenIds:[],role:"assistant",content:"",model:ne.id,modelName:ne.name??ne.id,userContext:null,timestamp:Math.floor(Date.now()/1e3)};t(3,A.messages[se]=Ce,A),t(3,A.currentId=se,A),x!==null&&t(3,A.messages[x].childrenIds=[...A.messages[x].childrenIds,se],A),je[$]=se}}await Ve(),ee&&V.length==2&&(o.saveChatHistory??!0?(t(11,q=await ls(localStorage.token,{id:l,title:s.t("New Chat"),models:L,system:o.system??void 0,options:{...o.params??{}},messages:V,history:A,tags:[],timestamp:Date.now()})),await Wt.set(await Zt(localStorage.token)),await Pt.set(q.id)):await Pt.set("local"),await Ve());const k=JSON.parse(JSON.stringify(l));return await Promise.all(F.map(async $=>{var se,Ce,Ge;console.log("modelId",$);const ne=r.filter(kt=>kt.id===$).at(0);if(ne){V.some(ke=>{var Ze;return(Ze=ke.files)==null?void 0:Ze.some(Le=>Le.type==="image")})&&!(((Ge=(Ce=(se=ne.info)==null?void 0:se.meta)==null?void 0:Ce.capabilities)==null?void 0:Ge.vision)??!0)&&De.error(s.t("Model {{modelName}} is not vision capable",{modelName:ne.name??ne.id}));let ct=je[$],yt=A.messages[ct],et=null;if(((o==null?void 0:o.memory)??!1)&&et===null){const ke=await hs(localStorage.token,B).catch(Ze=>(De.error(Ze),null));ke&&(ke.documents[0].length>0&&(et=ke.documents.reduce((Ze,Le,Xe)=>{const Te=ke.metadatas[Xe][0].created_at,Be=new Date(Te*1e3).toISOString().split("T")[0];return Ze.push(`${Xe+1}. [${Be}]. ${Le[0]}`),Ze},[])),console.log("userContext:",et))}yt.userContext=et;const Et=await tt(ne.id,k);U&&await ot(ne.id,x,ct);let It=null;(ne==null?void 0:ne.owned_by)==="openai"?It=await R(ne,B,ct,k):ne&&(It=await lt(ne,B,ct,k)),Ae.push(It),Et&&clearInterval(Et)}else De.error(s.t("Model {{modelId}} not found",{modelId:$}))})),await Wt.set(await Zt(localStorage.token)),Ae},lt=async(B,x,pe,ee)=>{var Ge,kt,ct,yt,et,Et,It;let Ae=null;const F=A.messages[pe];await Ve(),he();const je=[o.system||((F==null?void 0:F.userContext)??null)?{role:"system",content:`${El((o==null?void 0:o.system)??"",a.name,o!=null&&o.userLocation?await Dl(localStorage.token):void 0)}${(F==null?void 0:F.userContext)??null?`

User Context:
${((F==null?void 0:F.userContext)??[]).join(`
`)}`:""}`}:void 0,...V].filter(ke=>{var Ze;return(Ze=ke==null?void 0:ke.content)==null?void 0:Ze.trim()}).map((ke,Ze,Le)=>{var Be;const Xe={role:ke.role,content:ke.content},Te=(Be=ke.files)==null?void 0:Be.filter(Qe=>Qe.type==="image").map(Qe=>Qe.url.slice(Qe.url.indexOf(",")+1));return Te&&Te.length>0&&ke.role==="user"&&(Xe.images=Te),Xe});let k=-1;je.forEach((ke,Ze)=>{ke.images&&(k=Ze)}),je.forEach((ke,Ze)=>{Ze!==k&&delete ke.images});let $=[];(((kt=(Ge=B==null?void 0:B.info)==null?void 0:Ge.meta)==null?void 0:kt.knowledge)??!1)&&($=B.info.meta.knowledge),$=[...$,...V.filter(ke=>(ke==null?void 0:ke.files)??null).map(ke=>ke.files.filter(Ze=>["doc","collection","web_search_results"].includes(Ze.type))).flat(1)].filter((ke,Ze,Le)=>Le.findIndex(Xe=>JSON.stringify(Xe)===JSON.stringify(ke))===Ze),w.dispatchEvent(new CustomEvent("chat:start",{detail:{id:pe}})),await Ve();const[ne,se]=await es(localStorage.token,{model:B.id,messages:je,options:{...o.params??{},stop:((ct=o==null?void 0:o.params)==null?void 0:ct.stop)??void 0?o.params.stop.map(ke=>decodeURIComponent(JSON.parse('"'+ke.replace(/\"/g,'\\"')+'"'))):void 0,num_predict:((yt=o==null?void 0:o.params)==null?void 0:yt.max_tokens)??void 0,repeat_penalty:((et=o==null?void 0:o.params)==null?void 0:et.frequency_penalty)??void 0},format:o.requestFormat??void 0,keep_alive:o.keepAlive??void 0,tool_ids:j.length>0?j:void 0,docs:$.length>0?$:void 0,citations:$.length>0,chat_id:l});if(ne&&ne.ok){console.log("controller",se);const ke=ne.body.pipeThrough(new TextDecoderStream).pipeThrough(xn(`
`)).getReader();for(;;){const{value:Ze,done:Le}=await ke.read();if(Le||T||ee!==l){if(F.done=!0,t(15,V),t(3,A),T)se.abort("User: Stop Response");else{const Xe=qe(pe);await Re(B.id,Xe)}Ae=F.content;break}try{let Xe=Ze.split(`
`);for(const Te of Xe)if(Te!==""){console.log(Te);let Be=JSON.parse(Te);if("citations"in Be){F.citations=Be.citations;continue}if("detail"in Be)throw Be;if(Be.done==!1){if(F.content==""&&Be.message.content==`
`)continue;{F.content+=Be.message.content;const Qe=Qt(F.content);Qe.pop(),Qe.length>0&&Qe[Qe.length-1]!==F.lastSentence&&(F.lastSentence=Qe[Qe.length-1],w.dispatchEvent(new CustomEvent("chat",{detail:{id:pe,content:Qe[Qe.length-1]}}))),t(15,V),t(3,A)}}else{if(F.done=!0,F.content==""&&(F.error={code:400,content:"Oops! No text generated from Ollama, Please try again."}),F.context=Be.context??null,F.info={total_duration:Be.total_duration,load_duration:Be.load_duration,sample_count:Be.sample_count,sample_duration:Be.sample_duration,prompt_eval_count:Be.prompt_eval_count,prompt_eval_duration:Be.prompt_eval_duration,eval_count:Be.eval_count,eval_duration:Be.eval_duration},t(15,V),t(3,A),o.notificationEnabled&&!document.hasFocus()){const Qe=new Notification(`${B.id}`,{body:F.content,icon:`${xt}/static/favicon.png`})}((o==null?void 0:o.responseAutoCopy)??!1)&&Il(F.content),o.responseAutoPlayback&&!i&&(await Ve(),(Et=document.getElementById(`speak-button-${F.id}`))==null||Et.click())}}}catch(Xe){console.log(Xe),"detail"in Xe&&De.error(Xe.detail);break}D&&he()}l==ee&&(o.saveChatHistory??!0)&&(t(11,q=await il(localStorage.token,ee,{messages:V,history:A,models:L})),await Wt.set(await Zt(localStorage.token)))}else{if(ne!==null){const ke=await ne.json();console.log(ke),"detail"in ke?(De.error(ke.detail),F.error={content:ke.detail}):(De.error(ke.error),F.error={content:ke.error})}else De.error(s.t("Uh-oh! There was an issue connecting to {{provider}}.",{provider:"Ollama"})),F.error={content:s.t("Uh-oh! There was an issue connecting to {{provider}}.",{provider:"Ollama"})};F.done=!0,t(15,V),t(3,A)}T=!1,await Ve();let Ce=((It=Qt(F.content))==null?void 0:It.at(-1))??"";if(Ce&&w.dispatchEvent(new CustomEvent("chat",{detail:{id:pe,content:Ce}})),w.dispatchEvent(new CustomEvent("chat:finish",{detail:{id:pe,content:F.content}})),D&&he(),V.length==2&&V.at(1).content!==""){window.history.replaceState(A.state,"",`/c/${ee}`);const ke=await we(x);await at(ee,ke)}return Ae},R=async(B,x,pe,ee)=>{var $,ne,se,Ce,Ge,kt,ct,yt,et,Et,It,ke,Ze;let Ae=null;const F=A.messages[pe];let je=[];(((ne=($=B==null?void 0:B.info)==null?void 0:$.meta)==null?void 0:ne.knowledge)??!1)&&(je=B.info.meta.knowledge),je=[...je,...V.filter(Le=>(Le==null?void 0:Le.files)??null).map(Le=>Le.files.filter(Xe=>["doc","collection","web_search_results"].includes(Xe.type))).flat(1)].filter((Le,Xe,Te)=>Te.findIndex(Be=>JSON.stringify(Be)===JSON.stringify(Le))===Xe),he(),w.dispatchEvent(new CustomEvent("chat:start",{detail:{id:pe}})),await Ve();try{const[Le,Xe]=await rs(localStorage.token,{model:B.id,stream:!0,stream_options:((Ge=(Ce=(se=B.info)==null?void 0:se.meta)==null?void 0:Ce.capabilities)==null?void 0:Ge.usage)??!1?{include_usage:!0}:void 0,messages:[o.system||((F==null?void 0:F.userContext)??null)?{role:"system",content:`${El((o==null?void 0:o.system)??"",a.name,o!=null&&o.userLocation?await Dl(localStorage.token):void 0)}${(F==null?void 0:F.userContext)??null?`

User Context:
${((F==null?void 0:F.userContext)??[]).join(`
`)}`:""}`}:void 0,...V].filter(Te=>{var Be;return(Be=Te==null?void 0:Te.content)==null?void 0:Be.trim()}).map((Te,Be,Qe)=>{var Ht;return{role:Te.role,...((Ht=Te.files)==null?void 0:Ht.filter(Vt=>Vt.type==="image").length)>0&&Te.role==="user"?{content:[{type:"text",text:Qe.length-1!==Be?Te.content:(Te==null?void 0:Te.raContent)??Te.content},...Te.files.filter(Vt=>Vt.type==="image").map(Vt=>({type:"image_url",image_url:{url:Vt.url}}))]}:{content:Qe.length-1!==Be?Te.content:(Te==null?void 0:Te.raContent)??Te.content}}}),seed:((kt=o==null?void 0:o.params)==null?void 0:kt.seed)??void 0,stop:((ct=o==null?void 0:o.params)==null?void 0:ct.stop)??void 0?o.params.stop.map(Te=>decodeURIComponent(JSON.parse('"'+Te.replace(/\"/g,'\\"')+'"'))):void 0,temperature:((yt=o==null?void 0:o.params)==null?void 0:yt.temperature)??void 0,top_p:((et=o==null?void 0:o.params)==null?void 0:et.top_p)??void 0,frequency_penalty:((Et=o==null?void 0:o.params)==null?void 0:Et.frequency_penalty)??void 0,max_tokens:((It=o==null?void 0:o.params)==null?void 0:It.max_tokens)??void 0,tool_ids:j.length>0?j:void 0,docs:je.length>0?je:void 0,citations:je.length>0,chat_id:l},`${Kn}`);if(await Ve(),he(),Le&&Le.ok&&Le.headers){const Te=Le.headers.get("x-input-cost");Te&&t(16,X+=parseFloat(Te))}if(Le&&Le.ok&&Le.body){const Te=await rr(Le.body,o.splitLargeChunks);let Be=null;for await(const Qe of Te){const{value:Ht,done:Vt,citations:ml,cost:gl,error:_l,usage:pl}=Qe;if(_l){await ie(_l,null,B,F);break}if(Vt||T||ee!==l){if(F.done=!0,t(15,V),t(3,A),T)Xe.abort("User: Stop Response");else{const Mt=qe(pe);await Re(B.id,Mt)}Ae=F.content;break}if(pl&&(Be=pl),ml){F.citations=ml;continue}if(gl){F.cost=gl;continue}if(!(F.content==""&&Ht==`
`)){{F.content+=Ht;const Mt=Qt(F.content);Mt.pop(),Mt.length>0&&Mt[Mt.length-1]!==F.lastSentence&&(F.lastSentence=Mt[Mt.length-1],w.dispatchEvent(new CustomEvent("chat",{detail:{id:pe,content:Mt[Mt.length-1]}}))),t(15,V),t(3,A)}D&&he()}}if(o.notificationEnabled&&!document.hasFocus()){const Qe=new Notification(`${B.id}`,{body:F.content,icon:`${xt}/static/favicon.png`})}if(o.responseAutoCopy&&Il(F.content),o.responseAutoPlayback&&!i&&(await Ve(),(ke=document.getElementById(`speak-button-${F.id}`))==null||ke.click()),Be&&(F.info={...Be,openai:!0}),F.content){const Qe=B.name??B.id;console.log(`modelName: ${Qe}`);const Ht=Math.round(F.content.split(" ").length/.75);console.log(`Response contains ${Ht} tokens`);const Vt=Ht*1e-5;t(16,X+=Vt),t(16,X=Math.round(X*1e4)/1e4),console.log(`Cost: ${X}`)}l==ee&&(o.saveChatHistory??!0)&&(t(11,q=await il(localStorage.token,ee,{models:L,messages:V,history:A,cost:X})),await Wt.set(await Zt(localStorage.token)))}else await ie(null,Le,B,F)}catch(Le){await ie(Le,null,B,F)}t(15,V),t(3,A),T=!1,await Ve();let k=((Ze=Qt(F.content))==null?void 0:Ze.at(-1))??"";if(k&&w.dispatchEvent(new CustomEvent("chat",{detail:{id:pe,content:k}})),w.dispatchEvent(new CustomEvent("chat:finish",{detail:{id:pe,content:F.content}})),D&&he(),V.length==2){window.history.replaceState(A.state,"",`/c/${ee}`);const Le=await we(x);await at(ee,Le)}return Ae},ie=async(B,x,pe,ee)=>{let Ae="",F;B?F=B:x!==null&&(F=await x.json()),console.error(F),"detail"in F?(De.error(F.detail),Ae=F.detail):"error"in F?"message"in F.error?(De.error(F.error.message),Ae=F.error.message):(De.error(F.error),Ae=F.error):"message"in F&&(De.error(F.message),Ae=F.message),ee.error={content:s.t("Uh-oh! There was an issue connecting to {{provider}}.",{provider:pe.name??pe.id})+`
`+Ae},ee.done=!0,t(15,V),t(3,A)},Ne=()=>{T=!0,console.log("stopResponse")},Je=async B=>{if(console.log("regenerateResponse"),V.length!=0){let x=A.messages[B.parentId],pe=x.content;((x==null?void 0:x.models)??[...L]).length==1?await rt(pe,x.id):await rt(pe,x.id,{modelId:B.model})}},Y=async()=>{console.log("continueGeneration");const B=JSON.parse(JSON.stringify(l));if(V.length!=0&&V.at(-1).done==!0){const x=A.messages[A.currentId];x.done=!1,await Ve();const pe=r.filter(ee=>ee.id===x.model).at(0);pe&&((pe==null?void 0:pe.owned_by)==="openai"?await R(pe,A.messages[x.parentId].content,x.id,B):await lt(pe,A.messages[x.parentId].content,x.id,B))}else De.error(s.t("Model {{modelId}} not found",{modelId}))},we=async B=>{var x;return((x=o==null?void 0:o.title)==null?void 0:x.auto)??!0?await gs(localStorage.token,L[0],B,l).catch(ee=>(console.error(ee),"New Chat")):`${B}`},at=async(B,x)=>{B===l&&t(12,oe=x),(o.saveChatHistory??!0)&&(t(11,q=await il(localStorage.token,B,{title:x})),await Wt.set(await Zt(localStorage.token)))},ot=async(B,x,pe)=>{const ee=A.messages[pe];ee.statusHistory=[{done:!1,action:"web_search",description:s.t("Generating search query")}],t(15,V),t(3,A);const Ae=A.messages[x].content;let F=await ps(localStorage.token,B,V,Ae).catch(k=>(console.log(k),Ae));F||(De.warning(s.t("No search query generated")),ee.statusHistory.push({done:!0,error:!0,action:"web_search",description:"No search query generated"}),t(15,V),t(3,A)),ee.statusHistory.push({done:!1,action:"web_search",description:s.t('Searching "{{searchQuery}}"',{searchQuery:F})}),t(15,V),t(3,A);const je=await cs(localStorage.token,F).catch(k=>(console.log(k),De.error(k),null));je?(ee.statusHistory.push({done:!0,action:"web_search",description:s.t("Searched {{count}} sites",{count:je.filenames.length}),query:F,urls:je.filenames}),((ee==null?void 0:ee.files)??!0)&&(ee.files=[]),ee.files.push({collection_name:je.collection_name,name:F,type:"web_search_results",urls:je.filenames}),t(15,V),t(3,A)):(ee.statusHistory.push({done:!0,error:!0,action:"web_search",description:"No search results found"}),t(15,V),t(3,A))},ut=async()=>await ss(localStorage.token,l).catch(async B=>[]);function ft(B){P=B,t(14,P)}function At(B){L=B,t(1,L)}function Lt(B){M=B,t(7,M)}const dt=B=>B.dismissible?!JSON.parse(localStorage.getItem("dismissedBannerIds")??"[]").includes(B.id):!0,Dt=B=>{const x=B.detail;localStorage.setItem("dismissedBannerIds",JSON.stringify([x,...JSON.parse(localStorage.getItem("dismissedBannerIds")??"[]")].filter(pe=>y.find(ee=>ee.id===pe))))};function Z(B){A=B,t(3,A)}function Se(B){V=B,t(15,V),t(3,A)}function me(B){D=B,t(5,D)}function _e(B){K=B,t(13,K)}function He(B){Ie[B?"unshift":"push"](()=>{N=B,t(6,N)})}const We=B=>{t(5,D=N.scrollHeight-N.scrollTop<=N.clientHeight+5)},st=(B,x,pe,ee)=>{var F,je;const Ae=r.find(k=>k.id===x);return((je=(F=Ae==null?void 0:Ae.info)==null?void 0:F.meta)==null?void 0:je.toolIds)??!1?[...new Set([...B,...Ae.info.meta.toolIds])]:B};function it(B){P=B,t(14,P)}function Ot(B){K=B,t(13,K)}function Ct(B){D=B,t(5,D)}function Ut(B){j=B,t(9,j)}function qt(B){U=B,t(10,U)}function sl(B){C=B,t(2,C)}return n.$$set=B=>{"chatIdProp"in B&&t(0,_=B.chatIdProp)},n.$$.update=()=>{if(n.$$.dirty[0]&6&&t(8,W=C!==void 0?[C.id]:L),n.$$.dirty[0]&8)if(A.currentId!==null){let B=[],x=A.messages[A.currentId];for(;x!==null;)B.unshift({...x}),x=x.parentId!==null?A.messages[x.parentId]:null;t(15,V=B)}else t(15,V=[]),t(16,X=0);n.$$.dirty[0]&1&&_&&(async()=>{if(console.log(_),_&&await le()){await Ve(),t(4,p=!0),window.setTimeout(()=>he(),0);const B=document.getElementById("chat-textarea");B==null||B.focus()}else await rl("/")})()},[_,L,C,A,p,D,N,M,W,j,U,q,oe,K,P,V,X,l,r,i,m,v,y,b,w,re,G,rt,Ne,Je,Y,ft,At,Lt,dt,Dt,Z,Se,me,_e,He,We,st,it,Ot,Ct,Ut,qt,sl]}class oa extends xe{constructor(e){super(),$e(this,e,Ii,yi,Ke,{chatIdProp:0},null,[-1,-1,-1])}}export{oa as C};
//# sourceMappingURL=Chat.bff46c52.js.map
