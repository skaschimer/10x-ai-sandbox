{"version":3,"file":"index.1d78794b.js","sources":["../../../../../../src/lib/utils/index.ts"],"sourcesContent":["import { v4 as uuidv4 } from 'uuid';\nimport sha256 from 'js-sha256';\n\n//////////////////////////\n// Helper functions\n//////////////////////////\n\nexport const sanitizeResponseContent = (content: string) => {\n\treturn content\n\t\t.replace(/<\\|[a-z]*$/, '')\n\t\t.replace(/<\\|[a-z]+\\|$/, '')\n\t\t.replace(/<$/, '')\n\t\t.replaceAll(/<\\|[a-z]+\\|>/g, ' ')\n\t\t.replaceAll('<', '&lt;')\n\t\t.replaceAll('>', '&gt;')\n\t\t.trim();\n};\n\nexport const revertSanitizedResponseContent = (content: string) => {\n\treturn content.replaceAll('&lt;', '<').replaceAll('&gt;', '>');\n};\n\nexport const capitalizeFirstLetter = (string) => {\n\treturn string.charAt(0).toUpperCase() + string.slice(1);\n};\n\nexport const splitStream = (splitOn) => {\n\tlet buffer = '';\n\treturn new TransformStream({\n\t\ttransform(chunk, controller) {\n\t\t\tbuffer += chunk;\n\t\t\tconst parts = buffer.split(splitOn);\n\t\t\tparts.slice(0, -1).forEach((part) => controller.enqueue(part));\n\t\t\tbuffer = parts[parts.length - 1];\n\t\t},\n\t\tflush(controller) {\n\t\t\tif (buffer) controller.enqueue(buffer);\n\t\t}\n\t});\n};\n\nexport const convertMessagesToHistory = (messages) => {\n\tconst history = {\n\t\tmessages: {},\n\t\tcurrentId: null\n\t};\n\n\tlet parentMessageId = null;\n\tlet messageId = null;\n\n\tfor (const message of messages) {\n\t\tmessageId = uuidv4();\n\n\t\tif (parentMessageId !== null) {\n\t\t\thistory.messages[parentMessageId].childrenIds = [\n\t\t\t\t...history.messages[parentMessageId].childrenIds,\n\t\t\t\tmessageId\n\t\t\t];\n\t\t}\n\n\t\thistory.messages[messageId] = {\n\t\t\t...message,\n\t\t\tid: messageId,\n\t\t\tparentId: parentMessageId,\n\t\t\tchildrenIds: []\n\t\t};\n\n\t\tparentMessageId = messageId;\n\t}\n\n\thistory.currentId = messageId;\n\treturn history;\n};\n\nexport const getGravatarURL = (email) => {\n\t// Trim leading and trailing whitespace from\n\t// an email address and force all characters\n\t// to lower case\n\tconst address = String(email).trim().toLowerCase();\n\n\t// Create a SHA256 hash of the final string\n\tconst hash = sha256(address);\n\n\t// Grab the actual image URL\n\treturn `https://www.gravatar.com/avatar/${hash}`;\n};\n\nexport const canvasPixelTest = () => {\n\t// Test a 1x1 pixel to potentially identify browser/plugin fingerprint blocking or spoofing\n\t// Inspiration: https://github.com/kkapsner/CanvasBlocker/blob/master/test/detectionTest.js\n\tconst canvas = document.createElement('canvas');\n\tconst ctx = canvas.getContext('2d');\n\tcanvas.height = 1;\n\tcanvas.width = 1;\n\tconst imageData = new ImageData(canvas.width, canvas.height);\n\tconst pixelValues = imageData.data;\n\n\t// Generate RGB test data\n\tfor (let i = 0; i < imageData.data.length; i += 1) {\n\t\tif (i % 4 !== 3) {\n\t\t\tpixelValues[i] = Math.floor(256 * Math.random());\n\t\t} else {\n\t\t\tpixelValues[i] = 255;\n\t\t}\n\t}\n\n\tctx.putImageData(imageData, 0, 0);\n\tconst p = ctx.getImageData(0, 0, canvas.width, canvas.height).data;\n\n\t// Read RGB data and fail if unmatched\n\tfor (let i = 0; i < p.length; i += 1) {\n\t\tif (p[i] !== pixelValues[i]) {\n\t\t\tconsole.log(\n\t\t\t\t'canvasPixelTest: Wrong canvas pixel RGB value detected:',\n\t\t\t\tp[i],\n\t\t\t\t'at:',\n\t\t\t\ti,\n\t\t\t\t'expected:',\n\t\t\t\tpixelValues[i]\n\t\t\t);\n\t\t\tconsole.log('canvasPixelTest: Canvas blocking or spoofing is likely');\n\t\t\treturn false;\n\t\t}\n\t}\n\n\treturn true;\n};\n\nexport const generateInitialsImage = (name) => {\n\tconst canvas = document.createElement('canvas');\n\tconst ctx = canvas.getContext('2d');\n\tcanvas.width = 100;\n\tcanvas.height = 100;\n\n\tif (!canvasPixelTest()) {\n\t\tconsole.log(\n\t\t\t'generateInitialsImage: failed pixel test, fingerprint evasion is likely. Using default image.'\n\t\t);\n\t\treturn '/user.png';\n\t}\n\n\tctx.fillStyle = '#F39C12';\n\tctx.fillRect(0, 0, canvas.width, canvas.height);\n\n\tctx.fillStyle = '#FFFFFF';\n\tctx.font = '40px Helvetica';\n\tctx.textAlign = 'center';\n\tctx.textBaseline = 'middle';\n\n\tconst sanitizedName = name.trim();\n\tconst initials =\n\t\tsanitizedName.length > 0\n\t\t\t? sanitizedName[0] +\n\t\t\t  (sanitizedName.split(' ').length > 1\n\t\t\t\t\t? sanitizedName[sanitizedName.lastIndexOf(' ') + 1]\n\t\t\t\t\t: '')\n\t\t\t: '';\n\n\tctx.fillText(initials.toUpperCase(), canvas.width / 2, canvas.height / 2);\n\n\treturn canvas.toDataURL();\n};\n\nexport const copyToClipboard = async (text) => {\n\tlet result = false;\n\tif (!navigator.clipboard) {\n\t\tconst textArea = document.createElement('textarea');\n\t\ttextArea.value = text;\n\n\t\t// Avoid scrolling to bottom\n\t\ttextArea.style.top = '0';\n\t\ttextArea.style.left = '0';\n\t\ttextArea.style.position = 'fixed';\n\n\t\tdocument.body.appendChild(textArea);\n\t\ttextArea.focus();\n\t\ttextArea.select();\n\n\t\ttry {\n\t\t\tconst successful = document.execCommand('copy');\n\t\t\tconst msg = successful ? 'successful' : 'unsuccessful';\n\t\t\tconsole.log('Fallback: Copying text command was ' + msg);\n\t\t\tresult = true;\n\t\t} catch (err) {\n\t\t\tconsole.error('Fallback: Oops, unable to copy', err);\n\t\t}\n\n\t\tdocument.body.removeChild(textArea);\n\t\treturn result;\n\t}\n\n\tresult = await navigator.clipboard\n\t\t.writeText(text)\n\t\t.then(() => {\n\t\t\tconsole.log('Async: Copying to clipboard was successful!');\n\t\t\treturn true;\n\t\t})\n\t\t.catch((error) => {\n\t\t\tconsole.error('Async: Could not copy text: ', error);\n\t\t\treturn false;\n\t\t});\n\n\treturn result;\n};\n\nexport const compareVersion = (latest, current) => {\n\treturn current === '0.0.0'\n\t\t? false\n\t\t: current.localeCompare(latest, undefined, {\n\t\t\t\tnumeric: true,\n\t\t\t\tsensitivity: 'case',\n\t\t\t\tcaseFirst: 'upper'\n\t\t  }) < 0;\n};\n\nexport const findWordIndices = (text) => {\n\tconst regex = /\\[([^\\]]+)\\]/g;\n\tconst matches = [];\n\tlet match;\n\n\twhile ((match = regex.exec(text)) !== null) {\n\t\tmatches.push({\n\t\t\tword: match[1],\n\t\t\tstartIndex: match.index,\n\t\t\tendIndex: regex.lastIndex - 1\n\t\t});\n\t}\n\n\treturn matches;\n};\n\nexport const removeFirstHashWord = (inputString) => {\n\t// Split the string into an array of words\n\tconst words = inputString.split(' ');\n\n\t// Find the index of the first word that starts with #\n\tconst index = words.findIndex((word) => word.startsWith('#'));\n\n\t// Remove the first word with #\n\tif (index !== -1) {\n\t\twords.splice(index, 1);\n\t}\n\n\t// Join the remaining words back into a string\n\tconst resultString = words.join(' ');\n\n\treturn resultString;\n};\n\nexport const transformFileName = (fileName) => {\n\t// Convert to lowercase\n\tconst lowerCaseFileName = fileName.toLowerCase();\n\n\t// Remove special characters using regular expression\n\tconst sanitizedFileName = lowerCaseFileName.replace(/[^\\w\\s]/g, '');\n\n\t// Replace spaces with dashes\n\tconst finalFileName = sanitizedFileName.replace(/\\s+/g, '-');\n\n\treturn finalFileName;\n};\n\nexport const calculateSHA256 = async (file) => {\n\t// Create a FileReader to read the file asynchronously\n\tconst reader = new FileReader();\n\n\t// Define a promise to handle the file reading\n\tconst readFile = new Promise((resolve, reject) => {\n\t\treader.onload = () => resolve(reader.result);\n\t\treader.onerror = reject;\n\t});\n\n\t// Read the file as an ArrayBuffer\n\treader.readAsArrayBuffer(file);\n\n\ttry {\n\t\t// Wait for the FileReader to finish reading the file\n\t\tconst buffer = await readFile;\n\n\t\t// Convert the ArrayBuffer to a Uint8Array\n\t\tconst uint8Array = new Uint8Array(buffer);\n\n\t\t// Calculate the SHA-256 hash using Web Crypto API\n\t\tconst hashBuffer = await crypto.subtle.digest('SHA-256', uint8Array);\n\n\t\t// Convert the hash to a hexadecimal string\n\t\tconst hashArray = Array.from(new Uint8Array(hashBuffer));\n\t\tconst hashHex = hashArray.map((byte) => byte.toString(16).padStart(2, '0')).join('');\n\n\t\treturn `${hashHex}`;\n\t} catch (error) {\n\t\tconsole.error('Error calculating SHA-256 hash:', error);\n\t\tthrow error;\n\t}\n};\n\nexport const getImportOrigin = (_chats) => {\n\t// Check what external service chat imports are from\n\tif ('mapping' in _chats[0]) {\n\t\treturn 'openai';\n\t}\n\treturn 'webui';\n};\n\nexport const getUserPosition = async (raw = false) => {\n\t// Get the user's location using the Geolocation API\n\tconst position = await new Promise((resolve, reject) => {\n\t\tnavigator.geolocation.getCurrentPosition(resolve, reject);\n\t}).catch((error) => {\n\t\tconsole.error('Error getting user location:', error);\n\t\tthrow error;\n\t});\n\n\tif (!position) {\n\t\treturn 'Location not available';\n\t}\n\n\t// Extract the latitude and longitude from the position\n\tconst { latitude, longitude } = position.coords;\n\n\tif (raw) {\n\t\treturn { latitude, longitude };\n\t} else {\n\t\treturn `${latitude.toFixed(3)}, ${longitude.toFixed(3)} (lat, long)`;\n\t}\n};\n\nconst convertOpenAIMessages = (convo) => {\n\t// Parse OpenAI chat messages and create chat dictionary for creating new chats\n\tconst mapping = convo['mapping'];\n\tconst messages = [];\n\tlet currentId = '';\n\tlet lastId = null;\n\n\tfor (const message_id in mapping) {\n\t\tconst message = mapping[message_id];\n\t\tcurrentId = message_id;\n\t\ttry {\n\t\t\tif (\n\t\t\t\tmessages.length == 0 &&\n\t\t\t\t(message['message'] == null ||\n\t\t\t\t\t(message['message']['content']['parts']?.[0] == '' &&\n\t\t\t\t\t\tmessage['message']['content']['text'] == null))\n\t\t\t) {\n\t\t\t\t// Skip chat messages with no content\n\t\t\t\tcontinue;\n\t\t\t} else {\n\t\t\t\tconst new_chat = {\n\t\t\t\t\tid: message_id,\n\t\t\t\t\tparentId: lastId,\n\t\t\t\t\tchildrenIds: message['children'] || [],\n\t\t\t\t\trole: message['message']?.['author']?.['role'] !== 'user' ? 'assistant' : 'user',\n\t\t\t\t\tcontent:\n\t\t\t\t\t\tmessage['message']?.['content']?.['parts']?.[0] ||\n\t\t\t\t\t\tmessage['message']?.['content']?.['text'] ||\n\t\t\t\t\t\t'',\n\t\t\t\t\tmodel: 'gpt-3.5-turbo',\n\t\t\t\t\tdone: true,\n\t\t\t\t\tcontext: null\n\t\t\t\t};\n\t\t\t\tmessages.push(new_chat);\n\t\t\t\tlastId = currentId;\n\t\t\t}\n\t\t} catch (error) {\n\t\t\tconsole.log('Error with', message, '\\nError:', error);\n\t\t}\n\t}\n\n\tconst history = {};\n\tmessages.forEach((obj) => (history[obj.id] = obj));\n\n\tconst chat = {\n\t\thistory: {\n\t\t\tcurrentId: currentId,\n\t\t\tmessages: history // Need to convert this to not a list and instead a json object\n\t\t},\n\t\tmodels: ['gpt-3.5-turbo'],\n\t\tmessages: messages,\n\t\toptions: {},\n\t\ttimestamp: convo['create_time'],\n\t\ttitle: convo['title'] ?? 'New Chat'\n\t};\n\treturn chat;\n};\n\nconst validateChat = (chat) => {\n\t// Because ChatGPT sometimes has features we can't use like DALL-E or migh have corrupted messages, need to validate\n\tconst messages = chat.messages;\n\n\t// Check if messages array is empty\n\tif (messages.length === 0) {\n\t\treturn false;\n\t}\n\n\t// Last message's children should be an empty array\n\tconst lastMessage = messages[messages.length - 1];\n\tif (lastMessage.childrenIds.length !== 0) {\n\t\treturn false;\n\t}\n\n\t// First message's parent should be null\n\tconst firstMessage = messages[0];\n\tif (firstMessage.parentId !== null) {\n\t\treturn false;\n\t}\n\n\t// Every message's content should be a string\n\tfor (const message of messages) {\n\t\tif (typeof message.content !== 'string') {\n\t\t\treturn false;\n\t\t}\n\t}\n\n\treturn true;\n};\n\nexport const convertOpenAIChats = (_chats) => {\n\t// Create a list of dictionaries with each conversation from import\n\tconst chats = [];\n\tlet failed = 0;\n\tfor (const convo of _chats) {\n\t\tconst chat = convertOpenAIMessages(convo);\n\n\t\tif (validateChat(chat)) {\n\t\t\tchats.push({\n\t\t\t\tid: convo['id'],\n\t\t\t\tuser_id: '',\n\t\t\t\ttitle: convo['title'],\n\t\t\t\tchat: chat,\n\t\t\t\ttimestamp: convo['timestamp']\n\t\t\t});\n\t\t} else {\n\t\t\tfailed++;\n\t\t}\n\t}\n\tconsole.log(failed, 'Conversations could not be imported');\n\treturn chats;\n};\n\nexport const isValidHttpUrl = (string) => {\n\tlet url;\n\n\ttry {\n\t\turl = new URL(string);\n\t} catch (_) {\n\t\treturn false;\n\t}\n\n\treturn url.protocol === 'http:' || url.protocol === 'https:';\n};\n\nexport const removeEmojis = (str) => {\n\t// Regular expression to match emojis\n\tconst emojiRegex = /[\\uD800-\\uDBFF][\\uDC00-\\uDFFF]|\\uD83C[\\uDC00-\\uDFFF]|\\uD83D[\\uDC00-\\uDE4F]/g;\n\n\t// Replace emojis with an empty string\n\treturn str.replace(emojiRegex, '');\n};\n\nexport const extractSentences = (text) => {\n\t// Split the paragraph into sentences based on common punctuation marks\n\tconst sentences = text.split(/(?<=[.!?])\\s+/);\n\n\treturn sentences\n\t\t.map((sentence) => removeEmojis(sentence.trim()))\n\t\t.filter((sentence) => sentence !== '');\n};\n\nexport const extractSentencesForAudio = (text) => {\n\treturn extractSentences(text).reduce((mergedTexts, currentText) => {\n\t\tconst lastIndex = mergedTexts.length - 1;\n\t\tif (lastIndex >= 0) {\n\t\t\tconst previousText = mergedTexts[lastIndex];\n\t\t\tconst wordCount = previousText.split(/\\s+/).length;\n\t\t\tif (wordCount < 2) {\n\t\t\t\tmergedTexts[lastIndex] = previousText + ' ' + currentText;\n\t\t\t} else {\n\t\t\t\tmergedTexts.push(currentText);\n\t\t\t}\n\t\t} else {\n\t\t\tmergedTexts.push(currentText);\n\t\t}\n\t\treturn mergedTexts;\n\t}, []);\n};\n\nexport const blobToFile = (blob, fileName) => {\n\t// Create a new File object from the Blob\n\tconst file = new File([blob], fileName, { type: blob.type });\n\treturn file;\n};\n\n/**\n * @param {string} template - The template string containing placeholders.\n * @returns {string} The template string with the placeholders replaced by the prompt.\n */\nexport const promptTemplate = (\n\ttemplate: string,\n\tuser_name?: string,\n\tuser_location?: string\n): string => {\n\t// Get the current date\n\tconst currentDate = new Date();\n\n\t// Format the date to YYYY-MM-DD\n\tconst formattedDate =\n\t\tcurrentDate.getFullYear() +\n\t\t'-' +\n\t\tString(currentDate.getMonth() + 1).padStart(2, '0') +\n\t\t'-' +\n\t\tString(currentDate.getDate()).padStart(2, '0');\n\n\t// Format the time to HH:MM:SS AM/PM\n\tconst currentTime = currentDate.toLocaleTimeString('en-US', {\n\t\thour: 'numeric',\n\t\tminute: 'numeric',\n\t\tsecond: 'numeric',\n\t\thour12: true\n\t});\n\n\t// Replace {{CURRENT_DATETIME}} in the template with the formatted datetime\n\ttemplate = template.replace('{{CURRENT_DATETIME}}', `${formattedDate} ${currentTime}`);\n\n\t// Replace {{CURRENT_DATE}} in the template with the formatted date\n\ttemplate = template.replace('{{CURRENT_DATE}}', formattedDate);\n\n\t// Replace {{CURRENT_TIME}} in the template with the formatted time\n\ttemplate = template.replace('{{CURRENT_TIME}}', currentTime);\n\n\tif (user_name) {\n\t\t// Replace {{USER_NAME}} in the template with the user's name\n\t\ttemplate = template.replace('{{USER_NAME}}', user_name);\n\t}\n\n\tif (user_location) {\n\t\t// Replace {{USER_LOCATION}} in the template with the current location\n\t\ttemplate = template.replace('{{USER_LOCATION}}', user_location);\n\t}\n\n\treturn template;\n};\n\n/**\n * This function is used to replace placeholders in a template string with the provided prompt.\n * The placeholders can be in the following formats:\n * - `{{prompt}}`: This will be replaced with the entire prompt.\n * - `{{prompt:start:<length>}}`: This will be replaced with the first <length> characters of the prompt.\n * - `{{prompt:end:<length>}}`: This will be replaced with the last <length> characters of the prompt.\n * - `{{prompt:middletruncate:<length>}}`: This will be replaced with the prompt truncated to <length> characters, with '...' in the middle.\n *\n * @param {string} template - The template string containing placeholders.\n * @param {string} prompt - The string to replace the placeholders with.\n * @returns {string} The template string with the placeholders replaced by the prompt.\n */\nexport const titleGenerationTemplate = (template: string, prompt: string): string => {\n\ttemplate = template.replace(\n\t\t/{{prompt}}|{{prompt:start:(\\d+)}}|{{prompt:end:(\\d+)}}|{{prompt:middletruncate:(\\d+)}}/g,\n\t\t(match, startLength, endLength, middleLength) => {\n\t\t\tif (match === '{{prompt}}') {\n\t\t\t\treturn prompt;\n\t\t\t} else if (match.startsWith('{{prompt:start:')) {\n\t\t\t\treturn prompt.substring(0, startLength);\n\t\t\t} else if (match.startsWith('{{prompt:end:')) {\n\t\t\t\treturn prompt.slice(-endLength);\n\t\t\t} else if (match.startsWith('{{prompt:middletruncate:')) {\n\t\t\t\tif (prompt.length <= middleLength) {\n\t\t\t\t\treturn prompt;\n\t\t\t\t}\n\t\t\t\tconst start = prompt.slice(0, Math.ceil(middleLength / 2));\n\t\t\t\tconst end = prompt.slice(-Math.floor(middleLength / 2));\n\t\t\t\treturn `${start}...${end}`;\n\t\t\t}\n\t\t\treturn '';\n\t\t}\n\t);\n\n\ttemplate = promptTemplate(template);\n\n\treturn template;\n};\n\nexport const approximateToHumanReadable = (nanoseconds: number) => {\n\tconst seconds = Math.floor((nanoseconds / 1e9) % 60);\n\tconst minutes = Math.floor((nanoseconds / 6e10) % 60);\n\tconst hours = Math.floor((nanoseconds / 3.6e12) % 24);\n\n\tconst results: string[] = [];\n\n\tif (seconds >= 0) {\n\t\tresults.push(`${seconds}s`);\n\t}\n\n\tif (minutes > 0) {\n\t\tresults.push(`${minutes}m`);\n\t}\n\n\tif (hours > 0) {\n\t\tresults.push(`${hours}h`);\n\t}\n\n\treturn results.reverse().join(' ');\n};\n\nexport const getTimeRange = (timestamp) => {\n\tconst now = new Date();\n\tconst date = new Date(timestamp * 1000); // Convert Unix timestamp to milliseconds\n\n\t// Calculate the difference in milliseconds\n\tconst diffTime = now.getTime() - date.getTime();\n\tconst diffDays = diffTime / (1000 * 3600 * 24);\n\n\tconst nowDate = now.getDate();\n\tconst nowMonth = now.getMonth();\n\tconst nowYear = now.getFullYear();\n\n\tconst dateDate = date.getDate();\n\tconst dateMonth = date.getMonth();\n\tconst dateYear = date.getFullYear();\n\n\tif (nowYear === dateYear && nowMonth === dateMonth && nowDate === dateDate) {\n\t\treturn 'Today';\n\t} else if (nowYear === dateYear && nowMonth === dateMonth && nowDate - dateDate === 1) {\n\t\treturn 'Yesterday';\n\t} else if (diffDays <= 7) {\n\t\treturn 'Previous 7 days';\n\t} else if (diffDays <= 30) {\n\t\treturn 'Previous 30 days';\n\t} else if (nowYear === dateYear) {\n\t\treturn date.toLocaleString('default', { month: 'long' });\n\t} else {\n\t\treturn date.getFullYear().toString();\n\t}\n};\n"],"names":["sanitizeResponseContent","content","revertSanitizedResponseContent","splitStream","splitOn","buffer","chunk","controller","parts","part","convertMessagesToHistory","messages","history","parentMessageId","messageId","message","uuidv4","canvasPixelTest","canvas","ctx","imageData","pixelValues","i","p","generateInitialsImage","name","sanitizedName","initials","copyToClipboard","text","result","textArea","msg","err","error","compareVersion","latest","current","findWordIndices","regex","matches","match","removeFirstHashWord","inputString","words","index","word","transformFileName","fileName","getImportOrigin","_chats","getUserPosition","raw","position","resolve","reject","latitude","longitude","convertOpenAIMessages","convo","mapping","currentId","lastId","message_id","_a","new_chat","_c","_b","_f","_e","_d","_h","_g","obj","validateChat","chat","convertOpenAIChats","chats","failed","isValidHttpUrl","string","url","removeEmojis","str","emojiRegex","extractSentences","sentence","extractSentencesForAudio","mergedTexts","currentText","lastIndex","previousText","blobToFile","blob","promptTemplate","template","user_name","user_location","currentDate","formattedDate","currentTime","approximateToHumanReadable","nanoseconds","seconds","minutes","hours","results","getTimeRange","timestamp","now","date","diffDays","nowDate","nowMonth","nowYear","dateDate","dateMonth","dateYear"],"mappings":"+2BAOa,MAAAA,EAA2BC,GAChCA,EACL,QAAQ,aAAc,EAAE,EACxB,QAAQ,eAAgB,EAAE,EAC1B,QAAQ,KAAM,EAAE,EAChB,WAAW,gBAAiB,GAAG,EAC/B,WAAW,IAAK,MAAM,EACtB,WAAW,IAAK,MAAM,EACtB,KAAK,EAGKC,EAAkCD,GACvCA,EAAQ,WAAW,OAAQ,GAAG,EAAE,WAAW,OAAQ,GAAG,EAOjDE,EAAeC,GAAY,CACvC,IAAIC,EAAS,GACb,OAAO,IAAI,gBAAgB,CAC1B,UAAUC,EAAOC,EAAY,CAClBF,GAAAC,EACJ,MAAAE,EAAQH,EAAO,MAAMD,CAAO,EAC5BI,EAAA,MAAM,EAAG,EAAE,EAAE,QAASC,GAASF,EAAW,QAAQE,CAAI,CAAC,EACpDJ,EAAAG,EAAMA,EAAM,OAAS,CAAC,CAChC,EACA,MAAMD,EAAY,CACbF,GAAQE,EAAW,QAAQF,CAAM,CACtC,CAAA,CACA,CACF,EAEaK,EAA4BC,GAAa,CACrD,MAAMC,EAAU,CACf,SAAU,CAAC,EACX,UAAW,IAAA,EAGZ,IAAIC,EAAkB,KAClBC,EAAY,KAEhB,UAAWC,KAAWJ,EACrBG,EAAYE,EAAO,EAEfH,IAAoB,OACfD,EAAA,SAASC,CAAe,EAAE,YAAc,CAC/C,GAAGD,EAAQ,SAASC,CAAe,EAAE,YACrCC,CAAA,GAIMF,EAAA,SAASE,CAAS,EAAI,CAC7B,GAAGC,EACH,GAAID,EACJ,SAAUD,EACV,YAAa,CAAC,CAAA,EAGGA,EAAAC,EAGnB,OAAAF,EAAQ,UAAYE,EACbF,CACR,EAeaK,EAAkB,IAAM,CAG9B,MAAAC,EAAS,SAAS,cAAc,QAAQ,EACxCC,EAAMD,EAAO,WAAW,IAAI,EAClCA,EAAO,OAAS,EAChBA,EAAO,MAAQ,EACf,MAAME,EAAY,IAAI,UAAUF,EAAO,MAAOA,EAAO,MAAM,EACrDG,EAAcD,EAAU,KAG9B,QAASE,EAAI,EAAGA,EAAIF,EAAU,KAAK,OAAQE,GAAK,EAC3CA,EAAI,IAAM,EACbD,EAAYC,CAAC,EAAI,KAAK,MAAM,IAAM,KAAK,QAAQ,EAE/CD,EAAYC,CAAC,EAAI,IAIfH,EAAA,aAAaC,EAAW,EAAG,CAAC,EAC1B,MAAAG,EAAIJ,EAAI,aAAa,EAAG,EAAGD,EAAO,MAAOA,EAAO,MAAM,EAAE,KAG9D,QAASI,EAAI,EAAGA,EAAIC,EAAE,OAAQD,GAAK,EAClC,GAAIC,EAAED,CAAC,IAAMD,EAAYC,CAAC,EACjB,eAAA,IACP,0DACAC,EAAED,CAAC,EACH,MACAA,EACA,YACAD,EAAYC,CAAC,CAAA,EAEd,QAAQ,IAAI,wDAAwD,EAC7D,GAIF,MAAA,EACR,EAEaE,EAAyBC,GAAS,CACxC,MAAAP,EAAS,SAAS,cAAc,QAAQ,EACxCC,EAAMD,EAAO,WAAW,IAAI,EAI9B,GAHJA,EAAO,MAAQ,IACfA,EAAO,OAAS,IAEZ,CAACD,IACI,eAAA,IACP,+FAAA,EAEM,YAGRE,EAAI,UAAY,UAChBA,EAAI,SAAS,EAAG,EAAGD,EAAO,MAAOA,EAAO,MAAM,EAE9CC,EAAI,UAAY,UAChBA,EAAI,KAAO,iBACXA,EAAI,UAAY,SAChBA,EAAI,aAAe,SAEb,MAAAO,EAAgBD,EAAK,OACrBE,EACLD,EAAc,OAAS,EACpBA,EAAc,CAAC,GACdA,EAAc,MAAM,GAAG,EAAE,OAAS,EACjCA,EAAcA,EAAc,YAAY,GAAG,EAAI,CAAC,EAChD,IACF,GAEA,OAAAP,EAAA,SAASQ,EAAS,cAAeT,EAAO,MAAQ,EAAGA,EAAO,OAAS,CAAC,EAEjEA,EAAO,WACf,EAEaU,EAAkB,MAAOC,GAAS,CAC9C,IAAIC,EAAS,GACT,GAAA,CAAC,UAAU,UAAW,CACnB,MAAAC,EAAW,SAAS,cAAc,UAAU,EAClDA,EAAS,MAAQF,EAGjBE,EAAS,MAAM,IAAM,IACrBA,EAAS,MAAM,KAAO,IACtBA,EAAS,MAAM,SAAW,QAEjB,SAAA,KAAK,YAAYA,CAAQ,EAClCA,EAAS,MAAM,EACfA,EAAS,OAAO,EAEZ,GAAA,CAEG,MAAAC,EADa,SAAS,YAAY,MAAM,EACrB,aAAe,eAChC,QAAA,IAAI,sCAAwCA,CAAG,EAC9CF,EAAA,SACDG,EAAK,CACL,QAAA,MAAM,iCAAkCA,CAAG,CACpD,CAES,gBAAA,KAAK,YAAYF,CAAQ,EAC3BD,CACR,CAEA,OAAAA,EAAS,MAAM,UAAU,UACvB,UAAUD,CAAI,EACd,KAAK,KACL,QAAQ,IAAI,6CAA6C,EAClD,GACP,EACA,MAAOK,IACC,QAAA,MAAM,+BAAgCA,CAAK,EAC5C,GACP,EAEKJ,CACR,EAEaK,EAAiB,CAACC,EAAQC,IAC/BA,IAAY,QAChB,GACAA,EAAQ,cAAcD,EAAQ,OAAW,CACzC,QAAS,GACT,YAAa,OACb,UAAW,OACV,CAAA,EAAI,EAGIE,EAAmBT,GAAS,CACxC,MAAMU,EAAQ,gBACRC,EAAU,CAAA,EACZ,IAAAC,EAEJ,MAAQA,EAAQF,EAAM,KAAKV,CAAI,KAAO,MACrCW,EAAQ,KAAK,CACZ,KAAMC,EAAM,CAAC,EACb,WAAYA,EAAM,MAClB,SAAUF,EAAM,UAAY,CAAA,CAC5B,EAGK,OAAAC,CACR,EAEaE,EAAuBC,GAAgB,CAE7C,MAAAC,EAAQD,EAAY,MAAM,GAAG,EAG7BE,EAAQD,EAAM,UAAWE,GAASA,EAAK,WAAW,GAAG,CAAC,EAG5D,OAAID,IAAU,IACPD,EAAA,OAAOC,EAAO,CAAC,EAIDD,EAAM,KAAK,GAAG,CAGpC,EAEaG,EAAqBC,GAEPA,EAAS,cAGS,QAAQ,WAAY,EAAE,EAG1B,QAAQ,OAAQ,GAAG,EAuC/CC,EAAmBC,GAE3B,YAAaA,EAAO,CAAC,EACjB,SAED,QAGKC,EAAkB,MAAOC,EAAM,KAAU,CAErD,MAAMC,EAAW,MAAM,IAAI,QAAQ,CAACC,EAASC,IAAW,CAC7C,UAAA,YAAY,mBAAmBD,EAASC,CAAM,CAAA,CACxD,EAAE,MAAOrB,GAAU,CACX,cAAA,MAAM,+BAAgCA,CAAK,EAC7CA,CAAA,CACN,EAED,GAAI,CAACmB,EACG,MAAA,yBAIR,KAAM,CAAE,SAAAG,EAAU,UAAAC,GAAcJ,EAAS,OAEzC,OAAID,EACI,CAAE,SAAAI,EAAU,UAAAC,GAEZ,GAAGD,EAAS,QAAQ,CAAC,CAAC,KAAKC,EAAU,QAAQ,CAAC,CAAC,cAExD,EAEMC,EAAyBC,GAAU,qBAElC,MAAAC,EAAUD,EAAM,QAChBhD,EAAW,CAAA,EACjB,IAAIkD,EAAY,GACZC,EAAS,KAEb,UAAWC,KAAcH,EAAS,CAC3B,MAAA7C,EAAU6C,EAAQG,CAAU,EACtBF,EAAAE,EACR,GAAA,CAEF,GAAApD,EAAS,QAAU,IAClBI,EAAQ,SAAc,QACrBiD,EAAAjD,EAAQ,QAAW,QAAW,QAA9B,YAAAiD,EAAyC,KAAM,IAC/CjD,EAAQ,QAAW,QAAW,MAAW,MAG3C,SACM,CACN,MAAMkD,EAAW,CAChB,GAAIF,EACJ,SAAUD,EACV,YAAa/C,EAAQ,UAAe,CAAC,EACrC,OAAMmD,GAAAC,EAAApD,EAAQ,UAAR,YAAAoD,EAAqB,SAArB,YAAAD,EAAiC,QAAY,OAAS,YAAc,OAC1E,UACCE,GAAAC,GAAAC,EAAAvD,EAAQ,UAAR,YAAAuD,EAAqB,UAArB,YAAAD,EAAkC,QAAlC,YAAAD,EAA6C,OAC7CG,GAAAC,EAAAzD,EAAQ,UAAR,YAAAyD,EAAqB,UAArB,YAAAD,EAAkC,OAClC,GACD,MAAO,gBACP,KAAM,GACN,QAAS,IAAA,EAEV5D,EAAS,KAAKsD,CAAQ,EACbH,EAAAD,CACV,QACQ3B,EAAO,CACf,QAAQ,IAAI,aAAcnB,EAAS;AAAA,QAAYmB,CAAK,CACrD,CACD,CAEA,MAAMtB,EAAU,CAAA,EAChB,OAAAD,EAAS,QAAS8D,GAAS7D,EAAQ6D,EAAI,EAAE,EAAIA,CAAI,EAEpC,CACZ,QAAS,CACR,UAAAZ,EACA,SAAUjD,CACX,EACA,OAAQ,CAAC,eAAe,EACxB,SAAAD,EACA,QAAS,CAAC,EACV,UAAWgD,EAAM,YACjB,MAAOA,EAAM,OAAY,UAAA,CAG3B,EAEMe,EAAgBC,GAAS,CAE9B,MAAMhE,EAAWgE,EAAK,SAelB,GAZAhE,EAAS,SAAW,GAKJA,EAASA,EAAS,OAAS,CAAC,EAChC,YAAY,SAAW,GAKlBA,EAAS,CAAC,EACd,WAAa,KACtB,MAAA,GAIR,UAAWI,KAAWJ,EACjB,GAAA,OAAOI,EAAQ,SAAY,SACvB,MAAA,GAIF,MAAA,EACR,EAEa6D,EAAsB1B,GAAW,CAE7C,MAAM2B,EAAQ,CAAA,EACd,IAAIC,EAAS,EACb,UAAWnB,KAAST,EAAQ,CACrB,MAAAyB,EAAOjB,EAAsBC,CAAK,EAEpCe,EAAaC,CAAI,EACpBE,EAAM,KAAK,CACV,GAAIlB,EAAM,GACV,QAAS,GACT,MAAOA,EAAM,MACb,KAAAgB,EACA,UAAWhB,EAAM,SAAW,CAC5B,EAEDmB,GAEF,CACQ,eAAA,IAAIA,EAAQ,qCAAqC,EAClDD,CACR,EAEaE,EAAkBC,GAAW,CACrC,IAAAC,EAEA,GAAA,CACGA,EAAA,IAAI,IAAID,CAAM,OACT,CACJ,MAAA,EACR,CAEA,OAAOC,EAAI,WAAa,SAAWA,EAAI,WAAa,QACrD,EAEaC,EAAgBC,GAAQ,CAEpC,MAAMC,EAAa,8EAGZ,OAAAD,EAAI,QAAQC,EAAY,EAAE,CAClC,EAEaC,EAAoBxD,GAEdA,EAAK,MAAM,WAAe,gBAAA,GAG1C,IAAKyD,GAAaJ,EAAaI,EAAS,MAAM,CAAC,EAC/C,OAAQA,GAAaA,IAAa,EAAE,EAG1BC,EAA4B1D,GACjCwD,EAAiBxD,CAAI,EAAE,OAAO,CAAC2D,EAAaC,IAAgB,CAC5D,MAAAC,EAAYF,EAAY,OAAS,EACvC,GAAIE,GAAa,EAAG,CACb,MAAAC,EAAeH,EAAYE,CAAS,EACxBC,EAAa,MAAM,KAAK,EAAE,OAC5B,EACHH,EAAAE,CAAS,EAAIC,EAAe,IAAMF,EAE9CD,EAAY,KAAKC,CAAW,CAC7B,MAEAD,EAAY,KAAKC,CAAW,EAEtB,OAAAD,CACR,EAAG,CAAE,CAAA,EAGOI,EAAa,CAACC,EAAM7C,IAEnB,IAAI,KAAK,CAAC6C,CAAI,EAAG7C,EAAU,CAAE,KAAM6C,EAAK,IAAA,CAAM,EAQ/CC,EAAiB,CAC7BC,EACAC,EACAC,IACY,CAEN,MAAAC,MAAkB,KAGlBC,EACLD,EAAY,cACZ,IACA,OAAOA,EAAY,WAAa,CAAC,EAAE,SAAS,EAAG,GAAG,EAClD,IACA,OAAOA,EAAY,QAAS,CAAA,EAAE,SAAS,EAAG,GAAG,EAGxCE,EAAcF,EAAY,mBAAmB,QAAS,CAC3D,KAAM,UACN,OAAQ,UACR,OAAQ,UACR,OAAQ,EAAA,CACR,EAGD,OAAAH,EAAWA,EAAS,QAAQ,uBAAwB,GAAGI,CAAa,IAAIC,CAAW,EAAE,EAG1EL,EAAAA,EAAS,QAAQ,mBAAoBI,CAAa,EAGlDJ,EAAAA,EAAS,QAAQ,mBAAoBK,CAAW,EAEvDJ,IAEQD,EAAAA,EAAS,QAAQ,gBAAiBC,CAAS,GAGnDC,IAEQF,EAAAA,EAAS,QAAQ,oBAAqBE,CAAa,GAGxDF,CACR,EAyCaM,EAA8BC,GAAwB,CAClE,MAAMC,EAAU,KAAK,MAAOD,EAAc,IAAO,EAAE,EAC7CE,EAAU,KAAK,MAAOF,EAAc,KAAQ,EAAE,EAC9CG,EAAQ,KAAK,MAAOH,EAAc,MAAU,EAAE,EAE9CI,EAAoB,CAAA,EAE1B,OAAIH,GAAW,GACNG,EAAA,KAAK,GAAGH,CAAO,GAAG,EAGvBC,EAAU,GACLE,EAAA,KAAK,GAAGF,CAAO,GAAG,EAGvBC,EAAQ,GACHC,EAAA,KAAK,GAAGD,CAAK,GAAG,EAGlBC,EAAQ,QAAA,EAAU,KAAK,GAAG,CAClC,EAEaC,EAAgBC,GAAc,CACpC,MAAAC,MAAU,KACVC,EAAO,IAAI,KAAKF,EAAY,GAAI,EAIhCG,GADWF,EAAI,QAAQ,EAAIC,EAAK,QAAQ,IACjB,IAAO,KAAO,IAErCE,EAAUH,EAAI,UACdI,EAAWJ,EAAI,WACfK,EAAUL,EAAI,cAEdM,EAAWL,EAAK,UAChBM,EAAYN,EAAK,WACjBO,EAAWP,EAAK,cAEtB,OAAII,IAAYG,GAAYJ,IAAaG,GAAaJ,IAAYG,EAC1D,QACGD,IAAYG,GAAYJ,IAAaG,GAAaJ,EAAUG,IAAa,EAC5E,YACGJ,GAAY,EACf,kBACGA,GAAY,GACf,mBACGG,IAAYG,EACfP,EAAK,eAAe,UAAW,CAAE,MAAO,OAAQ,EAEhDA,EAAK,cAAc,UAE5B"}